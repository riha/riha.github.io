<?xml version="1.0" encoding="utf-8" ?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title>Gobbledygooks</title>
  <link href="http://richardhallgren.com/feed" rel="self" type="application/atom+xml" />
  <link href="http://richardhallgren.com/" type="text/html" rel="alternate" />
  <updated>2024-03-08T12:48:06+00:00</updated>
  <id>http://richardhallgren.com/</id>
  <author>
    <name>Richard</name>
    <email>richard.hallgren@gmail.com</email>
  </author>

  
  <entry>
    <title>How to document an integration architecture</title>
    <link href="http://richardhallgren.com/how-to-document-an-integration-architecture" />
    <updated>2024-03-08T09:00:00+00:00</updated>
    <id>http://richardhallgren.com/how-to-document-an-integration-architecture</id>
    <content type="html">&lt;p&gt;One could argue that creating good documentation for an integration solution is harder than with other types of software projects. The reason is that integration solutions almost always span over many systems and services and that we often talk about &lt;em&gt;hundreds&lt;/em&gt; of integrations, touching almost every part of your architecture.&lt;/p&gt;

&lt;p&gt;Keeping track of such a complex system is littery &lt;em&gt;impossible&lt;/em&gt; without the right documentation. 🤯&lt;/p&gt;

&lt;figure&gt;
  &lt;img src=&quot;../assets/massive-interconnect.jpg&quot; alt=&quot;&quot; /&gt;
  &lt;figcaption&gt;An example of bad documentation ...&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h2 id=&quot;basic-principles-of-good-documentation-for-an-integration-architecture&quot;&gt;Basic principles of good documentation for an integration architecture&lt;/h2&gt;

&lt;h3 id=&quot;1-visualizations-and-diagrams-are-more-important-than-textual-documentation&quot;&gt;1. Visualizations and diagrams are more important than textual documentation.&lt;/h3&gt;

&lt;p&gt;Textual documentation has its place and is important. But when it comes to trying to describe complex scenarios, visualizations in the form of architectural diagrams are easier to quickly understand and therefore arguably the most important part of your documentation.&lt;/p&gt;

&lt;h3 id=&quot;2-focus-on-the-high-level-diagrams&quot;&gt;2. Focus on the high-level diagrams.&lt;/h3&gt;

&lt;p&gt;As developers, we’re good at documenting all the little technical details in our solutions. But many times we document things that we as developers then end up looking up in the live code and configurations. Focus on high-level documentation, the overall picture and how the different parts of your solutions relate to each other.&lt;/p&gt;

&lt;h3 id=&quot;3-make-it-readable-for-everyone&quot;&gt;3. Make it readable for everyone.&lt;/h3&gt;

&lt;p&gt;UML and complex notations are great - if you understand them fully. The &lt;a href=&quot;https://c4model.com&quot;&gt;C4 model&lt;/a&gt; formalized the idea of a much simpler notation, based on boxes and arrows - easier to understand and work with.&lt;/p&gt;

&lt;p&gt;Use a dead simple notation that everybody can write and read.&lt;/p&gt;

&lt;h3 id=&quot;4-make-it-useful-for-everyone&quot;&gt;4. Make it useful for everyone.&lt;/h3&gt;

&lt;p&gt;Besides a simple notation, the &lt;a href=&quot;https://c4model.com&quot;&gt;C4 model&lt;/a&gt; describes a few different diagrams with increasing levels of detail. Using different levels makes it possible to drill down from an overview into more detailed diagrams. Similar to zooming in and out of a digital map.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Utilizing the levels and the simple notation in the C4 model, diagrams can have &lt;em&gt;information useful for non-technical business users and *describe large parts of architecture without cluttering them down with too many details&lt;/em&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;the-c4-levels-in-an-integration-context&quot;&gt;The C4 levels in an integration context&lt;/h2&gt;

&lt;p&gt;Let’s look at the three levels that make up good integration documentation.&lt;/p&gt;

&lt;figure&gt;
  &lt;img src=&quot;../assets/levels.png&quot; alt=&quot;&quot; /&gt;
  &lt;figcaption&gt;C4 model diagrams on levels with increasing detail.&lt;/figcaption&gt;
&lt;/figure&gt;

&lt;h3 id=&quot;level-1-context---the-overall-picture&quot;&gt;Level 1 (Context) - The Overall picture&lt;/h3&gt;

&lt;p&gt;For quickly understanding an integration architecture the most important part of documentation is the high-level documentation. It shows all the systems and the data-flows between them. Not the nitty-gritty details, just what systems are involved and what data is transferred between them.&lt;/p&gt;

&lt;p&gt;In smaller architectures, it’s possible to describe all systems and data-flows in a single level 1 diagram. In large ones, we need to choose a context to avoid too large and hard-to-read diagrams. In this example, the context is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;e-Commerce&lt;/code&gt; part of the architecture.&lt;/p&gt;

&lt;figure&gt;
  &lt;img src=&quot;../assets/revision-level-1.png&quot; alt=&quot;Image description&quot; /&gt;
  &lt;figcaption&gt;Level 1, Overall Picture example - &lt;a href=&quot;https://my.revision.app/diagram/6idZKQTeD8C9&quot;&gt;https://my.revision.app/diagram/6idZKQTeD8C9&lt;/a&gt; &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;It’s important to keep these diagrams as simple as possible. It’s often tempting to include more details than necessary. Try to skip everything besides concrete systems and what type of data that’s transferred. The reason for this is that these diagrams otherwise get too complicated, hard to work with and hard to understand.&lt;/p&gt;

&lt;p&gt;This part of the documentation is &lt;em&gt;important&lt;/em&gt;. This is information that often is hard to understand by looking at the code and configuration.&lt;/p&gt;

&lt;p&gt;This is also the part of the documentation that business users will understand. As we all know, getting the business users involved is critical for making the right decisions and in the end creating solutions that actually help the business in the right way.&lt;/p&gt;

&lt;p&gt;Even though most people would agree that the overall picture is important to have documented, I’ve found that this is the part most developers tend to skip.&lt;/p&gt;

&lt;h3 id=&quot;level-2-container---the-integration-processes&quot;&gt;Level 2 (Container) - The Integration Processes&lt;/h3&gt;

&lt;p&gt;It’s hard to define an integration. In the overall picture product data are moved between several systems. Is the integration the part that moves the products between &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;InRiver PIM&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dynamics 365 PO&lt;/code&gt;? Or is the integration the overall process that makes sure the products end up in all the destination systems?&lt;/p&gt;

&lt;p&gt;Leaving that discussion aside we can agree that the purpose of an integration is to support some sort of business process. In this case, the handling of product master data.&lt;/p&gt;

&lt;p&gt;Documenting how we support a business process is the second level of diagrams.&lt;/p&gt;

&lt;p&gt;The difference between this and the level 1 diagram is that we’ll zoom in to a specific area and that we’ll here include more details - things that we didn’t want to include in the overall picture to keep it easy to understand. In the example, we’re showing that product master data actually is distributed using a product service. We’re also including other details we didn’t show in the level 1 diagram.&lt;/p&gt;

&lt;figure&gt;
  &lt;img src=&quot;../assets/revision-level-2.png&quot; alt=&quot;&quot; /&gt;
  &lt;figcaption&gt;Level 2, Integration Process example - &lt;a href=&quot;https://my.revision.app/diagram/bwoG8AXEhhxD&quot;&gt;https://my.revision.app/diagram/bwoG8AXEhhxD&lt;/a&gt;. Shows how product master data flows between systems. &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;Again this is information that is hard to get from reading code and configuration and that is important for getting the business users to understand what we’re actually building.&lt;/p&gt;

&lt;p&gt;It’s important to try and keep purely technical details out of this diagram and try and focus on more business rules like information. Information that is useful for a business user.&lt;/p&gt;

&lt;p&gt;Example of information we might include on level 2;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;what’s triggering the transfer&lt;/li&gt;
  &lt;li&gt;duplication checks&lt;/li&gt;
  &lt;li&gt;conversions&lt;/li&gt;
  &lt;li&gt;transformations of data, and so on&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;level-3---the-integration-details&quot;&gt;Level 3 - The Integration Details&lt;/h3&gt;

&lt;p&gt;This is probably the diagram that needs the least explanation. This is the part I often find well-documented and maintained. Here we document all the technical components and implementation details.&lt;/p&gt;

&lt;p&gt;This is however also the part that doesn’t always require that much documentation. Much of the details at this level can easily be found in code and configuration and it’s easy to spend time documenting things that in the end developers will look up code and configuration instead.&lt;/p&gt;

&lt;figure&gt;
  &lt;img src=&quot;../assets/revision-level-3.png&quot; alt=&quot;&quot; /&gt;
  &lt;figcaption&gt;Level 3, Integration Details example - &lt;a href=&quot;https://my.revision.app/diagram/RmXsxDtuAEHy&quot;&gt;https://my.revision.app/diagram/RmXsxDtuAEHy&lt;/a&gt;. Shows a detailed view of how product master data in moved between one system to another.&lt;/figcaption&gt;
&lt;/figure&gt;
</content>
  </entry>
  
  <entry>
    <title>Build and generate environment specific binding files for BizTalk Server using Team Foundation Build Services</title>
    <link href="http://richardhallgren.com/build-and-generate-environment-specific-binding-files-for-biztalk-server-using-team-foundation-build-services-copy" />
    <updated>2015-03-31T11:00:00+00:00</updated>
    <id>http://richardhallgren.com/build-and-generate-environment-specific-binding-files-for-biztalk-server-using-team-foundation-build-services copy</id>
    <content type="html">&lt;p&gt;As most know a BizTalk Solution has two major parts – its resources in form of dlls, and its configuration in form of bindings. 
In an &lt;a href=&quot;http://richardhallgren.com/build-and-generate-msi-for-biztalk-server-using-team-foundation-build-services/&quot;&gt;previous post&lt;/a&gt; 
I described how to build and pack &lt;em&gt;resources&lt;/em&gt; into an MSI using Team Foundation Server (TFS) Build Services. Managing the configuration in a similar way is equally important.
So let’s see how we can build environment specific binding files using TFS Build Services and some config transformations syntax goodness!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/3c4hz5v643v1p4z/5.png?raw=1&quot; alt=&quot;Workflow&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;creating-a-simple-binding-example-for-development-and-test-environment&quot;&gt;Creating a simple binding example for development and test environment&lt;/h2&gt;

&lt;p&gt;Let’s start with a simple example of a simple binding with a receive port, receive location and a 
send port for two different environments - one called “Test” and one “Production”.&lt;/p&gt;

&lt;table class=&quot;post&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;
    &lt;tr&gt;
        &lt;th&gt;Port type&lt;/th&gt;
        &lt;th&gt;Name&lt;/th&gt;
        &lt;th&gt;Destination path in Test&lt;/th&gt;
        &lt;th&gt;Destination path in Production&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;Receive Port&lt;/td&gt;
        &lt;td&gt;BtsSample_ReceivePort_A&lt;/td&gt;
        &lt;td&gt;N/A&lt;/td&gt;
        &lt;td&gt;N/A&lt;/td&gt;
    &lt;/tr&gt;
        &lt;tr&gt;
        &lt;td&gt;Receive Location&lt;/td&gt;
        &lt;td&gt;BtsSample_ReceivePort_A_Location (File)&lt;/td&gt;
        &lt;td&gt;C:\Temp\In\*.xml&lt;/td&gt;
        &lt;td&gt;C:\Temp\In\*.xml&lt;/td&gt;
    &lt;/tr&gt;
        &lt;tr&gt;
        &lt;td&gt;Send Port&lt;/td&gt;
        &lt;td&gt;BtsSample_SendPort_A (File)&lt;/td&gt;
        &lt;td&gt;C:\Temp\&lt;strong&gt;TEST&lt;/strong&gt;\Out\%MessageID%.xml&lt;/td&gt;
        &lt;td&gt;C:\Temp\&lt;strong&gt;PROD&lt;/strong&gt;\Out\%MessageID%.xml&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;As one can see there’s a small difference between the send ports destinations paths in Test and Production.&lt;/p&gt;

&lt;h2 id=&quot;exporting-a-binding-template&quot;&gt;Exporting a binding template&lt;/h2&gt;
&lt;p&gt;Next we’ll create a binding template. The binding template will hold all information that is shared between the different environments. 
This is achieved this by an ordinary export of the application binding from the BizTalk Administration Console - as you’ve probably done many times before.
&lt;script src=&quot;https://gist.github.com/riha/72a597136892e428cf92.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h2 id=&quot;creating-environment-specific-bindings-using-webconfig-transformation-syntax&quot;&gt;Creating environment specific bindings using web.config Transformation Syntax&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/dd465326.aspx&quot;&gt;Web.config Transformation Syntax&lt;/a&gt; is feature that showed up in Visual Studio 2010 and 
is often used to transform app.config and web.config files between different versions and environments – but it will of course work on any type 
of configuration file. Including BizTalk binding files!&lt;/p&gt;

&lt;p&gt;So for each environment we’ll then create an environment specific config file that only contains the values that differs between the template and 
the values for that environment. We use the Web.config Transformation Syntax to match the nodes and values that we like to update in the template.&lt;/p&gt;

&lt;p&gt;Below is the Test environment specific file matching the send port and replacing the value with the value specific for Test.
&lt;script src=&quot;https://gist.github.com/riha/9f9fb0d2ca57502bd6f5.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;The Production specific file also matches the send port but with a different value for the Destination path.
&lt;script src=&quot;https://gist.github.com/riha/bf86d3de83f48b910809.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h2 id=&quot;using-msbuild-to-execute-the-transformation&quot;&gt;Using MSBuild to execute the transformation&lt;/h2&gt;
&lt;p&gt;As part of the Visual Studio installation an MSBuild target is installed for executing the transform. 
The target is installed into the standard &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/ms164309.aspx&quot;&gt;MSBuild Extensions Path&lt;/a&gt; 
which usally mean something lilke &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v10.0\Web\Microsoft.Web.Publishing.targets&lt;/code&gt; 
depending a Visual Studio version etc.&lt;/p&gt;

&lt;p&gt;Finally we’ll add a small .proj file to pass some parameters to the MSBuild process. We need to tell the process what file to use as 
template and what different environment specific files we like to use.
&lt;script src=&quot;https://gist.github.com/riha/79c4dab8854b8db6c692.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;Next we can kick of MSBuild and point it to the cretated proj file. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild build.proj&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Voila! MSBuild has performed our transformation and created two complete environment specific binding file by combining the template with the specific environment files - one of test and one for production.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/i0lt7i3lu54uih5/2.png?raw=1&quot; alt=&quot;Two specific binding files&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;generating-the-file-using-tfs-build-services&quot;&gt;Generating the file using TFS Build Services&lt;/h2&gt;
&lt;p&gt;Start by setting up a TFS build definition as described in previous post on 
&lt;a href=&quot;http://richardhallgren.com/build-and-generate-msi-for-biztalk-server-using-team-foundation-build-services/&quot;&gt;Generating BizTalk MSI using TFS Build Services&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We then need to add the $(DestinationPath) property to our Destination path to make sure the outputted binding files are written to the same 
path as the rest of the resources.&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/riha/5213f920b22912fd1476.js&quot;&gt;&lt;/script&gt;

&lt;p&gt;Once we have our build template all that’s needed is to add the build.proj file to the files to compile as shown below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/o71ofgvt1f5ngay/3.png?raw=1&quot; alt=&quot;Adding a build file&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When finally running the build our two complete binding files are written to the deployment area and ready for installation!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/szlteu8h963o1z7/4.png?raw=1&quot; alt=&quot;Binding files in the deployment area&quot; /&gt;&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Build and generate MSI for BizTalk Server using Team Foundation Build Services</title>
    <link href="http://richardhallgren.com/build-and-generate-msi-for-biztalk-server-using-team-foundation-build-services" />
    <updated>2015-02-26T11:00:00+00:00</updated>
    <id>http://richardhallgren.com/build-and-generate-msi-for-biztalk-server-using-team-foundation-build-services</id>
    <content type="html">&lt;p&gt;Using a build server and leveraging continuous integration is good practice in any software 
development project. The idea behind automated build and continuous integrations is to have a server that 
monitors one’s source code repository and builds the solution as changes occur. This separate build 
activity alone will ensure that all artifacts are checked in and that a successful build doesn’t depend on any artifacts or settings on the development machines.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/jepbxxkn38ixy3e/1.png?raw=1&quot; alt=&quot;Build server&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Today build servers do a lot more as part of the build - the build process usually involves execution of 
tests, labeling the source as well as packing the solution into a deployable artifact.&lt;/p&gt;

&lt;p&gt;In this post we’ll see how a build process can be achieved using Team Foundation (TFS) Build Services, building a BizTalk project that results in 
a deployable MSI artifact.&lt;/p&gt;

&lt;h2 id=&quot;tfs-build-services&quot;&gt;TFS Build Services&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://msdn.microsoft.com/en-us/library/ee259687.aspx&quot;&gt;TFS Build services&lt;/a&gt; is a component that is part of the standard TFS install media. 
Each TFS build controller controls a number of “Build Agents” that will perform the actual build process. For each solution to build one has to 
define its process. These processes are described in a “Build Template” that tells the agent what steps to go through 
and in what order.&lt;/p&gt;

&lt;p&gt;“Build Templates” in TFS Build Services are defined using Visual Studio. The image below shows a build template accessed through Visual Studio Team Explorer.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/4n5dmiepn0bmrzb/2.png?raw=1&quot; alt=&quot;Visual Studio Team Explorer Build Templates&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;major-steps-in-a-build-template&quot;&gt;Major steps in a build template&lt;/h3&gt;
&lt;p&gt;As one creates a new build template for a solution one has to go through the following major steps:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1. Define a trigger&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Decides what should trigger the build. Should it be triggered manually, should it be a scheduled build or should it 
be triggered at a check-in of new code?&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2. Source Setting&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This will tell the build process what part of the source tree the build template is relevant for. When queueing 
a new build this is the part of the source tree that will be downloaded to the staging area. It also tells the build 
services where on disk the source should be downloaded to.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;3. Process&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This is where all the steps and activities that the build service should perform are defined. Team Foundation Build 
Services comes with a number of standard templates and custom ones can be added. In this post we’ll however stick with the default one.&lt;/p&gt;

&lt;h2 id=&quot;build-your-first-biztalk-solution&quot;&gt;Build your first BizTalk solution&lt;/h2&gt;

&lt;p&gt;Building BizTalk Server solution using TFS Build Services is straight forward.&lt;/p&gt;

&lt;p&gt;In this post I will use &lt;a href=&quot;https://github.com/riha/BtsMsiTask/tree/master/Sample&quot;&gt;this sample&lt;/a&gt; BizTalk solution. After checking it into Team 
Foundation Source Control (I’ll use TFS Source control in this post but it’ll work similarly using Git) I’ll create a new build template for the solution. All that’s 
needed to change is the MsBuild platform setting property, so we’re using x86 when executing MsBuild as shown below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/lgcnk72pqko72s2/3.png?raw=1&quot; alt=&quot;Build process and the MsBuild platform setting property&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After queuing a build we can in the TFS Build Explorer see a successful build!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/u5lpl4hw7h7jxjx/4.png?raw=1&quot; alt=&quot;Successful build in TFS Build Explorer&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can also download the output from the build where we can see all our build artifacts!
&lt;img src=&quot;https://www.dropbox.com/s/erx3twhocbelfyq/5.png?raw=1&quot; alt=&quot;First artifact drop&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;using-btsmsitask-to-create-a-msi-as-part-of-the-build&quot;&gt;Using BtsMsiTask to create a MSI as part of the build&lt;/h2&gt;
&lt;p&gt;So far so good, but we started the article by saying that what we wanted was a deployable artifact. In the case of 
BizTalk this means a BizTalk MSI. Let’s see what we need to change to also have the build process create a MSI.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1. Install BtsMsiTask&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Download and install &lt;a href=&quot;http://richardhallgren.com/BtsMsiTask/&quot;&gt;BtsMsiTask&lt;/a&gt;. This will install a MsBuild task for generating the MSI.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2. Add a MsBuild project file&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Add a MsBuild project file (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;build.proj&lt;/code&gt;) to the solution&lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/riha/24856902e68bae4ec244.js&quot;&gt;&lt;/script&gt;
&lt;p&gt;The project file will tell the BtsMsiTask process what artifacts to include. 
Add the created project file to the solution and check it in as part of the solution.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;3. Add the MsBuild project file to the TFS build template&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Add the created MsBuild project file to the TFS build template by adding it to the list of projects to build.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.dropbox.com/s/6avtnovpdkzo0ll/6.png?raw=1&quot; alt=&quot;Adding the build file to the build process&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After another successful build we can see that we also created a MSI as part of the build!
&lt;img src=&quot;https://www.dropbox.com/s/qtbd8pp552x9y6p/7.png?raw=1&quot; alt=&quot;Successful build with msi&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;adding-build-information-to-the-msi&quot;&gt;Adding build information to the MSI&lt;/h2&gt;
&lt;h3 id=&quot;file-name&quot;&gt;File name&lt;/h3&gt;
&lt;p&gt;As we can see the MSI we just created ended up with the default BtsMsiFile name that is a combination of the BizTalk application name property and the 
current date and time. Wouldn’t it be nice of we instead could the build number as part of the name?
BtsMsiTask has an &lt;a href=&quot;http://richardhallgren.com/BtsMsiTask/available-parameters/&quot;&gt;optional property&lt;/a&gt; called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FileName&lt;/code&gt; that we for 
example can set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;FileName&amp;gt;$(TF_BUILD_BUILDNUMBER).msi&amp;lt;/FileName&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;source-location&quot;&gt;Source location&lt;/h3&gt;
&lt;p&gt;When installing the artifact to BizTalk Server we can see that the source location property in the BizTalk Administration Console is set to 
where the artifact was built on the staging area. 
&lt;img src=&quot;https://www.dropbox.com/s/8c7usslwvijnj75/8.png?raw=1&quot; alt=&quot;Source Location without build number&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It’d be nice to also have information about what build that produced these artifacts. This will give the required information to know exactly what builds that are used for all the installed artifacts.&lt;/p&gt;

&lt;p&gt;We can change what is set in the source location by using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SourceLocation&lt;/code&gt; property of BtsMsiTask &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;SourceLocation&amp;gt;c:\$(TF_BUILD_BUILDNUMBER)&amp;lt;/SourceLocation&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;So after setting the property as below, queue another build, reinstall using the MSI and we’ll get the following result with the build number in the source location property.
&lt;img src=&quot;https://www.dropbox.com/s/fkjxfdyqyp7vf86/9.png?raw=1&quot; alt=&quot;Source Location with build number&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And finally this is the MsBuild project file we ended up with in our example. &lt;script src=&quot;https://gist.github.com/riha/dd8d7b4a1fed1bad3ca5.js&quot;&gt;&lt;/script&gt;&lt;/p&gt;

</content>
  </entry>
  
  <entry>
    <title>Calling an on premise Microsoft Dynamics CRM using BizTalk and Active Directory Federated Security (ADFS)</title>
    <link href="http://richardhallgren.com/calling-an-on-premise-microsoft-dynamics-crm-using-biztalk-and-active-directory-federated-security-(ADFS)" />
    <updated>2014-10-17T11:00:00+00:00</updated>
    <id>http://richardhallgren.com/calling-an-on-premise-microsoft-dynamics-crm-using-biztalk-and-active-directory-federated-security-(ADFS)</id>
    <content type="html">&lt;p&gt;Federated security is a great way of accomplishing single-sign-on (SSO) security for your applications. It’s also a technique that is becoming increasingly relevant as things move to the cloud and we’re starting to get more hybrid situation with some applications on premise and some in the cloud.&lt;/p&gt;

&lt;p&gt;Active Directory Federated Security (ADFS) is an implementation of federated security and is used by a number of Microsoft Applications, Microsoft Dynamics CRM being one of them.&lt;/p&gt;

&lt;p&gt;Windows Communication Foundation (WCF) has a few techniques to simplify federated security communication and this post will show an example of using Microsoft BizTalk Server and WCF to communicate with an ADFS secured CRM installation.&lt;/p&gt;

&lt;h2 id=&quot;what-is-federated-security&quot;&gt;What is federated security?&lt;/h2&gt;
&lt;p&gt;Federated security at its core is pretty simple. In our scenario BizTalk Server (client) wants to login in and authenticate itself with the CRM system.&lt;/p&gt;

&lt;p&gt;Traditionally the CRM system then had to manage the credentials for the client and verify these as login happened. There a number of drawback to this, the main one being that it doesn’t scale that well when we’re getting many separated systems that need access to each other as login information and login logic is spreads out across a number of systems.&lt;/p&gt;

&lt;p&gt;When using federated security each part instead chooses to trust a common part (in this case the ADFS and AD), and as long as someone provide a token that can be validated with the trusted part, the CRM system will trust that it already has been authenticated and that everything is ok.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677004/35ce5cea-55e2-11e4-8283-91f8158ffbb2.png&quot; alt=&quot;Data flow&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Authentication and requesting token&lt;/li&gt;
  &lt;li&gt;Authentication against AD&lt;/li&gt;
  &lt;li&gt;Login authenticated&lt;/li&gt;
  &lt;li&gt;ADFS token response&lt;/li&gt;
  &lt;li&gt;ADFS token based authentication&lt;/li&gt;
  &lt;li&gt;Response from CRM&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;So basically a federated security model allows for separating all authentication and authorization out to a separate system.&lt;/p&gt;

&lt;p&gt;As mentioned ADFS is just an implementation of federated security were Active Directory acts as the main repository with a Security Token Service implementation on top of it.&lt;/p&gt;

&lt;h2 id=&quot;biztalk-and-adfs&quot;&gt;BizTalk and ADFS&lt;/h2&gt;
&lt;p&gt;As BizTalk has great WCF support we can use the WCF stack to handle all of communication with ADFS and CRM. But it does involve a fair bit of configuration. BizTalk and Visual Studio will help in most mainstream WCF scenario where one can point Visual Studio at the WSDL location and a basic binding file is generated for us. However, in the case of and ADFS based WSDL this will just result in an empty binding file that doesn’t help much.&lt;/p&gt;

&lt;p&gt;Lots of projects I’ve seen makes the decision at this point to use custom code and create a facade to solve authentication. As Microsoft Dynamics CRM comes with a nice SDK including a C# library to handle authentication is easy to understand how one would end up using that. The problem is however that this creates another code base that again needs to be maintained over time. One could also argue that using custom code that is called by BizTalk further complicates the overall solution and makes it harder to maintain.&lt;/p&gt;

&lt;p&gt;So let’s configure the authentication from scratch using Windows Communication Foundation.&lt;/p&gt;

&lt;h2 id=&quot;choosing-the-right-wcf-binding&quot;&gt;Choosing the right WCF binding&lt;/h2&gt;
&lt;p&gt;First thing to do is to choose the right WCF binding. Let’s create a WCF-Custom Static Solicit-Response send port and choose the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ws2007FederationHttpBinding&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4851310/55ef1c46-6071-11e4-95ad-fce44c84cf5a.png&quot; alt=&quot;Choose binding&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;adding-the-issuer&quot;&gt;Adding the Issuer&lt;/h2&gt;
&lt;p&gt;First thing we need to add is information on how to connect to the Issuer. The Issuer is the one issuing the ticket, in our case that’s the ADFS.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677021/615e582e-55e2-11e4-8a20-d412647a9a54.png&quot; alt=&quot;Issuer details&quot; /&gt;&lt;/p&gt;

&lt;p&gt;First we need to add information about the address of the Issuer. The WSDL tells us that the mex endpoint for the ADFS server is located at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://adfs20.xxx.yy/adfs/trust/mex&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677037/75a339c6-55e2-11e4-8bee-262b54497e53.png&quot; alt=&quot;Mex file&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Browsing the WSDL for the ADFS server shows a number of different endpoints. Which one to use depends on what kind of authentication being used when requesting the token. In our case we’re using a simple username and password so we’re using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;usernamemixed&lt;/code&gt; endpoint (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://adfs20.xxx.yy/adfs/services/trust/2005/usernamemixed&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;Secondly we need to add information about the binding and the binding configuration for communication with the ADFS service.&lt;/p&gt;

&lt;p&gt;What this basically means is that we need to add information to a second, or an inner, binding configuration. The BizTalk Server WCF configuration GUI doesn’t provide a way to set this so the only way is to configure this is to use one of the relevant configuration files (“machine.config” or the BizTalk config) and ad a binding manually.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;bindings&amp;gt;
 &amp;lt;ws2007HttpBinding&amp;gt;
  &amp;lt;clear/&amp;gt;
  &amp;lt;binding name=&quot;stsBinding&quot;&amp;gt;
   &amp;lt;security mode=&quot;TransportWithMessageCredential&quot;&amp;gt;
    &amp;lt;transport clientCredentialType=&quot;None&quot;/&amp;gt;
    &amp;lt;message clientCredentialType=&quot;UserName&quot; establishSecurityContext=&quot;false&quot;/&amp;gt;
   &amp;lt;/security&amp;gt;
  &amp;lt;/binding&amp;gt;
 &amp;lt;/ws2007HttpBinding&amp;gt;
&amp;lt;/bindings&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once this is setup we can point our BizTalk Server WCF configuration to the correct URL and reference the WCF inner binding we just configured.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677048/8771fe58-55e2-11e4-9fb8-cdaea394039a.png&quot; alt=&quot;Issuer configured&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Finally we need to provide the username and password to authenticate ourselves to the ADFS server.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677053/980b0d04-55e2-11e4-97d4-2c3a9befb553.png&quot; alt=&quot;Login details&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We now have communication setup to the ADFS service and should be able to get a valid ticket that we then can use to authenticate ourselves to the CRM system!&lt;/p&gt;

&lt;p&gt;We now however also need to provide information on how to connect to the actual CRM system.&lt;/p&gt;

&lt;h2 id=&quot;configure-communication-to-crm&quot;&gt;Configure communication to CRM&lt;/h2&gt;

&lt;p&gt;The rest is easy. Let’s start with adding the URL to the end service we want to call. As with any other service call we’ll also add the SOAP Action Header that in this case is the Update service (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/Update&lt;/code&gt;) of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OrganizationService&lt;/code&gt; service.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677061/a975aab8-55e2-11e4-9727-1ffbd12e5132.png&quot; alt=&quot;Service details&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As out service also uses SSL for encryption we need to tell the binding to use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TransportWithMessageCredentials&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677066/bab52f7e-55e2-11e4-8c17-5c93dde94637.png&quot; alt=&quot;Transport encryption&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;establishing-a-security-context--or-not&quot;&gt;Establishing a Security Context – or not&lt;/h2&gt;

&lt;p&gt;Finally there is a little tweak that is needed. WCF supports establishing a Security Context. This will cache the token and avoid asking the STS for a new token for each call to the CRM system. BizTalk Server however doesn’t seem to support this so we need to turn it off.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4677070/cc96a416-55e2-11e4-942a-851427e242ea.png&quot; alt=&quot;Security Context&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Understanding federated security is important and will become increasingly important as we move over to systems hosted in the cloud – federated security is the de facto authentication standard used by hosted systems in the cloud. Avoiding custom code and custom facades is a key factor in building maintainable large scale BizTalk based systems over time. BizTalk has great WCF support and taking full advantage of it is important to be able to build solutions that easy to oversee and possible to maintain not just by those familiar and comfortable in custom code.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Getting digital certificates right in BizTalk using a third party root certificate in combination with client certificate security and WCF BasicHttp</title>
    <link href="http://richardhallgren.com/getting-digital-certificates-right-in-biztalk-using-a-third-party-root-certificate-and-wcf-basichttp" />
    <updated>2014-08-28T22:00:00+00:00</updated>
    <id>http://richardhallgren.com/getting-digital-certificates-right-in-biztalk-using-a-third-party-root-certificate-and-wcf-basichttp</id>
    <content type="html">&lt;p&gt;Digital certificates and asymmetric security is notoriously hard to get right in a Windows environment. Getting it right in a &lt;em&gt;BizTalk context&lt;/em&gt; isn’t exactly easier.&lt;/p&gt;

&lt;p&gt;In this scenario a BizTalk Server act as a client and communicates with a service over https. The service also uses a client certificate for client authentication.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4082243/e3123c2e-2eef-11e4-9218-3ec8b31c041e.png&quot; alt=&quot;Flow&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;long-story-short&quot;&gt;Long story short&lt;/h2&gt;

&lt;p&gt;Third party root certificates always needs to be places under “Third-Party Root Certification Authorities” or directly under the “Trusted Root Certification Authorities” folder on Local Machine level in Windows. When however also configuring the “WCF-BasicHttp” adapter to also use client certificate authorization the BizTalk Administration console requires the thumbprint id of a specific server certificate (in addition to the client certificate thumbprint). This makes the runtime also look for the for the public certificates under “Trusted People” folder and &lt;strong&gt;causes an error if we don’t &lt;em&gt;also&lt;/em&gt; place it that folder.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;In the end this requires us to add the public root certificate in two different places.&lt;/p&gt;

&lt;h2 id=&quot;server-certificate&quot;&gt;Server certificate&lt;/h2&gt;

&lt;p&gt;Let’s start by getting the server certificate right.&lt;/p&gt;

&lt;p&gt;After configuring everything in BizTalk using a standard &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WCF-BasicHttp&lt;/code&gt; port and selecting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Transport&lt;/code&gt; security I encountered the following error message.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;A message sent to adapter “WCF-BasicHttp” on send port “SP1” with URI “https://skattjakt.cloudapp.net/Service1.svc” is suspended.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Error details: System.ServiceModel.Security.SecurityNegotiationException: Could not establish trust relationship for the SSL/TLS secure channel with authority ‘skattjakt.cloudapp.net’. —&amp;gt; System.Net.WebException: The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel. —&amp;gt; System.Security.Authentication.AuthenticationException: The remote certificate is invalid according to the validation procedure.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The error message is pretty straightforward: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Could not establish trust relationship for the SSL/TLS secure channel with authority&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The first thing that happens when trying to establish SSL channel is that a public server certificate is sent down the client for the client to use when encrypting further messages to the server. This certificate is validated so it hasn’t been revoked, that it’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Valid to&lt;/code&gt; date hasn’t passed, that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Issued to&lt;/code&gt; name actually matches the services domain and so on.&lt;/p&gt;

&lt;p&gt;But to be able to trust the information in the certificate it needs to be issued by someone we trust, a certificate authority (CA).&lt;/p&gt;

&lt;p&gt;If we take an example of a request to Google we actually don’t trust the information in the Google server certificate, neither do we trust the intermediate certificate they use to sign their public server certificate. The root certificate that issued the intermediary Google Certificate is however one of the preinstalled trusted certificate authorities in Windows.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4075616/ca0ada30-2eb1-11e4-86fa-a00a89d34559.png&quot; alt=&quot;Google&quot; /&gt;&lt;/p&gt;

&lt;p&gt;What authorities and certificates to trust is in Windows based on what certificates exists in the Certificate Store under the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Trusted Root Certificate Authorities&lt;/code&gt; folder.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4075860/ce641792-2eb4-11e4-8544-6a20e92ea9fe.png&quot; alt=&quot;ca&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In our case the service didn’t use a certificate from one of the trusted authorities but had based their certificate on a root certificate they created themselves.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4075933/8178a456-2eb5-11e4-8818-ca1b74fc66e2.png&quot; alt=&quot;ca2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Further the Certificate Manager in Windows has three different levels: “Local Machine”, “Service” and “Current User”. The top level is the “Local Machine” and certificates added on this level are available for all users. “Service” and “Current User” are more specific and only available for specific services and users. From a BizTalk perspective it’s important to place the certificate so it’s &lt;em&gt;accessible for the user running the BizTalk host instance&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;So after requesting the used root certificate and placing it in the trusted authorities folder for the Local Machine we’re able to successfully establish an SSL session!&lt;/p&gt;

&lt;h2 id=&quot;client-certificate&quot;&gt;Client certificate&lt;/h2&gt;

&lt;p&gt;As the server however required a client certificate for authorization I reconfigured the send port to use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Certificate&lt;/code&gt; as client credential type. &lt;br /&gt;
&lt;img src=&quot;https://cloud.githubusercontent.com/assets/1317734/4076354/713ca4c6-2eb9-11e4-8293-ed462b550fdc.png&quot; alt=&quot;3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The BizTalk Administration Console then requires one to enter the thumbprint of the private client certificate to use. When browsing for picking the client certificate the console will look for certificates to choose from in the “Personal” folder on the “Current User” level. So for the certificate to show up one has to add the client certificate to the “Personal” folder running as the user that eventually will hit the browse button in the console. Adding it only to the “Personal” folder of “Local Machine” will not make it show up in the console. As the “Current User” level also is separate for each user it’s very important to add it to the “Personal” folder for the user that eventually will run the BizTalk process as this user otherwise won’t find the certificate at runtime. In this case just pasting the thumbprint id from the certificate will work fine.&lt;/p&gt;

&lt;p&gt;When selecting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Certificate&lt;/code&gt; client credential type the BizTalk Administration console also requires one to pick what public server certificate to use - even though we still just want to use the same root certificate as just added to the trusted store on machine level ..? When locating server certificates to display the console will look in the “Other People” folder on “Local Computer” level. So for making our root certificate show up in the console we also have to this to this folder. It turns however out that when having a pinpointed specific server certificate &lt;strong&gt;the BizTalk runtime will throw an error if the server certificate is not placed in the “Other People” folder&lt;/strong&gt;. Likewise will an error we be &lt;strong&gt;thrown if the certificate is placed only in one of the trusted authorities folders&lt;/strong&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;A message sent to adapter “WCF-BasicHttp” on send port “SP1” with URI “https://skattjakt.cloudapp.net:444/Service42.svc” is suspended. 
 Error details: System.InvalidOperationException: Cannot find the X.509 certificate using the following search criteria: StoreName ‘AddressBook’, StoreLocation ‘LocalMachine’, FindType ‘FindByThumbprint’, FindValue ‘70A9899E6CF89B014E6195ADE6E1BA12BEA58728’.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So in this case we need to add the public CA certificate in two different places for the communication to work.&lt;/p&gt;

&lt;p&gt;Frankly I don’t see the point of having to point out a server certificate at all in this case - all I want is to configure what client certificate to use for authorization and the runtime to validate the server certificate against all CA I have in the trusted folders.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Why full NuGet support for BizTalk projects is important!</title>
    <link href="http://richardhallgren.com/why-full-nuget-support-for-biztalk-projects-is-important" />
    <updated>2014-06-03T09:33:09+00:00</updated>
    <id>http://richardhallgren.com/why-full-nuget-support-for-biztalk-projects-is-important</id>
    <content type="html">&lt;p&gt;Let’s start with a summary for those who don’t feel like reading the full post.&lt;/p&gt;

&lt;p&gt;Using NuGet to handle BizTalk dependencies for shared schemas, pipeline components and so on works fine today.&lt;/p&gt;

&lt;p&gt;As .btproj files however aren’t supported by NuGet (as shown in &lt;a href=&quot;https://nuget.codeplex.com/SourceControl/network/forks/robinhultman/NuGetWithBizTalkProjectExtension/changeset/d1f1a29c9b322670c820f52d769422cb111253b3&quot;&gt;this pull request&lt;/a&gt;) and are not in the current white list of allowed project types &lt;em&gt;Package Restore will not work&lt;/em&gt; (issue closed as by design &lt;a href=&quot;https://nuget.codeplex.com/workitem/3010&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Not having Package Restore of course is a problem as one now is forced to check in all packages as part of the solutions, something that in the end leads to bloated and messy solutions.&lt;/p&gt;

&lt;p&gt;So please reach out to your Microsoft contacts and let’s get this fixed!&lt;/p&gt;

&lt;h3 id=&quot;nuget&quot;&gt;NuGet&lt;/h3&gt;

&lt;p&gt;As most people know NuGet is the package management solution from Microsoft for .NET. It started off as an initiative to further boost open source within the .NET community and NuGet packages uploaded to the &lt;a href=&quot;http://www.nuget.org/&quot;&gt;NuGet.org platform&lt;/a&gt; are open and available directly within Visual Studio through the NuGet add-in. Currently there are well over 20 000 open packages for everyone to download and use.&lt;/p&gt;

&lt;p&gt;Lately there has however been lots of discussions within the community to use NuGet as a package manager for &lt;em&gt;internal&lt;/em&gt; shared resources as well (by &lt;a href=&quot;http://www.hanselman.com/blog/NuGetForTheEnterpriseNuGetInAContinuousIntegrationAutomatedBuildSystem.aspx&quot;&gt;Hanselman&lt;/a&gt; and &lt;a href=&quot;https://www.simple-talk.com/dotnet/.net-framework/taking-nuget-to-the-enterprise/&quot;&gt;others&lt;/a&gt;). Solutions like &lt;a href=&quot;https://www.myget.org/&quot;&gt;MyGet&lt;/a&gt; allows for &lt;em&gt;private&lt;/em&gt; NuGet feeds – only available to those within your organization but still levering all the ease and control offered by NuGet.&lt;/p&gt;

&lt;p&gt;Using NuGet for references has a number of of advantages:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Communication&lt;/strong&gt;       &lt;br /&gt;
All available resources are directly visible in Visual Studio and when updates to a used library is a available a notification is shown. No more spam mails about changes and never read list of available libraries.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Versioning&lt;/strong&gt;       &lt;br /&gt;
A NuGet package has it’s own versioning. This is useful as it isn’t always optimal to change the dll version, but by using the NuGet package version one can still indicate that something has changed.       &lt;br /&gt;
As you also reference a specific version of a NuGet package from your solution you always have full control of &lt;em&gt;exactly&lt;/em&gt; what version you’re targeting and where to find the built and ready bits.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Efficiency&lt;/strong&gt;       &lt;br /&gt;
When starting to work on a project with many references one first have to get the source code from source control for the references, build these (hopefully in the right version … hopefully you have your tags and labels in order …) until all the broken references are fix.       &lt;br /&gt;
With NuGet references this just works straight away and you can be sure you get the right version as the resource isn’t the latest from source control but the actual built dlls that’s part of the referenced NuGet package.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;nuget-feeds&quot;&gt;NuGet Feeds&lt;/h4&gt;

&lt;p&gt;As mentioned NuGet feeds can be public or private. A NuGet feed is basically a RSS feed with available resources and versions of these. A feed and a NuGet server can be a hosted web based solution or something as simple as a folder where you write your NuGet packages to. The &lt;a href=&quot;http://docs.nuget.org/docs/creating-packages/hosting-your-own-nuget-feeds&quot;&gt;NuGet documentation&lt;/a&gt; covers these options in depth.     &lt;br /&gt;
The point being that creating your own private NuGet feed is very simple!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;So if you haven’t already realized it by now - NuGet is not only a great tool to manage all public external dependencies but can add a &lt;strong&gt;a lot a value for internal references&lt;/strong&gt; as well.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;couple-of-relevant-nuget-features&quot;&gt;Couple of relevant NuGet features&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;NuGet Package Restore&lt;/strong&gt;        &lt;br /&gt;
&lt;a href=&quot;http://docs.nuget.org/docs/reference/package-restore&quot;&gt;NuGet Package Restore&lt;/a&gt; enables NuGet to download the used referenced package from the package area. The goal is to avoid having to check in the actual references in source control as this will bloat the version control system and in the end the create a messy solution.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;NuGet Specification (nuspec) metadata token replacements&lt;/strong&gt;        &lt;br /&gt;
All packages are based on a nuspec file that dictates the version, package description and other meta information.       &lt;br /&gt;
NuGet has the capability to by using replacement tokens (such as &lt;em&gt;$version$&lt;/em&gt; for example) read some of this information from the &lt;em&gt;AssemblyInfo&lt;/em&gt; files.       &lt;br /&gt;
This is far from a critical feature but nice to have and avoid having to repeat oneself and have the same information in a number of places.**&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;biztalk-and-nuget&quot;&gt;BizTalk and NuGet?&lt;/h3&gt;

&lt;p&gt;A typical BizTalk solution has a number of shared resources such as shared schemas, shared libraries and pipeline components. As the resources usually are shared between a number of project they often live in a separate development cycle. So when opening a BizTalk project with such resources it’s not only a lot of work getting the referenced code and building the references, there’s also this nagging feeling that it _might not be in the right version _and that the source might have changed since the first time the reference was added.&lt;/p&gt;

&lt;p&gt;Another reference issue occurs when using a build server for a solution with references. As the solution has a dependency to the referenced project one has to make sure not only that the main solution is fetched to the build workarea by the build server, but also that all the referenced project are fetched from version control – and again, hopefully the latest version in the attended version …    &lt;br /&gt;
This kind of works using TFS Build Service and common TFS Source Control. If however one’s using Git and have resources in separate repositories this becomes impossible as TFS Build Service currently only supports fetching a single repository per build definition to the build workarea …     &lt;br /&gt;
(This issue does not apply for &lt;a href=&quot;http://www.jetbrains.com/teamcity/&quot;&gt;TeamCity&lt;/a&gt; that has a number of different options for dependency management)&lt;/p&gt;

&lt;p&gt;All the these issues are actually solved when using NuGet references instead of traditional references as we can be sure we’re getting the packaged dlls as part of the NuGet package &lt;em&gt;in the version that one referenced and not the latest checked in version&lt;/em&gt;.     &lt;br /&gt;
A NuGet reference also makes things a bit easier when it comes to managing the workarea for the TFS Build Service as one only have to sure the NuGet package is available (either as checked in as part of the solution or by using Package Restore).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;But …&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;nuget-doesnt-support-biztalk-projects&quot;&gt;NuGet doesn’t support BizTalk projects!&lt;/h3&gt;

&lt;p&gt;As disused &lt;a href=&quot;https://nuget.codeplex.com/workitem/3010&quot;&gt;here&lt;/a&gt; NuGet currently doesn’t support .btproj files. As BizTalk project files are are basically a standard .NET project file with some extra information a two line change in the NuGet whitelist is needed as in &lt;a href=&quot;https://nuget.codeplex.com/SourceControl/network/forks/robinhultman/NuGetWithBizTalkProjectExtension/contribution/5960#!/tab/changes&quot;&gt;this pull request&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/2014/06/nolove.png&quot; alt=&quot;nolove&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So the main issue it that by &lt;em&gt;not having full support of .btproj files Package Restore won’t work&lt;/em&gt; and we’re for now force to check in all the NuGet packages as part of our solutions.     &lt;br /&gt;
An other minor issue is that the token replacement feature also doesn’t work. I also think that if we could actually get full BizTalk support we’d see more BizTalk specific open shared packages for things like useful libraries and pipeline components.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;Call for action&lt;/em&gt;&lt;/strong&gt;: Reach out to &lt;a href=&quot;https://twitter.com/nuget&quot;&gt;the NuGet Team&lt;/a&gt; or other Microsoft connections and let’s get those two lines added to the white list!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Talking Application Lifecycle Management and BizTalk in Gothenburg</title>
    <link href="http://richardhallgren.com/presenting-on-application-lifecycle-management-and-biztalk-again" />
    <updated>2014-02-22T14:13:29+00:00</updated>
    <id>http://richardhallgren.com/presenting-on-application-lifecycle-management-and-biztalk-again</id>
    <content type="html">&lt;p&gt;&lt;a href=&quot;http://www.eventbrite.com/e/biztalk-alm-tickets-10211239091?aff=eorg&quot;&gt;Back in February&lt;/a&gt; I and my college Robin did an presentation on ALM and BizTalk for the BizTalk User Group in Stockholm. In the two hour presentation we talked about things like:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Pros and cons on distributed version control handling systems and BizTalk (more specially Git).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Identifying the right level of automated test – what are the differences between integration and unit tests and how and what should one use when in a BizTalk context.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Using NuGet and BizTalk to handle dependencies and packages. How can we use the NuGet infrastructure to handle all BizTalk dependencies and also distribute artifacts like pipeline components within our company and teams?&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;How, in our opinion, are Continuous Integration and Delivery best handled when developing with BizTalk. In the presentation we’re looking at everything from build servers to how to handle BizTalk automated builds and packing with minimal amount of work.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So, now we doing &lt;a href=&quot;http://www.eventbrite.com/e/biztalk-alm-goteborg-tickets-10693092327?aff=eorg&quot;&gt;the presentation all over again&lt;/a&gt; for the newly started BizTalk User Group in Gothenburg the 24 of Mars. The presentation will be in Swedish and packed with demos.&lt;/p&gt;

&lt;p&gt;Hope to see you there!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Export BizTalk Server MSI packages directly from Visual Studio using BtsMsiTask</title>
    <link href="http://richardhallgren.com/export-biztalk-server-msi-packages-directly-from-visual-studio-using-btsmsitask" />
    <updated>2014-01-14T10:42:25+00:00</updated>
    <id>http://richardhallgren.com/export-biztalk-server-msi-packages-directly-from-visual-studio-using-btsmsitask</id>
    <content type="html">&lt;p&gt;&lt;em&gt;Getting a full Continuous Integration (CI) process working with BizTalk Server is hard!&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;One of the big advantages in a working CI process is to always have tested and verified artifacts from the build server to deploy into test and production. Packaging these build resources into a deployable unit is however notorious hard in BizTalk Server as a Visual Studio build will not provide a deployable artifact (only raw dlls). The only way to get a deployable MSI package for BizTalk Server is to first install everything into the server and then export – until now.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;why-continuous-integration&quot;&gt;Why Continuous Integration?&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://martinfowler.com/articles/continuousIntegration.html&quot;&gt;Continuous Integration&lt;/a&gt; is a concept first described by Martin Fowler back in 2006. At its core its about team communication and fast feedback but also often leads to better quality software and more efficient processes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/2014/01/CI1.png&quot; alt=&quot;CI&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A CI process usually works something like the above picture.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;A developer checks in code to the source control server.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The build server detects that a check in has occurred, gets all the new code and initiates a new build while also running all the relevant unit tests.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The result from the build and the tests are sent back to the team of developers and provides them with a up to date view of the “health” in the project.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;If the build and all the test are successful the built and tested resources are written to a deploy area.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;As one can see the CI build server acts as another developer on the team but always builds everything on a fresh machine and bases everything on what is actually checked in to source control – guaranteeing that nothing is build using artifacts that for some reasons is not in source control or that some special setting etc is required to achieve a successful build.&lt;/p&gt;

&lt;p&gt;In step 4 above the CI server also writes everything to a deploy area. A golden rule for a CI workflow is to use artifacts and packages from this area for further deployment to test and production environments – and &lt;em&gt;never&lt;/em&gt; directly build and move artifacts from developer machines! &lt;br /&gt;
As all resources from each successful build is stored safely and labeled one automatically achieves versioning and the possibility to roll back to previous versions and packages if needed.&lt;/p&gt;

&lt;h2 id=&quot;what-is-the-problem-with-ci-and-biztalk&quot;&gt;What is the problem with CI and BizTalk?&lt;/h2&gt;

&lt;p&gt;It is important to have the build and feedback process as efficient as possible to enable frequent checkins and to catch possible errors and mistake directly. As mentioned it is equally as important that the resources are written to the deploy area are the ones used to deploy to test and production so one gets all the advantages with versioning and roll back possibilities etc.&lt;/p&gt;

&lt;p&gt;The problem with BizTalk Server is however that only building a project in Visual Studio does not gives us a deployable package (only raw dlls)!&lt;/p&gt;

&lt;p&gt;There are a number of different ways to get around this. One popular option is to automate the whole installation of the dlls generated in the build. This not only requires a whole lot of scripting and work, it also requires a full BizTalk Server installation on the build server. The automated process of installation also takes time and slows down the feedback loop back to development team. There are however great frameworks as for example the &lt;a href=&quot;http://biztalkdeployment.codeplex.com/&quot;&gt;BizTalk Deployment Framework&lt;/a&gt; to help with this (this solution of course also enables integration testing using &lt;a href=&quot;http://bizunit.codeplex.com/&quot;&gt;BizUnit&lt;/a&gt; and other framework).&lt;/p&gt;

&lt;p&gt;Some people would also argue that the whole script package and the raw dlls could be moved onto test and production and viewed on as a deployment package. But MSI is a powerful packaging tool and BizTalk Server has a number of specialized features around MSI. As MSI also is so simple and flexible it usually the preferred solution by IT operations.&lt;/p&gt;

&lt;p&gt;A final possibility is of course to directly add the resources one by one using BizTalk Server Administration console. In more complex solutions this however takes time and requires deeper knowledge into the solution as one manually has to know in what order the different resources should be added.&lt;/p&gt;

&lt;h2 id=&quot;another-option-in-btsmsitask&quot;&gt;Another option in BtsMsiTask&lt;/h2&gt;

&lt;p&gt;Another option is then to use &lt;a href=&quot;https://github.com/riha/BtsMsiTask&quot;&gt;BtsMsiTask&lt;/a&gt; to directly generate a BizTalk Server MSI from the Visual Studio build and MsBuild.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/2014/01/SimplerProcess1.png&quot; alt=&quot;SimplerProcess&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The BtsMsiTask uses same approach and tools as the MSI export process implemented into BizTalk Server but extracts it into a MSBuild task that can be directly executed as part of the build process.&lt;/p&gt;

&lt;p&gt;BtsMsiTask enables the CI server to generate a deployable MSI package directly from the Visual Studio based build &lt;em&gt;without&lt;/em&gt; having to first install into BizTalk Server!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Presenting on “Efficient system integration documentation” at BizTalk User Group Sweden</title>
    <link href="http://richardhallgren.com/presenting-on-efficient-system-integration-documentation-at-biztalk-user-group-sweden" />
    <updated>2012-10-14T20:02:45+00:00</updated>
    <id>http://richardhallgren.com/presenting-on-efficient-system-integration-documentation-at-biztalk-user-group-sweden</id>
    <content type="html">&lt;p&gt;I’ve talked a lot about efficient documentation previously on this blog, both when in comes to splitting the documentation up in different layers as &lt;a href=&quot;http://www.richardhallgren.com/using-biztalk-config-explorer-as-a-new-way-of-documenting-your-biztalk-solutions/&quot;&gt;here&lt;/a&gt;, but also in relation to tools BizTalk Documenter and &lt;a href=&quot;http://btswebdoc.com/&quot;&gt;BizTalk Web Documenter&lt;/a&gt; for automatically generation technical documentation as &lt;a href=&quot;http://www.richardhallgren.com/reborn-as-biztalk-web-documenter/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Last week I however had the pleasure to present on the BizTalk User Group Sweden meeting and got to talk all documentation for a whole hour! You can find the PPT from the meeting &lt;a href=&quot;http://biztalkusergroup.se/blogs/info/BUGS%20docs%20-%20Richard%20Hallgren.pptx&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I ended the presentation by presenting the ten commandments for efficient system integration documentation:&lt;/p&gt;

&lt;p&gt;&lt;img style=&quot;float: right;margin-top:20px;&quot; src=&quot;http://drbristol.files.wordpress.com/2010/10/10-commandments.gif&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;I.&lt;/strong&gt; Thou shall &lt;em&gt;not&lt;/em&gt; manually document anything that can be automatized!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;II.&lt;/strong&gt; Thou shall keep it &lt;em&gt;simple&lt;/em&gt; &amp;amp; make it &lt;em&gt;look nice&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;III.&lt;/strong&gt; Thou shall &lt;em&gt;use a wiki&lt;/em&gt; based platform&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;IV.&lt;/strong&gt; Thou shall &lt;em&gt;use pictures&lt;/em&gt; whenever appropriate&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;V.&lt;/strong&gt; Thou shall have &lt;em&gt;well defined guidelines&lt;/em&gt; for your documentation&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;VI.&lt;/strong&gt; Thou shall have a &lt;em&gt;well defined target audience&lt;/em&gt; for your documentation&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;VII.&lt;/strong&gt; Thou shall &lt;em&gt;document continuously&lt;/em&gt; in your project&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;VIII.&lt;/strong&gt; Thou shall have a &lt;em&gt;common vocabulary&lt;/em&gt; and common icons defined&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;IX.&lt;/strong&gt;Thou shall &lt;em&gt;test your documentation&lt;/em&gt; with target audience&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;X.&lt;/strong&gt; Thou as the &lt;em&gt;developer&lt;/em&gt; of an integration should &lt;em&gt;document it&lt;/em&gt;&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Reborn as BizTalk Web Documenter!</title>
    <link href="http://richardhallgren.com/reborn-as-biztalk-web-documenter" />
    <updated>2012-09-30T20:27:40+00:00</updated>
    <id>http://richardhallgren.com/reborn-as-biztalk-web-documenter</id>
    <content type="html">&lt;p&gt;About a year ago &lt;a href=&quot;http://www.richardhallgren.com/using-biztalk-config-explorer-as-a-new-way-of-documenting-your-biztalk-solutions/&quot;&gt;I published a project&lt;/a&gt; that helps automating documentation for BizTalk Server – much like &lt;a href=&quot;http://biztalk2010autodc.codeplex.com/&quot;&gt;BizTalk Documenter&lt;/a&gt; but with the difference that this tools instead generates a dynamic web site. I’ve called in Config Explorer, a name I knew was sh*t from the start but the best I could come up with at the time.&lt;/p&gt;

&lt;p&gt;After a while however, when enough people told me that they also thought the name was crap I decided to change it to &lt;a href=&quot;http://btswebdoc.com/&quot;&gt;BizTalk Web Documenter&lt;/a&gt;. I’ve also moved the whole &lt;a href=&quot;https://github.com/riha/btswebdoc&quot;&gt;project to GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I’ll try and spend a bit more time on the project than I have the last year and will update the &lt;a href=&quot;http://btswebdoc.com/&quot;&gt;documentation&lt;/a&gt;, wiki and roadmap as well as implement a few new features.&lt;/p&gt;

&lt;p&gt;I hope you’ll help me – fork the project today!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Using BizTalk Web Documenter as a new way of documenting your BizTalk solutions</title>
    <link href="http://richardhallgren.com/using-biztalk-config-explorer-as-a-new-way-of-documenting-your-biztalk-solutions" />
    <updated>2011-09-02T11:01:22+00:00</updated>
    <id>http://richardhallgren.com/using-biztalk-config-explorer-as-a-new-way-of-documenting-your-biztalk-solutions</id>
    <content type="html">&lt;blockquote&gt;
  &lt;p&gt;2012-09-30: I’ve renamed the whole project and moved it to &lt;a href=&quot;https://github.com/riha/btswebdoc&quot;&gt;GitHub&lt;/a&gt;. Hope to see you there!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As most BizTalk developers/architects you have probably been in a situation were documentation of your integration solution has been discussed. And you probably also been just as happy as me when you first found &lt;a href=&quot;http://biztalkdocumenter.codeplex.com/&quot;&gt;BizTalk Documenter&lt;/a&gt;. BizTalk Documenter is a great tool for extracting all that configuration data that is so vital to BizTalk and create a nice technical documentation of it.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;../assets/2011/09/documentation-levels.png&quot; alt=&quot;documentation levels&quot; /&gt;There are of course several levels to documentation in BizTalk Server based solution were the technical information is at the lowest level. Above that you would then have you integration process descriptions and then possible another level above that where you fit the integration processes into bigger business processes, and so on – but let’s stick to the technical documentation for now.&lt;/p&gt;

&lt;p&gt;BizTalk Documenter does a nice job of automating the creation of technical documentation, instead of basically having to all that configuration job a second time when documenting. Doing technical documentation by hand usually also breaks down after a while as solution setup and configuration changes a lot and the work is really time consuming. And as documentation that isn’t up to date frankly is completely worthless people soon looses interest in both reading and maintaining the technical documentation.&lt;/p&gt;

&lt;p&gt;Using BizTalk Documenter however has a few problems …&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;The tool generates either a &lt;a href=&quot;http://en.wikipedia.org/wiki/Microsoft_Compiled_HTML_Help&quot;&gt;CHM&lt;/a&gt; file or a word file with documentation. As more and more organizations however move their documentation online new output formats are needed.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The latest 3.4 versions of the tools throws OutOfMemory Exceptions on bigger solutions.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;biztalk-config-explorer-web-documenter&quot;&gt;BizTalk &lt;strike&gt;Config Explorer&lt;/strike&gt; Web Documenter&lt;/h3&gt;

&lt;p&gt;As we started trying to find ways to solve the issues above we had a few ideas we wanted the new solution to handle better.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Web based documentation&lt;/strong&gt;&lt;br /&gt;
A web based documentation is both much easier to distribute and more accessible to read – sending a link and reading a web page rather then sending around a CHM file.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Easy way of see changes in versions&lt;/strong&gt;&lt;br /&gt;
Sometimes one wants to see how things have changed and how things used to be configured. The tools should support “jumping back in time” and see previous versions.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;http://demo.configexplorer.com/&quot;&gt;&lt;img src=&quot;../assets/2011/09/config-explorer.png&quot; alt=&quot;config explorer&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Check out an an &lt;a href=&quot;http://btswebdoc.com/demo&quot;&gt;example&lt;/a&gt; of a Config Explorer yourself.&lt;/p&gt;

&lt;h3 id=&quot;getting-started&quot;&gt;Getting started&lt;/h3&gt;

&lt;p&gt;Config Explorer is a open source tool &lt;a href=&quot;https://github.com/riha/btswebdoc&quot;&gt;published&lt;/a&gt; on &lt;strike&gt;CodePlex GitHub&lt;/strike&gt; - a good place to start to understanding the workflow of creating documentation and to download the tool itself.&lt;/p&gt;

&lt;h3 id=&quot;contribute&quot;&gt;Contribute!&lt;/h3&gt;

&lt;p&gt;This release is a 1.0 release and there will are many features we haven’t had time for, but a few of them we’ve planned for future releases. Unfortunately there will however also be bugs and obvious things we’ve missed. Please use the &lt;strike&gt;CodePlex GutHub&lt;/strike&gt; &lt;a href=&quot;https://github.com/riha/btswebdoc/issues&quot;&gt;Issue Tracker&lt;/a&gt; to let us know what you like us to add and what possible issues you’ve found.&lt;/p&gt;

&lt;p&gt;I’ll of course also check for any comments here! &lt;a href=&quot;../assets/2011/09/wlEmoticon-winkingsmile.png&quot;&gt;Winking smile&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Update to BAM Service Generator</title>
    <link href="http://richardhallgren.com/update-to-bam-service-generator" />
    <updated>2011-06-03T05:58:29+00:00</updated>
    <id>http://richardhallgren.com/update-to-bam-service-generator</id>
    <content type="html">&lt;p&gt;I have previously &lt;a href=&quot;http://www.richardhallgren.com/end-to-end-tracking-using-bam-services-and-the-bam-service-generator-tool/&quot;&gt;written&lt;/a&gt; about how to generate a types set of WCF services to achieve end-to-end BAM based tracking – making BAM logging possible from outside potential firewalls and/or from non .NET based clients.&lt;/p&gt;

&lt;p&gt;In that post I reference a open source tool to generate the services based on the BAM definition files to be able to make types BAM API calls. I called the tool &lt;a href=&quot;http://bmsrvgen.codeplex.com/&quot;&gt;BAM Service Generator&lt;/a&gt; and it’s published on CodePlex.&lt;/p&gt;

&lt;p&gt;The first version of the tool only made it possible to make simple activity tracking calls, even missing the option to defining a custom activity id. All advanced scenarios like continuation, activity and data reference or even updating a activity wasn’t possible. That has now been fixed and the second version of the tool enables the following operations.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;LogCompleteActivity&lt;/strong&gt;       &lt;br /&gt;
Creates a simple logging line and is the most efficient option if one only want’s to begin, update and and end an activity logging as soon as possible.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;BeginActivity&lt;/strong&gt;       &lt;br /&gt;
Start a new activity with a custom activity id&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;UpdateActivity&lt;/strong&gt;       &lt;br /&gt;
Updates a already started activity and accepts a types object as a parameter. The typed object is of course based on what’s has been defined in the BAM definition file. Multiple updates can be made until EndActivity is called.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;EnableContinuation&lt;/strong&gt;       &lt;br /&gt;
Enables continuation. This is used if you have multiple activity loggings that belong together but you can not use the same activity id. This enables you to tie those related activities together using some other set of id (could for example be the invoice id).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;AddActivivityReference&lt;/strong&gt;       &lt;br /&gt;
Add a reference to an another activity and enables you to for example display a link or read that whole activity when reading the main one.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;AddReference&lt;/strong&gt;       &lt;br /&gt;
Adds a custom reference to something that isn’t necessarily an activity. Could for example be a link to a document of some sort. Limited to 1024 characters.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;AddLongReference&lt;/strong&gt;       &lt;br /&gt;
Similar to AddReference but enables to also store a blog of data using the LongRefernceData parameter – limited to 512 KB.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;EndActivity&lt;/strong&gt;       &lt;br /&gt;
Ends a started activity.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Let &lt;a href=&quot;mailto:richard.hallgren@gmail.com&quot;&gt;me know&lt;/a&gt; if you think that something is missing, if something isn’t working as would expect etc.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>End-to-end tracking using BAM services and the BAM Service Generator tool</title>
    <link href="http://richardhallgren.com/end-to-end-tracking-using-bam-services-and-the-bam-service-generator-tool" />
    <updated>2011-01-18T14:48:36+00:00</updated>
    <id>http://richardhallgren.com/end-to-end-tracking-using-bam-services-and-the-bam-service-generator-tool</id>
    <content type="html">&lt;p&gt;An integration between systems can often be view upon as a chain of system and services working together to move a message to its final destination.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2011/01/image5.png&quot;&gt;&lt;img src=&quot;../assets/2011/01/image_thumb5.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One problem with this loosely-coupled way of dealing with message transfers is that its hard to see if and where something has gone wrong. Usually all we know is that the sending system has send the message, but the final system never received it. The problem could then be within any of the components in between. Tracking messages within BizTalk is one thing but achieving a _end-to-end tracking _within the whole “chain” is much harder.&lt;/p&gt;

&lt;p&gt;One way of solving the end-to-end tracking problem is to use &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee253368(BTS.10).aspx&quot;&gt;BAM&lt;/a&gt;. BAM is optimized for these kind of scenarios were we might have to deal with huge amount of messages and data – several of the potential problems around these issues are solved out-of-the-box (write optimized tables, partitioning of tables, aggregated views, archiving jobs and so on).&lt;/p&gt;

&lt;p&gt;And even though BAM is a product that in theory isn’t tied to BizTalk its still a product that is easier to use in the context of BizTalk than outside of it due tools like the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee253776(v=bts.10).aspx&quot;&gt;BizTalk Tracking Profile Editor&lt;/a&gt; and the built in BAM-interceptor patterns within BizTalk. It is however fully possible to track BAM data and take advantage of the BAM infrastructure even outside of BizTalk using the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee277263(v=bts.10).aspx&quot;&gt;BAM API&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The BAM API is a .NET based API used for writing tracking data to the BAM infrastructure from any .NET based application. There are however a few issues with this approach.&lt;/p&gt;

&lt;p&gt;The application sending the tracking data has to be .NET based and use the loose string based API. So for example writing to the “ApprovedInvoice” activity below would look something like this – lots of untyped strings.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;public void Log(ApprovedInvoicesServiceType value) 
{ 
    string approvedInvoicesServiceActivityID = Guid.NewGuid().ToString();
    
    var es = new DirectEventStream(&quot;Integrated Security=SSPI;Data Source=.;Initial Catalog=BAMPrimaryImportw&quot;, 1);

    es.BeginActivity(&quot;ApprovedInvoices&quot;, approvedInvoicesServiceActivityID);

    es.UpdateActivity(&quot;ApprovedInvoices&quot;, approvedInvoicesServiceActivityID, 
        &quot;ApprovedDate&quot;, &quot;2011-01-18 12:02&quot;, 
        &quot;ApprovedBy&quot;, &quot;Richard&quot;, 
        &quot;Amount&quot;, 122.34, 
        &quot;InvoiceId&quot;, &quot;Invoic123&quot;);
 
    es.EndActivity(&quot;ApprovedInvoices&quot;, approvedInvoicesServiceActivityID); 
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One way of getting around problem with the usage of strings is to use the “&lt;a href=&quot;http://generatetypedbamapi.codeplex.com/&quot;&gt;Generate Typed BAM API tool&lt;/a&gt;”. The tool reads the BAM definition file and generates a dll containing strong types that corresponds to the fields in the definition. By referencing the dll in the sending application we can get a strong typed .NET call. The fact that this still however &lt;em&gt;requires a .NET based application&lt;/em&gt; remains.&lt;/p&gt;

&lt;p&gt;The obvious way to solve the limitation of a .NET based client - and to get one step closer to a end-to-end tracking scenario - is of course to wrap the call to the API in a service.&lt;/p&gt;

&lt;h3 id=&quot;bam-service-generator&quot;&gt;BAM Service Generator&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://bmsrvgen.codeplex.com/&quot;&gt;BAM Service Generator&lt;/a&gt; is very similar to the Generate Typed BAM API tool mentioned above with the difference that instead of generation a .NET dll it generates a WCF service for each activity.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;c:\Tools\bmsrvgen.exe /help 
	
BAM Service Generator Version 1.0 

Generates a WCF service based on a BizTalk BAM definition file.

 -defintionfile: Sets path to BAM definition file.
 -output: Sets path to output folder.
 -namespace: Sets namespace to use.

Example: bmsrvgen.exe -defintionfile:c:\MyFiles\MyActivityDef.xml 
-output:c:\tempservices -nampespace:MyCompanyNamespace
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;a href=&quot;http://bmsrvgen.codeplex.com/&quot;&gt;BAM Service Generator&lt;/a&gt; is a command line tool that will read the BAM definition file and generate a compiled .NET 4.0 WCF service. The service is configured with a default basicHttp endpoint and is ready to go straight into AppFabric or similar hosting.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2011/01/image7.png&quot;&gt;&lt;img src=&quot;../assets/2011/01/image_thumb7.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This service-approach makes it possible to take advantage of the BAM infrastructure from all different types of system, and even in cases when they aren’t behind the same firewall! As shown in figure below this could take us one step closer to the end-to-end tracking scenario.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2011/01/image8.png&quot;&gt;&lt;img src=&quot;../assets/2011/01/image_thumb8.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;“BAM Service Generator” is open-source and can be found &lt;a href=&quot;http://bmsrvgen.codeplex.com/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Promote properties in a EDI schema using the EDI Disassembler</title>
    <link href="http://richardhallgren.com/promote-properties-in-a-edi-schema-using-the-edi-disassembler" />
    <updated>2010-04-23T07:08:46+00:00</updated>
    <id>http://richardhallgren.com/promote-properties-in-a-edi-schema-using-the-edi-disassembler</id>
    <content type="html">&lt;p&gt;I’ve doing a lot of EDI related work in BizTalk lately and I have to say that I’ve really enjoyed it! EDI takes a while to get used to (see example below), but once one started to understand it I’ve found it to be a real nice, strict standard - with some cool features built into BizTalk!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;UNB+IATB:1+6XPPC+LHPPC+940101:0950+1&apos;
UNH+1+PAORES:93:1:IA&apos;
MSG+1:45&apos;
IFT+3+XYZCOMPANY AVAILABILITY&apos;
ERC+A7V:1:AMD&apos;
IFT+3+NO MORE FLIGHTS&apos;
ODI&apos;
TVL+240493:1000::1220+FRA+JFK+DL+400+C&apos;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are however some things that _doesn’t _work as expected …&lt;/p&gt;

&lt;h3 id=&quot;promoting-values&quot;&gt;Promoting values&lt;/h3&gt;

&lt;p&gt;According to the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/bb226404(BTS.20).aspx&quot;&gt;MSDN documentation&lt;/a&gt; the EDI Disassembler by default promotes the following EDI fields: UNB2.1, UNB2.3, UNB3.1, UNB11; UNG1, UNG2.1, UNG3.1; UNH2.1, UNH2.2, UNH2.3.&lt;/p&gt;

&lt;p&gt;There are however situation where one would like &lt;em&gt;other&lt;/em&gt; values promoted.&lt;/p&gt;

&lt;p&gt;I my case I wanted the C002/1001 value in the &lt;a href=&quot;http://www.stylusstudio.com/edifact/d04b/BGM_.htm&quot;&gt;BGM segment&lt;/a&gt;. This is a value identifying the purpose of the document and I needed to route the incoming message based on the value.&lt;/p&gt;

&lt;p&gt;The short version is that &lt;em&gt;creating a property schema, promoting the field in the schema and having the EDI Disassembler promoting the value &lt;strong&gt;will not work&lt;/strong&gt; (as with the XML Disassembler)&lt;/em&gt;. To do this you’ll need to use a custom pipeline component to promote the value. Rikard Alard seem to have come to the same conclusion &lt;a href=&quot;http://rikardalard.wordpress.com/2009/06/15/promoted-properties-in-edi-schema-is-not-promoted-by-edireceive/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;promote-pipeline-component-to-use&quot;&gt;Promote pipeline component to use&lt;/h3&gt;

&lt;p&gt;If you don’t want to spend time on writing your own pipeline component to do this yourself you can find a nice “promote component” on CodePlex &lt;a href=&quot;http://eebiztalkpipelinecom.codeplex.com/&quot;&gt;here&lt;/a&gt; by &lt;a href=&quot;http://blog.eliasen.dk&quot;&gt;Jan Eliasen&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If you however expect to receive lots and lots of big messages you might want to look into changing the component to use XPathReader and custom stream implementations in the Microsoft.BizTalk.Streaming.dll. You can find more detailed information on how to do that in this &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee377071(BTS.10).aspx&quot;&gt;MSDN article&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Use code blocks to extend your BizTalk custom XSLT maps</title>
    <link href="http://richardhallgren.com/use-code-blocks-to-extend-your-biztalk-custom-xslt-maps" />
    <updated>2010-04-12T07:38:47+00:00</updated>
    <id>http://richardhallgren.com/use-code-blocks-to-extend-your-biztalk-custom-xslt-maps</id>
    <content type="html">&lt;blockquote&gt;
  &lt;p&gt;Update 2010-04-13: Grant Samuels commented and made me aware of the fact that inline scripts might in some cases cause memory leaks. He has some further information &lt;a href=&quot;http://linderalex.blogspot.com/2008/06/memory-leak-using-biztalk-mapper.html&quot;&gt;here&lt;/a&gt; and you’ll find a kb-article &lt;a href=&quot;http://support.microsoft.com/kb/918643&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I’ve posted a few times before on how powerful I think it is in complex mapping to be able to replace the BizTalk Mapper with a custom XSLT script (&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa560154(BTS.20).aspx&quot;&gt;here’s how to&lt;/a&gt;). The BizTalk Mapper is nice and productive in simpler scenarios but in my experience it break down in more complex ones and maintaining a good overview is &lt;em&gt;hard&lt;/em&gt;. I’m however looking forward to the new version of the &lt;a href=&quot;http://www.microsoft.com/biztalk/en/us/roadmap.aspx#2009r2&quot;&gt;tool in BizTalk 2010&lt;/a&gt; – but until then I’m using custom XSLT when things gets complicated.&lt;/p&gt;

&lt;p&gt;Custom XSLT however lacks a few things once has gotten used to have - such as scripting blocks, clever functoids etc. In some previously post (&lt;a href=&quot;http://www.richardhallgren.com/how-the-extend-a-custom-xslt-in-biztalk-using-exslt-and-the-mvpxml-project/&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;http://www.richardhallgren.com/using-xslt-1-0-to-summarize-a-node-set-with-comma-separated-values/&quot;&gt;here&lt;/a&gt;) I’ve talked about using EXSLT as a way to extend the capabilities of custom XSLT when used in BizTalk.&lt;/p&gt;

&lt;h3 id=&quot;bye-bye-external-libraries--heeeello-inline-scripts-&quot;&gt;Bye, bye external libraries – heeeello inline scripts ;)&lt;/h3&gt;

&lt;p&gt;Another way to achieve much of the same functionality even easier is to use embedded scripting that’s supported by the XslTransform class. Using a script block in XSLT is easy and is also the way the BizTalk Mapper makes it possible to include C# snippets right into your maps.&lt;/p&gt;

&lt;p&gt;Have a look at the following XSLT sample:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;
&amp;lt;xsl:stylesheet
    version=&quot;1.0&quot;
    xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
    xmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot;
    xmlns:code=&quot;http://richardhallgren.com/Sample/XsltCode&quot;
    exclude-result-prefixes=&quot;msxsl code&quot;
    &amp;gt;
    &amp;lt;xsl:output method=&quot;xml&quot; indent=&quot;yes&quot;/&amp;gt;

    &amp;lt;xsl:template match=&quot;@* | node()&quot;&amp;gt;
        &amp;lt;Test&amp;gt;
            &amp;lt;UniqueNumber&amp;gt;
                &amp;lt;xsl:value-of select=&quot;code:GetUniqueId()&quot; /&amp;gt;
            &amp;lt;/UniqueNumber&amp;gt;
            &amp;lt;SpecialDateFormat&amp;gt;
                &amp;lt;xsl:value-of select=&quot;code:GetInternationalDateFormat(&apos;11/16/2003&apos;)&quot; /&amp;gt;
            &amp;lt;/SpecialDateFormat&amp;gt;
            &amp;lt;IncludesBizTalk&amp;gt;
                &amp;lt;xsl:value-of select=&quot;code:IncludesSpecialWord(&apos;This is a text with BizTalk in it&apos;, &apos;BizTalk&apos;)&quot; /&amp;gt;
            &amp;lt;/IncludesBizTalk&amp;gt;
        &amp;lt;/Test&amp;gt;
    &amp;lt;/xsl:template&amp;gt;

    &amp;lt;msxsl:script language=&quot;CSharp&quot; implements-prefix=&quot;code&quot;&amp;gt;
        //Gets a unique id based on a guid
        public string GetUniqueId()
        {
            return Guid.NewGuid().ToString();
        }

        //Formats US based dates to standard international
        public string GetInternationalDateFormat(String date)
        {
            return DateTime.Parse(date, new System.Globalization.CultureInfo(&quot;en-US&quot;)).ToString(&quot;yyyy-MM-dd&quot;);
        }

        //Use regular expression to look for a pattern in a string
        public bool IncludesSpecialWord(String s, String pattern)
        {
            Regex rx = new Regex(pattern);
            return rx.Match(s).Success;
        }
    &amp;lt;/msxsl:script&amp;gt;
&amp;lt;/xsl:stylesheet&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All one has to do is to define a code block, reference the xml-namespace used and start coding! Say goodbye to all those external library dlls!&lt;/p&gt;

&lt;p&gt;It’s possible to use a few core namespaces without the full .NET namespace path but all namespaces are available as long as they are fully qualified. MSDN has a great page with all the details &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/533texsx(VS.71).aspx&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Is there a bug in BizTalk 2006 R2 SP1?</title>
    <link href="http://richardhallgren.com/is-there-a-bug-in-biztalk-2006-r2-sp1" />
    <updated>2010-03-17T11:14:25+00:00</updated>
    <id>http://richardhallgren.com/is-there-a-bug-in-biztalk-2006-r2-sp1</id>
    <content type="html">&lt;blockquote&gt;
  &lt;p&gt;Update 2012-03-28: This bug was fixed in the CU2 update for BizTalk 2006 R2 SP 1. Further details can be found &lt;a href=&quot;http://support.microsoft.com/kb/2211420&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;http://support.microsoft.com/kb/983185&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Update 2010-04-12: Seems like there is a patch coming that should fix all the bugs in SP1 … I’ve been told it should be public within a week or two. I’ll make sure to update the post as I know more. Our problem is still unsolved.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Late Thursday night last week we decided to upgrade one of our largest BizTalk 2006 R2 environment to recently released &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee532481(BTS.20).aspx&quot;&gt;Service Pack 1&lt;/a&gt;. The installation went fine and everything looked good.&lt;/p&gt;

&lt;p&gt;… But after a while we started see loads of error messages looking like below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Unable to cast COM object of type &apos;System.__ComObject&apos; to interface type
&apos;Microsoft.BizTalk.PipelineOM.IInterceptor&apos;. This operation failed because the
QueryInterface call on the COM component for the interface with IID
&apos;{24394515-91A3-4CF7-96A6-0891C6FB1360}&apos; failed due to the following error: Interface not
registered (Exception from HRESULT: 0x80040155).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After lots of investigation we found out that we got the errors on ports with the follow criteria:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Send port&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Uses the SQL Server adapter&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Has a mapping on the port&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Has a BAM tracking profile associated with the port&lt;/strong&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In our environment the tracking on the port is on “SendDateTime” from the “Messaging Property Schema”. We haven’t looked further into if just any BAM tracking associated with port causes the error or if only has to do with some specific properties.&lt;/p&gt;

&lt;h3 id=&quot;reproduce-it-to-prove-it&quot;&gt;Reproduce it to prove it!&lt;/h3&gt;

&lt;p&gt;I’ve setup a really simple sample solution to reproduce the problem. &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/SP1Issue.zip&quot;&gt;&lt;strong&gt;Download it here&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The sample receives a XML file, maps it on the send port to schema made to match the store procedure. It also uses a dead simple tracking definition and profile to track a milestone on the send port.&lt;a href=&quot;../assets/2010/03/image.png&quot;&gt;&lt;img src=&quot;../assets/2010/03/image_thumb.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;sample-solution-installation-instructions&quot;&gt;Sample solution installation instructions&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Create a database called “Test”&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Run the two SQL scripts (“TBL_CreateIds.sql” and “SP_CreateAddID.sql”) in the solution to create the necessary table and store procedure&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Deploy the BizTalk solution just using simple deploy from Visual Studio&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Apply the binding file (“Binding.xml”) found in the solution&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Run the BM.exe tool to deploy the BAM tracking defintion.        &lt;br /&gt;
Should look something like:&lt;/p&gt;

    &lt;p&gt;bm.exe deploy-all -definitionfile:&lt;the path=&quot;&quot; to=&quot;&quot; the=&quot;&quot; solution=&quot;&quot;&gt;\BAM\SimpleTestTrackingDefinition.xml&lt;/the&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Start the tracking Profile editor and open the “SimpleTestTrackingProfile.btt“ that you’ll find in the solution and apply the profile&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Drop the test file in the receive folder (“InSchema_output.xml”)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The sample solution &lt;em&gt;fails on a environment with SP 1 but works just fine on a “clean” BizTalk 2006 R2 environment&lt;/em&gt;.&lt;/p&gt;

&lt;h3 id=&quot;what-about-you&quot;&gt;What about you?&lt;/h3&gt;

&lt;p&gt;I haven’t had time to test this on a BizTalk 2009 environment but I’ll update the post as soon as I get around to it.&lt;/p&gt;

&lt;p&gt;We also currently have a support case with Microsoft on this and I’ll make sure to let you as soon as something comes out of that. But until then I’d be &lt;strong&gt;_really grateful _&lt;/strong&gt;to hear from you if any of you have the same behavior in your BizTalk 2006 R2 SP1 environment.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Using XSLT 1.0 to summarize a node-set with comma separated values</title>
    <link href="http://richardhallgren.com/using-xslt-1-0-to-summarize-a-node-set-with-comma-separated-values" />
    <updated>2010-02-26T09:31:50+00:00</updated>
    <id>http://richardhallgren.com/using-xslt-1-0-to-summarize-a-node-set-with-comma-separated-values</id>
    <content type="html">&lt;p&gt;Pure XSLT is very powerful but it definitely has its weaknesses (I’ve written about how to extend XSLT using mapping and BizTalk previously &lt;a href=&quot;http://www.richardhallgren.com/how-the-extend-a-custom-xslt-in-biztalk-using-exslt-and-the-mvpxml-project/&quot;&gt;here&lt;/a&gt;) … One of those are handling numbers that uses a different decimal-separator than a point (“.”).&lt;/p&gt;

&lt;p&gt;Take for example the XML below&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Prices&amp;gt;
  &amp;lt;Price&amp;gt;10,1&amp;lt;/Price&amp;gt;
  &amp;lt;Price&amp;gt;10,2&amp;lt;/Price&amp;gt;
  &amp;lt;Price&amp;gt;10,3&amp;lt;/Price&amp;gt;
&amp;lt;/Prices&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Just using the &lt;a href=&quot;http://www.zvon.org/xxl/XSLTreference/Output/function_sum.html&quot;&gt;XSLT sum-function&lt;/a&gt; on these values will give us a “NaN” values. To solve it we’ll have to use recursion and something like in the sample below.&lt;/p&gt;

&lt;p&gt;The sample will select the node-set to summarize and send it to the “SummarizePrice” template. It will then add the value for the first Price tag of the by transforming the comma to a point. It will then check if it’s the last value and if not use recursion to call into itself again with the next value. It will  keep adding to the total amount until it reaches the last value of the node set.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;xsl:template match=&quot;Prices&quot;&amp;gt;
  &amp;lt;xsl:call-template name=&quot;SummurizePrice&quot;&amp;gt;
    &amp;lt;xsl:with-param name=&quot;nodes&quot; select=&quot;Price&quot; /&amp;gt;
  &amp;lt;/xsl:call-template&amp;gt;
&amp;lt;/xsl:template&amp;gt;

&amp;lt;xsl:template name=&quot;SummurizePrice&quot;&amp;gt;
  &amp;lt;xsl:param name=&quot;index&quot; select=&quot;1&quot; /&amp;gt;
  &amp;lt;xsl:param name=&quot;nodes&quot; /&amp;gt;
  &amp;lt;xsl:param name=&quot;totalPrice&quot; select=&quot;0&quot; /&amp;gt;

  &amp;lt;xsl:variable name=&quot;currentPrice&quot; select=&quot;translate($nodes[$index], &apos;,&apos;, &apos;.&apos;)&quot;/&amp;gt;

  &amp;lt;xsl:choose&amp;gt;
    &amp;lt;xsl:when test=&quot;$index=count($nodes)&quot;&amp;gt;
      &amp;lt;xsl:value-of select=&quot;$totalPrice + $currentPrice&quot;/&amp;gt;
    &amp;lt;/xsl:when&amp;gt;
    &amp;lt;xsl:otherwise&amp;gt;
      &amp;lt;xsl:call-template name=&quot;SummurizePrice&quot;&amp;gt;
        &amp;lt;xsl:with-param name=&quot;index&quot; select=&quot;$index + 1&quot; /&amp;gt;
        &amp;lt;xsl:with-param name=&quot;totalPrice&quot; select=&quot;$totalPrice + $currentPrice&quot; /&amp;gt;
        &amp;lt;xsl:with-param name=&quot;nodes&quot; select=&quot;$nodes&quot; /&amp;gt;
      &amp;lt;/xsl:call-template&amp;gt;
    &amp;lt;/xsl:otherwise&amp;gt;
  &amp;lt;/xsl:choose&amp;gt;

&amp;lt;/xsl:template&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Simple but a bit messy and nice to have for future cut and paste ;)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Streaming pipeline and using context ResourceTracker to avoid disposed streams</title>
    <link href="http://richardhallgren.com/streaming-pipeline-and-using-resourcetracker-to-avoid-disposed-objects" />
    <updated>2010-02-22T08:50:16+00:00</updated>
    <id>http://richardhallgren.com/streaming-pipeline-and-using-resourcetracker-to-avoid-disposed-objects</id>
    <content type="html">&lt;p&gt;Recently there’s been a few really good resources on streaming pipeline handling published. You can find some of the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee377071(BTS.10).aspx&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ff384124(BTS.10).aspx&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee377071(BTS.10,classic).aspx&quot;&gt;Optimizing Pipeline Performance&lt;/a&gt; MSDN article has two great examples of how to use some of the &lt;a href=&quot;http://technet.microsoft.com/en-us/library/microsoft.biztalk.streaming(BTS.20).aspx&quot;&gt;Microsoft.BizTalk.Streaming.dl&lt;/a&gt; classes. The execute method of first example looks something like below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;public IBaseMessage Execute(IPipelineContext context, IBaseMessage message)
{
    try
    {
        ...
        IBaseMessageContext messageContext = message.Context;
        if (string.IsNullOrEmpty(xPath) &amp;amp;&amp;amp; string.IsNullOrEmpty(propertyValue))
        {
            throw new ArgumentException(...);
        }
        IBaseMessagePart bodyPart = message.BodyPart;
        Stream inboundStream = bodyPart.GetOriginalDataStream();
        VirtualStream virtualStream = new VirtualStream(bufferSize, thresholdSize);
        ReadOnlySeekableStream readOnlySeekableStream = new ReadOnlySeekableStream(inboundStream, virtualStream, bufferSize);
        XmlTextReader xmlTextReader = new XmlTextReader(readOnlySeekableStream);
        XPathCollection xPathCollection = new XPathCollection();
        XPathReader xPathReader = new XPathReader(xmlTextReader, xPathCollection);
        xPathCollection.Add(xPath);
        bool ok = false;
        while (xPathReader.ReadUntilMatch())
        {
            if (xPathReader.Match(0) &amp;amp;&amp;amp; !ok)
            {
                propertyValue = xPathReader.ReadString();
                messageContext.Promote(propertyName, propertyNamespace, propertyValue);
                ok = true;
            }
        }
        readOnlySeekableStream.Position = 0;
        bodyPart.Data = readOnlySeekableStream;
    }
    catch (Exception ex)
    {
        if (message != null)
        {
            message.SetErrorInfo(ex);
        }
        ...
        throw ex;
    }
    return message;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We used this example as a base when developing something very similar in a recent project. At first every thing worked fine but after a while we stared getting an error saying:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Cannot access a disposed object. Object name: DataReader
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It took us a while to figure out the real problem here, everything worked fine when sending in simple messages but as soon as we used to code in a pipeline were we also &lt;a href=&quot;http://geekswithblogs.net/benny/archive/2007/02/15/106329.aspx&quot;&gt;debatched&lt;/a&gt; messages we got the “disposed object” problem.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2010/02/image1.png&quot;&gt;&lt;img src=&quot;../assets/2010/02/image_thumb1.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;It turns out that when we debatched messages the execute method of the custom pipeline ran multiple times, one time for each sub-messages. This forced the .NET Garbage Collector to run.&lt;/p&gt;

&lt;p&gt;The GC found the XmlTextReader that we used to read the stream as unreferenced and decided to destoy it.&lt;/p&gt;

&lt;p&gt;The problem is that &lt;strong&gt;will also dispose the readOnlySeekable-Stream stream that we connected to our message data object&lt;/strong&gt;!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;It’s then the BizTalk End Point Manager (EPM) that throws the error as it hits a disposed stream object when trying to read the message body and save it to the BizTalkMsgBox!&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;resourcetracker-to-the-rescue&quot;&gt;ResourceTracker to the rescue!&lt;/h3&gt;

&lt;p&gt;Turns out that the BizTalk message context object has a nice little class connected to it called the &lt;em&gt;ResourceTracker&lt;/em&gt;. This object has a “AddResouce”-method that makes it possible to add an object and the context will the hold a reference to this object, &lt;strong&gt;this will tell the GC not to dispose it!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;So when adding the below before ending the method everything works fine - even when debatching messages!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;context.ResourceTracker.AddResource(xmlTextReader);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</content>
  </entry>
  
  <entry>
    <title>Checking if BizTalk binding file is up-to date during deployment</title>
    <link href="http://richardhallgren.com/checking-if-biztalk-binding-file-is-up-to-date-during-deployment" />
    <updated>2009-12-11T10:19:52+00:00</updated>
    <id>http://richardhallgren.com/checking-if-biztalk-binding-file-is-up-to-date-during-deployment</id>
    <content type="html">&lt;p&gt;As all of you know the number one time consuming task in BizTalk is deployment. How many times have you worked your way through the steps below (and even more interesting - how much time have you spent on them …)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Build&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Create application&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Deploy schemas&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Deploy transformations&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Deploy orchestration&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Deploy components&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Deploy pipelines&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Deploy web services&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Create the external databases&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Change config settings&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;GAC libraries&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Apply bindings on applications&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Bounce the host instances&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Send test messages&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Etc, etc …&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Not only is this time consuming it’s also &lt;em&gt;drop dead boring&lt;/em&gt; and therefore also very prone - small mistakes that takes ages to find and fix.&lt;/p&gt;

&lt;p&gt;The good news is however that the steps are quite easy to script. We use a combination of a couple of different open-source MsBuild libraries (like &lt;a href=&quot;http://www.codeplex.com/sdctasks&quot;&gt;this&lt;/a&gt; and &lt;a href=&quot;http://msbuildtasks.tigris.org/&quot;&gt;this&lt;/a&gt;) and have created our own little build framework. There is however the &lt;a href=&quot;http://biztalkdeployment.codeplex.com/&quot;&gt;BizTalk Deployment Framework&lt;/a&gt; by &lt;a href=&quot;http://www.traceofthought.net/&quot;&gt;Scott Colescott&lt;/a&gt; and &lt;a href=&quot;http://www.tfabraham.com/blog/&quot;&gt;Thomas F. Abraham&lt;/a&gt; that looks great and is very similar to what we have (ok, ok, it’s a &lt;em&gt;bit&lt;/em&gt; more polished …).&lt;/p&gt;

&lt;h3 id=&quot;binding-files-problem&quot;&gt;Binding files problem&lt;/h3&gt;

&lt;p&gt;Keeping the binding files in a source control system is of course a super-important part of the whole build concept. If something goes wrong and you need to roll back, or even rebuild the whole solution, having the right version of the binding file is critical.&lt;/p&gt;

&lt;p&gt;A problem is however that &lt;em&gt;if someone has done changes to the configuration via the administration console and &lt;strong&gt;missed&lt;/strong&gt; to export these binding to source control we’ll deploy an old version of the binding when redeploying&lt;/em&gt;. This can be a huge problem when for example addresses etc have changed on ports and we redeploy old configurations.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;What!? If fixed that configuration issue in production last week and now it back …&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So &lt;strong&gt;how can we reassure&lt;/strong&gt; that the binding file is up-to-date when deploying?&lt;/p&gt;

&lt;p&gt;One solution is to do and export of the current binding file and compare that to one we’re about to deploy in a “pre-deploy”-step using a custom MsBuild target.&lt;/p&gt;

&lt;h3 id=&quot;custom-build-task&quot;&gt;Custom build task&lt;/h3&gt;

&lt;p&gt;Custom build task in MsBuild are easy, a good explanation of how to write one can be found &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/t9883dzc.aspx&quot;&gt;here&lt;/a&gt;. The custom task below does the following.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Require a path to the binding file being deployed.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Require a path to the old deployed binding file to compare against.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Using a regular expression to strip out the time stamp in the files as this is the time the file was exported and that will otherwise differ between the files.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Compare the content of the files and return a boolean saying if they are equal or not.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; public class CompareBindingFiles : Task
 {
     string _bindingFileToInstallPath;
     string _bindingFileDeployedPath;
     bool _value = false; 

     [Required]
     public string BindingFileToInstallPath
     {
         get { return _bindingFileToInstallPath; }
         set { _bindingFileToInstallPath = value; }
     } 

     [Required]
     public string BindingFileDeployedPath
     {
         get { return _bindingFileDeployedPath; }
         set { _bindingFileDeployedPath = value; }
     } 

     [Output]
     public bool Value
     {
         get { return _value; }
         set { _value = value; } 

     } 

     public override bool Execute()
     {
         _value = GetStrippedXmlContent(_bindingFileDeployedPath).Equals(GetStrippedXmlContent(_bindingFileToInstallPath));
         return true; //successful
     } 

     private string GetStrippedXmlContent(string path)
     {
         StreamReader reader = new StreamReader(path);
         string content = reader.ReadToEnd();
         Regex pattern = new Regex(&quot;&amp;lt;Timestamp&amp;gt;.*&amp;lt;/Timestamp&amp;gt;&quot;);
         return pattern.Replace(content, string.Empty);
     } 

 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;using-the-build-task-in-msbuild&quot;&gt;Using the build task in MsBuild&lt;/h3&gt;

&lt;p&gt;After compiling the task above when have to reference the dll in &lt;UsingTask&gt; element like below.&lt;/UsingTask&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;UsingTask AssemblyFile=&quot;My.Shared.MSBuildTasks.dll&quot; TaskName=&quot;My.Shared.MSBuildTasks.CompareBindingFiles&quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can then do the following in out build script!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!--
    This target will export the current binding file, save as a temporary biding file and use a custom target to compare the exported file against the one we’re about to deploy.
    A boolean value will be returned as IsValidBindingFile telling us if they are equal of not.
--&amp;gt;
&amp;lt;Target Name=&quot;IsValidBindingFile&quot; Condition=&quot;$(ApplicationExists)==&apos;True&apos;&quot;&amp;gt;
    &amp;lt;Message Text=&quot;Comparing binding file to the one deployed&quot;/&amp;gt; 

    &amp;lt;Exec Command=&apos;BTSTask ExportBindings /ApplicationName:$(ApplicationName) &quot;/Destination:Temp_$(BindingFile)&quot;&apos;/&amp;gt; 

    &amp;lt;CompareBindingFiles BindingFileToInstallPath=&quot;$(BindingFile)&quot;
                         BindingFileDeployedPath=&quot;Temp_$(BindingFile)&quot;&amp;gt;
        &amp;lt;Output TaskParameter=&quot;Value&quot; PropertyName=&quot;IsValidBindingFile&quot; /&amp;gt;
    &amp;lt;/CompareBindingFiles&amp;gt; 

    &amp;lt;Message Text=&quot;Binding files is equal: $(IsValidBindingFile)&quot; /&amp;gt; 

&amp;lt;/Target&amp;gt;

&amp;lt;!--
    This pre-build step runs only if the application exists from before. If so it will check if the binding file we try to deploy is equal to one deployed. If not this step will break the build.
--&amp;gt;
&amp;lt;Target Name=&quot;PreBuild&quot; Condition=&quot;$(ApplicationExists)==&apos;True&apos;&quot; DependsOnTargets=&quot;ApplicationExists;IsValidBindingFile&quot;&amp;gt;
    &amp;lt;!--We&apos;ll break the build if the deployed binding files doesn&apos;t match the one being deployed--&amp;gt;
    &amp;lt;Error Condition=&quot;$(IsValidBindingFile) == &apos;False&apos;&quot; Text=&quot;Binding files is not equal to deployed&quot; /&amp;gt; 

&amp;lt;!--All other pre-build steps goes here--&amp;gt;

&amp;lt;/Target&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;../assets/2009/12/rocket.jpg&quot; style=&quot;float:right&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we now break the build if the binding file being deployed aren’t up-to-date!&lt;/p&gt;

&lt;p&gt;This is &lt;em&gt;far&lt;/em&gt; from rocket science but can potentially save you from making some stupid mistakes.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>BAM tracking data not moved to BAM Archive database</title>
    <link href="http://richardhallgren.com/bam-tracking-data-not-moved-to-bam-archive-database" />
    <updated>2009-11-13T15:31:20+00:00</updated>
    <id>http://richardhallgren.com/bam-tracking-data-not-moved-to-bam-archive-database</id>
    <content type="html">&lt;p&gt;There are a few really good blog post that explains BAM – like &lt;a href=&quot;http://blogs.digitaldeposit.net/SARAVANA/post/2009/10/08/BAM-Production-environment-management.aspx&quot;&gt;this&lt;/a&gt; from Saravana Kumar and &lt;a href=&quot;http://geekswithblogs.net/andym/archive/2009/05/21/132346.aspx&quot;&gt;this&lt;/a&gt; by Andy Morrison. They both do a great job explaining the complete BAM process in detail.&lt;/p&gt;

&lt;p&gt;This post will however focus on some details in the last step of the process that has to do with archiving the data. Let’s start with a quick walk-through of the whole process.&lt;/p&gt;

&lt;h3 id=&quot;bam-tracking-data-lifecycle&quot;&gt;BAM Tracking Data lifecycle&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image3.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image_thumb.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;The tracked data is intercepted in the BizTalk process and written to the “BizTalk MsgBox” database.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The TDDS service reads the messages and moves them to the correct table in the “BAM Primary Import” database.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The SSIS package for the current BAM activity has to be triggered (this is manual job or something that one has to schedule). When executing the job will do couple of things.           &lt;br /&gt;
    1. Create a new partitioned table with a name that is a combination of the active table name and a GUID.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2. Move data from the active table to this new table. The whole point is of course to keep the active table as small and efficient as possible for writing new data to. 
   
3. Add the newly created table to a database view definition. It is this view we can then use to read all tracked data (including data from the active and partitioned tables). 
   
4. Read from the “BAM Metadata Activities” table to find out the configured time to keep data in the BAM Primary Import database. This value is called the “online window”. 
   
5. Move data that is older than the online window to the “BAM Archive” database (or delete it if you have that [option](http://support.microsoft.com/kb/971984)). 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sound simple doesn’t it? I was however surprised to see &lt;em&gt;that my data was not moved to the BAM Archive database, even if it was clearly outside of the configured online window&lt;/em&gt;.&lt;/p&gt;

&lt;h3 id=&quot;so-what-data-is-moved-to-the-bam-archive-database-then&quot;&gt;So, what data is moved to the BAM Archive database then?&lt;/h3&gt;

&lt;p&gt;Below there is a deployed tracking activity called “SimpleTracking” with a online window of 7 days. Ergo, &lt;em&gt;all data that is older than 7 days should be moved to the BAM Archive database when we run the SSIS job for the activity&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image8.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image_thumb5.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If we then look at the “BAM Completed” table for this activity we see that all the data is much older than 7 days as today’s date is “13-11-2009”.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;So if we run the SSIS job these rows should be moved to the archive database. lets run the SSIS job. Right?&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image9.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image_thumb6.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But when we execute the SSIS job the BAM Archive database is still empty! All we see are the partitioned tables that were created as part of the first steps of the SSIS job. &lt;em&gt;All data from the active table is however moved to the new partitioned table but not moved to the Archive database.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image10.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image_thumb7.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;It turns out that the SSIS job does &lt;strong&gt;not at all look at the the “Last Modified” values&lt;/strong&gt; of each row &lt;strong&gt;but on the “Creation Time” of the partitioned table in the “BAM MetaData Partitions” table&lt;/strong&gt; that is shown below.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image11.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image_thumb8.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The idea behind this is of course to not have to read from tables that potentially are huge and find those rows that should be moved. But it also means that it will &lt;em&gt;take another 7 days before the data in the partitioned view is actually move to the archive database.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;This might actually be a problem if you haven not scheduled the SSIS job to run from day one and you BAM Primary Import database is starting to get to big and you quickly have to move data over to archiving. All you then have to is of course to change that “Creation Time” value in the BAM Metadata Partitions table so it is outside of the online window value for the activity.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>What kind of integration patters do you implement in BizTalk?</title>
    <link href="http://richardhallgren.com/what-kind-of-integration-patters-do-you-implement-in-biztalk" />
    <updated>2009-11-10T19:41:58+00:00</updated>
    <id>http://richardhallgren.com/what-kind-of-integration-patters-do-you-implement-in-biztalk</id>
    <content type="html">&lt;p&gt;I like to divide BizTalk based integrations into three different patterns.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Point-to-point integration&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Broker-based integration&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ESB-based integration&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I am sure someone could come up with fancier names but I will in this post try and dig into each of them, explain what I mean by them. I will also try and highlight some issues with each of the patterns.&lt;/p&gt;

&lt;h3 id=&quot;point-to-point-integration&quot;&gt;Point-to-point integration&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image-thumb.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt; This is where a lot of us started. The idea is that the sending system has information and knowledge about the receiving system.&lt;/p&gt;

&lt;p&gt;This usually means that the &lt;em&gt;messages are exported in a message format that is tailored to the format of the particular receiving system’s needs&lt;/em&gt;. It also means that we usually &lt;em&gt;get one integration process for each receiving system there is&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The example in the figure on the right shows a sending system that sends information about invoices to two different receiving systems (“System A” and “System B”). Using a point-to-point pattern in this scenario we end up with two different types of messages that are exported. Each of the exported messages that are suited and tailored to the format of the receiving system.&lt;/p&gt;

&lt;h4 id=&quot;issues&quot;&gt;Issues&lt;/h4&gt;

&lt;p&gt;The main problem with this kind of point-to-point integration, where the sending system has detailed knowledge about the receiving systems, is that &lt;em&gt;this knowledge translates into a coupling between the systems&lt;/em&gt;. When we tie the export message format from the sending system to the format of the receiving, &lt;em&gt;all changes in the receiving system will also cause changes in the sending system&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Suppose there is a sudden need to change the format of the receiving system - &lt;em&gt;as we use that format as our export format we now also have to change it there&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Another problem is the &lt;em&gt;lack of agility&lt;/em&gt;. In this invoice scenario all other system that also has the need of invoice based information has to get this by going all the way back to the sending system and develop a whole new &lt;em&gt;specific&lt;/em&gt; integration - separate to the existing ones.&lt;/p&gt;

&lt;h3 id=&quot;broker-based-integration&quot;&gt;Broker-based integration&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image1.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image-thumb1.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;In the broker-based scenario the integration platform is used as a broker of messages.&lt;/p&gt;

&lt;p&gt;This means that only **one canonical **format is exported from the sending system. The broker then handles the routing to the different systems and the transformation to the message formats that the receiving systems expects.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;The main advantage between this approach - where the sending system do not know anything about the receiving systems – and the point-to-point pattern is &lt;strong&gt;agility&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;If there now is a need for invoice information in a third, new system, we do not have to change the export from the sending system (as long as we have all the information need that is) or develop a whole new integration. &lt;em&gt;All we have to do is to route the invoices so that they also are sent to the third system and transformed into the format that the system expects&lt;/em&gt;. A new BizTalk map and port and we are done!&lt;/p&gt;

&lt;h4 id=&quot;issues-1&quot;&gt;Issues&lt;/h4&gt;

&lt;p&gt;In my point of view this approach to integration has a lot of advantages over the point-to-point integrations previously discussed. And in a lot of simpler, stabile scenarios it works just fine and is the way to go.&lt;/p&gt;

&lt;p&gt;But in some scenarios it kind of breaks down and becomes hard to work with. The problems is related to configuration and how we define the routing information in BizTalk. In BizTalk we can either create an orchestration and “hardcode” the process that defines which systems the messages should be sent to. We can also create a “messaging” scenario where we configure this routing information in the different BizTalk port artifacts by setting up filters.&lt;/p&gt;

&lt;p&gt;Regardless if we choose a “messaging” or orchestration based solution the routing information becomes hard to update as the solution grow in size. We either get very complicated orchestrations or loads of ports to maintain.&lt;/p&gt;

&lt;p&gt;Furthermore the whole process is very coupled to the one canonical schema which makes versioning and updates hard. If the canonical schema needs to be updated and we still need to be able to send information using the old schema (so we have a “version 1” and “version 2” of the schema side-by-side) all artifacts needs to be more or less duplicated and the complexity of the solutions grows fast.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;This makes business agility hard and any changes takes long time to develop and deploy correctly.&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I guess these issues has more to do with how BizTalk works than the integration pattern itself - but this is a BizTalk blog!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;esb-based-integration&quot;&gt;ESB-based integration&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/11/image2.png&quot;&gt;&lt;img src=&quot;../assets/2009/11/image-thumb2.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;ESB-based integration in BizTalk is today achieved using &lt;a href=&quot;http://msdn.microsoft.com/en-us/biztalk/dd876606.aspx&quot;&gt;ESB Toolkit&lt;/a&gt; from Microsoft.&lt;/p&gt;

&lt;p&gt;One of the ideas of ESB-based integration is that the integration platform should not have hardcoded routing information. These routing rules should either be looked up at run time or travel with the actual payload of the message (called “dynamic routing”).&lt;/p&gt;

&lt;p&gt;This in combination with having generic on- and off-ramps instead of loads of separate ports to maintain _promises to create more agile and configurable solutions _(called “Loosely coupled service composition” and “Endpoint run-time discovery and virtualization”).&lt;/p&gt;

&lt;p&gt;The figure again shows the invoice scenario used previously. In this case we export a “Invoice 1.0”-format from the sending system. The format is not directly bound to a schema in the port (as we are used to in BizTalk) but it is basically possible to send &lt;strong&gt;any&lt;/strong&gt; message format to the on-ramp.&lt;/p&gt;

&lt;p&gt;The on-ramp then identifies what kind of message it received (for example using the XML-namespace) and looks up the routing rules for that specific message (the message “itinerary”) in a repository.&lt;/p&gt;

&lt;p&gt;In this scenario there could be rules to route the message to a orchestration or directly to a send port. _All the configuration for this port is however configured as part of the itinerary and applied at run-time on the generic off-ramp port. And as itineraries are simple XML documents they are super light to update and deploy in the repository! _&lt;/p&gt;

&lt;p&gt;So if we now wanted to update the “Invoice”-format to “version 2.0” all we would have to do is to create a new XML itinerary for the “Invoice 2.0” message type and possibly create new orchestration to handle the new message type. No new ports, no new bindings etc, etc. The configuration and deployment would be a lot simpler than before! We would end up with a lot fewer artifacts to maintain.&lt;/p&gt;

&lt;p&gt;**And **the itinerary for “Invoice 1.0” would still be applied to all incoming Invoice 1.0 messages. &lt;em&gt;Thus we have achieved what used to be so hard with a lot less development power!&lt;/em&gt;&lt;/p&gt;

&lt;h4 id=&quot;issues-2&quot;&gt;Issues&lt;/h4&gt;

&lt;p&gt;With agility and dynamic capabilities comes complexity in debugging when something bad happens … I also feel that we give up a lot of validating and control capabilities that we had in the more schema-coupled patterns previously discussed.&lt;/p&gt;

&lt;p&gt;I am new to this ESB-based model and I would love to hear your experiences, problems, stories etc!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;I am however sure that this is the way to go and I would not be surprised if ESB like patterns will play an ever bigger role in future BizTalk versions!&lt;/em&gt;&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Third party BizTalk monitoring tools</title>
    <link href="http://richardhallgren.com/third-party-biztalk-monitoring-tools" />
    <updated>2009-08-11T15:18:11+00:00</updated>
    <id>http://richardhallgren.com/third-party-biztalk-monitoring-tools</id>
    <content type="html">&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Update 2012-03-28&lt;/strong&gt;      &lt;br /&gt;
When looking into BizTalk monitoring and overall governance tools for BizTalk, don’t miss &lt;a href=&quot;http://www.biztalk360.com/&quot;&gt;BizTalk360&lt;/a&gt;. BizTalk 360 wasn’t available when this post was written and has some really compelling features.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Update 2010-09-30:&lt;/strong&gt; BizMon is now owned and developed by &lt;a href=&quot;http://www.communicate.no&quot;&gt;Communicate Norway&lt;/a&gt;. They have renamed, and further developed the product, to IPM (Integration Monitoring Platform) – check it out &lt;a href=&quot;http://ipm.communicate.no/exciting-news&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I’ll start this post by clarifying two important things&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;I am involved in the development and marketing of “BizMon”. Therefore I am biased and you have to decide for yourself if that affects the content of the post. As always it is best to &lt;a href=&quot;http://bizmontool.com/buy&quot;&gt;try it for yourself&lt;/a&gt; and see if it is useful for you.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;I have talked about BizTalk monitoring tools in a previous post and my goal then was then to start a an open source project. That did not happened and you can read why in the update to &lt;a href=&quot;http://www.richardhallgren.com/aggregated-monitoring-of-biztalk-solutions-using-bizmon/&quot;&gt;that post&lt;/a&gt;.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;why-monitoring-for-biztalk&quot;&gt;Why “monitoring” for BizTalk?&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;../assets/2009/08/image1.png&quot; alt=&quot;image&quot; /&gt; I have worked as a BizTalk developer for many years but it was not until I really got in to maintaining a large integration solution that I realized that the tools I really needed was not there. I found myself using the following “tools” and techniques over and over again.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Open the BizTalk Administration Console and query for suspended messages, running instances, routing errors etc, etc.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;But as I had to pull for this information it took time and discipline (two things I’m short of) to quickly find out when errors occurred.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;I used the HAT to try and find out when the last messages was sent and received on the different applications. This gave me a “guarantee” that things worked as I accepted and that the solution had a “pulse” – messages at least moved back and forward.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The problem is that the HAT tool is bad and it is hard to find what one is looking for (It is a bit better in BizTalk 2009 but it is still tricky to get useful information out of it.)&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Some of the integrations in our environment used BAM to track messages and their state.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The problem was that all solutions was developed by either myself or different consultants. This made it hard to get everyone to use the same tracking. It was also hard to convince management to go back and try and “instrument” old working integrations with BAM tracking.&lt;/p&gt;

&lt;p&gt;At the same time as we had the “tools” and techniques mentioned above available, management had the following requirements for us.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Start working on fixing an error &lt;em&gt;within 10 minutes&lt;/em&gt; after it occurred &lt;em&gt;24/7 all 365 days&lt;/em&gt; …&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Be able to delegate simple monitoring task to support personnel (a help desk).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Not have to actively “pull” for information but be quickly altered of errors and get the information “pushed” to us.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The idea was that this would would save time as people don’t have to look for errors when everything is working fine. Time that people can use for other tasks …&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Enable reporting so we can provide systems owners and other interested people with information on how much data has been sent received to the systems and parties they care about.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;All the above lead up to the realization that we needed some sort of tool.&lt;/p&gt;

&lt;h3 id=&quot;what-are-the-existing-options-for-biztalk-monitoring-tooling&quot;&gt;What are the existing options for BizTalk monitoring tooling?&lt;/h3&gt;

&lt;p&gt;At the time we started looking for options all we could find was &lt;a href=&quot;http://www.microsoft.com/systemcenter/operationsmanager/en/us/default.aspx&quot;&gt;System Center Operations Manager (SCOM)&lt;/a&gt;. We looked at &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ee308798%28BTS.10%29.aspx&quot;&gt;SCOM BizTalk Management Pack&lt;/a&gt; and decided that &lt;em&gt;for us&lt;/em&gt; this was not the right solution. It was too big, too complicated and it would be to hard to get it to the what we wanted to do.&lt;/p&gt;

&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; The decision to not use SCOM I think was right for us. We wanted something leaner and more specialized. I am however **_not saying _**that it is the right decision for you.
&amp;gt; 
&amp;gt;    
&amp;gt; 
&amp;gt; If you are successfully suing SCOM to monitor BizTalk I would love to [hear about it](mailto:richard.hallgren@gmail.com)!
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;h3 id=&quot;what-we-ended-up-with&quot;&gt;What we ended up with&lt;/h3&gt;

&lt;p&gt;We ended up building &lt;a href=&quot;http://bizmontool.com/&quot;&gt;BizMon&lt;/a&gt;. It does what we need and our help desk can now basically monitor about 100 different BizTalk application themselves. At the same time they do all the other support task they have to do. When something happens (and it does …) they are the first to know. Some easy tasks they can solve themselves, otherwise they make sure to notify the users and quickly call the developer that knows more and can help them.&lt;/p&gt;

&lt;p&gt;Support personnel can now also setup custom reports that users can subscribe to, all based on BAM that they now easily can interject tracking points in existing solutions – both new and old ones.&lt;/p&gt;

&lt;p&gt;As I said. This worked out out good and helped us. If you think that it could work for you as well – &lt;a href=&quot;http://bizmontool.com/buy&quot;&gt;give it a try&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I am also really interested to how you have solved similar requirements as we had with your own tool or other solutions.&lt;/p&gt;

&lt;h3 id=&quot;what-else-is-there&quot;&gt;What else is there?&lt;/h3&gt;

&lt;p&gt;Recently &lt;a href=&quot;http://www.frends.com/&quot;&gt;FRENDS&lt;/a&gt; released a beta version of their &lt;a href=&quot;http://www.frends.com/product/monitoring-technologies/&quot;&gt;FRENDS Helium&lt;/a&gt; product that looks promising could potentially solve a lot of the same issues that BizMon does and that I have discussed in this post.&lt;/p&gt;

&lt;p&gt;Check it out and let us know what you think.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Tips and tricks on BizTalk generated SOAP Web Services</title>
    <link href="http://richardhallgren.com/tips-and-tricks-on-biztalk-generated-soap-web-services" />
    <updated>2009-06-16T08:30:32+00:00</updated>
    <id>http://richardhallgren.com/tips-and-tricks-on-biztalk-generated-soap-web-services</id>
    <content type="html">&lt;p&gt;Traditional SOAP Web Services might feel kind of old as more and more people move over to WCF. But a lot of integration projects still relay heavily on old fashion SOAP Web Services.&lt;/p&gt;

&lt;p&gt;Using BizTalk generated Web Services however has a few issues and one needs to add a few extra steps and procedures to make them effective and easy to work with. This post aims to collect, link and discuss all those issues and solutions.&lt;/p&gt;

&lt;h3 id=&quot;1-building-and-deploying&quot;&gt;1. Building and deploying&lt;/h3&gt;

&lt;p&gt;BizTalk Server includes the “BizTalk Web Services Publishing Wizard” tool that integrates with Visual Studio. This is basically a tool to generate a &lt;a href=&quot;http://en.wikipedia.org/wiki/Domain-specific_programming_language&quot;&gt;DSL&lt;/a&gt; based script for generating web services.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/06/image.png&quot;&gt;&lt;img src=&quot;../assets/2009/06/image-thumb.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The wizard collects information about what schema or a orchestration to expose, namespaces, names of service and method, where on IIS to publish the service etc, etc.&lt;/p&gt;

&lt;p&gt;The output of the tool is then a xml file (a “WebServiceDescription” file) that has all the collected values in it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/06/image1.png&quot;&gt;&lt;img src=&quot;../assets/2009/06/image-thumb1.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As a final step Visual Studio uses the newly created description file as input to a class called WebServiceBuilder in the .NET Framework. It is this class that is responsible for interpreting the description, configure and generate the service.&lt;/p&gt;

&lt;p&gt;A common procedure is to use the wizard and click thru it and input values for &lt;strong&gt;&lt;em&gt;every&lt;/em&gt;&lt;/strong&gt; single deployment. This is of course slow, error prone and stupid.&lt;/p&gt;

&lt;p&gt;What is much better is to take a copy of the generated “WebServiceDescription” file, save it to your source control system and then programmatically pass the file to the WebServiceBuilder class as part of your deployment process. Possible changes to the details of the service can then be done directly in the description file.&lt;/p&gt;

&lt;p&gt;I have seen this approach save lots of time and problems related to deployment.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Paul Petrov has a great post on how to call the “WebServiceBuilder” class and pass the description file using C#.      &lt;br /&gt;
&lt;a href=&quot;http://geekswithblogs.net/paulp/archive/2006/05/22/79282.aspx&quot;&gt;http://geekswithblogs.net/paulp/archive/2006/05/22/79282.aspx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Michael Stephenson has a good post on how to used the “WebServiceBuilder” class via MSBuild.      &lt;br /&gt;
&lt;a href=&quot;http://geekswithblogs.net/michaelstephenson/archive/2006/09/16/91369.aspx&quot;&gt;http://geekswithblogs.net/michaelstephenson/archive/2006/09/16/91369.aspx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-fixing-namespace&quot;&gt;2. Fixing namespace&lt;/h3&gt;

&lt;p&gt;Another annoying problem (I’d would actually go so far as calling it a bug) is the problem with the &lt;em&gt;bodyTypeAssemblyQualifiedName&lt;/em&gt; value in the generated Web Service class.&lt;/p&gt;

&lt;p&gt;This causes BizTalk to skip looking up the actual message type for the incoming message. As no message type exists for the message is in BizTalk mapping and routing on message types etc will fail. It is a know problem and there are solutions to it. I would also recommend take the extra time need to make this small “post process step” be part of your deployment process (see how &lt;a href=&quot;http://www.richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja/&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Saravana Kumar discusses the problem and solutions in this great post.      &lt;br /&gt;
&lt;a href=&quot;http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx&quot;&gt;http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Richard Seroter has a short and well written post published.      &lt;br /&gt;
[http://blogs.msdn.com/richardbpi/archive/2006/09/15/Fixing-_2200&lt;em&gt;SOAP-_2F00&lt;/em&gt;-Envelope-Schema_2200&lt;em&gt;-Error-In-BizTalk.aspx](http://blogs.msdn.com/richardbpi/archive/2006/09/15/Fixing-_2200_SOAP-_2F00&lt;/em&gt;-Envelope-Schema_2200_-Error-In-BizTalk.aspx)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;I have a post on how to solve the issue using MSBuild.      &lt;br /&gt;
&lt;a href=&quot;http://www.richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja/&quot;&gt;http://www.richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja/&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-pre-compiling&quot;&gt;3. Pre-compiling&lt;/h3&gt;

&lt;p&gt;By default the “WebServiceBuilder” class generates a web service &lt;em&gt;without&lt;/em&gt; pre-compiling it. Usually this is not a problem. &lt;em&gt;But&lt;/em&gt; in some cases were one really on the web service being online and give a quick response-message the performance problems in this approach can be a huge problem.&lt;/p&gt;

&lt;p&gt;When generating the web service without pre-compiling it IIS has to compile the service and then keep the compiled service in memory. That means that when IIS releases the service from memory there is a latency before IIS re-compiled the service, loaded it into memory and executed it. This is a known problem and I have seen this “slow first hit” issue been a frequent question the different forums.&lt;/p&gt;

&lt;p&gt;The solution is to use the aspnet_compiler.exe tool and pre-compile the service and the use those pre-compiled dlls as the service. IIS then never has to recompile it and will serve initial hits much faster.&lt;/p&gt;

&lt;p&gt;Here is an example of how we defined a target to do this as part of our deployment process using MSBuild.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Pre-compile the service into a new folder&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Clean out the “old” not compile service folder.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Copy the pre-complied service into the service folder&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Target Name=&quot;CompileWeb&quot;&amp;gt;
    &amp;lt;Message Text=&quot;Uses aspnet compiler to compile the service into a new folder. Then copies the compiled content back into its original place&quot; /&amp;gt;
    &amp;lt;AspNetCompiler
        PhysicalPath=&quot;$(WebSiteServicePath)InitiateProjectService\&quot;
        VirtualPath=&quot;/WebServiceName&quot;
        TargetPath=&quot;$(WebSiteServicePath)$(WebServiceName)Compiled\&quot;
        Force=&quot;true&quot; /&amp;gt;

    &amp;lt;Folder.CleanFolder Path=&quot;$(WebSiteServicePath)$(WebServiceName)\&quot;/&amp;gt;

    &amp;lt;Folder.CopyFolder
                Source=&quot;$(WebSiteServicePath)$(WebServiceName)Compiled\&quot;
                Destination=&quot;$(WebSiteServicePath)$(WebServiceName)\&quot; /&amp;gt;

&amp;lt;/Target&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Paul Petrov has two different articles here describing the process and also a different way that above on how to include the pre-compilation in you build process.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;http://geekswithblogs.net/paulp/archive/2006/03/30/73900.aspx&quot;&gt;http://geekswithblogs.net/paulp/archive/2006/03/30/73900.aspx&lt;/a&gt;, &lt;a href=&quot;http://geekswithblogs.net/paulp/archive/2006/04/19/75633.aspx&quot;&gt;http://geekswithblogs.net/paulp/archive/2006/04/19/75633.aspx&lt;/a&gt;&lt;/p&gt;

</content>
  </entry>
  
  <entry>
    <title>BAM ate my XML declaration!</title>
    <link href="http://richardhallgren.com/bam-ate-my-xml-declaration" />
    <updated>2009-05-28T12:14:49+00:00</updated>
    <id>http://richardhallgren.com/bam-ate-my-xml-declaration</id>
    <content type="html">&lt;p&gt;There are integrations which only purpose is to move a file &lt;em&gt;just as it is&lt;/em&gt;. No advanced routing. No orchestration processing. No transformation. Just a simple port-to-port messaging scenario.&lt;/p&gt;

&lt;p&gt;It is however still a good idea to monitor these just as one would monitor a more complicated integration. We use BAM to monitor all our integrations and to measure how many messages that has been processed in a integration. Using BAM monitoring in a simple solution as the above however has its issues …&lt;/p&gt;

&lt;h3 id=&quot;setting-up-a-simple-test-solution&quot;&gt;Setting up a simple test solution&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/05/image.png&quot;&gt;&lt;img src=&quot;../assets/2009/05/image-thumb.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;The solution will move a XML file between two port called “SimpleTrackingReceivePort” and “SimpleTrackingSendPort”.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Both port have &lt;em&gt;PassThru pipelines configured&lt;/em&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;The XML file does not have a installed schema&lt;/em&gt;. Remember we are just moving the file not actually doing anything with it.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A BAM tracking definition with one milestone called “StartPort” will be used. This will be mapped to the “PortStartTime” property on both the receiving and sending port .&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Our tracking profile configuration will like below. Dead simple.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/05/image1.png&quot;&gt;&lt;img src=&quot;../assets/2009/05/image-thumb1.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;so--whats-the-problem&quot;&gt;So – what’s the problem?&lt;/h3&gt;

&lt;p&gt;Let us drop a XML message looking some like this.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-16&quot;?&amp;gt;
&amp;lt;SimpleTest&amp;gt;
    &amp;lt;SimpleContent Text=&quot;This is a test&quot; /&amp;gt;
&amp;lt;/SimpleTest&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remember that there is not a schema installed so we do not really have to worry about the structure of the file. It should just be “a file” to BizTalk and everything should be transferred between the ports. Even if we drop a executable or whatever - it should just be transferred. &lt;strong&gt;&lt;em&gt;Nothing should read or examine the file&lt;/em&gt;&lt;/strong&gt; as it’s just a pass thru!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;As soon as BAM tracking is configured on a port that is however not the case&lt;/em&gt;&lt;/strong&gt;. Lets take a look at the file we receive on the other end of our integration.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;SimpleTest&amp;gt;
    &amp;lt;SimpleContent Text=&quot;This is a test&quot; /&amp;gt;
&amp;lt;/SimpleTest&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;BizTalk now removed our XML declaration!&lt;/em&gt;&lt;/strong&gt; Basically it treated the message as a XML message and parsed the message as such while tracking it. It’ will also add the dreaded &lt;a href=&quot;http://en.wikipedia.org/wiki/Byte-order_mark&quot;&gt;Byte-Order-Mark&lt;/a&gt; and fail any non-valid XML messages. The problem is that &lt;strong&gt;&lt;em&gt;this is not the behavior what one expects&lt;/em&gt;&lt;/strong&gt; and causes receiving systems that rely on the XML declaration to fail!&lt;/p&gt;

&lt;p&gt;As we also don’t have a installed schema it is not possible to use a XMLTransmit pipeline to add the XML declaration and remove the BOM.&lt;/p&gt;

&lt;h3 id=&quot;what-to-do&quot;&gt;What to do?&lt;/h3&gt;

&lt;p&gt;If you’d like to track a XML based message using BAM make sure you have the schema installed … Even if you are just using PassThru.&lt;/p&gt;

&lt;p&gt;Is it a bug or just something one should expect? In my opinion it is at least &lt;strong&gt;&lt;em&gt;very&lt;/em&gt;&lt;/strong&gt; annoying!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Receiving scheduled MsgBoxViewer-reports via e-mail</title>
    <link href="http://richardhallgren.com/receiving-scheduled-msgboxviewer-reports-via-e-mail" />
    <updated>2009-03-19T16:37:01+00:00</updated>
    <id>http://richardhallgren.com/receiving-scheduled-msgboxviewer-reports-via-e-mail</id>
    <content type="html">&lt;p&gt;I attended a session the other day at TechDays here in Sweden with Microsoft Escalation Engineer &lt;a href=&quot;http://bizspace.blogspot.com/&quot;&gt;Niklas Engfelt&lt;/a&gt;. The session was about troubleshooting BizTalk and Niklas of course showed the wonderful &lt;a href=&quot;http://blogs.technet.com/jpierauc/pages/what-is-biztalk-msgboxviewer.aspx&quot;&gt;MsgBoxViewer&lt;/a&gt; (MBV) tool by &lt;a href=&quot;http://blogs.technet.com/jpierauc/default.aspx&quot;&gt;Jean-Pierre Auconie&lt;/a&gt;. If you haven’t tested and looked deeper into this tool you &lt;em&gt;&lt;strong&gt;need&lt;/strong&gt;&lt;/em&gt; to do so. It’s great!&lt;/p&gt;

&lt;p&gt;I worked with the tool before but now I wanted to schedule the tool and to have MBV-reports e-mailed to relevant persons within the company on a weekly basis. This is quite easy to accomplish as MBV comes in two version. One GUI-based (shown below) version and one command-line based.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/03/windowslivewriterreceivingscheduledmsgboxviewereportsviae-f7aeimage-12.png&quot;&gt;&lt;img src=&quot;../assets/2009/03/windowslivewriterreceivingscheduledmsgboxviewereportsviae-f7aeimage-thumb-5.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The command-line version is of course perfect for scheduling using the &lt;a href=&quot;http://www.iopus.com/guides/winscheduler.htm&quot;&gt;Windows Task Scheduler&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/03/windowslivewriterreceivingscheduledmsgboxviewereportsviae-f7aeimage-10.png&quot;&gt;&lt;img src=&quot;../assets/2009/03/windowslivewriterreceivingscheduledmsgboxviewereportsviae-f7aeimage-thumb-4.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you feel uncomfortable running all the queries (there is &lt;em&gt;a lot&lt;/em&gt; of them) on a schedule you can pick some you find important and configure the tool to only run those. Jean-Pierre has a post on how to do just that &lt;a href=&quot;http://blogs.technet.com/jpierauc/archive/2009/03/11/mbv-how-to-run-only-some-specific-queries-in-the-console-version-of-mbv-btsdbcollect-exe.aspx&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;After MBV has completed all its queries and done its magic it will produce a html-report in the working folder (that’s the folder in the “Start in” field in the scheduled task example above).&lt;/p&gt;

&lt;p&gt;We then use a tool called &lt;a href=&quot;http://www.duodata.de/amlnt/index.htm&quot;&gt;AutoMailer NT&lt;/a&gt; (cost €20 - there is a 30 days trial) to:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Poll the working folder for a *.html report file.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Compress the file (using zip).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Send the report to a configured list of recipients.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Delete the report file.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The AutoMailer NT installation is a bit rough (don’t miss to the &lt;em&gt;****&lt;/em&gt;&lt;a href=&quot;http://www.duodata.de/amlnt/download.htm&quot;&gt;separate download&lt;/a&gt; (!) of the trial certificate). But once you have everything working it’s great to have a fresh MBV report in you inbox every Monday telling you how your BizTalk environment is doing and possible issues to attend to.&lt;/p&gt;

</content>
  </entry>
  
  <entry>
    <title>Better performance in batch imports to SQL Server using BizTalk</title>
    <link href="http://richardhallgren.com/better-performance-in-batch-imports-to-sql-server-using-biztalk" />
    <updated>2009-02-17T21:36:09+00:00</updated>
    <id>http://richardhallgren.com/better-performance-in-batch-imports-to-sql-server-using-biztalk</id>
    <content type="html">&lt;p&gt;During my years of BizTalk development I’ve been warned of a couple of scenarios that the product wouldn’t handle very well. Yesterday another of those scenarios turned out to kind of false and, if done right, not really a problem at all.&lt;/p&gt;

&lt;p&gt;The scenario I’m talking about is a batch import of data to SQL Server using the SQL adapter. In my case the data is received as a flat text file containing a large number of rows. These rows should the be places inside a database table as one table-row per row in the flat file.&lt;/p&gt;

&lt;p&gt;The common way of dealing with batch incoming data like this is to split (aka disassemble) it in the receive port using the Flat File Disassembler pipeline component (for a good example - look &lt;a href=&quot;http://geekswithblogs.net/benny/archive/2006/02/05/68249.aspx&quot;&gt;here&lt;/a&gt;). Disassembling the data when receiving it is usually good practice to avoid running into &lt;em&gt;OutOfMemoryException&lt;/em&gt; when &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa560481.aspx&quot;&gt;dealing with big messages&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Sometimes the requirements also forces one into reading each row to a separate message to be able to route and handle each messages in a unique way depending of it’s content. If that so - this is a not a good post for you. &lt;em&gt;In this post I’ll discuss the scenario were all the data just needs to go as fast as possible from the text file into a single database table. No orchestration or anything, just a simple batch import.&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;so-whats-the-problem-with-the-batch-import-scenario&quot;&gt;So, what’s The problem with the batch import scenario?&lt;/h3&gt;

&lt;p&gt;When I implemented similar batch import scenarios in the past I tried to practice good practice and split the data into separate files that I then filtered to the SQL adapter send port, one by one.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/02/windowslivewriterperformanceinbatchimportstosqlserverusin-b997image-8.png&quot;&gt;&lt;img src=&quot;../assets/2009/02/windowslivewriterperformanceinbatchimportstosqlserverusin-b997image-thumb-3.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The received flat file files has been split into thousands of small little message that one by one are sent to the SQL adapter send port.&lt;/li&gt;
  &lt;li&gt;The SQL adapter then parses each message into a SQL script that executes a store procedure and the message is finally inserted to the target database.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;“So what’s the problem?”&lt;/strong&gt; you then ask? &lt;strong&gt;&lt;em&gt;It’s slow! It’s very slow!&lt;/em&gt;&lt;/strong&gt; Each message gets stored a couple of times in the BizTalk database and each message is sent inside it’s own &lt;a href=&quot;http://en.wikipedia.org/wiki/Distributed_Transaction_Coordinator&quot;&gt;DTC transaction&lt;/a&gt; against the target database. And all this adds up …&lt;/p&gt;

&lt;p&gt;And after reading this &lt;a href=&quot;http://seroter.wordpress.com/2008/09/03/interview-series-four-questions-with-alan-smith/&quot;&gt;this interview&lt;/a&gt; by &lt;a href=&quot;http://seroter.wordpress.com/&quot;&gt;Richard Seroter&lt;/a&gt; with &lt;a href=&quot;http://geekswithblogs.net/asmith/Default.aspx&quot;&gt;Alan Smith&lt;/a&gt; I also felt I was the only one having the problem either …&lt;/p&gt;

&lt;blockquote&gt;There are quite a few people asking about using BizTalk for heavy database integration, taking flat files, inserting the data in databases and processing it. SQL Server Integration Services (SSIS) does a much better job than BizTalk at this, and is worth looking at in those scenarios. BizTalk still has its uses for that type of work, but is limited be performance. The worst case I saw was a client who had a daily batch that took 36 hours to process using BizTalk, and about 15 minutes using SSIS. On another project I worked on they had used BizTalk for all the message based integration, and SSIS for the data batching, and it worked really well.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;Note: As I’ll described later in this post my import scenario went from something like 3-4 hours to 2 minutes (importing 10 MB). Alan talks about a 36 hours (!) import. I don’t know &lt;em&gt;anything&lt;/em&gt; more about the scenario he mentions and it might not even be solved using the technique discussed below. Hopefully Alan might comment on the post and give us more details. ;)&lt;/p&gt;

&lt;h3 id=&quot;how-can-we-get-better-performing-imports-using-biztalk&quot;&gt;How can we get better performing imports using BizTalk?&lt;/h3&gt;

&lt;p&gt;As the import scenario we described doesn’t involve any orchestration but is a pure messaging scenario and we do all the transformation on the ports we don’t really have to worry about _OutOfMemoeyExceptions _even though the message is quite big.&lt;/p&gt;

&lt;blockquote&gt;**Large message transformation.** In previous versions of BizTalk Server, mapping of documents always occurred in-memory. While in-memory mapping provides the best performance, it can quickly consume resources when large documents are mapped. In BizTalk Server 2006, large messages will be mapped by the new large message transformation engine, which buffers message data to the file system, keeping the memory consumption flat. ([Source](http://www.microsoft.com/technet/prodtechnol/biztalk/2006/evaluate/overview/default.mspx))
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;Another reason for splitting the message was for it to work with the SQL adapter. When setting up the SQL adapter to work with a store procedure the adapter expects a message that looks something like the below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;ns0:ImportDataSP_Request xmlns:ns0=&quot;http://FastSqlServerBatchImport.Schemas.SQL_ImportDataSP&quot;&amp;gt;
    &amp;lt;ImportData Name=&quot;Name 1&quot; Value=&quot;1&quot;&amp;gt;&amp;lt;/ImportData&amp;gt;
&amp;lt;/ns0:ImportDataSP_Request&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This tells us that the store procedure called is “ImportData” with “Name 1” as the value for the “Name” parameter and “1” as the value for the parameter called “Value” in the stored procedure. So each little separate message would get mapped on the send port into something like this.&lt;/p&gt;

&lt;p&gt;What I however didn’t know until I read &lt;a href=&quot;http://connectedthoughts.wordpress.com/2008/09/09/multiple-stored-procedure-calls-using-the-biztalk-sql-adapter-without-a-loop-shape/&quot;&gt;this post&lt;/a&gt; was that the message I send to the SQL adapter port just as well could look like this!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;ns0:ImportDataSP_Request xmlns:ns0=&quot;http://FastSqlServerBatchImport.Schemas.SQL_ImportDataSP&quot;&amp;gt;
    &amp;lt;!-- TWO rows!!! --&amp;gt;
    &amp;lt;ImportData Name=&quot;Name 1&quot; Value=&quot;1&quot;&amp;gt;&amp;lt;/ImportData&amp;gt;
    &amp;lt;ImportData Name=&quot;Name 2&quot; Value=&quot;2&quot;&amp;gt;&amp;lt;/ImportData&amp;gt;
&amp;lt;/ns0:ImportDataSP_Request&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So basically we can have as &lt;strong&gt;&lt;em&gt;many store procedure calls as we want in one single file&lt;/em&gt;&lt;/strong&gt; that then can send to the SQL adapter send port!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;strong&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Eureka_(word)&quot;&gt;Eureka!&lt;/a&gt; **__&lt;/strong&gt;This means that we don’t have to split the incoming file! We can keep it as one big single file and just transform it to a huge file containing separate nodes that we send to the SQL Adapter send port! The SQL adapter will then parse this into separate store procedure calls for us.**&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/02/windowslivewriterperformanceinbatchimportstosqlserverusin-b997image-10.png&quot;&gt;&lt;img src=&quot;../assets/2009/02/windowslivewriterperformanceinbatchimportstosqlserverusin-b997image-thumb-4.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;strong&gt;__&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;is-it-really-any-faster&quot;&gt;Is it really any faster?&lt;/h3&gt;

&lt;p&gt;As the technique above drastically reduced the amount of database communication needed I knew it’d be much faster. Some initial testing shows that &lt;strong&gt;&lt;em&gt;an import of a file containing somewhere around 55 000 rows (about 10 MB) into our article database went from 3-4 hours to under two minutes!&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;see-for-yourself&quot;&gt;See for yourself!&lt;/h3&gt;

&lt;p&gt;In &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/SqlServerBatchImport sample.zip&quot;&gt;this sample solution&lt;/a&gt; I have a text file containing 2 600 rows. I’ve then created two separate projects in a solutions. One that splits the messages into separate messages (called “SlowImport”) and one that just transforms it and send it as one message to the send port (called “FastImport”). One takes 1:50 minutes and 2 seconds on my development machine … I won’t tell you which one is the faster one …&lt;/p&gt;

&lt;p&gt;Test it for yourself and let me know what you think.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Aggregated monitoring of BizTalk solutions using 'BizMon'</title>
    <link href="http://richardhallgren.com/aggregated-monitoring-of-biztalk-solutions-using-bizmon" />
    <updated>2009-01-06T15:25:20+00:00</updated>
    <id>http://richardhallgren.com/aggregated-monitoring-of-biztalk-solutions-using-bizmon</id>
    <content type="html">&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; **Update 2010-09-30:** BizMon is now owned and developed by [Communicate Norway](http://www.communicate.no). They have renamed, and further developed the product, to IPM (Integration Monitoring Platform) – check it out [here](http://ipm.communicate.no/exciting-news).
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; _**Update 2009-08-11: **This project turned out to be far more complicated and bigger than I first expected (ever heard that before?). Due to that and the fact that we wanted to have a company behind that could offer full-time support and stability “BizMon” has been released as a commercial product that you can find [here](http://bizmontool.com/). _
&amp;gt; 
&amp;gt;    
&amp;gt; 
&amp;gt; _I love to get some [help from you](http://bizmontool.com/we-have-a-rtm-version)**** to test it and make it as good as possible. Even if it is commercial and cost money we have a free alternative for small environments and we work hard to keep the license price as low as possible._
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;&lt;em&gt;****&lt;/em&gt;&lt;/p&gt;

&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; _**Update 2009-02-25:** In the original post I said I&apos;d post more on the architecture and the code during February 09. I&apos;m however current struggling getting the needed legal rights etc, etc to be able to talk further about the &quot;BizMon&quot;-solution. It was harder than I thought ... I&apos;ll get back to posing on the subject as soon as I have that sorted._
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;Integration of enterprise processes often ends up being very business critical. If a integration fails delivering the messages it was supposed to it usually means the business will be affected in a very negative way (for example losing money or delivering bad service). That of course means that monitoring the status of the integrations soon becomes very important (if you’re not into getting yelled at or potentially loosing your job).&lt;/p&gt;

&lt;p&gt;Strangely enough &lt;em&gt;&lt;strong&gt;BizTalk Server 2006 R2 _in my humble opinion_ doesn’t come with the right tool to efficiently monitoring big enterprise integration solutions!&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;what-do-i-mean-by-monitoring&quot;&gt;What do I mean by monitoring?&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-20.png&quot;&gt;&lt;img src=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-thumb-9.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt; Before I get myself deeper into trouble I’d like to define what I mean by monitoring. I think monitoring a BizTalk integration solution could be divided into four categories.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Infrastructure **(traditional)&lt;/strong&gt;         &lt;br /&gt;
**This is the easy one and one that IT-pros and alike are used to monitor. Hardware status, network traffic, disk space, event logs etc all fall under this category. If the storing area for the databases start running low on memory we can be pretty sure it’ll eventually effect the integration somehow.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**BizTalk infrastructure        &lt;br /&gt;
**This is where it starts getting a bit trickier. This category includes the status of receive locations, orchestrations, host instances and send ports. If a receive location is down no messages will be picked up (but we can also be sure of not getting any suspended messages).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**Suspended messages        &lt;br /&gt;
**As most reader of this blog probably know suspended message is due to some sort of failure in BizTalk. It can be an actually exception in code or something that went wrong while trying to send messages. It’s however and important category to monitor.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**Heartbeat (monitoring actual successful traffic)        &lt;br /&gt;
**While the points 1-3 above focuses on errors and that things being inactive this category actually monitors that the integration &lt;em&gt;runs as expected&lt;/em&gt;.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;To me this final point is almost the most important one. What I mean is that if everything runs as expected and we’re sending the expected amount of messages in the right pace everything else must be ok - right? It’s however the one that in my experience almost always overlooked!&lt;/p&gt;

&lt;h3 id=&quot;what-do-you-mean-not-the-right-tools-to-monitor-we-have-loads-of-tools-in-biztalk-2006-r2&quot;&gt;“What do you mean ‘Not the right tools to monitor’? We have loads of tools in BizTalk 2006 R2!”&lt;/h3&gt;

&lt;p&gt;OK. So let’s see what tools we have available actually monitor the categories above.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Infrastructure **(traditional)&lt;/strong&gt;**       &lt;br /&gt;
I won’t discuss this kind of monitoring in this post. There are loads of tools (all from the &lt;a href=&quot;http://www.microsoft.com/systemcenter/operationsmanager/en/us/default.aspx&quot;&gt;huge expensive enterprise ones&lt;/a&gt; to plenty of &lt;a href=&quot;http://www.nagios.org/&quot;&gt;good open-source alternatives&lt;/a&gt;) for this and you’re probably already using one or several of them already.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**BizTalk infrastructure        &lt;br /&gt;
**There are a couple of way of achieving this. One of the is to use the &lt;a href=&quot;http://www.microsoft.com/downloads/details.aspx?FamilyID=389FCB89-F4CF-46D7-BC6E-57830D234F91&amp;amp;displaylang=en&quot;&gt;Microsoft BizTalk Server Management Pack for Operation Manager&lt;/a&gt;. It does however of course require that you have invested in System Center Operation Manager already …&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Another way is to either use the &lt;a href=&quot;http://technet.microsoft.com/en-us/library/microsoft.biztalk.explorerom.aspx&quot;&gt;ExplorerOM classes&lt;/a&gt; or connecting directly to the BizTalk configuration database and code your own report of some sort.&lt;/p&gt;

&lt;p&gt;The final (and most common way in my experience) is to try and document the correct configuration and settings and then have someone check these manually (if you’re that person I feel for you …).&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;**Suspended messages        &lt;br /&gt;
**Suspended messages are of course very important to monitor and it’s for some reason also the first thing developers think of monitoring when developing BizTalk integration (maybe because of the fact that they’re similar to traditional exceptions in software). There are also here a couple of different ways to solve the problem.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;a href=&quot;http://www.microsoft.com/downloads/details.aspx?FamilyID=389FCB89-F4CF-46D7-BC6E-57830D234F91&amp;amp;displaylang=en&quot;&gt;Microsoft BizTalk Server Management Pack for Operation Manager&lt;/a&gt; mentioned above has the functionality to monitor and altering on suspended messages.&lt;/p&gt;

&lt;p&gt;BizTalk Server fires &lt;em&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa547324.aspx&quot;&gt;the MSBTS_ServiceInstanceSuspendedEvent&lt;/a&gt;&lt;/em&gt; WMI event every time a service instance gets suspended. It’s fully possible to write a service that watches for this event and then for example sends some sort of alert. Darren Jefford has an example on how do something like that in &lt;a href=&quot;http://blogs.msdn.com/darrenj/archive/2004/03/30/104135.aspx&quot;&gt;this post&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In BizTalk 2006 &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa578516.aspx&quot;&gt;Failed Message Routing&lt;/a&gt; was introduced. This gives the developer the possibility to subscribe to suspended messages. These can then for example be sent out to file system or written to a database. &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/cc487894.aspx&quot;&gt;Microsoft ESB Guidance for BizTalk Server 2006 R2&lt;/a&gt; Exception management component uses this approach. The problem with this approach is however that the message is moved out of BizTalk and one loses all the built in possibilities of resending them etc.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;**Heartbeat (monitoring actual successful traffic)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-4.png&quot;&gt;&lt;img src=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-thumb-1.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;As I said before I think this is a very important metric. If you can see that messages travel through BizTalk in a normal rate things much be pretty ok – right? Without doing to much coding and developing you own pipeline components for tracking etc there are two options.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        **      
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first one is of course using the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms943738.aspx&quot;&gt;Health and Activity Tracking&lt;/a&gt; tool (HAT). This shows a simple view of receives, processed and sent messages. I hate to say it but the HAT tool is &lt;em&gt;&lt;strong&gt;bad&lt;/strong&gt;&lt;/em&gt;. It’s slow, it’s hard to use, it’s hard to filter information, it times out, it doesn’t aggregate information, it’s basically almost useless … (Just to make one thing clear: I make my living working with BizTalk and &lt;em&gt;I really enjoy&lt;/em&gt; the product but tracking and monitoring is really one of it’s ugly sides. I hate to say it.)&lt;/p&gt;

&lt;p&gt;The other option is to develop a simple &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa972199.aspx&quot;&gt;BAM tracking&lt;/a&gt; profile to monitoring the send and receive port ports of the different processes.&lt;/p&gt;

&lt;p&gt;So to repeat what I said earlier: no I don’t think BizTalk comes with the right tool to monitor integration solutions. I do however think that the platform has the capabilities to create something that could close that gap in the product.&lt;/p&gt;

&lt;h3 id=&quot;what-i-need&quot;&gt;What I need!&lt;/h3&gt;

&lt;p&gt;Much of what’s discussed in this post can be solved using the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms943596.aspx&quot;&gt;BizTalk Administrations Console&lt;/a&gt; (to manually monitor BizTalk infrastructure status) or in the &lt;a href=&quot;http://technet.microsoft.com/en-us/library/ms943738.aspx&quot;&gt;Health and Activity Tracking&lt;/a&gt; tool (to manually monitor traffic). &lt;em&gt;&lt;strong&gt;The aim of this post is however to discuss the possibilities to use this information, aggregate it and give the persons responsible for monitoring integration a dashboard that shows the current status of all integrations within the enterprise.&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80monitor-dashboard-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80monitor-dashboard-thumb.jpg&quot; alt=&quot;Monitor DashBoard&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The dashboard monitor application need the following main features.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;In one single screen give an overview of the overall status of all the integrations. By status I mean if there are ports, orchestration or host instances that aren’t running that should be running or if there is any suspended traffic on that particular integration.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The possibility to show detailed information for a specific integration on what artifacts (ports, host instances etc) that are/aren’t running. How much traffic that’s been sent/received via the integration. When traffic was sent/received and if there’s any suspended messages on the integration.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The option to filter exclude specific artifacts from monitoring (for example receive locations that’s usually turned off etc).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Setting up monitoring by for example email and also define what integrations to be included in one specific monitoring (different persons are usually responsible for monitoring different integrations).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;introducing-bizmon&quot;&gt;Introducing “BizMon”&lt;/h3&gt;

&lt;p&gt;Based on the needs and “requirements” above I’ve started developing a application. The idea is to release it as open-source as soon as I get to a first stable version (I’d be very interested in help on practical details on how to do so). For now I’ll demonstrate it by showing some screenshots. The application is a web application based on &lt;a href=&quot;http://www.asp.net/mvc/&quot;&gt;ASP.NET MVC&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;screenshot-applications-page&quot;&gt;Screenshot: “Applications” page&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-10.png&quot;&gt;&lt;img src=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-thumb-4.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The above image shows a screenshot from the start page of the BizMon-application that shows the aggregated status of the entire BizTalk group it’s connected to. The applications is build to monitor one BizTalk group and the shown page displays all &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa560585.aspx&quot;&gt;applications&lt;/a&gt; within that &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms962428.aspx&quot;&gt;BizTalk group&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In the example image the two first rows have an OK status. That means that all of the monitored artifacts (receive locations, send ports, orchestrations and host instances) &lt;em&gt;within&lt;/em&gt; that application are in a running and OK status.     &lt;br /&gt;
The yellow line on the &lt;em&gt;YIT.NO.Project&lt;/em&gt;-application indicates a warning. That means that all the artifacts are in a OK status &lt;em&gt;but&lt;/em&gt; there’re suspended messages within that application. The red line indicates that one or more of the monitored artifacts are in a inactive status.&lt;/p&gt;

&lt;p&gt;Each row and application show when the last message on that application was received and/or sent. It also show how many suspended messages exists and when the last message got suspended.&lt;/p&gt;

&lt;h3 id=&quot;screenshot-application-detail-page&quot;&gt;Screenshot: “Application-detail” page&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-12.png&quot;&gt;&lt;img src=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-thumb-5.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When clicking on a application on the main page previously shown the application-detail page is displayed for that application. This page shows detailed information on each of the artifacts within that application. I also shows suspended messages and the date and time of the last suspended.&lt;/p&gt;

&lt;p&gt;It also displays a graph showing how many messages that has been processed by each of the ports. Currently the graph can view data from the last 7 days. In the screenshot above data from the 6th of January is shown and as it’s set to display data for a specific day the data is grouped in hours of that day. It’s also possible to view the aggregated data from all the traced days as show below. When viewing data from all days the graphs is grouped by days.&lt;/p&gt;

&lt;p&gt;(The graph only shows data from the 6th of January as this is from test and there was no traffic of the previous days but I’m sure you get the idea …)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-14.png&quot;&gt;&lt;img src=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-thumb-6.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;screenshot-application-detail-page-with-inactive-artifacts&quot;&gt;Screenshot: “Application-detail” page with inactive artifacts&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-18.png&quot;&gt;&lt;img src=&quot;../assets/2009/01/windowslivewriteraggregatedmonitoringofbiztalksolutions-dd80image-thumb-8.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This final page show details of an application with some inactive artifacts. The small cross highlighted by the arrow in the image show the possibility to filter out a single artifact from monitoring. If an excluded artifacts is failing the overall status of the application will still be OK and no alerts will be sent.&lt;/p&gt;

&lt;h3 id=&quot;help&quot;&gt;Help!&lt;/h3&gt;

&lt;p&gt;I’d love to &lt;strong&gt;&lt;em&gt;get some input and feedback&lt;/em&gt;&lt;/strong&gt; on all this. &lt;em&gt;&lt;strong&gt;What do you think could be useful, what do you think won’t? Do you know of something similar, how do you solve this kind of monitoring?&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;I’d also like to know any suitable placed to publish the code as an open-source project or is the best thing to just release it here on the blog? What do you think? Use the comments or &lt;a href=&quot;mailto:richard.hallgren@gmail.com&quot;&gt;send me a mail&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h3&gt;

&lt;p&gt;I have a few thing on the alerts part of the application left and then I’ll release a first version. I’m hoping that could happened at the &lt;strike&gt;end of February 09&lt;/strike&gt; (look at the update at the top of the post) . Make sure to &lt;a href=&quot;mailto:richard.hallgren@gmail.com&quot;&gt;let me know what you think&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;I’ll publish a follow-up post discussing the technical details and the architecture more in detail shortly.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Handle the 'bodyTypeAssemblyQualifiedName' SOAP Adapter bug in MSBuild as a RegEx ninja</title>
    <link href="http://richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja" />
    <updated>2008-11-12T12:53:32+00:00</updated>
    <id>http://richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja</id>
    <content type="html">&lt;p&gt;This is a very specific problem but I’m sure some of you stumbled over it. When disassembling a XML message in a SOAP port BizTalk can’t read the message type. This causes problems when for example trying to handle an envelope message and split it to smaller independent messages in the port. It’s a known problem discussed &lt;a href=&quot;http://blogs.msdn.com/richardbpi/archive/2006/09/15/Fixing-_2200_SOAP-_2F00_-Envelope-Schema_2200_-Error-In-BizTalk.aspx&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx&quot;&gt;here&lt;/a&gt; (you also find information about it in the &lt;a href=&quot;http://download.microsoft.com/download/3/7/6/376a6f6c-8c97-4ab5-9d5a-416c76793fbb/bts06developerstroubleshootingguide.doc&quot;&gt;BizTalk Developer’s Troubleshooting Guide&lt;/a&gt;) and the solution is to make a small change in the generated web service class. Below is a small part of he generated class.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//[cut for clarity] ...
            Microsoft.BizTalk.WebServices.ServerProxy.ParamInfo[] outParamInfos = null;
            string bodyTypeAssemblyQualifiedName = &quot;XXX.NO.XI.CustomerPayment.Schemas.r1.CustomerPayments_v01, XXX.NO.XI.CustomerPaym&quot; +
                &quot;ent.Schemas.r1, Version=1.0.0.0, Culture=neutral, PublicKeyToken=ac564f277cd4488&quot; +
                &quot;e&quot;;
            // BizTalk invocation
            this.Invoke(&quot;SaveCustomerPayment&quot;, invokeParams, inParamInfos, outParamInfos, 0, bodyTypeAssemblyQualifiedName, inHeaders, inoutHeaders, out inoutHeaderResponses, out outHeaderResponses, null, null, null, out unknownHeaderResponses, true, false);
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically the problem is that the generated code puts the wrong _DocumentSpecName _property in the message context. I’ll not dicusses the problem in detail here but Saravana Kumar does thorough dissection of the problem in &lt;a href=&quot;http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx&quot;&gt;his post&lt;/a&gt; on it.&lt;/p&gt;

&lt;p&gt;The solution is to update the &lt;em&gt;bodyTypeAssemblyQualifiedName&lt;/em&gt; to set a null value. That will cause the &lt;em&gt;XmlDiassasemler&lt;/em&gt; to work as we’re used to and expect.&lt;/p&gt;

&lt;blockquote&gt;

&amp;gt; 
&amp;gt; If the value _null_ is passed instead of _bodyTypeAssemblyQualifiedName_, SOAP adapter won&apos;t add the _DocumentSpecName_ property to the context. Now, when we configure our auto-generated SOAP_ReceiveLocation_ to use _XmlReceive_ pipeline, the _XmlDisassembler_ component inside _XmlReceive_ will go through the process of automatic dynamic schema resolution mechanism, pick up the correct schema and promotes all the required properties (distinguished and promoted) defined in the schema and it also promotes the _MessageType_ property.
&amp;gt; 
&amp;gt; 

&amp;gt; 
&amp;gt; **From:** [http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx](http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx)
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//[cut for clarity] ...
            Microsoft.BizTalk.WebServices.ServerProxy.ParamInfo[] outParamInfos = null;
            string bodyTypeAssemblyQualifiedName = null;
            // BizTalk invocation
            this.Invoke(&quot;SaveCustomerPayment&quot;, invokeParams, inParamInfos, outParamInfos, 0, bodyTypeAssemblyQualifiedName, inHeaders, inoutHeaders, out inoutHeaderResponses, out outHeaderResponses, null, null, null, out unknownHeaderResponses, true, false);
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But if you have an automated deployment process you probably use &lt;a href=&quot;http://geekswithblogs.net/michaelstephenson/archive/2006/09/16/91369.aspx&quot;&gt;MSBuild to generate your Web Services&lt;/a&gt;. Then is soon becomes &lt;strong&gt;_very _&lt;/strong&gt;annoying to remember to update the .cs-file again and again for every deployment. &lt;strong&gt;So how can we script that update?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;First we need to find a regular expression to find the right values. With some help from &lt;a href=&quot;http://stackoverflow.com/&quot;&gt;StackOverflow&lt;/a&gt; (let’s face it, there are some &lt;strong&gt;&lt;em&gt;crazy&lt;/em&gt;&lt;/strong&gt; regular expressions skills out there …) I ended up on the following.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(?&amp;lt;=string\sbodyTypeAssemblyQualifiedName\s=\s)(?s:[^;]*)(?=;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;../assets/2008/11/windowslivewriterhandlethebodytypeassemblyqualifiednameso-adf4ninja5-thumb.jpg&quot; alt=&quot;ninja5&quot; /&gt; If you’re not a RegEx ninja the line above does something like this:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;After the string “string bodyTypeAssemblyQualifiedName = “&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;turn on single line (treat “\r\n” as any other character) ( this is what “(?s: )” does)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;match every character that is not a semicolon&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;until a single semicolon is reached.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Then I used a task from the &lt;a href=&quot;http://www.codeplex.com/sdctasks&quot;&gt;SDC Task library&lt;/a&gt; (you probably already use this if you’re using MSBuild and BizTalk). More specially we use the &lt;em&gt;File.Replace&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Target Name=&quot;FixSOAPServiceCode&quot;&amp;gt;
    &amp;lt;File.Replace
            Path=&quot;$(WebSiteServicePath)CustomerPaymentService\App_Code\CustomerPaymentService.asmx.cs&quot;
            Force=&quot;true&quot;
            NewValue=&quot;null&quot;
            RegularExpression=&quot;(?&amp;amp;lt;=string\sbodyTypeAssemblyQualifiedName\s=\s)(?s:[^;]*)(?=;)&quot;&amp;gt;
    &amp;lt;/File.Replace&amp;gt;
&amp;lt;/Target&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now this task is part of the build script and called right after the tasks that generates the web service. This saves me a lot of manual work and potential errors!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Using BizUnitExtensions to poke around in some XML</title>
    <link href="http://richardhallgren.com/using-bizunitextensions-to-poke-around-in-some-xml" />
    <updated>2008-10-30T14:59:17+00:00</updated>
    <id>http://richardhallgren.com/using-bizunitextensions-to-poke-around-in-some-xml</id>
    <content type="html">&lt;p&gt;I’ll start by saying that I really (like in “really, &lt;strong&gt;&lt;em&gt;really!&lt;/em&gt;&lt;/strong&gt;”) like &lt;a href=&quot;http://www.codeplex.com/bizunit&quot;&gt;BizUnit&lt;/a&gt;! BizUnit in combination with &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/wea2sca5.aspx&quot;&gt;MSBuild&lt;/a&gt;, &lt;a href=&quot;http://www.nunit.org/index.php&quot;&gt;NUnit&lt;/a&gt; and &lt;a href=&quot;http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET&quot;&gt;CruiseControl.NET&lt;/a&gt; has really changed the way work and how I &lt;em&gt;feel&lt;/em&gt; about work in general and BizTalk development in particular.&lt;/p&gt;

&lt;p&gt;If you haven’t started looking into what for example MSBuild can do you for you and your BizTalk build process you’re missing out on something great. The time spent on setting up a automatic build process is time well spent - take my word for it!&lt;/p&gt;

&lt;p&gt;But build processes isn’t was this post is supposed to be about. This post is about one of the few limitations of BizUnit and the possibilities to work around one of those in particular.&lt;/p&gt;

&lt;blockquote&gt;BizUnit is a test framework that is intended to test Biztalk solutions. BizUnit was created by Kevin.B.Smith and can be found on [this CodePlex space](http://www.codeplex.com/bizunit) . BizUnit has quite a significant number of steps that have nothing to do with Biztalk per se and can be used for any integration project testing.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;blockquote&gt;[![note](../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286note-thumb.gif)](../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286note-2.gif)If you have used BizUnit before and need an introduction before reading further, start [here](http://www.codeproject.com/KB/biztalk/BizUnit2006.aspx), [here](http://www.codeplex.com/bizunit) or [here](http://biztalkia.blogspot.com/2007/03/getting-started-with-nunit-and-bizunit.html) - they&apos;re all excellent articles.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;As stated BizTalk has quite a significant number of steps but to my knowledge it’s missing a step to change and update file from within the test script. This step and a couple of other are added in separate fork-project to BizUnit called &lt;a href=&quot;http://www.codeplex.com/bizunitextensions&quot;&gt;BizUnitExtensions&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;This project [_BizUnitExtension_] aims to provide some more test step libraries, tools and utilities to enhance the reach of BizUnit. Here you can find some enhancements/extensions to the steps in the base libraries , new steps, support applications, tutorials and other documentation to help you understand and use it....This project is currently owned and contributed to by Santosh Benjamin and Gar Mac Críostaand. Our colleagues have also contributed steps and suggestions. We welcome more participation and contributions. 
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;Amongst other steps (some for Oracle DBs etc) BizUnitExtensions adds a &lt;a href=&quot;http://www.codeplex.com/bizunitextensions/Wiki/View.aspx?title=BizUnit%20Extensions&amp;amp;referringTitle=Documentation&quot;&gt;XmlPokeStep&lt;/a&gt;!&lt;/p&gt;

&lt;blockquote&gt;**XmlPokeStep:** This step is modelled on the lines of the NAnt XmlPoke task The XmlPokeStep is used to update data in an XML file with values from the context This will enable the user to write tests which can use the output of one step to modify the input of another step.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;A cool thing about BizUnitExtensions is that it really just extends BizUnit. You’ll continue to run on the BizUnit dll:s when you use steps form BizUnit and just use the BizUnitExtensions code when you actually use some of steps from that library.&lt;/p&gt;

&lt;p&gt;The example below shows how we first use an ordinary BizUnit task to validate and read a value from a file. We then use BizUnitExtension to gain some new powers and update the file with that value we just read.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;!–Ordinary BizUnit step to validate a file –&amp;gt;
&amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.FileValidateStep&quot;&amp;gt;
    &amp;lt;Timeout&amp;gt;5000&amp;lt;/Timeout&amp;gt;
    &amp;lt;Directory&amp;gt;..\..\ReceiveRequest&amp;lt;/Directory&amp;gt;
    &amp;lt;SearchPattern&amp;gt;*Request.xml&amp;lt;/SearchPattern&amp;gt;
    &amp;lt;DeleteFile&amp;gt;false&amp;lt;/DeleteFile&amp;gt;

    &amp;lt;ContextLoaderStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.XmlContextLoader&quot;&amp;gt;
        &amp;lt;XPath contextKey=&quot;messageID&quot;&amp;gt;/*[local-name()=’SystemRequest’]/ID&amp;lt;/XPath&amp;gt;
    &amp;lt;/ContextLoaderStep&amp;gt;

&amp;lt;/TestStep&amp;gt;

&amp;lt;!–Use BizUnitExtensions to poke the value and change it –&amp;gt;
&amp;lt;TestStep assemblyPath=&quot;BizUnitExtensions.dll&quot; typeName=&quot;BizUnit.Extensions.XmlPokeStep&quot;&amp;gt;
    &amp;lt;InputFileName&amp;gt;..\..\SystemResponse.xml&amp;lt;/InputFileName&amp;gt;
    &amp;lt;XPathExpressions&amp;gt;
        &amp;lt;Expression&amp;gt;
            &amp;lt;XPath&amp;gt;/*[local-name()=’SystemResponse’]/ID&amp;lt;/XPath&amp;gt;
            &amp;lt;NewValue takeFromCtx=&quot;messageID&quot;&amp;gt;&amp;lt;/NewValue&amp;gt;
        &amp;lt;/Expression&amp;gt;
    &amp;lt;/XPathExpressions&amp;gt;
&amp;lt;/TestStep&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This of course means that all you need to extend you current test steps and gain some cool new abilities is to add another assembly to you test project&lt;img src=&quot;../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286image-8.png&quot; alt=&quot;![image](../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286image-thumb-3.png)&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;using-bizunitextensions-in-a-real-scenario&quot;&gt;Using BizUnitExtensions in a “real” scenario&lt;/h3&gt;

&lt;p&gt;An scenario when this can be useful is the following example were we need to test some message correlation.&lt;a href=&quot;../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286image-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286image-thumb.png&quot; alt=&quot;image&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;A message request is received via a web service.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;The message is sent to a queue via an orchestration in BizTalk. &lt;em&gt;To be able to correlate the response &lt;strong&gt;a message id is added to the message request&lt;/strong&gt; sent to the back-end system.&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A message response is sent from the back-end system using a second queue. &lt;em&gt;The response message contains the same message id as the incoming request contained&lt;/em&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;BizTalk correlates the message back to the web service using the message id.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;So how can we &lt;strong&gt;&lt;em&gt;now test this&lt;/em&gt;&lt;/strong&gt;? The steps should be something like the below.&lt;/p&gt;

&lt;blockquote&gt;

&amp;gt; 
&amp;gt; [![note](../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286note-thumb-1.gif)](../assets/2008/10/windowslivewriterusingbizunitextensionstopokesomexml-d286note-4.gif) Notice that we read and write to the file system in the example. Once deployed to test these send ports and receive location will be reconfigured to use the queuing adapter. But for testing the scenario the file system works just fine a simplifies things IMHO.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;ol&gt;
  &lt;li&gt;Send a request message using BizUnit and the &lt;em&gt;HttpRequestResponseStep&lt;/em&gt;. Make sure it runs &lt;em&gt;&lt;strong&gt;concurrently&lt;/strong&gt;&lt;/em&gt; with the other steps and then wait for a response (using the _runConcurrently-_attribute on the step).&lt;/li&gt;
  &lt;li&gt;Configure the send port so the orchestration that added the generated message id writes the message to a folder. Use the &lt;em&gt;FileValidateStep&lt;/em&gt; and a nested &lt;em&gt;XmlContextLoader&lt;/em&gt; to read the message from the folder and write the message id the context.&lt;/li&gt;
  &lt;li&gt;Use the context and the &lt;em&gt;XmlPokeStep&lt;/em&gt; from BizUnitExtensions to update a response message template with the message id from the request message (this is of course needed so we can correlate the response message back to the right orchestration).&lt;/li&gt;
  &lt;li&gt;Copy the update response message template using the &lt;em&gt;FileCreateStep&lt;/em&gt; to the folder that is monitored by the the receive location used for reading responses.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;TestCase testName=&quot;TestCorrelationTest&quot;&amp;gt;
    &amp;lt;TestSetup&amp;gt;
        &amp;lt;!–Clean up!–&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.FileDeleteMultipleStep&quot;&amp;gt;
            &amp;lt;Directory&amp;gt;..\..\ReceiveRequest&amp;lt;/Directory&amp;gt;
            &amp;lt;SearchPattern&amp;gt;*.*&amp;lt;/SearchPattern&amp;gt;
        &amp;lt;/TestStep&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.FileDeleteMultipleStep&quot;&amp;gt;
            &amp;lt;Directory&amp;gt;..\..\SendResponse&amp;lt;/Directory&amp;gt;
            &amp;lt;SearchPattern&amp;gt;*.*&amp;lt;/SearchPattern&amp;gt;
        &amp;lt;/TestStep&amp;gt;
    &amp;lt;/TestSetup&amp;gt;

    &amp;lt;TestExecution&amp;gt;
        &amp;lt;!–Post a request message on the SOAP port. Run it Concurrently–&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.HttpRequestResponseStep&quot; runConcurrently=&quot;true&quot;&amp;gt;
            &amp;lt;SourcePath&amp;gt;..\..\WebRequest.xml&amp;lt;/SourcePath&amp;gt;
            &amp;lt;DestinationUrl&amp;gt;http://localhost:8090/BizTalkWebService/WebService1.asmx?op=WebMethod1&amp;lt;/DestinationUrl&amp;gt;
            &amp;lt;RequestTimeout&amp;gt;15000&amp;lt;/RequestTimeout&amp;gt;
        &amp;lt;/TestStep&amp;gt;

        &amp;lt;!–Read the system request message and read the generaed id to the context–&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.FileValidateStep&quot;&amp;gt;
            &amp;lt;Timeout&amp;gt;5000&amp;lt;/Timeout&amp;gt;
            &amp;lt;Directory&amp;gt;..\..\ReceiveRequest&amp;lt;/Directory&amp;gt;
            &amp;lt;SearchPattern&amp;gt;*Request.xml&amp;lt;/SearchPattern&amp;gt;
            &amp;lt;DeleteFile&amp;gt;false&amp;lt;/DeleteFile&amp;gt;
            &amp;lt;ContextLoaderStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.XmlContextLoader&quot;&amp;gt;
                &amp;lt;XPath contextKey=&quot;messageID&quot;&amp;gt;/*[local-name()=’SystemRequest’]/ID&amp;lt;/XPath&amp;gt;
            &amp;lt;/ContextLoaderStep&amp;gt;
        &amp;lt;/TestStep&amp;gt;

        &amp;lt;!–If we have the file in source control it might be read-only -&amp;gt; remove that attribute–&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.ExecuteCommandStep&quot;&amp;gt;
            &amp;lt;ProcessName&amp;gt;attrib&amp;lt;/ProcessName&amp;gt;
            &amp;lt;ProcessParams&amp;gt;SystemResponse.xml -r&amp;lt;/ProcessParams&amp;gt;
            &amp;lt;WorkingDirectory&amp;gt;..\..\&amp;lt;/WorkingDirectory&amp;gt;
        &amp;lt;/TestStep&amp;gt;

        &amp;lt;!–Update our response template (using BizUnitExtensions) and add the message id that we read into the the context–&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;BizUnitExtensions.dll&quot; typeName=&quot;BizUnit.Extensions.XmlPokeStep&quot;&amp;gt;
            &amp;lt;InputFileName&amp;gt;..\..\SystemResponse.xml&amp;lt;/InputFileName&amp;gt;
            &amp;lt;XPathExpressions&amp;gt;
                &amp;lt;Expression&amp;gt;
                    &amp;lt;XPath&amp;gt;/*[local-name()=’SystemResponse’]/ID&amp;lt;/XPath&amp;gt;
                    &amp;lt;NewValue takeFromCtx=&quot;messageID&quot;&amp;gt;&amp;lt;/NewValue&amp;gt;
                &amp;lt;/Expression&amp;gt;
            &amp;lt;/XPathExpressions&amp;gt;
        &amp;lt;/TestStep&amp;gt;

        &amp;lt;!–Wait a moment so we don’t copy the file until we’re done updating it–&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.DelayStep&quot;&amp;gt;
            &amp;lt;Delay&amp;gt;1000&amp;lt;/Delay&amp;gt;
        &amp;lt;/TestStep&amp;gt;

        &amp;lt;!–Copy the file to the folder that monitored by the receive location for opicking up system responses–&amp;gt;
        &amp;lt;TestStep assemblyPath=&quot;&quot; typeName=&quot;Microsoft.Services.BizTalkApplicationFramework.BizUnit.FileCreateStep&quot;&amp;gt;
            &amp;lt;SourcePath&amp;gt;..\..\SystemResponse.xml&amp;lt;/SourcePath&amp;gt;
            &amp;lt;CreationPath&amp;gt;..\..\SendResponse\SystemResponse.xml&amp;lt;/CreationPath&amp;gt;
        &amp;lt;/TestStep&amp;gt;
    &amp;lt;/TestExecution&amp;gt;
&amp;lt;/TestCase&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This might look messy at first but I think it’s really cool I also think it worth thinking about on how you should run this at during development otherwise? You would then have to build some small stub to return a response message with the right id … I prefer this method!&lt;/p&gt;

&lt;p&gt;BizUnitExtension makes me like BizUnit even more! Thanks to &lt;a href=&quot;http://kevinsmi.blogspot.com/&quot;&gt;&lt;em&gt;Kevin. B. Smith&lt;/em&gt;&lt;/a&gt;, &lt;a href=&quot;http://santoshbenjamin.wordpress.com/&quot;&gt;&lt;em&gt;Santosh Benjamin&lt;/em&gt;&lt;/a&gt; and &lt;em&gt;&lt;a href=&quot;http://thetaoofbiztalk.blogspot.com/&quot;&gt;Gar Mac Críostaand&lt;/a&gt;&lt;/em&gt; for spending so much time on this and sharing it with us mere mortals!&lt;/p&gt;

&lt;p&gt;Update: Gar’s blog can be found &lt;a href=&quot;http://thetaoofbiztalk.blogspot.com/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>How the extend a custom Xslt in BizTalk using EXSLT and the Mvp.Xml project</title>
    <link href="http://richardhallgren.com/how-the-extend-a-custom-xslt-in-biztalk-using-exslt-and-the-mvpxml-project" />
    <updated>2008-09-05T20:15:55+00:00</updated>
    <id>http://richardhallgren.com/how-the-extend-a-custom-xslt-in-biztalk-using-exslt-and-the-mvpxml-project</id>
    <content type="html">&lt;p&gt;Lately I’ve been using custom Xslt &lt;a href=&quot;http://www.richardhallgren.com/efficient-grouping-and-debatching-of-big-files-using-biztalk-2006/&quot;&gt;more&lt;/a&gt; and more instead of the BizTalk mapping tool. I still use the mapping tool in easy scenarios when I just need to do some straight mapping or maybe even when I need to concatenate some fields, but as soon as I need to to some looping, grouping, calculations etc I’ve made a &lt;em&gt;promise&lt;/em&gt; to myself to use custom Xslt!&lt;/p&gt;

&lt;p&gt;I find custom Xslt so much easier in more complex scenarios and once one get past the template matching and understands how and when to use recursion (No you can’t reassign a variable in Xslt and you’re not supposed to!) I find it to be a &lt;strong&gt;dream&lt;/strong&gt; compared to the mapping tool. I also find the code so much easier to maintain compared to the result from the mapping tool. I mean someone would have to pay me good money to even start figuring out what &lt;a href=&quot;http://www.edsquared.com/content/binary/WindowsLiveWriter/DebugthatBizTalkMap_E215/BadMap_thumb.png&quot;&gt;this&lt;/a&gt; map is doing. And the scary thing is that if you worked with BizTalk for a while you probably know that maps like this isn’t that rare! I’ve even seen worse!&lt;/p&gt;

&lt;p&gt;Don’t get me wrong, Xslt definitely has some &lt;strong&gt;major&lt;/strong&gt; &lt;a href=&quot;http://biglist.com/lists/xsl-list/archives/200102/msg01384.html&quot;&gt;limitations&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;Some of the acute limitations of XSLT 1.0 I can think of off the top of my head are: 
&amp;gt; 
&amp;gt;   * The lack of real string comparison  
&amp;gt;   * No support for dates  
&amp;gt;   * No simple mechanism for grouping  
&amp;gt;   * No querying into RTF&apos;s 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;And it doesn’t take long before one runs up against one of these and suddenly you wish you were &lt;strong&gt;back&lt;/strong&gt; in mapping tool were we just could add scripting functoid and some code or a external assembly. But then you remember … (Sorry, I know it’s painful just to watch it).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/09/windowslivewriterhowtheextendacustomxsltinbizt.xmlproject-138fabadmap-thumb-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/09/windowslivewriterhowtheextendacustomxsltinbizt.xmlproject-138fabadmap-thumb-thumb.png&quot; alt=&quot;BadMap_thumb&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;**There has to be a better way of doing this and &lt;em&gt;combining&lt;/em&gt; the best out of the two worlds! **&lt;/p&gt;

&lt;p&gt;I started looking into to how BizTalk actually solves combining Xslt and the possibility to use external assemblies. After a couple of searches I found Yossi’s &lt;a href=&quot;http://www.sabratech.co.uk/blogs/yossidahan/archive/2005_08_01_archive.html&quot;&gt;nice article&lt;/a&gt; that explained it to me (from 2005! I’m behind on this one!) and it even turns out that there an &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms966408.aspx&quot;&gt;example&lt;/a&gt; in the BizTalk SDK.&lt;/p&gt;

&lt;p&gt;Ok, so now I had what I need. I started a new class library project and began writing some date parsing methods, some padding methods and so on.&lt;/p&gt;

&lt;p&gt;It somehow however felt wrong from the start and I got this grinding feeling that I must be reinventing the wheel (I mean these are well know limitations of Xslt and must have been solved before). Even worse I also felt that I was creating a stupid &lt;em&gt;single point of failure&lt;/em&gt; as I started using the component from all different maps in my projects and I have actually seen how much pain a bug in similar shared dll:s could cause. Basically &lt;em&gt;a small bug in the component could halt all the process using the library&lt;/em&gt;! Finally I realized that this kind of library would be under constant development as we ran into more and more areas of limitations in the our Xslt:s and that would just &lt;strong&gt;increase&lt;/strong&gt; the risk of errors and mistakes.&lt;/p&gt;

&lt;p&gt;After some further investigation I found &lt;a href=&quot;http://www.exslt.org/&quot;&gt;EXSLT&lt;/a&gt; which looked like a solution to my problems! A &lt;em&gt;stable, tested&lt;/em&gt; library of Xslt extensions that we could take dependency on as &lt;strong&gt;it’s unlikely to have any bugs and that should include the functionality we’re missing in standard Xslt!&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;how-i-used-exslt-in-biztalk&quot;&gt;How I used EXSLT in BizTalk&lt;/h3&gt;

&lt;p&gt;These days it’s the &lt;a href=&quot;http://www.codeplex.com/MVPXML/People/ProjectPeople.aspx&quot;&gt;Xml Mvp crowd&lt;/a&gt; over at the &lt;a href=&quot;http://www.codeplex.com/MVPXML&quot;&gt;Mvp.Xml project&lt;/a&gt; who develops and maintains the .NET implementation of EXSLT. So I downloaded the latest &lt;a href=&quot;http://www.codeplex.com/MVPXML/Release/ProjectReleases.aspx?ReleaseId=4894&quot;&gt;binaries&lt;/a&gt; (version 2.3). Put the the &lt;em&gt;Mvp.Xml.dll&lt;/em&gt; in the GAC. Wrote a short custom extension Xml snippet that looked like this (using what I’ve learnt from &lt;a href=&quot;http://www.sabratech.co.uk/blogs/yossidahan/archive/2005_08_01_archive.html&quot;&gt;Yossi’s article&lt;/a&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;
&amp;lt;ExtensionObjects&amp;gt;
    &amp;lt;ExtensionObject
     Namespace=&quot;http://exslt.org/dates-and-times&quot;
     AssemblyName=&quot;Mvp.Xml, 
     Version=2.3.0.0, Culture=neutral, 
     PublicKeyToken=6ead800d778c9b9f&quot;
     ClassName=&quot;Mvp.Xml.Exslt.ExsltDatesAndTimes&quot;/&amp;gt;
&amp;lt;/ExtensionObjects&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All you define is the &lt;em&gt;Xml namespace _you like to use in your Xslt to reference the dll, the _full assembly name&lt;/em&gt; and finally the &lt;em&gt;name of the class&lt;/em&gt; in &lt;em&gt;Mvp.Xml.Exslt&lt;/em&gt; you want to use (make sure you also download the source to Xml.Mvp, it helps when looking up in what classes and namespaces different methods are placed).&lt;/p&gt;

&lt;p&gt;That means you need one &lt;em&gt;ExtensionObjects&lt;/em&gt; block for each class you want you use which really isn’t a problem as the methods are nicely structured based on there functionality.&lt;/p&gt;

&lt;p&gt;Then we can use this in a Xslt like this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;
&amp;lt;xsl:stylesheet xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
                xmlns:S1=&quot;http://ExtendedMapping.Schema1&quot;
                xmlns:S2=&quot;http://ExtendedMapping.Schema2&quot;
                xmlns:exslt=&quot;http://exslt.org/dates-and-times&quot;
                version=&quot;1.0&quot;&amp;gt; 

    &amp;lt;xsl:template match=&quot;/&quot;&amp;gt;
        &amp;lt;S2:Root&amp;gt;
            &amp;lt;Field&amp;gt;
                &amp;lt;xsl:value-of select=&quot;exslt:dateTime()&quot;/&amp;gt;
            &amp;lt;/Field&amp;gt;
        &amp;lt;/S2:Root&amp;gt;
    &amp;lt;/xsl:template&amp;gt;
&amp;lt;/xsl:stylesheet&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which gives us the below output. &lt;strong&gt;Notice the current time and date! Cool!&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;S2:Root xmlns:S1=&quot;http://ExtendedMapping.Schema1&quot; xmlns:S2=&quot;http://ExtendedMapping.Schema2&quot; xmlns:exslt=&quot;http://exslt.org/dates-and-times&quot;&amp;gt;
  &amp;lt;Field&amp;gt;2008-09-05T20:45:13+02:00&amp;lt;/Field&amp;gt; 
&amp;lt;/S2:Root&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All you then have to do in you map is to reference the Xslt and the extension Xml.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/09/windowslivewriterhowtheextendacustomxsltinbizt.xmlproject-138facustom-extension-in-map-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/09/windowslivewriterhowtheextendacustomxsltinbizt.xmlproject-138facustom-extension-in-map-thumb.png&quot; alt=&quot;Custom Extension In Map&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Just as final teaser I’ll paste a few methods from the &lt;a href=&quot;http://www.exslt.org/&quot;&gt;EXSLT documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Some &lt;em&gt;string&lt;/em&gt; methods:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;str:align()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;str:concat()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;str:decode-uri()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;str:encode-uri()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;str:padding()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;str:replace()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;str:split()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;str:tokenize()&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Some &lt;em&gt;date and time&lt;/em&gt; methods:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;date:add()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:add-duration()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:date()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:date-time()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:day-abbreviation()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:day-in-month()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:day-in-week()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:day-in-year()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:day-name()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:day-of-week-in-month()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:difference()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:duration()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:format-date()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:hour-in-day()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:leap-year()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:minute-in-hour()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:month-abbreviation()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:month-in-year()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:month-name()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:parse-date()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:second-in-minute()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:seconds()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:sum()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:time()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:week-in-month()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:week-in-year()&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;date:year()&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;As if this was enough (!) the Mvp Xml project added a couple of there own methods! What about &lt;strong&gt;&lt;em&gt;string lowercase&lt;/em&gt;&lt;/strong&gt; and &lt;strong&gt;_string uppercase - _all in Xslt!&lt;/strong&gt; And about 30 new date-time related methods extra to the standard ones already in EXSLT!&lt;/p&gt;

&lt;p&gt;Check out the full documentation &lt;a href=&quot;http://www.xmllab.net/mvpxml/default.aspx&quot;&gt;here&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Let me know how it works out for you.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Efficient grouping and debatching of big files using BizTalk 2006</title>
    <link href="http://richardhallgren.com/efficient-grouping-and-debatching-of-big-files-using-biztalk-2006" />
    <updated>2008-07-16T10:06:06+00:00</updated>
    <id>http://richardhallgren.com/efficient-grouping-and-debatching-of-big-files-using-biztalk-2006</id>
    <content type="html">&lt;p&gt;I’ve seen people struggle both on the &lt;a href=&quot;http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3564558&amp;amp;SiteID=1&quot;&gt;forums&lt;/a&gt; and while doing consulting when in it comes to finding an good way of grouping and transforming content in file before debatching it. Say for example we have a text file like the example below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0001;Test row, id 0001, category 10;10 
0002;Test row, id 0002, category 10;10
0003;Test row, id 0003, category 10;10
0004;Test row, id 0004, category 20;20
0005;Test row, id 0005, category 20;20
0006;Test row, id 0006, category 20;20
0007;Test row, id 0007, category 20;20
0008;Test row, id 0008, category 10;10
0009;Test row, id 0009, category 10;10
0010;Test row, id 0010, category 30;30
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice how the the ten rows belong to three different categories (10,20 and 30). These kind of export are in my experience quite common batch export from legacy systems and they usually aren’t ten rows (in my last project the sizes ranged from 5 MB to 25 MB) …&lt;/p&gt;

&lt;h3 id=&quot;the-problem&quot;&gt;The problem&lt;/h3&gt;

&lt;p&gt;The problem is that the receiving system expects the data to be in &lt;em&gt;separate groups,&lt;/em&gt; &lt;em&gt;grouped by the categories the rows belong to&lt;/em&gt;. The expected message might look something like the below for category 10 (notice how all rows within the group are from category 10)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;ns1:Group numberOfRows=&quot;5&quot; xmlns:ns1=&quot;http://Blah/Group&quot;&amp;gt;
  &amp;lt;Row&amp;gt;
    &amp;lt;Id&amp;gt;0001&amp;lt;/Id&amp;gt;
    &amp;lt;Text&amp;gt;Test row, id 0001, category 10&amp;lt;/Text&amp;gt;
    &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
  &amp;lt;/Row&amp;gt;
  &amp;lt;Row&amp;gt;
    &amp;lt;Id&amp;gt;0002&amp;lt;/Id&amp;gt;
    &amp;lt;Text&amp;gt;Test row, id 0002, category 10&amp;lt;/Text&amp;gt;
    &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
  &amp;lt;/Row&amp;gt;
  &amp;lt;Row&amp;gt;
    &amp;lt;Id&amp;gt;0003&amp;lt;/Id&amp;gt;
    &amp;lt;Text&amp;gt;Test row, id 0003, category 10&amp;lt;/Text&amp;gt;
    &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
  &amp;lt;/Row&amp;gt;
  &amp;lt;Row&amp;gt;
    &amp;lt;Id&amp;gt;0008&amp;lt;/Id&amp;gt;
    &amp;lt;Text&amp;gt;Test row, id 0008, category 10&amp;lt;/Text&amp;gt;
    &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
  &amp;lt;/Row&amp;gt;
  &amp;lt;Row&amp;gt;
    &amp;lt;Id&amp;gt;0009&amp;lt;/Id&amp;gt;
    &amp;lt;Text&amp;gt;Test row, id 0009, category 10&amp;lt;/Text&amp;gt;
    &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
  &amp;lt;/Row&amp;gt;
&amp;lt;/ns1:Group&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is now that we need to find a efficient way of first &lt;em&gt;grouping the incoming flat file based message&lt;/em&gt; and then to _debatch it using those groups. &lt;strong&gt;Our ultimate goal is to have separate messages that groups all rows that belongs to the same category and then send these messages to the receiving system&lt;/strong&gt;. _How would you solve this?&lt;/p&gt;

&lt;p&gt;I’ve seen loads of different solution involving orchestrations, databases etc, but the main problem they all had in common is that they’ve loaded up to much of the message in memory and finally hit an &lt;em&gt;OutOfMemoryException&lt;/em&gt;.&lt;/p&gt;

&lt;h3 id=&quot;the-solution&quot;&gt;The solution&lt;/h3&gt;

&lt;p&gt;The way to solve this is to use pure messaging as one of the new features in BizTalk 2006 is the new &lt;a href=&quot;http://www.microsoft.com/technet/prodtechnol/biztalk/2006/evaluate/overview/default.mspx&quot;&gt;large messages transformation engine&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  
&amp;gt; 
&amp;gt; **Large message transformation.** In previous versions of BizTalk Server, mapping of documents always occurred in-memory. While in-memory mapping provides the best performance, it can quickly consume resources when large documents are mapped. In BizTalk Server 2006, large messages will be mapped by the new large message transformation engine, which buffers message data to the file system, keeping the memory consumption flat.
&amp;gt; 
&amp;gt; 
&lt;/blockquote&gt;

&lt;p&gt;So the idea is the to read the incoming flat file, use the &lt;a href=&quot;FlatFileDisassembler&quot;&gt;Flat File Disassembler&lt;/a&gt; to transform the message to it’s XML representation (step 1,2 and in the figure below) and the to use XSLT to transform in to groups (step 4 and 5). We will then use the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa561814.aspx&quot;&gt;XML Disassembler&lt;/a&gt; to split those groups into separate messages containing all the rows within a category (step 6 and 7).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/07/windowslivewriterefficientgroupingandsplittingofbigfiles-8295groupingflow2-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/07/windowslivewriterefficientgroupingandsplittingofbigfiles-8295groupingflow2-thumb.png&quot; alt=&quot;GroupingFlow2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Step 1, 2 and 3 are &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa577898.aspx&quot;&gt;straight forward&lt;/a&gt; and pure configuration. Step 4 and 5 will require some custom XSLT and I’ll describe that in more detail in the section below. Step 6 and 7 will be discussed in the last section of the post.&lt;/p&gt;

&lt;h4 id=&quot;grouping&quot;&gt;Grouping&lt;/h4&gt;

&lt;p&gt;Let’s start by looking at a way to group the message. I will use some custom XSLT and a technique called the &lt;a href=&quot;http://www.jenitennison.com/xslt/grouping/muenchian.html&quot;&gt;Muenchian method&lt;/a&gt;. A segment from the XML representation of the flat file message could look something like this.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Rows xmlns=&quot;http://Blah/Incoming_FF&quot;&amp;gt;
    &amp;lt;Row xmlns=&quot;&quot;&amp;gt;
        &amp;lt;ID&amp;gt;0001&amp;lt;/ID&amp;gt;
        &amp;lt;Text&amp;gt;Test row, id 0001, category 10&amp;lt;/Text&amp;gt;
        &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
    &amp;lt;/Row&amp;gt;
    &amp;lt;Row xmlns=&quot;&quot;&amp;gt;
        &amp;lt;ID&amp;gt;0002&amp;lt;/ID&amp;gt;
        &amp;lt;Text&amp;gt;Test row, id 0002, category 10&amp;lt;/Text&amp;gt;
        &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
    &amp;lt;/Row&amp;gt;
...
[message cut for readability]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The XSLT will use could look something like the below. It’s kind of straight forward and I’ve tried commenting the important parts of in the actual script. Basically it will use keys to fins the unique categories and then (again using keys) selecting those rows within the category to loop and write to a group.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;

&amp;lt;xsl:stylesheet version=&quot;1.0&quot;
                xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
                xmlns:ns1=&quot;http://GroupAndDebatch.Schemas.Incoming_FF&quot;
                xmlns:ns2=&quot;http://GroupAndDebatch.Schemas.Grouped&quot;
                &amp;gt;
    &amp;lt;!--Defining the key we&apos;re gonna use--&amp;gt;
    &amp;lt;xsl:key name=&quot;rows-by-category&quot; match=&quot;Row&quot; use=&quot;Category&quot; /&amp;gt;

    &amp;lt;xsl:template match=&quot;/ns1:Rows&quot;&amp;gt;
        &amp;lt;ns2:Groups&amp;gt;
        
        &amp;lt;!--Looping the unique categories to get a group for--&amp;gt;
        &amp;lt;xsl:for-each select=&quot;Row[count(. | key(&apos;rows-by-category&apos;, Category)[1]) = 1]&quot;&amp;gt;
            
            &amp;lt;!--Creating a new group and set the numberOfRows--&amp;gt;
            &amp;lt;Group numberOfRows=&quot;{count(key(&apos;rows-by-category&apos;, Category))}&quot;&amp;gt;
            
            &amp;lt;!--Loop all the rows within the specific category we&apos;re on--&amp;gt;
            &amp;lt;xsl:for-each select=&quot;key(&apos;rows-by-category&apos;, Category)&quot;&amp;gt;
                &amp;lt;Row&amp;gt;
                    &amp;lt;ID&amp;gt;
                        &amp;lt;xsl:value-of select=&quot;ID&quot;/&amp;gt;
                    &amp;lt;/ID&amp;gt;
                    &amp;lt;Text&amp;gt;
                        &amp;lt;xsl:value-of select=&quot;Text&quot;/&amp;gt;
                    &amp;lt;/Text&amp;gt;
                    &amp;lt;Category&amp;gt;
                        &amp;lt;xsl:value-of select=&quot;Category&quot;/&amp;gt;
                    &amp;lt;/Category&amp;gt;
                &amp;lt;/Row&amp;gt;
            &amp;lt;/xsl:for-each&amp;gt;
            &amp;lt;/Group&amp;gt;
        &amp;lt;/xsl:for-each&amp;gt;
        &amp;lt;/ns2:Groups&amp;gt;
    &amp;lt;/xsl:template&amp;gt;

&amp;lt;/xsl:stylesheet&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  
&amp;gt; 
&amp;gt; [![note](../assets/2008/07/windowslivewriterefficientgroupingandsplittingofbigfiles-8295note-thumb.gif)](../assets/2008/07/windowslivewriterefficientgroupingandsplittingofbigfiles-8295note-2.gif)You have found all the [XSLT and XML related features](http://msdn.microsoft.com/en-us/library/aa302298.aspx) in Visual Studio - right?
&amp;gt; 
&amp;gt; 
&lt;/blockquote&gt;

&lt;p&gt;Ok, so the above XSLT will give us a XML structure that looks some like this.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;
&amp;lt;ns2:Groups xmlns:ns2=&quot;http://Blah/Groups&quot; xmlns:ns1=&quot;http://Blah/Group&quot;&amp;gt;
    &amp;lt;ns1:Group numberOfRows=&quot;5&quot;&amp;gt;
        &amp;lt;Row&amp;gt;
            &amp;lt;ID&amp;gt;0001&amp;lt;/ID&amp;gt;
            &amp;lt;Text&amp;gt;Test row, id 0001, category 10&amp;lt;/Text&amp;gt;
            &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
        &amp;lt;/Row&amp;gt;
        &amp;lt;Row&amp;gt;
            &amp;lt;ID&amp;gt;0002&amp;lt;/ID&amp;gt;
            &amp;lt;Text&amp;gt;Test row, id 0002, category 10&amp;lt;/Text&amp;gt;
            &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
        &amp;lt;/Row&amp;gt;
        &amp;lt;Row&amp;gt;
            &amp;lt;ID&amp;gt;0003&amp;lt;/ID&amp;gt;
            &amp;lt;Text&amp;gt;Test row, id 0003, category 10&amp;lt;/Text&amp;gt;
            &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
        &amp;lt;/Row&amp;gt;
        &amp;lt;Row&amp;gt;
            &amp;lt;ID&amp;gt;0008&amp;lt;/ID&amp;gt;
            &amp;lt;Text&amp;gt;Test row, id 0008, category 10&amp;lt;/Text&amp;gt;
            &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
        &amp;lt;/Row&amp;gt;
        &amp;lt;Row&amp;gt;
            &amp;lt;ID&amp;gt;0009&amp;lt;/ID&amp;gt;
            &amp;lt;Text&amp;gt;Test row, id 0009, category 10&amp;lt;/Text&amp;gt;
            &amp;lt;Category&amp;gt;10&amp;lt;/Category&amp;gt;
        &amp;lt;/Row&amp;gt;
    &amp;lt;/ns1:Group&amp;gt;
    &amp;lt;ns1:Group numberOfRows=&quot;4&quot;&amp;gt;
        &amp;lt;Row&amp;gt;
            &amp;lt;ID&amp;gt;0004&amp;lt;/ID&amp;gt;
            &amp;lt;Text&amp;gt;Test row, id 0004, category 20&amp;lt;/Text&amp;gt;
            &amp;lt;Category&amp;gt;20&amp;lt;/Category&amp;gt;
        &amp;lt;/Row&amp;gt;
...
[message cut for readability]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Finally! This we can debatch!&lt;/strong&gt;&lt;/p&gt;

&lt;h4 id=&quot;debatching&quot;&gt;Debatching&lt;/h4&gt;

&lt;p&gt;Debatch the &lt;em&gt;Groups&lt;/em&gt; message above is also rather straight forward and I won’t spend much time on in this post. The best way to learn more about it is to have a look ate the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms966332.aspx&quot;&gt;EnvelopeProcessing sample&lt;/a&gt; in the BizTalk SDK.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;And the end result of the debatching are single messages within a unique category, just as the receiving system expects! Problem solved.&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;issue-1---slow-transformations&quot;&gt;Issue #1 - slow transformations&lt;/h3&gt;

&lt;p&gt;The first time I’ve put a solution like this in test and started testing with some real sized messages (&amp;gt; 1 MB) I really panicked, the mapping took forever. And I really mean forever, I sat there waiting for 2-3 hours (!) for a single file getting transformed. When I had tested the same XML based file in Visual Studio the transformation took about 10 seconds so I knew that wasn’t it. With some digging &lt;a href=&quot;http://technet.microsoft.com/en-us/library/aa560481.aspx&quot;&gt;here&lt;/a&gt; I found the &lt;em&gt;TransformThreshold&lt;/em&gt; parameter.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;TransformThreshold&lt;/em&gt; decides how big a message can be in memory before BizTalk start buffering it to disk. The default value is 1 MB and one really has to be careful when changing this. Make sure you thought hard about your solution and situation before changing the value - how much traffic do you receive and how much of that can you afford reading in to memory?&lt;/p&gt;

&lt;p&gt;In my case I received a couple of big files spread out over a night so setting parameter with a large amount wasn’t really a problem and that really solved the problem. The mapping finished in below 10 minutes as I now allow a much bigger message to be read into memory and executed in memory before switching over to the large message transformation engine and start buffering to disk (which is always much slower).&lt;/p&gt;

&lt;h3 id=&quot;problem-2---forced-to-temp-storage&quot;&gt;Problem #2 - forced to temp storage&lt;/h3&gt;

&lt;p&gt;Looking at the model of the data flow again you probably see that I’m using the XML Disassembler to split the grouped files (step 5 to step 6).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/07/windowslivewriterefficientgroupingandsplittingofbigfiles-8295groupingflow3-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/07/windowslivewriterefficientgroupingandsplittingofbigfiles-8295groupingflow3-thumb.png&quot; alt=&quot;GroupingFlow3&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The only way I’ve found this to work is actually to write the Grouped XML message to file and the to read that file in to BizTalk again and in that receive pipeline debatch the message. Not the most elegant solution, but there really isn’t a another out-of-the-box way of debatching messages (the XML Assembler can’t do it) and I don’t want to use an orchestration to execute the a pipeline as I want to keep the solution pure messaging for simplicity and performance reasons.&lt;/p&gt;

&lt;h3 id=&quot;finishing-up&quot;&gt;Finishing up&lt;/h3&gt;

&lt;p&gt;Have you solved similar cases differently? I’d be very interested in your experience! I also have a sample solution of this - just send me an &lt;a href=&quot;email:richard.hallgren@gmail.com&quot;&gt;email&lt;/a&gt; and make sure you’ll get it.&lt;/p&gt;

&lt;h3 id=&quot;update&quot;&gt;Update&lt;/h3&gt;

&lt;p&gt;Also don’t miss &lt;a href=&quot;http://biztalkhotrod.com/Documents/BizTalk_HotRod_Issue6_Q2_2009.pdf&quot;&gt;this issue&lt;/a&gt; (pdf) of &lt;a href=&quot;http://biztalkhotrod.com/&quot;&gt;BizTalk Hotrod magazine&lt;/a&gt;. There is an article on “Muenchian Grouping and Sorting using Xslt” describing exactly the problem discussed above.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Running MSBuild scripts from Visual Studio</title>
    <link href="http://richardhallgren.com/running-msbuild-scripts-from-visual-studio" />
    <updated>2008-07-09T09:04:22+00:00</updated>
    <id>http://richardhallgren.com/running-msbuild-scripts-from-visual-studio</id>
    <content type="html">&lt;p&gt;&lt;a href=&quot;../assets/2008/07/windowslivewriterrunningmsbuildscriptsfromvisualstudio-9bb0msbuild2-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/07/windowslivewriterrunningmsbuildscriptsfromvisualstudio-9bb0msbuild2-thumb.png&quot; alt=&quot;MSBuild2&quot; /&gt;&lt;/a&gt;It seems like there more build script one writes, the more often one wants to run them and it’s always a bit annoying (and time consuming) having to leave Visual Studio and start MSBuild from the command line. Brennan Stehling has a cool solution to that problem &lt;a href=&quot;http://brennan.offwhite.net/blog/2007/05/31/running-msbuild-from-visual-studio/&quot;&gt;here&lt;/a&gt; were he sets up MSBuild as an external tool and runs it.&lt;/p&gt;

&lt;p&gt;One problem for us was the we had our solution files in one place on the file system and our build files in a totally different place. The solution was to add the build file for the current solution as a &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/haytww03(VS.80).aspx&quot;&gt;Solution Folder&lt;/a&gt; (as shown in the figure below) and then set MSBuild to use $(ItemDir) as its Initial Directory. That will kick of MSBuild from the directory that the current selected Solution Folder points to and in our case that’s were the XXX.Build.Article.proj file exists.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/07/windowslivewriterrunningmsbuildscriptsfromvisualstudio-9bb0msbuild-6.png&quot;&gt;&lt;img src=&quot;../assets/2008/07/windowslivewriterrunningmsbuildscriptsfromvisualstudio-9bb0msbuild-thumb-2.png&quot; alt=&quot;MSBuild&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Looking forward to stackoverflow.com</title>
    <link href="http://richardhallgren.com/looking-forward-to-stackoverflowcom" />
    <updated>2008-07-09T06:52:12+00:00</updated>
    <id>http://richardhallgren.com/looking-forward-to-stackoverflowcom</id>
    <content type="html">&lt;p&gt;&lt;a href=&quot;../assets/2008/07/windowslivewriterlookingforwardtostackoverflow.com-7cb8stackoverflow-logo-250-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/07/windowslivewriterlookingforwardtostackoverflow.com-7cb8stackoverflow-logo-250-thumb.png&quot; alt=&quot;stackoverflow-logo-250&quot; /&gt;&lt;/a&gt;I’m really looking forward to the release of s&lt;a href=&quot;http://stackoverflow.com/&quot;&gt;tackoverflow.com&lt;/a&gt; - have you heard about it? If not it’s a collaboration between &lt;a href=&quot;http://www.joelonsoftware.com/AboutMe.html&quot;&gt;Joel Spolsky&lt;/a&gt; and &lt;a href=&quot;http://www.codinghorror.com/blog/archives/000021.html&quot;&gt;Jeff Atwood&lt;/a&gt;. Joel and Jeff are of course the two blogger behind the popular &lt;a href=&quot;http://www.joelonsoftware.com/&quot;&gt;Joel on Software&lt;/a&gt; and &lt;a href=&quot;http://www.codinghorror.com/blog/&quot;&gt;Coding Horror&lt;/a&gt; blogs.&lt;/p&gt;

&lt;p&gt;Joel is also one of the founders of the &lt;a href=&quot;http://fogcreek.com/&quot;&gt;FogCreek Software&lt;/a&gt; company. FogCreek has a couple of different products but the most known is probably &lt;a href=&quot;http://fogcreek.com/FogBugz/&quot;&gt;FogBugz&lt;/a&gt; which is a really cool project management/bug tracking/wiki/support tool for software development and management. At first it might not look like a very impressing tool but have a look at &lt;a href=&quot;http://www.joelonsoftware.com/items/2007/10/24austindemo.html&quot;&gt;this presentation&lt;/a&gt; by Joel and I think you’ll start thinking different (I know we did and we’re now using it for both planing and managing big integrations projects).&lt;/p&gt;

&lt;p&gt;Anyway, if you missed the story behind stackoverflow have a look &lt;a href=&quot;http://blog.stackoverflow.com/&quot;&gt;here&lt;/a&gt; and don’t miss the &lt;a href=&quot;http://blog.stackoverflow.com/index.php?feed=podcast&quot;&gt;podcasts&lt;/a&gt; that Joel and Jeff record, some of them are really cool. I know I’ve learnt a lot by just listening in to their conversations.&lt;/p&gt;

&lt;p&gt;We not have quite a few online BizTalk communities such as &lt;a href=&quot;http://forums.microsoft.com/msdn/default.aspx?ForumGroupID=398&amp;amp;SiteID=1&quot;&gt;the Microsoft forums&lt;/a&gt;, &lt;a href=&quot;http://groups.google.com/group/microsoft.public.biztalk.general/topics&quot;&gt;Google Groups&lt;/a&gt;, &lt;a href=&quot;http://www.biztalkgurus.com/forums/default.aspx&quot;&gt;BizTalk Gurus&lt;/a&gt;, &lt;a href=&quot;http://www.facebook.com/&quot;&gt;facebook&lt;/a&gt; (search for BizTalk related groups) and at &lt;a href=&quot;https://www.linkedin.com/home&quot;&gt;LinkedIn&lt;/a&gt; (a couple of open BizTalk related groups) - is there room for another one at stackoverflow? Do we need one?&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Removing XML namespaces - revisit</title>
    <link href="http://richardhallgren.com/removing-xml-namespaces-revisit" />
    <updated>2008-06-26T07:25:33+00:00</updated>
    <id>http://richardhallgren.com/removing-xml-namespaces-revisit</id>
    <content type="html">&lt;p&gt;I have a &lt;a href=&quot;http://www.richardhallgren.com/removing-namespace-from-outgoing-messages/&quot;&gt;old post on removing XML namespace&lt;/a&gt; from outgoing messages using XSLT in a map on the send port. Removing XML namespace is usually a late requirement that shows up during integration tests with for example legacy systems that has problems reading XML and only finds XML namespaces messy and confusing and wants it removed.&lt;/p&gt;

&lt;p&gt;The post recently got commented by &lt;a href=&quot;http://codebetter.com/blogs/jeff.lynch/&quot;&gt;Jeff Lynch&lt;/a&gt; (one of the &lt;a href=&quot;http://codebetter.com/&quot;&gt;codebetter.com&lt;/a&gt; bloggers) asking me why I just didn’t create a schema without any XML namespace in it to represent the outgoing schema (see figure below) and then map to that in the send port.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/06/windowslivewriterremovingxmlnamespacesrevisit-834dremoving-xml-namespaces-revisit-2.png&quot;&gt;&lt;img src=&quot;../assets/2008/06/windowslivewriterremovingxmlnamespacesrevisit-834dremoving-xml-namespaces-revisit-thumb.png&quot; alt=&quot;Removing XML namespaces - revisit&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Say for example that we have incoming messages like the one below with namespaces.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns0:BlahRoot &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns:ns0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Sample.BlahIncomingSchema&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
  &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;BlahNode&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;Test Value&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;BlahNode&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns0:BlahRoot&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We’ve then defined a schema without namespace and map to that and get the following result.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;BlahRoot&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
  &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;BlahNode&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;Test Value&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;BlahNode&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;BlahRoot&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This method is of course much cleaner then any previous and it’s also more conceptually correct as the schema actually represents the contact between BizTalk and the receiving system (the contract is a message without namespace in it, &lt;strong&gt;not one with that we then remove&lt;/strong&gt;).&lt;/p&gt;

&lt;p&gt;The only problem with this kind of approach is that as BizTalk recognized the message type using a combination between root node and XML namespace we can’t have another schema with the &lt;em&gt;BlahRoot&lt;/em&gt; root node without a defined XML namespace. Even if those two schemas would look totally different in structure and be two different message types BizTalk would be able to see the difference (to BizTalk they both be &lt;em&gt;#BlahRoot&lt;/em&gt; message types).&lt;/p&gt;

&lt;p&gt;Thanks Jeff for pointing this out to me.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Does BizTalk have man-boobs?</title>
    <link href="http://richardhallgren.com/does-biztalk-have-man-bobs" />
    <updated>2008-06-09T07:14:04+00:00</updated>
    <id>http://richardhallgren.com/does-biztalk-have-man-bobs</id>
    <content type="html">&lt;p&gt;I’ve just finished watching &lt;a href=&quot;http://www.infoq.com/presentations/soa-without-esb&quot;&gt;this webcast&lt;/a&gt; from &lt;a href=&quot;http://qcon.infoq.com/sanfrancisco-2008/conference/&quot;&gt;QCon 2008&lt;/a&gt; with &lt;a href=&quot;http://martinfowler.com/&quot;&gt;Martin Fowler&lt;/a&gt; and &lt;a href=&quot;http://jim.webber.name/&quot;&gt;Jim Webber&lt;/a&gt;. It’s basically their view on how integration middleware is used today and how we plan and implement our SOA and ESB project.&lt;/p&gt;

&lt;p&gt;Their main point is that we use much to bloated middleware (BizTalk is mentioned as an example here) and that we should have a more agile approach to implement SOA and ESBs. They’ve used all the agile ideas (testing, isolated testable functionality, deliver small and often, continuous builds etc, etc) and applied them to integration - fair enough. I totally agree that trying to convert your complete enterprise architecture into a SOA architecture is a guaranteed failure. This is also &lt;a href=&quot;http://www.microsoft.com/biztalk/solutions/soa/overview.mspx#EZB&quot;&gt;something we heard for a while now from others&lt;/a&gt; as well.&lt;/p&gt;

&lt;p&gt;I do also agree that BizTalk is a huge platform and that it isn’t perfect in all aspects. IMHO it does however give us some important advantages compared to a custom coded message bus and services. I’ll try and list a few of them below.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Fixed architecture&lt;/strong&gt;       &lt;br /&gt;
We don’t have invent the wheel every time. BizTalk is a product with an &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa561521.aspx&quot;&gt;architecture&lt;/a&gt; that one have to learn and use. There are times when this is a pain (did I hear low latency and BizTalk persistence points?) but it’s also a huge kick start to all projects once you learnt it. Once you figured out how you use the products you’ll actually have something up and running in no time.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Isn’t an early delivery that we can test something good? I’m sure I can deliver a BizTalk based integration faster that some can using custom code when starting from scratch.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Drag-and-drop&lt;/strong&gt;       &lt;br /&gt;
There is a learning curve to BizTalk and all it’s tools but once one gotten over this one can move really fast, even without a deep understanding of .NET and software development (there are of course both pros and cons to this). I’ve seen projects with 50+ integration processes (to me that’s a big, complex project) where we actually used people fresh out of school, spent two weeks to teach them basic BizTalk and had them deliver critical parts of the projects. I’d like to see that happen custom coded ESB project with thousands lines of code …&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;You probably get a nice design and implementation if you can hire 10 top developers and a couple of architects, but that isn’t always possible.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Tools        &lt;br /&gt;
**Does a custom code, lean approach, really scale in this scenario? Do you take the time to pause and build that management and configuration tool that you don’t get with a custom code project? I don’t say that we got the perfect view and control of our processes and messages in BizTalk but at least we got **some&lt;/strong&gt; control. At least I got the &lt;a href=&quot;http://technet.microsoft.com/en-us/library/aa578089.aspx&quot;&gt;BizTalk Administration Console&lt;/a&gt; to let me see how my different application are doing, what messages and process etc that got suspended. At least I got the BAM framework where I can configure a tracking and monitoring in no time (usually …) etc, etc.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**It works        &lt;br /&gt;
**Say your implementing a process that receives purchase orders and that these orders might contain orders for a couple of millions dollars. Do you want to be developer that tells you boss that you think you might have lost a message due to a exception in your custom code? Of course you have 90% test coverage and continuous integration but you never tested for this exception case … I don’t want to be that developer/architect.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I don’t say don’t test. I’m very pro testing and I really feel that agile is the right approach. I’m just saying I need something tested and safe to build this super critical solutions on. Something that I know works and that I can be really productive on and start solving business cases from minute one.&lt;/p&gt;

&lt;p&gt;What do you think? Does BizTalk have man-bobs and is that only a bad thing? And does Martin Fowler really have leather pants on?&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Speaking at KNUG - Karlstad .NET User Group</title>
    <link href="http://richardhallgren.com/speaking-at-knug-karlstad-net-user-group" />
    <updated>2008-05-09T14:05:53+00:00</updated>
    <id>http://richardhallgren.com/speaking-at-knug-karlstad-net-user-group</id>
    <content type="html">&lt;p&gt;Yesterday I presented the &lt;a href=&quot;http://www.richardhallgren.com/talking-at-developer-summit-on-masterdata-management-using-biztalk-2006/&quot;&gt;MasterData Management using BizTalk 2006 R2 talk&lt;/a&gt; (I’ll soon have a post out with the presentation in English) I recently held at Developer Summit at the local .NET user group in Karlstad (&lt;a href=&quot;http://www.compare.se/index.asp?id=6221&quot;&gt;KNUG&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/05/windowslivewriterspeakingatknugkarlstad.netusergroup-e257janolof-on-how-to-be-cool.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/05/windowslivewriterspeakingatknugkarlstad.netusergroup-e257janolof-on-how-to-be-cool-thumb.jpg&quot; alt=&quot;Janolof on how to be cool&quot; /&gt;&lt;/a&gt;KNUG is a new .NET user group that I actually helped start a couple of months ago. This meeting was the second meeting for the group. The meeting was attended by about 20 persons and we had two presentations on the agenda. Besides my own Thomas Heder showed the group some &lt;a href=&quot;http://en.wikipedia.org/wiki/Language_Integrated_Query&quot;&gt;LINQ&lt;/a&gt; and how he and his colleagues uses &lt;a href=&quot;http://www.linqpad.net/&quot;&gt;LINQPad&lt;/a&gt; to develop and test there queries.&lt;/p&gt;

&lt;p&gt;We also discussed future subjects, possible speakers and moving information on the group over to a &lt;a href=&quot;http://communityserver.com/&quot;&gt;Community Server&lt;/a&gt; driven site.&lt;/p&gt;

&lt;p&gt;Does anyone have any experience on Community Server and how the feature set matches those need for running a user group (managing users, blogs, email lists, calendar etc)?&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Using BAM for latency tracking in a BizTalk request response scenario</title>
    <link href="http://richardhallgren.com/using-bam-for-latency-tracking-in-a-biztalk-request-response-scenario" />
    <updated>2008-04-28T13:35:15+00:00</updated>
    <id>http://richardhallgren.com/using-bam-for-latency-tracking-in-a-biztalk-request-response-scenario</id>
    <content type="html">&lt;p&gt;This post will try and explain how BAM tracking can be used in SOAP based request response scenario in BizTalk 2006. It important to notice that some of the issues discussed in the post are specific to the SOAP adapter and are non-issues if the scenario would for example use the the WCF adapter or similar.&lt;/p&gt;

&lt;h3 id=&quot;describing-the-scenario&quot;&gt;Describing the scenario&lt;/h3&gt;

&lt;p&gt;In this case we have a SOAP receive port that receives a request and returns a response. The request is routed to a orchestration that calls three different send ports. These ports then sends new requests to back-end systems and returns responses (communication with back-ends systems are also SOAP based). The three responses are used to build up the final response that is then returned to original receive port as a final response.&lt;/p&gt;

&lt;p&gt;Our goal is to track the duration between the request and response on each of the ports. The idea is also to find a solution and tracking model that doesn’t have to change if we add or remove ports or add similar processes to track.&lt;/p&gt;

&lt;h4&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bscenario-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bscenario-thumb.jpg&quot; alt=&quot;scenario&quot; /&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;h4 id=&quot;defining-and-deploying-the-tracking-model&quot;&gt;Defining and deploying the tracking model&lt;/h4&gt;

&lt;p&gt;We’ll start by defining our tracking model in Excel. Our activity contains of the following items:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;InterchangeId&lt;/strong&gt; (data item)       &lt;br /&gt;
As we won’t correlate all the tracking point into one single row (that would break the goal of having one model for all processes, the model would then have to be specific for one process and it’s specific ports) the interchange id will then tell us what different rows belong together and that describes one process.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ReceivePortName&lt;/strong&gt; (data item)       &lt;br /&gt;
The name of the receive port.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Request&lt;/strong&gt; (milestone item)       &lt;br /&gt;
The time the request was either sent or received (depending on if we track a port that received/sent the request using a receive port or send port).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Response&lt;/strong&gt; (milestone item)       &lt;br /&gt;
The time the response was either sent or received (depending on if we track a port that received/sent it’s response on a receive port or send port).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;SendPortName&lt;/strong&gt; (data item)       &lt;br /&gt;
The name of the send port.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After we described the model it’s time to export it to an XML representation and then to use the &lt;a href=&quot;http://technet.microsoft.com/en-us/library/aa547898.aspx&quot;&gt;BM tool&lt;/a&gt; to deploy it and generate the BAM database infrastructure. You’ll find some nice info on this &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa558802.aspx&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;using-the-tracking-profile-editor-to-bind-the-model&quot;&gt;Using the Tracking Profile Editor to bind the model&lt;/h3&gt;

&lt;p&gt;Next step is to bind the model to the implementation using the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms946851.aspx&quot;&gt;Tracking Profile Editor&lt;/a&gt;. The figure below shows the different properties that were used. Notice that none of the items was bound to the actual orchestration context. All properties are general properties that we track &lt;strong&gt;on the ports&lt;/strong&gt;.** **This is important as that gives us the possibility to just add and remove ports to change the tracking.&lt;/p&gt;

&lt;p&gt;**&lt;a href=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0btracking-profile-using-continuation-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0btracking-profile-using-continuation-thumb.jpg&quot; alt=&quot;tracking profile using continuation&quot; /&gt;&lt;/a&gt; **&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;The next figure shows how the tracking of the request milestone event actually happens on either the RP1 port or on any of the three different send ports! If we developed a new process using other ports we could just add it here, no new model required.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0btracking-profile-configure-ports-2-4.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0btracking-profile-configure-ports-2-thumb-1.jpg&quot; alt=&quot;tracking profile configure ports 2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;what-about-the-continuation-then&quot;&gt;What about the continuation then?&lt;/h3&gt;

&lt;p&gt;Our final problem is that unless we somehow correlate our request tracking point with our receive tracking point the receive we’ll end up with each tracking point spread over several different rows. In the example below I’ve marked the request for the RP01 port and the response event on the same port.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bbam-portal-split-results-4.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bbam-portal-split-results-thumb-1.jpg&quot; alt=&quot;bam portal split results&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The reason for this is of course that BAM doesn’t have a context for the two tracking points and doesn’t know that actually belongs together. This differs from tracking in a orchestration were we always are in a context (the context of the orchestration), it’s then easy for BAM to understand that we like to view all the tracking point as one row – when tracking on ports it’s different. Continuation helps us tell BAM that we like have a context and correlate these two points.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0btracking-profile-using-continuation-2-6.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0btracking-profile-using-continuation-2-thumb-2.jpg&quot; alt=&quot;tracking profile using continuation 2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In our case ServiceID is the prefect candidate for correlating the two points. A request and a response will have the same service id. In an other situation we could just as well have used a value from inside the message (say for example an invoice id).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The result is one single row for the request response for each port&lt;/strong&gt;. So in our case a complete process (a complete interchange) is shown on four rows (one row for each of the ports). In the example below the first rows shows us the complete duration (and the other tracking data) between the request response to the client. The other rows show the duration for the send ports communication with the back-ends systems.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bbam-portal-complete-results-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bbam-portal-complete-results-thumb.jpg&quot; alt=&quot;bam portal complete results&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This model might not be optimal in an other scenario where your process are more fixed and you can then create a tracking model that is more specific to you actual process. But this solution meets our design goal as we’re now able to just add and remove port using the tracking profiler to track new port in completely new processes without having to go back and change the tracking model.&lt;/p&gt;

&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; [![note](../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bnote-thumb.gif)](../assets/2008/04/windowslivewriterusingbamforlatencytrackinginabiztalkrequ-9c0bnote-2.gif) NOTE: When configuring BAM to track a port the _[MessageType](http://msdn2.microsoft.com/en-us/library/aa561650.aspx)_ is actually promoted. This causes some problems in combination with the SOAP based ports that have been published using the Web Services Publishing Wizard. Saravana writes about this [here](http://www.digitaldeposit.net/blog/2007/08/soap-adapter-and-biztalk-web-publishing.html) and all his articles on this subject is a must read when working with SOAP ports. The problem however comes down to that the Web Services Publishing Wizard generates code that puts the wrong _DocumentSpecName _in the message context and that causes the _XmlDisassembler_ to fail (it tricks the _XmlDisassembler_ to look for a _MessageType_ that doesn&apos;t exists).
&amp;gt; 
&amp;gt;    
&amp;gt; 
&amp;gt; This usually isn’t a problem (unless you like to use a map on a port) but as BAM will force the port to promote the _MessageType_ based on the _DocumentSpecName _we’ll have to fix this. Saravana has two solutions to the problem and I find the one that replaces the _DocumentSpecName_ with a null value and lets the _XmlDisassembler_ find the _MessageType_ to work well.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;
</content>
  </entry>
  
  <entry>
    <title>Speaking at Developer Summit on Masterdata Management using BizTalk 2006</title>
    <link href="http://richardhallgren.com/talking-at-developer-summit-on-masterdata-management-using-biztalk-2006" />
    <updated>2008-04-24T20:33:39+00:00</updated>
    <id>http://richardhallgren.com/talking-at-developer-summit-on-masterdata-management-using-biztalk-2006</id>
    <content type="html">&lt;p&gt;I recently spoke at the leading developer conference here in Sweden called &lt;a href=&quot;http://www.expertzone.se/dev08/&quot;&gt;Developer Summit&lt;/a&gt;. The talk was called &lt;em&gt;Masterdata Management using BizTalk 2006&lt;/em&gt;. The slides can be found &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/MasterData%20Management%20-%20Developer%20Summit%203.0.ppt&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I can really recommend Developer Summit as a conference. Everything is super well organized and having the opportunity to listen to celebrities like &lt;a href=&quot;http://www.davidchappell.com/blog/&quot;&gt;David Chappell&lt;/a&gt;, &lt;a href=&quot;http://jim.webber.name/&quot;&gt;Jim Webber&lt;/a&gt;, &lt;a href=&quot;http://dannorth.net/&quot;&gt;Dan North&lt;/a&gt; and &lt;a href=&quot;http://blogs.thinktecture.com/cweyer/&quot;&gt;Christian Weyer&lt;/a&gt; &lt;strong&gt;in Sweden&lt;/strong&gt; is really great!&lt;/p&gt;

&lt;p&gt;This year I also liked the mix of presentation as some where more general presentation as for example Benjamin Ling who’s the director of platform at Facebook and who gave an insight to how the platform is managed and developed. I also really enjoyed (besides the obvious ones as for example Christian Weyer’s WCF talk) Frans Hanel’s talk on the history and architecture behind a major price comparison site called &lt;a href=&quot;http://prisjakt.nu/&quot;&gt;prisjakt.nu&lt;/a&gt; - very interesting and a great technical mix in otherwise Microsoft focused conference.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Writing BizTalk context properties to a message from a WCF service using behaviors</title>
    <link href="http://richardhallgren.com/writing-biztalk-context-properties-to-a-message-from-a-wcf-service-using-behaviors" />
    <updated>2008-04-24T17:43:28+00:00</updated>
    <id>http://richardhallgren.com/writing-biztalk-context-properties-to-a-message-from-a-wcf-service-using-behaviors</id>
    <content type="html">&lt;p&gt;The new WCF adapter in BizTalk 2006 R2 offers a lot of new possibilities. One of those is to write data to the BizTalk Message context properties directly from an exposed WCF Service. A practical use of this technic could be to write the username from the Windows credentials of the calling client into the context of the BizTalk message. This could be useful as this information is encrypted in messages that are received via the WCF adapter and isn’t possible to read when inside BizTalk. I’ll try and demonstrate the technique in this post.&lt;/p&gt;

&lt;p&gt;If you have used the SOAP adapter before you might know that all you had to do was to turn on Windows based security for the exposed SOAP service and the username was automatically promoted to the context of the incoming BizTalk message. That username could then be used for routing, tracking which user called the service or using the value in plain text when communicating further to other connected systems. However using the WCF adapter this is not true anymore - when using the new &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms789036.aspx&quot;&gt;WCF Message Security model&lt;/a&gt; the username and password is encrypted in the message and once the message is received by BizTalk it’s to late to read it. Basically we have to read the username in the actual service and write it into our own context property (that doesn’t get encrypted).&lt;/p&gt;

&lt;p&gt;One way of achieving this is to read the username in the service and then to add it to the WCF Message Headers. All WCF message headers will by default be written to a the BizTalk Message context property called &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/bb259987.aspx&quot;&gt;InboundHeaders&lt;/a&gt; (in the &lt;em&gt;http://schemas.microsoft.com/BizTalk/2006/1/Adapters/WCF-properties&lt;/em&gt; namespace). First we’ll create an EndpointBehavior that will use a MessageInspector to add the username to the message header. Finally we create BehaviorExtensionElement so we can use a WCF Custom Binding in BizTalk and configure it to add our new behavior.&lt;/p&gt;

&lt;h3 id=&quot;creating-the-new-endpointbehavior&quot;&gt;Creating the new EndpointBehavior&lt;/h3&gt;

&lt;p&gt;To create the configurable behavior we’ll need the three classes we mentioned above.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;A class that implements the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.servicemodel.dispatcher.idispatchmessageinspector.aspx&quot;&gt;IDispatchMessageInspector&lt;/a&gt; interface to handle to reading and writing to the actual message.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A class that implements the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.servicemodel.description.iendpointbehavior.aspx&quot;&gt;IEndpointBehavior&lt;/a&gt; interface to define what kind of endpoint we’re creating and what it should do.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A class that implements the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.servicemodel.configuration.behaviorextensionelement.aspx&quot;&gt;BehaviorExtensionElement&lt;/a&gt; abstract class to create the behavior and make it configurable.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.Collections.Generic;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.Text;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.ServiceModel;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.ServiceModel.Channels;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.ServiceModel.Dispatcher;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.ServiceModel.Description;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.ServiceModel.Configuration;

&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;namespace&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; CustomWCFProperties.Behavior
{
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;&amp;lt;summary&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; PromoteUserNameMessageInspector implements IDispatchMessageInspector and adds the name from the WindowsIdentity to a WCF header called WindowsUserName in the &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; text-decoration: underline&quot;&amp;gt;http://CustomWCFProperties.Schema&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; namespace. BeforeSendReply only returns as we&apos;re not interested in handling the response.
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;&amp;lt;/summary&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;class&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; PromoteUserNameMessageInspector : IDispatchMessageInspector
    {
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;#region&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; IDispatchMessageInspector Members&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;object&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; AfterReceiveRequest(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;ref&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; System.ServiceModel.Channels.Message request, System.ServiceModel.IClientChannel channel, System.ServiceModel.InstanceContext instanceContext)
        {
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; windowsUserName &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; ServiceSecurityContext.Current.WindowsIdentity.Name;
            request.Headers.Add(MessageHeader.CreateHeader(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;WindowsUserName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;http://CustomWCFProperties.Schema&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, windowsUserName));
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;null&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;;
        }

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;void&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; BeforeSendReply(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;ref&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Message reply, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;object&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; correlationState)
        {
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;;
        }

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;#endregion&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;
    }

    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;&amp;lt;summary&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; PromoteUserNameBehavior implements IEndpointBehavior and adds a message inspector to the dispatch behavior. Doesn&apos;t use any binding parameters, doesn&apos;t validate any configuration etc and can&apos;t be used in a client (only in a service).
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;&amp;lt;/summary&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;class&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; PromoteUserNameBehavior : IEndpointBehavior
    {
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;#region&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; IEndpointBehavior Members&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;void&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; AddBindingParameters(ServiceEndpoint endpoint, System.ServiceModel.Channels.BindingParameterCollection bindingParameters)
        {
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;;
        }

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;void&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; ApplyClientBehavior(ServiceEndpoint endpoint, System.ServiceModel.Dispatcher.ClientRuntime clientRuntime)
        {
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;throw&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Exception(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;The method or operation is not implemented.&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;);
        }

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;void&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; ApplyDispatchBehavior(ServiceEndpoint endpoint, System.ServiceModel.Dispatcher.EndpointDispatcher endpointDispatcher)
        {
            endpointDispatcher.DispatchRuntime.MessageInspectors.Add(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; PromoteUserNameMessageInspector());
        }

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;void&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Validate(ServiceEndpoint endpoint)
        {
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;;
        }

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;#endregion&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;
    }

    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;&amp;lt;summary&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; Defines the behavior.
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;&amp;lt;/summary&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;class&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; PromoteUserNameBehaviorElement : BehaviorExtensionElement
    {
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;protected&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;override&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;object&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; CreateBehavior()
        {
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; PromoteUserNameBehavior();
        }

        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;override&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Type BehaviorType
        {
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;get&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; { &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;typeof&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(PromoteUserNameBehavior); }
        }
    }
}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally we have to sign the assembly using a strong key and add it to the GAC.&lt;/p&gt;

&lt;h3 id=&quot;configure-the-machineconfig&quot;&gt;Configure the machine.config&lt;/h3&gt;

&lt;p&gt;As we need BizTalk and the WCF adapter to pick up the need behavior and make it possible to configure our receive port we need to to add the behavior element to the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms229697(VS.71).aspx&quot;&gt;machine.config&lt;/a&gt;. The easiest way of doing this is to use the new &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms732009.aspx&quot;&gt;WCF Service Configuration Editor tool&lt;/a&gt; and point to the machine.config file.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4promoteusernamebehavior-gac-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4promoteusernamebehavior-gac-thumb.jpg&quot; alt=&quot;PromoteUserNameBehavior GAC&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After the dll been added and the machine.config file has been saved the the line below should have been added to the [&lt;behaviorExtensions&gt; element](http://msdn2.microsoft.com/en-us/library/aa734726.aspx) (that is if you use the same strong name key as in the sample project I&apos;ve linked here).&lt;/behaviorExtensions&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000&quot;&amp;gt;add &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;name&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;=&quot;addCustomWCFProperties&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt; type&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;=&quot;CustomWCFProperties.Behavior.PromoteUserNameBehaviorElement, AddCustomWCFPropertiesBehavior, Version=1.0.0.0, Culture=neutral, PublicKeyToken=705e34637fdffc54&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;create-the-biztalk-receive-port-and-receive-location&quot;&gt;Create the BizTalk Receive Port and Receive Location&lt;/h3&gt;

&lt;p&gt;Next thing to do is to start the BizTalk WCF Service Publishing Wizard. Choose to publish a service endpoint and make sure you enable metadata and create a receive location. In this example we’ll next choose to “Publish schemas as WCF service” and then define our service by naming service operations and so on.&lt;/p&gt;

&lt;p&gt;When you then browse to the URL you choose to publish your service to you’ll see the nice example of how to instance the service you just defined.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4wsdl-code-example-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4wsdl-code-example-thumb.jpg&quot; alt=&quot;WSDL code example&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If we then send a request message to service (you’ll find a client as part of the &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/CustomWCFProperties.zip&quot;&gt;attached solution here&lt;/a&gt;) and inspect the message and its context properties in BizTalk we’ll see that the username of the calling client is nowhere to be found.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4message-no-username-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4message-no-username-thumb.jpg&quot; alt=&quot;Message No Username&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;configure-a-wcf-custom-binding-and-adding-a-endpoint-behavior&quot;&gt;Configure a WCF-Custom binding and adding a Endpoint Behavior&lt;/h3&gt;

&lt;p&gt;To add the username to the message context we’ll need to add our newly created behavior to our service. We’ll do this by switch the service over to use a WCF-Custom binding to enable configuration. We then need to add the URL in the address field, define the binding type to a wsHttpBinding and to add our addCustomeWCFProperties behavior to the list of endpoint behaviors.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4add-endpoint-behavior-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4add-endpoint-behavior-thumb.jpg&quot; alt=&quot;Add Endpoint behavior&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  
&amp;gt; 
&amp;gt; [![note](../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4note-thumb.gif)](../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4note-2.gif) NOTE: there is a limitation in the BizTalk WCF implementation in that you can&apos;t create the WCF-Custom receive location that uses a HTTP in-process based binding (like the wsHttpBinding used in a WCF-Custom endpoint is) first and then use the WCF Publishing Wizard to only publish a metadata endpoint.
&amp;gt; 
&amp;gt; 

  
&amp;gt; 
&amp;gt; [Richard Seroter writes about it here](http://www.topxml.com/code/cod-72_10213_biztalk-and-wcf-part-v-publishing-operations-patterns.aspx) and I found the same thing to be true.
&amp;gt; 
&amp;gt; 

  
&amp;gt; 
&amp;gt; _&quot;This error doesn’t have to do with mixing MEX endpoints and “regular” endpoints in the same IIS web site, but rather, creating MEX endpoints for in-process HTTP bindings seems to trigger this. **Note that an IIS-hosted MEX endpoint CAN be created for IIS-hosted HTTP endpoints, but not for in-process hosted HTTP endpoints.&quot;**_
&amp;gt; 
&amp;gt; 

  
&amp;gt; 
&amp;gt; If you however choose a different binding that Http or (as in this case) publishes the metadata first and then switches over to a custom binding you&apos;re ok.
&amp;gt; 
&amp;gt; 
&lt;/blockquote&gt;

&lt;p&gt;If we then post another message to the service and inspect the message we’ll see that the behavior actually added a header and that it’s part of our BizTalk context properties. The adapter is also smart enough to know that this header isn’t part of the original headers and therefore stores in it’s own field within the context properties (you’ll find as part of the InboundHeaders block as well).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4message-username-4.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4message-username-thumb-1.jpg&quot; alt=&quot;Message Username&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One problem remains - the actual value of the user is nested inside a XML node and the property isn’t promoted.&lt;/p&gt;

&lt;h3 id=&quot;extract-and-promote-the-value&quot;&gt;Extract and promote the value&lt;/h3&gt;

&lt;p&gt;To extract and promote the value we use an old fashion pipeline component using the following code in the execute method (the complete project is part of the &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/CustomWCFProperties.zip&quot;&gt;downloadable sample project&lt;/a&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; IBaseMessage Execute(IPipelineContext pc, IBaseMessage inmsg)
        {
            StringReader reader &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; StringReader(inmsg.Context.Read(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;WindowsUserName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;http://CustomWCFProperties.Schema&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;).ToString());
            
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;if&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; (reader &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;!=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;null&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;)
            {
                XPathDocument document &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; XPathDocument(reader);
                XPathNavigator navigator &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; document.CreateNavigator();
                &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; value &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; navigator.SelectSingleNode(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;).Value;
                inmsg.Context.Promote(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;WindowsUserName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;http://CustomWCFProperties.Schema&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, value);
            }

            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; inmsg;
        }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All the component does is reading the XML node the value exists inside and then it reads the actual value. Finally it writes the value back and promotes it. To be able to promote the value we also have to have a &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa561059.aspx&quot;&gt;Property Schema&lt;/a&gt; deployed with a corresponding property name and namespace (WindowsUser and &lt;em&gt;http://CustomeWCFProperties.Schema&lt;/em&gt; in this case).&lt;/p&gt;

&lt;p&gt;The end results looks something like this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4message-promoted-username-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/04/windowslivewriterwritingbiztalkcontextpropertiestoamessag-72f4message-promoted-username-thumb.jpg&quot; alt=&quot;Message Promoted Username&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The username is extracted and promoted and available for example for tracking or to for example use in a routing scenario.&lt;/p&gt;

&lt;p&gt;This technique could of course be used for all kinds of scenarios where you like to add information to the context properties and could potentially replace a lot of the classic scenarios for custom pipelines.&lt;/p&gt;

&lt;p&gt;All kind of comments are of course more than welcome!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.richardhallgren.com/blogfiles/CustomWCFProperties.zip&quot;&gt;Download the sample solution here&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Random thoughts on SQL Server Adapter and T-SQL Stored Procedures for BizTalk 2006</title>
    <link href="http://richardhallgren.com/random-thoughts-on-sql-server-adapter-and-t-sql-stored-procedures-for-biztalk-2006" />
    <updated>2008-02-18T22:36:06+00:00</updated>
    <id>http://richardhallgren.com/random-thoughts-on-sql-server-adapter-and-t-sql-stored-procedures-for-biztalk-2006</id>
    <content type="html">&lt;p&gt;Writing Stored Procedures is an art of its own. As all of you know it’s very different from writing ordinary code and presents its own kind of problems and issues when it comes to performance, builds, version control, testing etc. This post will try and highlight a few points that I find important when it comes to Stored Procedures, and the especially in a BizTalk and integration related scenario.&lt;/p&gt;

&lt;p&gt;Consider the simplified procedure below, I’ll use is an example for much of the discussion in the rest of the post. Basically the procedure inserts or updates (based on if the optional EmployeeID exists from before or not) employee information to the Employee table of a database named “TestDB”.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;span class=&quot;kwrd&quot;&amp;gt;&amp;lt;/span&amp;gt;



  




&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Use&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;[&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;TestDB&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Go&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; 
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;If&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;Exists&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;select&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;*&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;From&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; dbo.sysobjects &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Where&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; id &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff00ff&quot;&amp;gt;object_id&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(N&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;AddEmployee&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;And&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff00ff&quot;&amp;gt;OBJECTPROPERTY&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(id, N&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;IsProcedure&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Drop&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Procedure&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; AddEmployeeGo 
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Create&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Procedure&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; AddEmployee    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@EmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold&quot;&amp;gt;Int&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;-&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;,    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@LastName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold&quot;&amp;gt;Varchar&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;30&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;),    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@FirstName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold&quot;&amp;gt;Varchar&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;30&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;),    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@MiddleName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold&quot;&amp;gt;Varchar&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;30&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;)
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;As&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; 
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Begin&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Declare&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentEmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold&quot;&amp;gt;int&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Declare&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentAction&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold&quot;&amp;gt;tinyint&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt;--&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt; Check based on the EmployeeId if the employee exists from before    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;If&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;Not&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;Exists&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Select&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; EmployeeId &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;From&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Employee &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Where&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; EmployeeId &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@EmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;)    
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Begin&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;        
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt;--&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt; Inserts new employee        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Insert&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Into&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Employee (LastName,FirstName,MiddleName)         
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Values&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; (&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@LastName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@FirstName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@MiddleName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;)        
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Set&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentEmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff00ff&quot;&amp;gt;Scope_Identity&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;()        
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Set&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentAction&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;End&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Else&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Begin&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;        
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt;--&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt; Updates employee        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008080&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Update&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Employee &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Set&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; LastName &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@LastName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;,        
            FirstName &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@FirstName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;WHERE&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; EmployeeId &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@EmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;        
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Set&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentEmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@EmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;        
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Set&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentAction&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;2&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;    
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;End&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;      

    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Select&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentEmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;As&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;[&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;@EmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@currentAction&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;     
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;As&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;[&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;@ProcedureAction&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;For&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; Xml Path (&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;Response&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;)
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;End&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Go&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;builds-and-version-control&quot;&gt;Builds and version control&lt;/h3&gt;

&lt;p&gt;I always try to have the complete database version controlled. One solution to this that some people advocate is to have a central development database. I have however always found it to be a lot of hassle with overwriting each others changes and so on and always try to make it possible for each developer to build a local version of the database for development. It should also be possible to always check out the latest version and run it to build all the database objects - no matter what you have from before. This is of course a bit tricky when it comes to the actual tables as you might have data and so on (in my opinion it shouldn’t be the case during development but that’s another post discussing test data for the database etc).&lt;/p&gt;

&lt;p&gt;When it however comes to Stored Procedure as in this post it’s easy - &lt;strong&gt;drop the old one if it exists and create the new one as in the example&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;If&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;Exists&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;select&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;*&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;From&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; dbo.sysobjectsWhere id &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff00ff&quot;&amp;gt;object_id&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(N&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;AddEmployee&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;And&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff00ff&quot;&amp;gt;OBJECTPROPERTY&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;(id, N&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;IsProcedure&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #ff0000&quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Drop&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Procedure&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; AddEmployee
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Go&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Create&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000ff&quot;&amp;gt;Procedure&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; AddEmployee &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000&quot;&amp;gt;@EmployeeId&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold&quot;&amp;gt;Int&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080&quot;&amp;gt;-&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold&quot;&amp;gt;1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000&quot;&amp;gt;, ...&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If found &lt;a href=&quot;http://www.codinghorror.com/blog/archives/001050.html&quot;&gt;this article&lt;/a&gt; by Jeff Atwood over at &lt;a href=&quot;http://www.codinghorror.com/blog/&quot;&gt;Coding Horror&lt;/a&gt; (and &lt;a href=&quot;http://odetocode.com/Blogs/scott/archive/2008/01/30/11702.aspx&quot;&gt;the articles&lt;/a&gt; by K. Scott Allen it links to) very good on how to think about version control database objects.&lt;/p&gt;

&lt;h3 id=&quot;idempotent-procedures&quot;&gt;Idempotent procedures&lt;/h3&gt;

&lt;p&gt;In complex integration solution it’s a common problem with multiple messages - sending systems might send the same message twice for a number of reasons and one will end up with a shaky system if that causes an error in the integration. I’ve also seen solutions to this problem where a check is done against the database (say from a BizTalk orchestration) and based on that result a decision is made to call an update or an insert procedure. In my opinion that just unnecessary complexity and database communication. I believe &lt;strong&gt;one should try and handle whether to update or insert inside the procedure as long as that’s possible and effective&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;I in the AddEmployee Stored Procedure example might receive a EmployeeID as an input parameter and based on a check inside the procedure if the employee exists from before with that id a post is either updated or inserted.&lt;/p&gt;

&lt;h3 id=&quot;response-message&quot;&gt;Response message&lt;/h3&gt;

&lt;p&gt;I generally always want two things in return from a Store Procedure like the one in the AddEmployee example (In a select based procedure that would of course be very different as we like all the data in return).&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;The id that been added or changed&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;What action that’s been performed (insert or update)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;What action that was performed is a good idea to return as it’s quite usual to use this in for example BAM tracking or other logging and so on (we might want know how many employees that was added versus updated for example).&lt;/p&gt;

&lt;p&gt;Using the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms189885.aspx&quot;&gt;Xml Path syntax&lt;/a&gt; for generating the Xml response (thanks again Nick for a &lt;a href=&quot;http://www.modhul.com/2008/01/23/an-easier-way-to-do-complex-for-xml-explicit/&quot;&gt;great post&lt;/a&gt;) from the procedure has made it even simpler to actually skip using the &lt;a href=&quot;Add Generated Item&quot;&gt;Add Generated Item&lt;/a&gt; option in BizTalk. All you have think about is to &lt;strong&gt;set name of the child node the request root node to the same name as the procedure&lt;/strong&gt; (in this case AddEmployee). Also remember that the type should be &lt;strong&gt;set up as a Multi-Part Message Type in the orchestrations&lt;/strong&gt; you use it from and that the **Receive Pipeline you choose in the Send Port must use a Xml Disassembler component **(XmlReceive pipeline will do fine unless you have your custom pipeline for some reason).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235schemadbtest-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235schemadbtest-thumb.jpg&quot; alt=&quot;SchemaDBTest&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;error-handling&quot;&gt;Error handling&lt;/h3&gt;

&lt;p&gt;Some people might find it strange that I don’t have any error handling in my Stored Procedures but in most cases an error in the procedure will cause an exception in the port communication with the database and that’s fine. If I’d like to handle that error I’ll handle that either in the orchestration or using other mechanisms in BizTalk like &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa578516.aspx&quot;&gt;Failed Message Routing&lt;/a&gt; etc. &lt;strong&gt;If I can’t handle the error in the procedure I don’t see a reason to catch it.&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;security&quot;&gt;Security&lt;/h3&gt;

&lt;p&gt;I’ve seen to many cases where developers actually used the user and password login option available on the database adapter and port. Even if the credentials are safe in the SSO database there is a risk you’ll end up in a mess with login data spread all over the BizTalk administration. &lt;strong&gt;One should always use try to use Windows NT Integrated Security!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Even more common than the above is to have a user that part of the administrators group or similar to hit the database - &lt;strong&gt;don’t!&lt;/strong&gt; I usually try an set up one Host to run as in all the communication with a specific database (Could also be a Host for that database and that BizTalk Application so that different applications have their own Host). I’ll then give that specific user the **least privileges **needed in the specific database.&lt;/p&gt;

&lt;p&gt;In the AddEmployee and TestDB example I’d create &lt;strong&gt;a new Group in the AD called for example “BizTalk TestDB Users”&lt;/strong&gt;. I’d then create &lt;strong&gt;a User in the AD called “BizTalk TestDB User”&lt;/strong&gt;. It’s based on this I’d then create a Host in BizTalk referencing the above created Group.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235testdbhost-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235testdbhost-thumb.jpg&quot; alt=&quot;TestDBHost&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Finally we’ll create a Host Instance and make a Send Handler of it on the SQL Server Adapter.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235dbtesthostinstance-4.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235dbtesthostinstance-thumb-1.jpg&quot; alt=&quot;DBTestHostInstance&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235dbtestsqladapter-2.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/02/windowslivewritertsqlstoreproceduresforbiztalk-c235dbtestsqladapter-thumb.jpg&quot; alt=&quot;DBTestSqlAdapter&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now we can &lt;strong&gt;set the least required privileges on the “BizTalk TestDB Users” in Sql Server as that the Group the User belongs that’ll hit the database&lt;/strong&gt;. In this case this means granting the Group to the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa547356.aspx&quot;&gt;standard BizTalk required privileges for a Host&lt;/a&gt; besides granting it Execute right on the AddEmployee Stored Procedure.&lt;/p&gt;

&lt;p&gt;Something I missed? How do you handle your database communication and security in your BizTalk implementations?&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>A loosely coupled Scatter-and-Gather implementation In BizTalk 2006</title>
    <link href="http://richardhallgren.com/a-loosely-coupled-scatter-and-gather-implementation-in-biztalk-2006" />
    <updated>2008-01-15T17:40:05+00:00</updated>
    <id>http://richardhallgren.com/a-loosely-coupled-scatter-and-gather-implementation-in-biztalk-2006</id>
    <content type="html">&lt;h3 id=&quot;why-loose-coupling&quot;&gt;Why loose coupling?&lt;/h3&gt;

&lt;p&gt;There was a &lt;a href=&quot;http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2660792&amp;amp;SiteID=1&quot;&gt;question in Microsoft BizTalk forums&lt;/a&gt; the other day about how one could implement a &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa561967.aspx&quot;&gt;Scatter and Gather pattern&lt;/a&gt; in a more &lt;a href=&quot;http://en.wikipedia.org/wiki/Loose_coupling&quot;&gt;loosely coupled&lt;/a&gt; fashion.&lt;/p&gt;

&lt;p&gt;Most examples on the implementation of this pattern in BizTalk use the Call Shape functionality available in BizTalk orchestrations. This however creates a hard coupling between the “Scatter orchestration” and it’s “partner orchestrations”. The downside of that is that when one adds or removes a partner the whole solution has to be recompiled and redeployed.&lt;/p&gt;

&lt;p&gt;If one however could use the publish-subscribe architecture in the MessageBox to route messages between the “Gather orchestration” and it’s partners, it’d be possible to add partners without having to worry about the rest of the solution. This post shows and example on how to implement a solution like that.&lt;/p&gt;

&lt;p&gt;#&lt;/p&gt;

&lt;h3 id=&quot;the-biztalk-process-in-steps&quot;&gt;The BizTalk process in steps&lt;/h3&gt;

&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; [![Aa559774_note(ja-jp,MSDN_10)](../assets/2008/01/aa559774-noteja-jpmsdn-10-thumb.gif)](../assets/2008/01/aa559774-noteja-jpmsdn-10.gif) NOTE: Notice the difference between the **Partners**Request, the **Partners**Response, the **Partner**Request and the **Partner**Response messages. The names are unfortunately very similar.
&amp;gt; 
&amp;gt;    
&amp;gt; 
&amp;gt; The **Partners**Request and **Partners**Response messages are used for communication between the Scatter and the Gather orchestrations. It&apos;s also a **Partners**Request message that activates the process.
&amp;gt; 
&amp;gt;    
&amp;gt; 
&amp;gt; **Partner**Response and **Partner**Request are used for communicating between the Scatter and the Gather orchestration and all the partner orchestrations.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Request and scatter&lt;/strong&gt;      &lt;br /&gt;
A PartnersRequest message is received. This message is an empty message and is only used for activating the process in this example scenario. The PartnersRequest message is consumed by the Scatter orchestration. The Scatter orchestration creates one PartnerRequest message. The orchestration also generates a unique key called a RequestID and start a correlation combining that that id and the PartnersRequest MessageType. Finally it post the PartnerRequest message to message box, writes the generated RequestID to the request messages context (RequestID is a MessageContextPropertyBase based context property) and dehydrates itself.      &lt;br /&gt;
&lt;a href=&quot;../assets/2008/01/looselycoupledscattergather1.jpg&quot;&gt;&lt;img src=&quot;../assets/2008/01/looselycoupledscattergather1-thumb.jpg&quot; alt=&quot;LooselyCoupledScatterGather1&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Partners&lt;/strong&gt;      &lt;br /&gt;
All the enlisted Partner orchestrations pick up the PartnerRequest message from the message box. These orchestration then communicates with their specific data source (could be a service, database, file or whatever), receives a response. Finally these orchestrations transform the response they received and creates a PartnerResponse message that’s posted to the message box. Notice that the RequestID that was generated by the Scatter orchestration is also part of the context of the newly created PartnerResponse message.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Gather&lt;/strong&gt;      &lt;br /&gt;
The PartnerResponse messages are routed to the Gather orchestration. This orchestration uses a Singleton pattern based on the RequestID which all PartnerResponse messages carried with them in their context. This means that it’ll receive all the PartnerResponse messages containing that same RequestID into the same orchestration instance (ergo all the Partners that were activated by the request message being sent from one Scatterer). For each message instance it receives it add it’s price to a total price variable. When the Gather orchestration has received all the PartnerResponse messages (the orchestration knows how many Partners responses it should expect from one Scatterer orchestration and we can timeout if we don’t get all expected with a timeframe) the total price we calculated is written to a PartnersResponse message.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Response&lt;/strong&gt;      &lt;br /&gt;
This message is routed back the Scatter orchestration by using the correlation it initialized in the start. It’s finally this orchestration that send the final outgoing message (a PartnersResponse message).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;example-solution&quot;&gt;Example solution&lt;/h3&gt;

&lt;p&gt;An example of the implementation can be &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/LooselyCoupledScatterGatherExample.zip&quot;&gt;downloaded from here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The solution contains five different schemas.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;PartnersResponse&lt;/strong&gt;      &lt;br /&gt;
Used for initializing the process.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;PartnersRequest&lt;/strong&gt;      &lt;br /&gt;
Send from the Gather orchestration to the Scatter orchestration. It’s also the final result and outgoing message from the process.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;PartnerRequest&lt;/strong&gt;      &lt;br /&gt;
Picked up and activates all enlisted Partner orchestrations.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;PartnerRequest&lt;/strong&gt;      &lt;br /&gt;
Send from the Partner orchestration containing the result from the Partner Service and send to the Gather orchestration.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**LooselyCoupledScatterGatherExampleProperties       &lt;br /&gt;
**Property schema for storing the RequestID and to correlate all the PartnerResponses as well as the final PartnersResponse back to the Scatter orchestration.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;five-orchestrations&quot;&gt;Five orchestrations&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;**Scatterer orchestration       &lt;br /&gt;
**The “main orchestration” that receives a request message from outside and “scatters” party requests to all the party orchestrations.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**Gatherer orchestration       &lt;br /&gt;
**Gatherer orchestration that gathers all the responses from the partners and transforms these to a reply that is being routed back to the Scatterer and back out.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Partner1&lt;/strong&gt;, &lt;strong&gt;Partner2&lt;/strong&gt; and **Partner3 orchestration       &lt;br /&gt;
**Partner orchestrations that communicates to different services and receives price information.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;setting-up-and-testing-the-example-solution---its-easy&quot;&gt;Setting up and testing the example solution - it’s easy!&lt;/h4&gt;

&lt;p&gt;When the solution is built and deployed one needs to setup and bind two ports; one outgoing port and one incoming port (this could also be a Request-Response port by changing the port type in the Scatterer orchestration). &lt;strong&gt;That’s it!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Enlist and start everything by dropping a PartnersRequest test message (you’ll find one among the zipped files) in the incoming folder. A PartnersResposne message should then be published in the outgoing folder containing a calculated price from all the Partner orchestrations.&lt;/p&gt;

&lt;p&gt;Test message and a binding file are part of the &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/LooselyCoupledScatterGatherExample.zip&quot;&gt;zipped solution&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;what-would-be-different-in-real-life-solution&quot;&gt;What would be different in “real life” solution?&lt;/h3&gt;

&lt;p&gt;I’ve made some major simplifications in this example to make it easy for setting it up and test the concept. These would very different in a “real” solution.&lt;/p&gt;

&lt;h4 id=&quot;partner-services&quot;&gt;Partner Services&lt;/h4&gt;

&lt;h4 id=&quot;the-partner-orchestrations-are-very-simple-they-actually-dont-communicate-with-outside-world-at-all-all-the-do-is-setting-a-hard-coded-price-and-post-a-response-in-a-real-solution-these-would-not-be-part-of-the-same-solution-as-the-scatter-and-gather-orchestration-otherwise-we-would-be-force-to-redeploy-when-adding-a-partner-orchestration-to-the-dll&quot;&gt;The Partner orchestrations are very simple. They actually don’t communicate with outside world at all. All the do is setting a hard coded price and post a response. In a real solution these would &lt;strong&gt;not&lt;/strong&gt; be part of the same solution as the Scatter and Gather orchestration (otherwise we would be force to redeploy when adding a Partner orchestration to the dll).&lt;/h4&gt;

&lt;p&gt;The Partner orchestrations would also communicate with some sort of outbound source like a web service or database for example. This would however complicate the setup therefore I’ve skipped that part in the example.&lt;/p&gt;

&lt;h4 id=&quot;managing-partners&quot;&gt;Managing partners&lt;/h4&gt;

&lt;p&gt;One of the benefits with a loosely coupled implementation is the possibility to add and remove Partner orchestrations without having redeploy the rest of the solution. Using this implementation the Gatherer orchestration needs to know how many Partner responses it should wait for before timing out. This requires that value being set in a config file or something similar. In this example the number of Partners are hard coded into the Gather orchestration (it’s set to 3 Partners) to simplify the setup.&lt;/p&gt;

&lt;h3 id=&quot;final-thoughts&quot;&gt;Final thoughts&lt;/h3&gt;

&lt;p&gt;Knowing how to create loosely coupled solutions like this is good knowledge to have. It’s my own &lt;a href=&quot;http://msdn.microsoft.com/msdnmag/issues/07/05/BizTalk/#S2&quot;&gt;and others&lt;/a&gt; belief that this architecture makes it possible to create more robust and separated solutions that one can update without having to do a lot a work and disturb the current processes. It’s however not the best solution performancewise as it adds a lot of extra hits on the MessageBox database and generates more work for the MessageAgent.&lt;/p&gt;

&lt;p&gt;There are also a few things to watch out for:&lt;/p&gt;

&lt;h4 id=&quot;eternal-loops&quot;&gt;Eternal loops&lt;/h4&gt;

&lt;p&gt;It easy to end up in a situation where you’re subscribing to the same message as you posting to the MessageBox. That’ll create and endless loop and cause a lot disturbance before you’ll find it. Think through and document you subscriptions!&lt;/p&gt;

&lt;h4 id=&quot;correlations-for-promoting-values&quot;&gt;Correlations for promoting values&lt;/h4&gt;

&lt;p&gt;When doing a direct post in BizTalk most properties are not promoted. To &lt;a href=&quot;http://geekswithblogs.net/bloesgen/archive/2006/04/24/76278.aspx&quot;&gt;force you properties to be promoted&lt;/a&gt; you’ll have to initialize a correlation on the property as you send it. I can’t say I like this. There should be a other way of saying that one wants it promoted.&lt;/p&gt;

&lt;p&gt;A couple of other useful articles as we on the subject:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://blogs.msdn.com/biztalk_core_engine/archive/2004/07/22/191888.aspx&quot;&gt;Is there a pub/sub system underneath BizTalk?&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://blogs.msdn.com/biztalk_core_engine/archive/2004/08/03/206589.aspx&quot;&gt;Okay, so where do subscriptions come from?&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://weblogs.asp.net/gsusx/archive/2005/01/08/349177.aspx&quot;&gt;Starting BizTalk Server 2004 orchestrations using the MessageAgent.&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;http://www.richardhallgren.com/blogfiles/LooselyCoupledScatterGatherExample.zip&quot;&gt;Download the example orchestration&lt;/a&gt; and let me know how you used it and what your solution looks like!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Speaking at Developer Summit 2008!</title>
    <link href="http://richardhallgren.com/speaking-at-developer-summit-2008" />
    <updated>2007-12-20T13:26:59+00:00</updated>
    <id>http://richardhallgren.com/speaking-at-developer-summit-2008</id>
    <content type="html">&lt;p&gt;&lt;a href=&quot;http://www.expertzone.se/dev08/&quot;&gt;&lt;img src=&quot;../assets/2007/12/devsum.jpg&quot; alt=&quot;Developer Summit 2008&quot; /&gt;&lt;/a&gt;Whoho! I’ll be speaking at &lt;a href=&quot;http://www.expertzone.se/dev08/&quot;&gt;Developer Summit 2008&lt;/a&gt;. Developer Summit is a conference hosted by &lt;a href=&quot;http://www.cornerstone.se/&quot;&gt;Cornerstone&lt;/a&gt;, it’s being held in Stockholm between the 9th and 11th of April 2008.&lt;/p&gt;

&lt;p&gt;I’ll be doing a talk on &lt;a href=&quot;http://en.wikipedia.org/wiki/Reference_Data_Management&quot;&gt;Master Data Management&lt;/a&gt; (MDM) for the Enterprise using BizTalk 2006. Basically I’ll present some basic theory behind the MDM concept and how it relates to &lt;a href=&quot;http://en.wikipedia.org/wiki/Service-oriented_architecture&quot;&gt;SOA&lt;/a&gt;. Then I’ll relate all that to a customer case I recently worked on solving a MDM requirement. Finally I’ll be showing a short demo where I publish some Master Data and update all subscribers to it. In the same demo I’ll also demonstrate on how to monitor the process using &lt;a href=&quot;http://www.microsoft.com/technet/prodtechnol/biztalk/2006/evaluate/overview/default.mspx#EWC&quot;&gt;Business Activity Monitoring&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Sound interesting? Something specific you think should be in the presentation? Let me know!&lt;/p&gt;

&lt;p&gt;Hope to see you there!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Removing namespace from outgoing messages</title>
    <link href="http://richardhallgren.com/removing-namespace-from-outgoing-messages" />
    <updated>2007-12-20T12:38:24+00:00</updated>
    <id>http://richardhallgren.com/removing-namespace-from-outgoing-messages</id>
    <content type="html">&lt;p&gt;Way to often I get a request to deliver a message from BizTalk without any &lt;a href=&quot;http://en.wikipedia.org/wiki/XML_namespace&quot;&gt;XML namespace&lt;/a&gt;. Comments like the one below aren’t that rare.&lt;/p&gt;

&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; Why do you put those &quot;ns0&quot; I front of every tag!? We can&apos;t read the XML when it&apos;s written like that! All our XPath and XSLT seems to fail.
&amp;gt; 
&amp;gt;    
&amp;gt; 
&amp;gt; We don&apos;t want _**&lt;ns0:OutMessage xmlns:ns0=&quot;Acme.Messages.OutMessage/1.0&quot;&gt;**_ ... We expect the messages from you to be like _**&lt;OutMessage&gt;**_ ...
&amp;gt; 
&amp;gt;    
&amp;gt; 
&amp;gt; Is that some BizTalk specific?
&amp;gt; 
&amp;gt; &amp;lt;/blockquote&amp;gt;

 

I always try to explain what XML namespaces are, and why it&apos;s a good idea to use them (especially when it comes to versioning of messages). Sometimes it&apos;s just impossible to get people to understand the advantages of using it and to persuade them to change their solutions to handle XML namespaces. It&apos;s in these cases it&apos;ll be up to the implementation in BizTalk to remove the namespace.

 

### How to remove XML namespace

 

There are a couple of ways of achieving this, we can use [.NET code](http://www.pluralsight.com/blogs/keith/archive/2005/10/19/15714.aspx) that we call in a pipeline or in an orchestration. But we can also handle this using XSL - and that&apos;s what I&apos;ll show in this post. The XSL stylesheet below will remove all XML namespaces while transforming the message. Basically it just copies the nodes, attributes and it&apos;s values using the [local-name()](http://www.webhostingsearch.com/blogs/richard/nevermind-the-xml-namespaces-in-xpath-expressions/) function to ignore the XML namespaces.

 

  
    
    &lt;div&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&lt;?&lt;/span&gt;&lt;span style=&quot;color: #ff00ff&quot;&gt;xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;?&gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
    
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:stylesheet &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;version&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;1.0&quot;&lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;
        xmlns:xsl&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;http://www.w3.org/1999/XSL/Transform&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
    
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;match&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;/&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:copy&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:apply-templates &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:copy&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
    
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;match&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;*&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:element &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;{local-name()}&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:apply-templates &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;select&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;@* | node()&quot;&lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:element&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
    
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;match&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;@*&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:attribute &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;{local-name()}&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:value-of &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;select&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;.&quot;&lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;&lt;/span&gt;
            &lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:attribute&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
    
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template &lt;/span&gt;&lt;span style=&quot;color: #ff0000&quot;&gt;match&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;=&quot;text() | processing-instruction() | comment()&quot;&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:copy &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
        &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:template&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #000000&quot;&gt;
    
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&quot;color: #800000&quot;&gt;xsl:stylesheet&lt;/span&gt;&lt;span style=&quot;color: #0000ff&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;



  








### Apply the XSL transformation





We can use this XSL stylesheet in a ordinary BizTalk map on the send port using the _Custom XSL Path_ property in the BizTalk Mapper. The result is that the XSL we usually generate in the mapping tool will be overridden by our own XSL stylesheet. The figure below shows how we use the property windows of the grid in the BizTalk Mapper to set the property and point the Mapper to our XSLT document.





[![](../assets/2007/12/windowslivewriterremovingnamespacefromoutgoingmessage-a4edxsltpath-thumb11.jpg)](../assets/2007/12/windowslivewriterremovingnamespacefromoutgoingmessage-a4edxsltpath51.jpg)





**But what if we already have a map on the send port and it&apos;s that already transformed message we like to remove the namespace from?** One possibility is to use the [_XSLT Transform_ pipeline component](http://msdn2.microsoft.com/en-us/library/aa561389.aspx) that comes with the BizTalk 2006 SDK. It&apos;s usually located at _C:\Program Files\Microsoft BizTalk Server 2006\SDK\Samples\Pipelines\XslTransformComponent\XslTransform_ on your development machine. I&apos;ve written about this sample component before [here](http://www.webhostingsearch.com/blogs/richard/transform-and-split-messages-using-an-xslt-transformation-pipeline-component-and-the-xmldissasembler/) were I used it another scenario.





The figure below shows how we use the property windows of the _XSLT Transform Component_ in a pipeline in the Pipeline designer tool to set the path to our XSLT stylesheet.





[![](../assets/2007/12/windowslivewriterremovingnamespacefromoutgoingmessage-a4edxsltpath2-thumb1.jpg)](../assets/2007/12/windowslivewriterremovingnamespacefromoutgoingmessage-a4edxsltpath221.jpg)





### Final thoughts





The XSLT Transform component is far from perfect and the obvious problem is of course that the component loads the whole message into memory using the [XmlDocument class](http://msdn2.microsoft.com/en-us/library/system.xml.xmldocument.aspx) to read the message. That means that this solution isn&apos;t for those scenarios where you&apos;ll have huge messages coming in by the thousands. But for those cases where you have normal sized messages and you have a idea of the traffic you receive, it&apos;s a quick and easy solution.





Any comments on the pro and cons on this solution and how you usually solve this scenario will be appreciated!





&lt;blockquote&gt;
  
&amp;gt; 
&amp;gt; **UPDATE #1: **Make sure you don&apos;t miss [Johan Hedbergs solution](http://blogical.se/blogs/johan/archive/2008/01/07/removing-xml-namespace-in-a-pipeline-component.aspx) to this problem. Basically he solved it using the [Microsoft.BizTalk.Streaming.dll](http://technet.microsoft.com/en-us/library/microsoft.biztalk.streaming.aspx) which will give you better memory management.
&amp;gt; 
&amp;gt; 
&lt;/blockquote&gt;





&lt;blockquote&gt;
  
&amp;gt; 
&amp;gt; **UPDATE #2: **Based on the comments to this post I&apos;ve posted an &quot;updated&quot; post [here](http://www.richardhallgren.com/removing-xml-namespaces-revisit/) solving this using ordinary mapping and defining a schema without a XML namespace - easier and more correct. 
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;
&lt;/OutMessage&gt;&lt;/ns0:OutMessage&gt;&lt;/blockquote&gt;
</content>
  </entry>
  
  <entry>
    <title>Dealing with cXML based messages in BizTalk</title>
    <link href="http://richardhallgren.com/dealing-with-cxml-based-messages-in-biztalk" />
    <updated>2007-11-29T16:33:30+00:00</updated>
    <id>http://richardhallgren.com/dealing-with-cxml-based-messages-in-biztalk</id>
    <content type="html">&lt;p&gt;&lt;a href=&quot;http://cxml.org/&quot;&gt;cXML&lt;/a&gt; (commerce eXtensible Markup Language) is a XML based standard for communication of data related to electronic commerce. The problem from a BizTalk perspective is that they &lt;strong&gt;don’t publish any &lt;a href=&quot;http://en.wikipedia.org/wiki/XML_Schema&quot;&gt;XML schemas&lt;/a&gt;&lt;/strong&gt; (XSD),  only &lt;a href=&quot;http://en.wikipedia.org/wiki/Document_Type_Definition&quot;&gt;Document Type Definition&lt;/a&gt; (DTD).&lt;/p&gt;

&lt;p&gt;When trying to generate a schema based on a DTD using the functionality in BizTalk (via &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms944737.aspx&quot;&gt;Add Generated Items&lt;/a&gt;) one ends up with a schema split of three files that really doesn’t make any sense (&lt;a href=&quot;http://www.altova.com/products/xmlspy/xml_editor.html&quot;&gt;XmlSpy&lt;/a&gt; doesn’t do a very good job either …). So after a while I found &lt;a href=&quot;http://www.modhul.com/schema-repository-cxml/&quot;&gt;Nick Heppleston schema repository&lt;/a&gt;! After some tweaking I actually had a cXML Order schema in the version I was looking for! Thanks Nick!&lt;/p&gt;

&lt;p&gt;The next set of problems was to handle &lt;strong&gt;the lack&lt;/strong&gt; of &lt;a href=&quot;http://en.wikipedia.org/wiki/XML_namespace&quot;&gt;XML namespace&lt;/a&gt; and the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms256059.aspx&quot;&gt;DOCTYPE declaration&lt;/a&gt; that messages validating against DTD carries on top.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF00FF; &quot;&amp;gt;xml version=&quot;1.0&quot; standalone=&quot;no&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;?&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF00FF; &quot;&amp;gt;DOCTYPE cXML SYSTEM &quot;http://xml.cxml.org/schemas/cXML/1.2.014/cXML.dtd&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;cXML &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xml:lang&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;en-US&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; payloadID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;2007117.25919@Contempus&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; timestamp&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;2007-11-07T11:06:16+01:00&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To handel these two issues I set up a receive pipeline that looked like the one below.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/11/windowslivewriterba0c14911562-ef39pipeline32.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/11/windowslivewriterba0c14911562-ef39pipeline-thumb12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;remove-the-doctype-declaration&quot;&gt;Remove the DOCTYPE declaration&lt;/h1&gt;

&lt;p&gt;First I created a pipeline component to remove the DOCTYPE node. It’s simple code using &lt;a href=&quot;http://en.wikipedia.org/wiki/Regular_expression&quot;&gt;regular expression&lt;/a&gt; to find the DOCTYPE node, replace it with an empty string and return the message.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; IBaseMessage Execute(IPipelineContext pc, IBaseMessage inmsg)
{
   &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; messageString &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; StreamReader(inmsg.BodyPart.Data).ReadToEnd();
   Regex doctypePattern &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; Regex(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;lt;!DOCTYPE.+?&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;);
   messageString &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; doctypePattern.Replace(messageString, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;.Empty);
   MemoryStream memStream &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; MemoryStream();
   &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;byte&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;[] data &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; Encoding.UTF8.GetBytes(messageString);
   memStream.Write(data, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;, data.Length);
   memStream.Seek(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;, SeekOrigin.Begin);
   inmsg.BodyPart.Data &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; memStream;
   &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; inmsg;
}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;set-an-xml-namespace&quot;&gt;Set an XML namespace&lt;/h1&gt;

&lt;p&gt;Secondly I used &lt;a href=&quot;http://seroter.wordpress.com/2007/02/11/add-namespace-to-inbound-biztalk-messages/&quot;&gt;Richard Seroter’s post&lt;/a&gt; on how to change the SetNSForMsg component to add a XML namespace. That’s the second component showing in the decode stage of the pipeline.&lt;/p&gt;

&lt;p&gt;Arrow number 3 shows how the SetMsgNS exposes a property that allows us to set the namespace that we can configure per pipeline. In this case I’ve set it to _http://schemas.modhul.com/cXML/1.2.014/OrderRequest__ _which is the namespace of the cXML schema I’m currently working agains.&lt;/p&gt;

&lt;p&gt;In the end we’ll have a message with the following declaration and root node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF00FF; &quot;&amp;gt;xml version=&quot;1.0&quot; encoding=&quot;utf-16&quot; standalone=&quot;no&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;?&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;cXML &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xml:lang&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;en-US&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; payloadID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;2007117.25919@Contempus&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://schemas.modhul.com/cXML/1.2.014/OrderRequest&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; timestamp&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;2007-11-07T11:06:16+01:00&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we’re ready to start mapping!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>A pattern for Ordered Delivery using orchestrations</title>
    <link href="http://richardhallgren.com/a-pattern-for-ordered-delivery-using-orchestrations" />
    <updated>2007-11-01T13:37:46+00:00</updated>
    <id>http://richardhallgren.com/a-pattern-for-ordered-delivery-using-orchestrations</id>
    <content type="html">&lt;p&gt;&lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa559637.aspx&quot;&gt;Ordered Delivery&lt;/a&gt; is a great feature of BizTalk 2006. The problem is however that as soon as one introduce a orchestration in the process it doesn’t work. The Ordered Delivery option on ports in BizTalk 2006 ensures two things today:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Messages are published to the MessageBox in the same order as they were consumed by the Receive Port.&lt;/li&gt;
  &lt;li&gt;Messages are consumed from the MessageB0ox and published to the end destination by the send port in the same order as they were persisted in the MessageBox.&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;whats-the-problem&quot;&gt;What’s the problem?&lt;/h1&gt;

&lt;p&gt;Fine. But if we introduce an orchestration each message being persisted in the  the MessageBox will start it’s own orchestration instance. These instances could (and in many cases will) finish in different order than they started. This means that we loose the correct order of the messages one they are persisted back to the MessageBox from the orchestration instance.&lt;/p&gt;

&lt;p&gt;The above “limitation” is well known and the solution to this has always been a &lt;a href=&quot;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/bts_2004wp/html/956fd4cb-aacc-43ee-99b6-f6137a5a2914.asp&quot;&gt;Sequential Orchestration&lt;/a&gt; pattern (also called Singleton Orchestration). Basically this correlates messages from for example a specific Receive Port of a particular Message Type. This ensures that only one instance of the orchestration will be started and we can keep the order of the messages. We’ve experienced a lot of problems using this this kind of solution for Ordered Delivery - all from &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/bb203853.aspx&quot;&gt;Zombies&lt;/a&gt; to them using huge amounts of memory and so on.&lt;/p&gt;

&lt;h1 id=&quot;microsofts-new-solution&quot;&gt;Microsoft’s new solution&lt;/h1&gt;

&lt;p&gt;Now &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/Bb851740.1542441d-d33a-4634-898f-c89efb0d94fa(en-us,MSDN.10).gif&quot;&gt;&lt;img src=&quot;../assets/2007/11/windowslivewriterapatternforordereddeliverythatworksfinal-c24buntitled31.gif&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;it finally looks like this problem is about to be solved! Microsoft released a &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/bb851740.aspx&quot;&gt;white paper&lt;/a&gt; recently (download it &lt;a href=&quot;http://www.microsoft.com/downloads/details.aspx?FamilyID=02c5fd53-fee9-44fc-a780-5d1d34ee8754&amp;amp;displaylang=en&quot;&gt;here&lt;/a&gt; - found it via &lt;a href=&quot;http://seroter.wordpress.com/&quot;&gt;Richard Seroter’s blog&lt;/a&gt;) to solve these problems in a other way. It basically means that a pipeline will stamp the messages with a sequence number as they enter BizTalk (the messages are then in order as we’re then using Ordered Delivery on the port). Then one can have as many orchestration as one like processing these messages and publish them back to the MessageBox (now possibly out of order but with a sequence number stamped on them). The last business orchestration will set a “destination” property that will route the message to a resequence orchestration. This orchestration resequences the messages and decides by checking the last sequence number it sent out if the current message should be sent out or put back on queue.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;My biggest concern in this solution is that is still based on a singleton. We’ve had cases where where the send procedure been extremely slow (for example when we used SOAP and had a slow Web Service in the other end), then the orchestration has built up in memory as it queued messages internally. However it looks like this solution is well thought through with a “flush queue” functionality, stop message, some ideas on how to handle errors (remember that if the singleton fails and you don’t handle this your processes stop) and so on.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/bb851740.aspx&quot;&gt;Read it&lt;/a&gt; and please let me know what you think!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Why BizTalk isn’t an ESB today and is it heading there?</title>
    <link href="http://richardhallgren.com/why-biztalk-isnt-an-esb-today-and-is-it-heading-there" />
    <updated>2007-09-25T14:01:57+00:00</updated>
    <id>http://richardhallgren.com/why-biztalk-isnt-an-esb-today-and-is-it-heading-there</id>
    <content type="html">&lt;p&gt;I’ve written about the ESB concept &lt;a href=&quot;http://www.webhostingsearch.com/blogs/richard/index.php&quot;&gt;before&lt;/a&gt; and what I think an ESB architecture is. In the posts comments there were some discussion about if BizTalk is an ESB or not. And if not - &lt;strong&gt;why not&lt;/strong&gt;?&lt;/p&gt;

&lt;p&gt;I think &lt;a href=&quot;http://dotnet.sys-con.com/read/121831.htm&quot;&gt;this article&lt;/a&gt; does a great job in explaining and discussing this subject. Basically it says that the main reason for BizTalk not qualifying as an ESB today (I know about the &lt;a href=&quot;http://www.codeplex.com/esb&quot;&gt;ESB Guidance&lt;/a&gt; - we get there ;)) is because of it’s “all-or-nothing” packaging. What that means is that it’s different functionality can not be separately deployed a cross a bus structure. For example; the scenario of having the transformation functionality in one place and the routing functionality in another just isn’t possible in today’s architecture. Today you install the full product in one place.&lt;/p&gt;

&lt;p&gt;I think I’ve personally have learnt to live with this limitation. On the other hand I can see that the possibility of splitting parts up definitely changes things as the possibility of reuse and single point of failure problems etc.&lt;/p&gt;

&lt;h1 id=&quot;is-biztalk-going-the-esb-way&quot;&gt;Is BizTalk going the ESB way?&lt;/h1&gt;

&lt;p&gt;I still haven’t had as much time as I’d like to examine the &lt;a href=&quot;http://www.codeplex.com/esb&quot;&gt;ESB Guidance&lt;/a&gt; but I look forward to see how they worked around the problem described above.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/09/windowslivewriterisbiztalkanesb-e886microsoftesbtechnicaloverview51.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/09/windowslivewriterisbiztalkanesb-e886microsoftesbtechnicaloverview-thumb31.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt; Just looking at this architecture image shows that they’ve split things up in a new way and that each part is accessible trough services - nice! Could this be the future architecture of BizTalk server? What do you think?&lt;/p&gt;

&lt;p&gt;I’ll try and install the ESB project as soon as I get some more time on my hands. In the mean time I’d love some tips and comments on articles and other reading on the experiences of the ESB Guidance project.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>SOA isn’t response request</title>
    <link href="http://richardhallgren.com/soa-isnt-response-request" />
    <updated>2007-08-10T17:48:17+00:00</updated>
    <id>http://richardhallgren.com/soa-isnt-response-request</id>
    <content type="html">&lt;p&gt;I’ve often been told that one of the biggest mistakes people make when implementing a service oriented architecture is that they don’t re-architect their current architecture to become service oriented. I’ve never really understood what they meant by that until I read &lt;a href=&quot;http://blogs.msdn.com/nickmalik/archive/2007/08/07/getting-away-from-request-and-response-soa.aspx&quot;&gt;this article&lt;/a&gt;. SOA is not about adding a service based call to expose &lt;strong&gt;your current&lt;/strong&gt; procedure calls as a service - it’s so much more. It’s about enabling ease of change and to create a more agile architecture.&lt;/p&gt;

&lt;blockquote&gt;Each of these assumptions exist in a Remote Procedure Call. They are forms of coupling, pure and simple. They fly in the face of SOA.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;What do you think? Does it make sense in your world?&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>XPathmania and XPath on TV!</title>
    <link href="http://richardhallgren.com/xpathmania-and-xpath-on-tv" />
    <updated>2007-08-03T08:08:46+00:00</updated>
    <id>http://richardhallgren.com/xpathmania-and-xpath-on-tv</id>
    <content type="html">&lt;p&gt;I’ve blogged about the Visual Studio extension &lt;a href=&quot;http://www.codeplex.com/MVPXML/Release/ProjectReleases.aspx?ReleaseId=77&quot;&gt;XPathmania&lt;/a&gt; &lt;a href=&quot;http://www.webhostingsearch.com/blogs/richard/reading-text-value-from-node-using-xpath-function-directly-in-biztalk-orchestrations/&quot;&gt;before&lt;/a&gt;. It’s a very simple little tool that lets you write and test &lt;a href=&quot;http://en.wikipedia.org/wiki/XPath&quot;&gt;XPath&lt;/a&gt; inside of Visual Studio 2005. No big deal if you already have tools like &lt;a href=&quot;http://www.altova.com/products/xmlspy/xml_editor.html&quot;&gt;XMLSpy&lt;/a&gt; or &lt;a href=&quot;http://www.microsoft.com/downloads/details.aspx?familyid=72d6aa49-787d-4118-ba5f-4f30fe913628&amp;amp;displaylang=en&quot;&gt;XML Notepad&lt;/a&gt; but still. I like not having to start another application, opening the XML document I’m working with and so on. Doing stuff inside of Visual Studio just feels right and saves some time anyway.&lt;/p&gt;

&lt;p&gt;One of the &lt;a href=&quot;http://www.dnrtv.com/default.aspx?showNum=67&quot;&gt;last episodes&lt;/a&gt; of &lt;a href=&quot;http://www.dnrtv.com/&quot;&gt;dnrTV&lt;/a&gt; hosted &lt;a href=&quot;http://donxml.com/Default.aspx&quot;&gt;Dom Demsak&lt;/a&gt; (Don XML), the creator of XPathmania. The show is 30% about XPathmania and 70% about XPath and XPath syntax in general. It’s kind of basic XPath but I think it can be useful for someone who feels they haven’t got full control of the language.&lt;/p&gt;

&lt;p&gt;During the show they touch on &lt;a href=&quot;http://www.w3schools.com/xml/xml_namespaces.asp&quot;&gt;XML namespaces and XML default namespaces&lt;/a&gt;. However they don’t really explain the difference between them and how it effects the document. Something that’s sad as I feel that XML namespaces (and especially default namespaces) is something that most people haven’t fully understood.&lt;/p&gt;

&lt;p&gt;Anyway, if you got some spare time watch it or forward it someone you think should watch it. ;)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Transform and split messages using an Xslt transformation pipeline component and the XmlDissasembler</title>
    <link href="http://richardhallgren.com/transform-and-split-messages-using-an-xslt-transformation-pipeline-component-and-the-xmldissasembler" />
    <updated>2007-08-02T08:44:09+00:00</updated>
    <id>http://richardhallgren.com/transform-and-split-messages-using-an-xslt-transformation-pipeline-component-and-the-xmldissasembler</id>
    <content type="html">&lt;p&gt;There was a question on the &lt;a href=&quot;http://www.microsoft.com/technet/community/newsgroups/dgbrowser/en-us/default.mspx?dg=microsoft.public.biztalk.general&quot;&gt;Microsoft newsgroup&lt;/a&gt; the other day where someone had to split a message into parts. But some of the information that was supposed to go in to the different parts were part of the envelope. I thought I’d give my solution to the problem a try - here it is.&lt;/p&gt;

&lt;p&gt;Say for example that we receive the following message.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns0:EmployeeSalesReport &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;ReportID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;R100&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; EmployeeID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;0012345&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; xmlns:ns0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Example.TransformAndSplit.EmployeeSalesReport&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sales&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns1:Sale &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns:ns1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Example.TransformAndSplit.Sale&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;100&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;10&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns1:Sale&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns1:Sale &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns:ns1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Example.TransformAndSplit.Sale&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;200&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;20&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns1:Sale&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sales&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns0:EmployeeSalesReport&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the above message we have different sales information from one employee &lt;strong&gt;but all the global employee and report information (the &lt;em&gt;ReportID&lt;/em&gt; and &lt;em&gt;EmployeeID&lt;/em&gt; attributes) exists in the root node&lt;/strong&gt; (what we’ll call the &lt;em&gt;envelope&lt;/em&gt; of the message).&lt;/p&gt;

&lt;p&gt;What we like to achieve is to split this envelope message into it’s different sale item so we get separate message looking something like the below where each item contains the global information from the envelope.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sale &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Example.TransformAndSplit.Sale&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;200&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;20&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;0012345&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ReportID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;R100&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ReportID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sale&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There might be different needs for doing this in a pipeline but much of it comes down to choice of architecture style in your BizTalk solution. Personally I’d refuse to introduce another orchestration for splitting a message like this. I don’t believe that’s what orchestrations are for (they should deal with possible logic and workflow in my world). I’m sure other people feel different - feel free to use the comments.&lt;/p&gt;

&lt;h2 id=&quot;step-1---transforming-the-envelope-message-using-xslt&quot;&gt;Step 1 - Transforming the envelope message using XSLT&lt;/h2&gt;

&lt;p&gt;The first thing we’ll need to do is to transform the envelope message so that the information from the root node (the &lt;em&gt;ReportID&lt;/em&gt; and the &lt;em&gt;EmployeeID&lt;/em&gt;) get into every single _Sale-_node. There are a couple of ways of achieving this but I’ll use the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa561389.aspx&quot;&gt;XSLT-transformation pipeline component&lt;/a&gt; that ships with the BizTalk 2006 SDK.&lt;/p&gt;

&lt;p&gt;All this component does is to let you point out a &lt;a href=&quot;http://en.wikipedia.org/wiki/XSLT&quot;&gt;XSLT stylesheet&lt;/a&gt; you like to use to transform your message.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6xsltpipeline29.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6xsltpipeline-thumb9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The stylesheet I’ve used is part of the solution that you can download here. I will not show the stylesheet full script here but rather the result after the message travel through the component.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF00FF; &quot;&amp;gt;xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;?&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeSalesReport &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;EmployeeID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;0012345&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; ReportID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;R100&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Example.TransformAndSplit.EmployeeSalesReport&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sales &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sale &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Example.TransformAndSplit.Sale&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;100&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;10&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;0012345&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ReportID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;R100&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ReportID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sale&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sale &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://Example.TransformAndSplit.Sale&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;200&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ItemID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;20&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Amount&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;0012345&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ReportID &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;R100&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ReportID&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sale&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Sales&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;EmployeeSalesReport&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ok, nice. Now we have all the information we like in each of the &lt;em&gt;Sale&lt;/em&gt;-nodes! All we have to do now is to split the message!&lt;/p&gt;

&lt;h2 id=&quot;step-2---splitting-the-message&quot;&gt;Step 2 - Splitting the message&lt;/h2&gt;

&lt;p&gt;We’ll use the standard &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms964545.aspx&quot;&gt;&lt;em&gt;XmlDisassembler&lt;/em&gt;&lt;/a&gt; component for splitting the message. All we have to do is to make sure we done the following.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Set the schema envelope property to “&lt;strong&gt;true”&lt;/strong&gt; in the schema editor.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Set the &lt;em&gt;Body Xpath&lt;/em&gt; property on the _EmployeeSalesReport-_node to point to the _Sale-_node.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Configure the &lt;em&gt;Document Schemas _and&lt;/em&gt; Envelope Schemas (&lt;em&gt;same properties are called _DocumentSpecNames&lt;/em&gt; and &lt;em&gt;EnvelopeSpecNames&lt;/em&gt; if your doing the configuration after deployment in the administration console_)_ properties of the &lt;em&gt;XmlDisassember&lt;/em&gt; component to match the names of your schemas.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;This is what the envelope schema looks like in this example.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6envelopeschema59.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6envelopeschema-thumb19.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is what the &lt;em&gt;XmlDisassembler&lt;/em&gt; configuration looks like.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6pipelineconfig29.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6pipelineconfig-thumb9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There, we’re done! Now we can drop a test file containing two &lt;em&gt;Sale&lt;/em&gt;-nodes and all the report/employee information on the top and have the two following separate files as a result when using a file send port.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6out29.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6out-thumb9.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;setting-up-the-test-solution&quot;&gt;Setting up the test solution&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.richardhallgren.com/blogfiles/Example.TransformAndSplit.zip&quot;&gt;Download&lt;/a&gt; a zipped version of the solution.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;You’ll have to unzip the project to &lt;em&gt;C:\Example.TransformAndSplit&lt;/em&gt;. If that isn’t possible you’ll have to change the path to the XSLT stylesheet in the &lt;em&gt;XsltComponent&lt;/em&gt; in the pipeline as this is a fixed path.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;When you build the &lt;em&gt;XsltComponent&lt;/em&gt; the &lt;em&gt;Output path&lt;/em&gt; is set to the &lt;em&gt;Pipeline Components&lt;/em&gt; folder. This assumes that BizTalk is installed at _C:\Program Files\Microsoft BizTalk Server 2006_. If that isn’t the case make sure to change the output path of the component.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;If you’d like to run the pipeline component in debug I’ve set this up using the &lt;a href=&quot;http://msdn.microsoft.com/library/en-us/sdk/htm/ebiz_sdk_utils_pipeline_ackm.asp?frame=true&quot;&gt;pipeline.exe tool.&lt;/a&gt; There are however some paths in the debug setting of the &lt;em&gt;XsltComponent&lt;/em&gt; project also that assumes that your BizTalk solutions is installed at &lt;em&gt;C:\Program Files\Microsoft BizTalk Server 2006. _If this isn’t the case you’ll have to change some values in the _Command lines arguments&lt;/em&gt; property, but that only if you like to run debug.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Build and deploy.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Set up a receive port and location using the &lt;em&gt;TransformAndSplitSales&lt;/em&gt; pipeline.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Set up a send port with for example a filter on the name of the &lt;em&gt;Receiveport&lt;/em&gt; you’ve just set up.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Drop the example message that’s part of the solution!&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;final-thoughts&quot;&gt;Final thoughts&lt;/h2&gt;

&lt;p&gt;This example didn’t really take much more than an hour to put together. I do however realize that this is a simplified incoming message and that in the case of a more complex message we’d get a messy XSLT stylesheet to maintain. It’s also important to remember that using this method with XSLT transformation means that we will load the entire incoming Xml document into memory, so when we’re dealing with bigger Xml documents we’ll have manipulate the incoming message using other techniques.&lt;/p&gt;

&lt;p&gt;Hope this is useful for someone!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Developing and debugging orchestrations using DebugView and SOAPTrace tools</title>
    <link href="http://richardhallgren.com/developing-and-debugging-orchestrations-using-debugview-and-soaptrace-tools" />
    <updated>2007-07-31T07:38:33+00:00</updated>
    <id>http://richardhallgren.com/developing-and-debugging-orchestrations-using-debugview-and-soaptrace-tools</id>
    <content type="html">&lt;p&gt;The main problem I have with developing BizTalk orchestrations is the fact that I’m so blind when it comes to follow the runtime processing. Using the &lt;a href=&quot;http://msdn2.microsoft.com/EN-US/library/aa577988.aspx&quot;&gt;debugger&lt;/a&gt; that is part of the HAT tool is slow and clumsy which IMHO makes the tool almost useless in everyday development. But there is hope!&lt;/p&gt;

&lt;h2 id=&quot;debugview&quot;&gt;DebugView&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.microsoft.com/technet/sysinternals/default.mspx&quot;&gt;Sysinternals&lt;/a&gt; (&lt;em&gt;Windows Sysinternal&lt;/em&gt; now - Microsoft bought them last year) &lt;a href=&quot;http://www.microsoft.com/technet/sysinternals/Miscellaneous/DebugView.mspx&quot;&gt;DebugView&lt;/a&gt; is a wonderful little tool and is especially useful when it comes to figure out what’s actually going on inside an orchestration. Basically the tool listens to system wide debug output. From an orchestration it’s possible to write debug information using the .NET &lt;em&gt;&lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.diagnostics.aspx&quot;&gt;System.Diagnostics&lt;/a&gt;&lt;/em&gt; namespace and the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.diagnostics.debug.aspx&quot;&gt;&lt;em&gt;Debug&lt;/em&gt;&lt;/a&gt; or &lt;em&gt;&lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.diagnostics.trace.aspx&quot;&gt;Trace&lt;/a&gt;&lt;/em&gt; class.&lt;/p&gt;

&lt;h3 id=&quot;decide-on-how-to-filter&quot;&gt;Decide on how to filter&lt;/h3&gt;

&lt;p&gt;There are a couple of handy little tricks that makes DebugView a even better in BizTalk development. First one should try and have something in the debug messages that makes it possible to filter and distinct one’s own (as DebugView listens system wide debug output all running applications debug info will show up). Our team decided on “&lt;a href=&quot;http://www.sogeti.com&quot;&gt;Sogeti&lt;/a&gt;” (our company name) for all our development and to have a method in our BaseLibrary component that outputs something like the below (the BaseLibrary is a small little .NET component with a couple of very useful classes we use company wide in our BizTalk related development).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;System.Diagnostics.Debug.WrtieLine(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;Sogeti, your debug/trace message here&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This make is possible to have a filter in DebugView and to for example have it look something like this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview133.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview1-thumb13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;trace-full-context-of-messages&quot;&gt;Trace full context of messages&lt;/h3&gt;

&lt;p&gt;Another little useful trick is to trace the full context of messages. This is done be storing the message in a &lt;em&gt;XmlDocument&lt;/em&gt; typed variable and get the &lt;em&gt;OuterXml&lt;/em&gt; property of that variable. The below code is and example of this.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;tempXml &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; msgFindPartyRequest.parameters;
System.Diagnostics.Trace.Write(System.String.Concat(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;Sogeti, msgFindPartyRequest: &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;, tempXml.OuterXml));&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Example of a full message trace.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview253.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview2-thumb13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;to-trace-or-debug---thats-the-question&quot;&gt;To Trace or Debug - that’s the question&lt;/h3&gt;

&lt;p&gt;As stated earlier both &lt;em&gt;System.Diagnostics.Debug&lt;/em&gt; and &lt;em&gt;System.Diagnostics.Trace&lt;/em&gt; has methods (&lt;em&gt;Write&lt;/em&gt;, &lt;em&gt;WriteLine&lt;/em&gt; and so on) for outputting debug information. However there is only one that stays in your compiled code when switching from Development to Deployment compilation mode (guess which one ;)). So make sure you choose the right class for the right information. I like to have some critical messages left using Trace and be able to trace these even on the test and production server.&lt;/p&gt;

&lt;h3 id=&quot;debugview-on-a-remote-desktop&quot;&gt;DebugView on a remote desktop&lt;/h3&gt;

&lt;p&gt;When running DebugView on an other server (say a test or a production server) using &lt;a href=&quot;http://www.microsoft.com/windowsxp/downloads/tools/rdclientdl.mspx&quot;&gt;Remote Desktop&lt;/a&gt; I’ve found that ones has to use the &lt;a href=&quot;http://firechewy.com/blog/archive/2005/10/18/926.aspx&quot;&gt;console user&lt;/a&gt; on the server. This kind of makes sense as if we’re connection “normally” we’re creating a virtual session and that’s not were the debug information is written to.&lt;/p&gt;

&lt;h2 id=&quot;microsoft-soap-toolkit-30&quot;&gt;Microsoft SOAP Toolkit 3.0&lt;/h2&gt;

&lt;p&gt;This is a totally &lt;a href=&quot;http://www.microsoft.com/downloads/details.aspx?FamilyId=C943C0DD-CEEC-4088-9753-86F052EC8450&amp;amp;displaylang=en&quot;&gt;other tool&lt;/a&gt; than DebugView but I thought it fit here any way. It’s a handy tool when working with SOAP based messages. Without it’s very hard to actually figure out how the raw request and response message look and why your orchestration web service is acting the way it does.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace123.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace1-thumb3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The trace tool is placed as a &lt;a href=&quot;http://en.wikipedia.org/wiki/Reverse_proxy&quot;&gt;reverse proxy&lt;/a&gt; between BizTalk and the Internet. It’s setup by telling the tracing tool which localhost port to listen at (for example 9091 as in the example below) then we’ll redirect to that port by changing the setting in the BizTalk send port.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soapsendport122.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soapsendport1-thumb2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Finally we’ll set up the trace tool to listen to port 9091 and redirect all traffic to our web service URL at port 80 in this case. So basically the trace tool will catch all the traffic hitting the 9091 port and forward it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace222.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace2-thumb2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That’s it! This is probably basic stuff for most of you but hopefully it’s useful for someone!&lt;/p&gt;

&lt;p&gt;I’ve also noticed that the SOAP Toolkit is deprecated by Microsoft and I’d like to hear if anyone used something else (like &lt;a href=&quot;http://www.fiddlertool.com/fiddler/&quot;&gt;Fiddler&lt;/a&gt; example) for tracing SOAP messages. I’d also love some other tips, tools and methods you use for debugging BizTalk orchestrations.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Reading text value from node using XPath function directly in BizTalk orchestrations</title>
    <link href="http://richardhallgren.com/reading-text-value-from-node-using-xpath-function-directly-in-biztalk-orchestrations" />
    <updated>2007-07-24T14:10:02+00:00</updated>
    <id>http://richardhallgren.com/reading-text-value-from-node-using-xpath-function-directly-in-biztalk-orchestrations</id>
    <content type="html">&lt;p&gt;The XPath function that’s available directly inside BizTalk orchestration is a powerful little tool. However I’ve seen a couple of project where developers just grown tired of it and started creating their own little libraries instead. I’ll be the first to admit that the XPath function isn’t perfect, and it sure doesn’t work like most of the other XPath engines (which is the biggest problem) but it’s still &lt;strong&gt;inside&lt;/strong&gt; the orchestration and you can use it to both read and &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms963270.aspx&quot;&gt;assign values&lt;/a&gt; to a message which is super useful! &lt;strong&gt;Basically I don’t see a valid reason for bringing more complexity into your solution by adding another library&lt;/strong&gt; - as long as you’re just going to read or set value using XPath.&lt;/p&gt;

&lt;p&gt;However there is one trick that you should know of when it comes to reading a text value from a node. Basically you have to use both the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms256180.aspx&quot;&gt;string()&lt;/a&gt; and &lt;br /&gt;
text() XPath functions. Both &lt;a href=&quot;http://geekswithblogs.net/cyoung/archive/2006/12/12/100981.aspx&quot;&gt;Charles Young&lt;/a&gt; and &lt;a href=&quot;http://www.sabratech.co.uk/blogs/yossidahan/2006/09/returning-text-only-from-xpath-in.html&quot;&gt;Yossi Dahan&lt;/a&gt; has good post on this subject. Also if your new to writing XPath expressions for complex schemas with loads of namespaces and stuff (like schemas in BizTalk) &lt;a href=&quot;http://www.webhostingsearch.com/blogs/richard/nevermind-the-xml-namespaces-in-xpath-expressions/&quot;&gt;this post&lt;/a&gt; could be useful for you.&lt;/p&gt;

&lt;p&gt;Finally a nice tool for writing and testing small XPath expression inside Visual Studio (if you don’t want to spend x minutes waiting for XmlSpy to start up …) is &lt;a href=&quot;http://www.codeplex.com/MVPXML/Release/ProjectReleases.aspx?ReleaseId=4894&quot;&gt;XPathmania&lt;/a&gt;. Read about it &lt;a href=&quot;http://donxml.com/allthingstechie/archive/2006/07/07/2792.aspx&quot;&gt;here&lt;/a&gt; - I use it all the time!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Lists, Arrays and collections within BizTalk orchestrations</title>
    <link href="http://richardhallgren.com/lists-arrays-and-collections-within-biztalk-orchestrations" />
    <updated>2007-07-05T12:40:30+00:00</updated>
    <id>http://richardhallgren.com/lists-arrays-and-collections-within-biztalk-orchestrations</id>
    <content type="html">&lt;blockquote&gt;  
&amp;gt; 
&amp;gt; **Update 2012-03-28**        
Unfortunately the images for this post was lost in upgrade of the blog.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;This post shows how it’s possible to create your own .NET class and then use this within your orchestration (as a variable) to work with typed lists - something that unfortunately isn’t supported out of the box in BizTalk orchestrations. Below is the class used to create a typed list for System.String objects.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;span class=&quot;kwrd&quot;&amp;gt;using&amp;lt;/span&amp;gt; System;
&amp;lt;span class=&quot;kwrd&quot;&amp;gt;using&amp;lt;/span&amp;gt; System.Collections.Generic;
&amp;lt;span class=&quot;kwrd&quot;&amp;gt;using&amp;lt;/span&amp;gt; System.Text;

&amp;lt;span class=&quot;kwrd&quot;&amp;gt;namespace&amp;lt;/span&amp;gt; Sample.BizTalkCollections
{
    [Serializable]
    &amp;lt;span class=&quot;kwrd&quot;&amp;gt;public&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;kwrd&quot;&amp;gt;class&amp;lt;/span&amp;gt; StringList
    {
        &amp;lt;span class=&quot;kwrd&quot;&amp;gt;private&amp;lt;/span&amp;gt; List&amp;lt;&amp;lt;span class=&quot;kwrd&quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;gt; _list = &amp;lt;span class=&quot;kwrd&quot;&amp;gt;new&amp;lt;/span&amp;gt; List&amp;lt;&amp;lt;span class=&quot;kwrd&quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;gt;();

        &amp;lt;span class=&quot;kwrd&quot;&amp;gt;public&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;kwrd&quot;&amp;gt;void&amp;lt;/span&amp;gt; Add(&amp;lt;span class=&quot;kwrd&quot;&amp;gt;string&amp;lt;/span&amp;gt; item)
        {
            _list.Add(item);
        }

        &amp;lt;span class=&quot;kwrd&quot;&amp;gt;public&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;kwrd&quot;&amp;gt;int&amp;lt;/span&amp;gt; Count()
        {
            &amp;lt;span class=&quot;kwrd&quot;&amp;gt;return&amp;lt;/span&amp;gt; _list.Count;
        }

        &amp;lt;span class=&quot;kwrd&quot;&amp;gt;public&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;kwrd&quot;&amp;gt;bool&amp;lt;/span&amp;gt; Remove(&amp;lt;span class=&quot;kwrd&quot;&amp;gt;string&amp;lt;/span&amp;gt; item)
        {
            &amp;lt;span class=&quot;kwrd&quot;&amp;gt;return&amp;lt;/span&amp;gt; _list.Remove(item);
        }

        &amp;lt;span class=&quot;kwrd&quot;&amp;gt;public&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;kwrd&quot;&amp;gt;void&amp;lt;/span&amp;gt; RemoveAt(&amp;lt;span class=&quot;kwrd&quot;&amp;gt;int&amp;lt;/span&amp;gt; index)
        {
            _list.RemoveAt(index);
        }

        &amp;lt;span class=&quot;kwrd&quot;&amp;gt;public&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;kwrd&quot;&amp;gt;override&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;kwrd&quot;&amp;gt;string&amp;lt;/span&amp;gt; ToString()
        {
            StringBuilder builder = &amp;lt;span class=&quot;kwrd&quot;&amp;gt;new&amp;lt;/span&amp;gt; StringBuilder();
            &amp;lt;span class=&quot;kwrd&quot;&amp;gt;foreach&amp;lt;/span&amp;gt; (&amp;lt;span class=&quot;kwrd&quot;&amp;gt;string&amp;lt;/span&amp;gt; item &amp;lt;span class=&quot;kwrd&quot;&amp;gt;in&amp;lt;/span&amp;gt; _list)
            {
                builder.AppendLine(item);
            }

            &amp;lt;span class=&quot;kwrd&quot;&amp;gt;return&amp;lt;/span&amp;gt; builder.ToString();
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that the class is &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.serializableattribute.aspx&quot;&gt;serializable&lt;/a&gt; so BizTalk can serialize when &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa995563.aspx&quot;&gt;dehydrating the orchestration&lt;/a&gt; to the database. We’ve also chosen not to extend the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.collections.ilist.aspx&quot;&gt;IList interface&lt;/a&gt; as we don’t want to expose all methods of that interface, but only the once we’ll really going use within our orchestrations.&lt;/p&gt;

&lt;p&gt;This &lt;em&gt;StringList&lt;/em&gt; class exists within the &lt;em&gt;BizTalkCollections&lt;/em&gt; namespace where we have other classes for lists types with different datatypes (for example &lt;em&gt;ObjectList&lt;/em&gt;, &lt;em&gt;Int32List&lt;/em&gt; and so on). Below is a picture showing the structure of the Visual Studio project containing all the collections we current have implemented. This project and the BizTalk testproject is available for &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/Sample.BizTalkCollection.zip&quot;&gt;download here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterlistsarraysandcollectionswithinorchestra-b729biztalkcollections23.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterlistsarraysandcollectionswithinorchestra-b729biztalkcollections-thumb23.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the orchestration we then have set up a variable and type this to our &lt;em&gt;StringList&lt;/em&gt; class within the &lt;em&gt;Sample.BizTalkCollections&lt;/em&gt; namespace.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterlistsarraysandcollectionswithinorchestra-b729variable53.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterlistsarraysandcollectionswithinorchestra-b729variable-thumb53.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also make sure the assembly with your collection class is installed in the &lt;a href=&quot;http://support.microsoft.com/kb/815808&quot;&gt;GAC&lt;/a&gt;, otherwise you’ll end up with a _FileNotFound exception _saying&lt;/p&gt;

&lt;blockquote&gt;
  
&amp;gt; 
&amp;gt; Could not load file or assembly &apos;Sample.BizTalkCollections, Version=1.0.0.0, Culture=neutral, PublicKeyToken=7109528d5dbf986b&apos; or one of its dependencies. The system cannot find the file specified.
&amp;gt; 
&amp;gt; 
&lt;/blockquote&gt;

&lt;p&gt;Then you can use the following code within your orchestration! &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/Sample.BizTalkCollection.zip&quot;&gt;Download the sample project&lt;/a&gt; and test it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/07/windowslivewriterlistsarraysandcollectionswithinorchestra-b729code212.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/07/windowslivewriterlistsarraysandcollectionswithinorchestra-b729code2-thumb12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;a-really-generic-class&quot;&gt;A really generic class&lt;/h2&gt;

&lt;p&gt;I’d really like for it be possible to create my own generic classes and then initialize these using something like the below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;genericList = Sample.BizTalkCollections.GenericList&amp;lt;System.String&amp;gt;();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However this isn’t possible as BizTalk orchestrations don’t seem to understand generic classes … If someone found a solution to this please let me/us know via the comments to this post.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>TechEd Barcelona here I come!</title>
    <link href="http://richardhallgren.com/teched-barcelona-here-i-come" />
    <updated>2007-07-02T11:41:34+00:00</updated>
    <id>http://richardhallgren.com/teched-barcelona-here-i-come</id>
    <content type="html">&lt;p&gt;I’ve just found out that I get to go to &lt;a href=&quot;http://www.mseventseurope.com/teched/&quot;&gt;TechEd in November&lt;/a&gt;! I haven’t been there before. I’ve been to a lot of conferences but not **the **Microsoft conference. Do I have to say that I’m looking forward to it?&lt;/p&gt;

&lt;p&gt;If you’re going and feel like meeting up for a BizTalk lunch, dinner or whatever don’t hesitate to drop me an e-mail.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Reading the message body and context from the BizTalkDTADb using operations library in BizTalk 2006</title>
    <link href="http://richardhallgren.com/reading-the-message-body-and-context-from-the-biztalkdtadb-using-operations-library-in-biztalk-2006" />
    <updated>2007-06-04T14:18:20+00:00</updated>
    <id>http://richardhallgren.com/reading-the-message-body-and-context-from-the-biztalkdtadb-using-operations-library-in-biztalk-2006</id>
    <content type="html">&lt;p&gt;&lt;strong&gt;Update 2007-07-05:&lt;/strong&gt; The example project used in the post can be &lt;a href=&quot;http://www.richardhallgren.com/blogfiles/BizTalkDTAReader.zip&quot;&gt;downloaded from here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The operations dll (&lt;em&gt;Micrsoft.BizTalk.Operations&lt;/em&gt;) is one of the new bits in BizTalk 2006 that at least I haven’t heard much about (most of you probably find in the &lt;em&gt;C:\Program Files\Microsoft BizTalk Server 2006&lt;/em&gt; folder). However it’s a library with a lot of useful functionality.&lt;/p&gt;

&lt;p&gt;In this post I’ll focus on how it’s possible to use the library to get hold of message parts and message context from the BizTalk tracking database (usually called the &lt;em&gt;BizTalkDTADb&lt;/em&gt;). If you’re unfamiliar with the architecture of the tracking in BizTalk &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa559554.aspx&quot;&gt;this article&lt;/a&gt; is a good place to start.&lt;/p&gt;

&lt;h2 id=&quot;what-used-to-be-the-problem&quot;&gt;What used to be the problem?&lt;/h2&gt;

&lt;p&gt;In BizTalk 2004 one soon got into problems when trying to read the message parts and the message context from the tracking database. The problem is that the the Xml is compressed (something that makes totally sence - Xml is a perfect candidate for compression). To my knowledge no one has found a good way to decompress the message context. There’s however a way to decompress &lt;strong&gt;the message parts&lt;/strong&gt; (and only the parts) that &lt;a href=&quot;http://groups.google.com/group/microsoft.public.biztalk.general/browse_thread/thread/599c038807317802&quot;&gt;Rob posted on in the BizTalk newsgroup&lt;/a&gt;. But this method doesn’t work on the compressed context of the same message that the parts belong to! One could assume that the same method could be used for both compression and decompression but I haven’t got it to work for the context of the message (read about my frustration &lt;a href=&quot;http://groups.google.com/group/microsoft.public.biztalk.general/browse_thread/thread/19a232369218b2f9&quot;&gt;here&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&quot;whats-wrong-with-wmi-and-msbts_trackedmessageinstance&quot;&gt;What’s wrong with WMI and &lt;em&gt;MSBTS_TrackedMessageInstance&lt;/em&gt;?&lt;/h2&gt;

&lt;p&gt;So the option that was left to us before BizTalk 2006 for reading all the message parts as well as the message context was to use the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa546797.aspx&quot;&gt;MSBTS_TrackedMessageInstance WMI scrtipt&lt;/a&gt; and save everything down to file. The problem with this approach is that it’s slow and ugly! Say that we like to save a couple of thousand messages from the tracking database. When forced to save the messages to file we’ll end up with a slow and ugly solution where writing to file takes ages, then we have to read the content of the different files before cleaning up and deleting the files.&lt;/p&gt;

&lt;h2 id=&quot;micrsoftbiztalkoperations-to-the-rescue&quot;&gt;Micrsoft.BizTalk.Operations to the rescue&lt;/h2&gt;

&lt;p&gt;A quick view in &lt;a href=&quot;http://www.aisto.com/roeder/dotnet/&quot;&gt;Lutz Roeder’s Reflector&lt;/a&gt; shows us a couple of interesting methods in the operations dll. However I’ll only use the &lt;em&gt;GetTrackedMessage&lt;/em&gt; method in this post.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/06/operations1.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/06/operations-thumb1.jpg&quot; alt=&quot;operations&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I’ve written a tiny test application that uses the library to read the body part of the message (the meat of the message) and a couple of properties I’m interested in from the context of the message. It looks something like this. If your interested drop me an email and I’ll send it. The first screenshot below shows an example of reading the &lt;em&gt;InterchangeID&lt;/em&gt; from the context of a tracked message.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/06/operationstest22.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/06/operationstest2-thumb2.jpg&quot; alt=&quot;OperationsTest2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This screenshot shows an example of reading the full body of a tracked message from the tracking database. Try doing this with less then 10 lines of code using the &lt;em&gt;MSBTS_TrackedMessageInstance&lt;/em&gt; script!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/06/operationstest11.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/06/operationstest1-thumb1.jpg&quot; alt=&quot;OperationsTest1&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There is really nothing to the application, reading a tracked message using the &lt;em&gt;MessageID&lt;/em&gt; will return an object implementing &lt;em&gt;&lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/microsoft.biztalk.message.interop.ibasemessage_members.aspx&quot;&gt;IBaseMessage&lt;/a&gt;&lt;/em&gt; and we basically read the &lt;em&gt;&lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/microsoft.biztalk.message.interop.ibasemessage.bodypart.aspx&quot;&gt;BodyPart&lt;/a&gt;&lt;/em&gt; property of - it really couldn’t be any easier.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;public&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;static&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; GetMessageBodyByMessageID(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; dbServer, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; dbName, Guid messageID)
{
    TrackingDatabase dta &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; TrackingDatabase(dbServer, dbName);
    BizTalkOperations operations &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; BizTalkOperations();
    IBaseMessage message &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; operations.GetTrackedMessage(messageID, dta);
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; body &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;.Empty;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;using&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;(StreamReader streamReader &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; StreamReader(message.BodyPart.Data))
    {
        body &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; streamReader.ReadToEnd();
    }

    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; body;
} &amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I’d be very interested in how people use the operations library both when it comes to read and use tracked messages, but also in other ways! Use the comments to tell me and other readers how you use it your solutions!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Visual Studio 2005 tries to load the .pdb debug file from the GAC</title>
    <link href="http://richardhallgren.com/visual-studio-2005-tries-to-load-the-pdb-debug-file-from-the-gac" />
    <updated>2007-05-15T06:14:01+00:00</updated>
    <id>http://richardhallgren.com/visual-studio-2005-tries-to-load-the-pdb-debug-file-from-the-gac</id>
    <content type="html">&lt;p&gt;Ever seen this alert when trying to debug a project using Visual Studio 2005?&lt;/p&gt;

&lt;blockquote&gt;The following module was build with optimizations enabled or without information:
&amp;gt; 
&amp;gt; C:\Windows\assembly\GAC_MSIL\ ...
&amp;gt; 
&amp;gt; To debug this module, change its build configuration to debug mode. TO suppress this message, disable the &apos;Warn if no user code on launch&apos; debugger option.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;Basically this means that &lt;strong&gt;Visual Studio can’t find the debug file **(the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms241903.aspx&quot;&gt;.pdb file&lt;/a&gt;)&lt;/strong&gt; at the same location as the dll is loaded from&lt;strong&gt;. Reading the error message tells us that the **dll been loaded from the GAC&lt;/strong&gt; and there aren’t any pdb files there! Just make sure to uninstall the dll from the GAC and Visual Studio should be able to load it from your Debug folder and  you’ll probably  be good to go.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>XPathUpdateException when assigning value to constructed messages</title>
    <link href="http://richardhallgren.com/xpathupdateexception-when-assigning-value-to-constructed-messages" />
    <updated>2007-05-14T14:11:53+00:00</updated>
    <id>http://richardhallgren.com/xpathupdateexception-when-assigning-value-to-constructed-messages</id>
    <content type="html">&lt;p&gt;Ever had a “use of unconstructed message” error message in your orchestrations? Then you know that messages has to be constructed before one can use them within orchestrations. Basically messages in orchestrations are created in ports or when executing a map in a construct shape. However there is also the possibility of creating messages in expression shapes using code. Matt Meleski does a great job explain the different approaches in his &lt;em&gt;&lt;a href=&quot;http://objectsharp.com/cs/blogs/matt/archive/2004/11/09/1009.aspx&quot;&gt;Constructing BizTalk 2004 XML Messages (In an Orchestration) - Choices&lt;/a&gt;&lt;/em&gt; blog post_._&lt;/p&gt;

&lt;p&gt;However there are some pitfalls when constructing messages from scratch within orchestration (a part from the fact that there really isn’t a clean way of doing it … Scott Colestock has some ideas in &lt;a href=&quot;http://www.traceofthought.net/PermaLink,guid,c1164c59-72e2-49e2-be7a-47e4e8dc46d4.aspx&quot;&gt;this post&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;A common problem is &lt;em&gt;XPathUpdateException&lt;/em&gt;. Say one has a mapping that looks like the one below where one node isn’t mapped. &lt;strong&gt;This will create a message without the &lt;em&gt;ElementB&lt;/em&gt; element&lt;/strong&gt;. This doesn’t have to be in a mapping, it could also happend when constructing a message using code in a expression shape. A common scenario is that we &lt;strong&gt;add code for constructing the bone structure of the XML message&lt;/strong&gt;, then change the schema &lt;strong&gt;without updating the construct code. Ergo a message will be constructed without that element&lt;/strong&gt; (could be both valid or invalid XML then depending on the &lt;em&gt;Min Occurs&lt;/em&gt; value)!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping23.jpg&quot;&gt;[](../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping23.jpg)&lt;/a&gt;&lt;a href=&quot;../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping61.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping-thumb61.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When we then try to add a value to the element that hasn’t been created the exception will be thrown!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2assignment31.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2assignment-thumb31.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One way around when using a map is to make sure to have a default value on every element to force them be constructed. Adding the following to map will make it work.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2defaultvalue61.jpg&quot;&gt;&lt;img src=&quot;../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2defaultvalue-thumb61.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It’s a one time mistake but it’s good to know what to look for when the &lt;em&gt;XPathUpdateException in Microsoft.XLANGs.Core.XSDPart.SetDistinguishedField&lt;/em&gt; (if it’s a distinguished field that is) shows up in the event log.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>What’s an ESB architecture!?</title>
    <link href="http://richardhallgren.com/whats-an-esb-architecture" />
    <updated>2007-05-11T06:18:39+00:00</updated>
    <id>http://richardhallgren.com/whats-an-esb-architecture</id>
    <content type="html">&lt;p&gt;I’ve just finished reading a &lt;a href=&quot;http://www.neudesic.com/media/Neudesic%20-%20Neuron%20ESB%20White%20Paper%20(P1).pdf&quot;&gt;paper written by David Pallmann&lt;/a&gt; (PDF) from &lt;em&gt;&lt;a href=&quot;http://www.neudesic.com/&quot;&gt;Neudesic&lt;/a&gt;&lt;/em&gt;. Belive it or not (or even better check it out), it’s a short and understandable description of what an ESB is!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Neudesic&lt;/em&gt; sells a product called &lt;em&gt;&lt;a href=&quot;http://www.neudesic.com/Main.aspx?SS=7&amp;amp;PE=75&quot;&gt;Cyclone&lt;/a&gt;&lt;/em&gt; which is something they call a &lt;em&gt;ESB architecture and framework software&lt;/em&gt; and even if describing this product is the main purpose of the paper the first part deals with describing the basics of an ESB and try’s to “assemble a synthesis of popular ESB definitions”.&lt;/p&gt;

&lt;p&gt;I’ve chosen a couple of parts of the paper that really appealed to me but I really recommend the full length version (only 8 pages!).&lt;/p&gt;

&lt;blockquote&gt;Defining the ESB
&amp;gt; 
&amp;gt;   * An ESB is a backbone for connecting and integrating an enterprise’s applications and services.  
&amp;gt;   * An ESB provides the necessary infrastructure to create a service oriented architecture.  
&amp;gt;   * An ESB is a convergence of EAI, MOM, and SOA concepts.  
&amp;gt;   * An ESB is based on open standards such as XML, SOAP, and WS-*.  
&amp;gt;   * An ESB provides intelligent routing, such as publish-subscribe, message brokering, and failover routing.  
&amp;gt;   * An ESB provides mediation, overcoming data, communication, and security differences between endpoints.  
&amp;gt;   * An ESB integrates with legacy systems using standardsbased adapters.  
&amp;gt;   * An ESB provides logical centralized management but is  
physically decentralized.  
&amp;gt;   * An ESB is able to apply EAI concepts such as rules and  
orchestrations.  
&amp;gt;   * An ESB is able to monitor and throttle activity as per a Service Level Agreement (SLA).
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;I never thought of an ESB as an convergence of EAI (Enterprise Application Integration), MOM (Message Oriented Middleware) and SOA (Service Oriented Architecture) concepts. But, ok, so what does the writer really mean by these concepts?&lt;/p&gt;

&lt;blockquote&gt;SOA makes loosely-coupled, decentralized solutions possible that are enterprise-ready and based on interoperable standards. EAI allows integration of any combination of systems, with sophisticated message brokering, message translation, business process orchestration, and rules engine processing. MOM provides intelligent routing such as publish-subscribe topical messaging and strong managerial controls over routing, auditing, activity monitoring, and throttling.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;And why do we need a bus architecture on top of SOA, MOM and EAI?&lt;/p&gt;

&lt;blockquote&gt;Point-to-point architecture  
works all right on a small scale, but its problems become  
apparent when used at the enterprise level. If each system has to know the connection details of every other system, then each new system added increases the problem of configuration and management exponentially. This was the impetus that led us to hub-and-spoke architectures, which most EAI products use. This architecture was a vast improvement over point-to-point architectures, and each system needed to communicate with only the hub. In addition, the hub could provide excellent management features since it was a party to all communication. It only took time to reveal some shortcomings with the hub-and-spoke approach, and today it is often associated with concerns about scalability, single point of failure, and vendor lock-in.  
&amp;gt; 
&amp;gt; ... 
&amp;gt; 
&amp;gt; Fortunately, there is a sound compromise to be found in the bus architecture, which provides the benefits of logical centralization but is physically decentralized. The bus architecture in earlier days was often used in message bus systems based on proprietary technologies, but an ESB implements this architecture using WS-* standards.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;So using all three of them will make an ESB? Well, not really …&lt;/p&gt;

&lt;blockquote&gt;If combining disciplines was all there was to an ESB, we’d simply call it “consulting”. To properly leverage these disciplines they need to be combined in the right way through an architecture that lets their strengths shine and overcome their inherent weaknesses. Each discipline has some weak areas that the others help to resolve: SOA needs better enterprise manageability; EAI needs to become decentralized; MOM needs to get away from proprietary technologies. Combining these disciplines properly in an ESB overcomes these weaknesses.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;I’d be very intreseted in comments of other artciles, papers and so on relating to the ESB concept!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Get row identity from SQL Adapter response</title>
    <link href="http://richardhallgren.com/get-row-identity-from-sql-adapter-response" />
    <updated>2007-04-18T14:11:52+00:00</updated>
    <id>http://richardhallgren.com/get-row-identity-from-sql-adapter-response</id>
    <content type="html">&lt;p&gt;Recently I had to insert a record using a stored procedure and the SQL Adapter in BizTalk 2006. There are lots of examples on both how to insert records and how to select a number of record using this adapter. However I had problems finding how to **insert a record and receiving the new id of the inserted row in return **(the &lt;em&gt;&lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms190315.aspx&quot;&gt;SCOPE_IDENTITY()&lt;/a&gt;&lt;/em&gt;). In my scenario I needed the id to insert into another database further down in the orchestration.&lt;/p&gt;

&lt;p&gt;I ended up with a stored procedure looking like the below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;ALTER&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;PROCEDURE&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;[&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;dbo&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;[&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;TestInsertParty&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt;@partyName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold; &quot;&amp;gt;nchar&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; font-weight: bold; &quot;&amp;gt;30&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #808080; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;NULL&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;AS&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;BEGIN&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;SET&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; NOCOUNT &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;ON&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;Insert&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;Into&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; Party (&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;[&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;name&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;, chain_idx) &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;Values&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt;@partyName&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;NULL&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;)
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;Select&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF00FF; &quot;&amp;gt;Scope_Identity&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;() &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;As&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; Id &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;For&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; Xml &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; font-weight: bold; &quot;&amp;gt;Raw&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; (&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;Response&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;&apos;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;)
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;END&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The trick was to use the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms175140.aspx&quot;&gt;&lt;em&gt;XML RAW Mode&lt;/em&gt;&lt;/a&gt;. This mode transforms the result set into a generic identifier as _&lt;row&gt;_. It is however possible to provide a element name, as &lt;_Response&gt;_. Basically this will insert the new value and return something like this from the stored procedure.&lt;/_Response&gt;&lt;/row&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Response &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;Id&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;1054&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After return via the send port the orchestration will receive something like the below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;TestInsertResponse &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;TestInsert&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Response &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;Id&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;1054&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;TestInsertResponse&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The schema that I use to both handling the response and request against the SQL Adapter is shown below. First I set the type of the Id-attribute to &lt;em&gt;xs:int&lt;/em&gt; but this gave me some problems when using the promoted value in the orchestration, everything worked fine when switching back to &lt;em&gt;xs:string&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://richardhallgren.com/blog/wp-content/uploads/2007/04/WindowsLiveWriter/GetrowidentityfromSQLAdapterresponse_D964/sqlinsertschema%5B12%5D2.jpg&quot;&gt;&lt;img src=&quot;http://richardhallgren.com/blog/wp-content/uploads/2007/04/WindowsLiveWriter/GetrowidentityfromSQLAdapterresponse_D964/sqlinsertschema_thumb%5B12%5D2.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt; &lt;br /&gt;
The same technique would be used for receiving a code from the stored procedure (say 1 for success and 0 for failure or whatever) and then to make a logical decision in the orchestration.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Convoying</title>
    <link href="http://richardhallgren.com/convoying" />
    <updated>2007-04-05T07:21:51+00:00</updated>
    <id>http://richardhallgren.com/convoying</id>
    <content type="html">&lt;p&gt;Convoying is one of BizTalk’s real strengths but it has a lot of pitfalls (I’m talking performance, zombies etc). &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/ms942189.aspx&quot;&gt;This article&lt;/a&gt; is really good at explaining the different patterns used for creating convoys. It also makes some deep dives into how the subscriptions are solved, why zombies are created and how to deal with them.&lt;/p&gt;

&lt;p&gt;Even if you feel you understand the convoy patters from before the part about how BizTalk solves the subscriptions for correlations (the part called &lt;em&gt;Basic Convoy Theory&lt;/em&gt;) is great.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Using sequential convoy to handle ordered delivery&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;A big selling point in BizTalk 2006 is it’s ability to handle &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa559637.aspx&quot;&gt;Ordered Delivery&lt;/a&gt;. It’s important however to understand that this setting (on the Receive and Send port) only works in a pure messaging scenario (a scenario without orchestration, just passing messages between ports). To get order delivery in a scenario using orchestrations one has to use the sequential convoy pattern (basically forcing the orchestration to only one instance on one thread). This &lt;a href=&quot;http://msevents.microsoft.com/cui/webcasteventdetails.aspx?eventid=1032288276&amp;amp;culture=en-us&quot;&gt;Webcast&lt;/a&gt; explains this in depth and also deals with some of the different problems that are related to the issue. Problems like performance of course, but also the requirement for receive adapter (on the send side all adapters support ordered delivery) for enabling ordered delivery (you’ll have to use MSMQ, MQSeries or specific scenarios of File, SOAP or HTTP).&lt;/p&gt;

&lt;p&gt;Both convoying and ordered delivery are important concepts to understand in depth to be able to make the right decisions in a BizTalk 2006 solution.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Weekly sum up</title>
    <link href="http://richardhallgren.com/weekly-sum-up" />
    <updated>2007-03-02T08:31:13+00:00</updated>
    <id>http://richardhallgren.com/weekly-sum-up</id>
    <content type="html">&lt;p&gt;I’ll start trying to post a weekly sum up of BizTalk, .NET topics I’ve come across during the week. We’ll see how goes as I’m not the most constant blogger …&lt;/p&gt;

&lt;p&gt;However I worked with mainly three things this week.&lt;/p&gt;

&lt;h3 id=&quot;error-handling-and-general-exception&quot;&gt;Error handling and General Exception&lt;/h3&gt;

&lt;p&gt;I’ve tested some ideas relating to an error handling pattern we like to implement in a one of our major integration projects. We’ve looked at how the new BizTalk 2006 &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa578516.aspx&quot;&gt;Failed Message Routing&lt;/a&gt; fits in with our project. The idea is to have and Orchestration listening to the Error Message, log these and then put the failing message parts to file. We’ll then have a system that picks up the failed messages, launches them in an editor and makes it possible to resend the message after it’s been edited.&lt;/p&gt;

&lt;p&gt;Problem arises when we get to handling exceptions in Orchestrations. Orchestrations doesn’t have the possible to use Failed Message Routing as ports does (I guess that ok, we might want handle different errors in different ways and so on.). However that means that we have to catch an error and create our own Error Message to submit to the message data box for further routing to the Orchestration handling errors (the one that logs and puts the message to file.) So far so good as long as we don’t get an &lt;a href=&quot;http://geekswithblogs.net/cyoung/archive/2004/04/26/4345.aspx&quot;&gt;General Exception&lt;/a&gt;! Usually when getting an General Exception, and we don’t catch it, the message gets suspended and we get a some error details giving us an idea of what went wrong. However as soon as one catches a General Exception we loose all information about the error … We’ve still haven’t found a good way of handling these errors. We just can’t afford loosing that error information!&lt;/p&gt;

&lt;p&gt;General Exceptions are still a mystery to me. I guess that are there so BizTalk has a chance in catching exception that aren’t raised from .NET based code. But what kind of errors within an orchestration raises these kind of exceptions? I know a failure in a mapping does, what else? I’d really like this scenario to better documented. The error handling patter is based on a chapter in the &lt;a href=&quot;http://www.amazon.com/Pro-BizTalk-2006-George-Dunphy/dp/1590596994&quot;&gt;Pro BizTalk 2006 book&lt;/a&gt; (which is a excellent book in my opinion - buy it!) but the General Exception and how to deal with it isn’t discussed there either. &lt;strong&gt;Any ideas, book, articles are highly appreciated!&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;validation&quot;&gt;Validation&lt;/h3&gt;

&lt;p&gt;One important thing to think of in a BizTalk solution &lt;strong&gt;is to not let anything either in or out that doesn’t validate&lt;/strong&gt; (ok, there are exception to this, but generally speaking)! BizTalk has great built in support for this in the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/aa578187.aspx&quot;&gt;XML Validator Pipeline Component&lt;/a&gt; (you might also want to have a look at &lt;a href=&quot;http://thearchhacker.blogspot.com/2004/09/cool-xsd-validation-function-for.html&quot;&gt;this code&lt;/a&gt;). However when working with this it’s important to understand what one is validating against and it suddenly even more important to understand every details in the schemas (external system owners usually like some technical explanation when your telling them that their messages don’t validate in your pipeline ;)). Things we run into this week is the &lt;a href=&quot;http://www.w3.org/TR/xmlschema-0/#NS&quot;&gt;elementFormDefault&lt;/a&gt; attribute. The following reading help me understanding what the attribute does:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.w3.org/TR/xmlschema-0/#NS&quot;&gt;http://www.w3.org/TR/xmlschema-0/#NS&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.hanselman.com/blog/XmlValidatingReaderProblemsOverDerivedXmlReaders.aspx&quot;&gt;http://www.hanselman.com/blog/XmlValidating…XmlReaders.aspx&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://geekswithblogs.net/dmillard/archive/2004/10/20/12935.aspx&quot;&gt;http://geekswithblogs.net/dmillard…12935.aspx&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://blogs.msdn.com/ebattalio/archive/2006/03/03/543154.aspx&quot;&gt;http://blogs.msdn.com/ebattalio/archive/2006/03/03/543154.aspx&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Another thing we ran into was white space handling and  the &lt;em&gt;xml:space&lt;/em&gt; attribute. Apparently if one likes to have a node with a space in it BizTalk removes this if the element doesn’t have the &lt;em&gt;xml:space&lt;/em&gt; attribute. so &lt;em&gt;&lt;node&gt; &lt;/node&gt;&lt;/em&gt; will come out as &lt;em&gt;&lt;node&gt;&lt;/node&gt;&lt;/em&gt; - sound familiar?&lt;/p&gt;

&lt;p&gt;But if the schema doesn’t declare that the node will have a xml:space attribute the validation will fail! To get this working one has to get the schema declaring the the xml:space attribute and then reference it like &lt;a href=&quot;http://www.jezuk.co.uk/cgi-bin/view/jez?id=2306&quot;&gt;this example&lt;/a&gt;. The schema from w3c (if you don’t write your own like in the article) is located &lt;a href=&quot;http://www.w3.org/2001/xml.xsd&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;end-to-end-tracing-in-a-soa&quot;&gt;End-to-end tracing in a SOA&lt;/h3&gt;

&lt;p&gt;I’ll make this short even if it should be the longest part in this post. Basically we’re trying to archive the following:&lt;/p&gt;

&lt;p&gt;Our solution send loads of different messages types between five different BizTalk servers. The client likes to be able to have full text search within these messages and to also be able to see all the messages in each interchange within a server.&lt;/p&gt;

&lt;p&gt;So say for example that we receive and &lt;em&gt;Order message&lt;/em&gt; in a flat file format. This is transformed in to a Xml message that is then routed down to two other different BizTalk servers. It should then be possible for the client to start an application, click on the &lt;em&gt;Order message&lt;/em&gt; type, enter for example the &lt;em&gt;order number&lt;/em&gt; (an element i in the message) and see the the full content of the different files within the interchange (in this example that would be the flat file and the Xml file) where that &lt;em&gt;Order number&lt;/em&gt; is found.&lt;/p&gt;

&lt;p&gt;Basically it’s does what the HAT does (with full text search and a custom GUI). In the first phase of the project we’ll have it work per server, but in the final solution this should perform over all servers … I’ll come back to this in a later post. In the mean time listen to &lt;a href=&quot;http://www.hanselminutes.com/default.aspx?showID=68&quot;&gt;this episode of Hanselminutes on end-to-end tracking&lt;/a&gt;. This will be a challenge in every service orientated architecture …&lt;/p&gt;

&lt;h3 id=&quot;finally&quot;&gt;Finally&lt;/h3&gt;

&lt;p&gt;I’ve sold my &lt;a href=&quot;http://www.apple.com/se/ipodnano/&quot;&gt;iPod Nano&lt;/a&gt; and ordered the &lt;a href=&quot;http://www.creative.com/products/mp3/zenvisionm/&quot;&gt;Creative Vision Zen:M&lt;/a&gt;. Now I’ll catch up on all those &lt;a href=&quot;http://www.dnrtv.com/&quot;&gt;dnrTV Webcasts&lt;/a&gt;! I’ll also make sure to watch everyone of the &lt;a href=&quot;http://richardhallgren.com/blog/?p=25&quot;&gt;BizTalk 2006 Webcasts&lt;/a&gt; during my commute to work.&lt;/p&gt;

&lt;p&gt;Let me know if you found some of this information useful and I’ll try harder to post some like this every Friday.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Simple RegEx replace in C#</title>
    <link href="http://richardhallgren.com/simple-regex-replace-in-c" />
    <updated>2007-02-01T07:22:47+00:00</updated>
    <id>http://richardhallgren.com/simple-regex-replace-in-c</id>
    <content type="html">&lt;p&gt;As I don’t use regular expressions that often I always forget the syntax. So I thought I just put a basic replace pattern up here.&lt;/p&gt;

&lt;p&gt;This method takes a schema, finds all places where is says &lt;em&gt;schemaLocation=”whatever”&lt;/em&gt; in a text and changes this to &lt;em&gt;schemaLocation=”whatever&lt;strong&gt;.xsd&lt;/strong&gt;“&lt;/em&gt; and then returns the schema.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;private&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; XmlSchema FixSchemaLocation(XmlSchema schema)
{
  System.Text.RegularExpressions.Regex locationReplacePattern &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; System.Text.RegularExpressions.Regex(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;schemaLocation=\&quot;(?&amp;lt;location&amp;gt;.*?)\&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;);
  &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;string&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; locationReplaceValue &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;schemaLocation=\&quot;${location}.xsd\&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;;
  &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt;//&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt;Puts .xsd after the schemaLocation. We need this find the imported schemas&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;  StringWriter sw &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; StringWriter();
  schema.Write(sw);
  XmlSchema formatedSchema &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; XmlSchema.Read(&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; StringReader(locationReplacePattern.Replace(sw.ToString(), locationReplaceValue)),&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;null&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;);
  &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; formatedSchema;
}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</content>
  </entry>
  
  <entry>
    <title>BizTalk assembly version redirection</title>
    <link href="http://richardhallgren.com/biztalk-assembly-version-redirection" />
    <updated>2007-01-26T13:34:56+00:00</updated>
    <id>http://richardhallgren.com/biztalk-assembly-version-redirection</id>
    <content type="html">&lt;p&gt;The version redirection in BizTalk do NOT work as one is used to coming from a ordinary .NET developer background (so I was wrong in &lt;a href=&quot;http://richardhallgren.com/blog/?p=50&quot;&gt;this post&lt;/a&gt; …). Say that we made a reference to a code library in one of our orchestrations. This code library is in version 1.0.0.0 when we build and deploy the orchestration to BizTalk and to the GAC. The setup in VS 2005 looks something like this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://richardhallgren.com/blog/wp-content/uploads/2007/02/WindowsLiveWriter/BizTalkassemblyversionredirection_CA12/VersionReference3.jpg&quot;&gt;&lt;img src=&quot;http://richardhallgren.com/blog/wp-content/uploads/2007/02/WindowsLiveWriter/BizTalkassemblyversionredirection_CA12/VersionReference_thumb3.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then we make some minor changes in the code library, we fix them and set the version to 1.0.1.0. Build and deploy it. This means that we now have one 1.0.0.0 and one 1.0.1.0 version side-by-side in the GAC (as shown in the figure below).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://richardhallgren.com/blog/wp-content/uploads/2007/02/WindowsLiveWriter/BizTalkassemblyversionredirection_CA12/GAC8.jpg&quot;&gt;&lt;img src=&quot;http://richardhallgren.com/blog/wp-content/uploads/2007/02/WindowsLiveWriter/BizTalkassemblyversionredirection_CA12/GAC_thumb8.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Coming from .NET the CLR should now load the 1.0.1.0 version as it identifies assemblies based on the assembly name, major or minor version (NOT the build and revision version), public key token and culture (&lt;a href=&quot;http://www.informit.com/articles/article.asp?p=99977&amp;amp;seqNum=6&amp;amp;rl=1&quot;&gt;more about this here&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;However, this does NOT work in BizTalk. BizTalk loads assemblies by fullname it has stored in the management database and the build and revision number are part of the fullname … This means we have to build and redelopy EVERY part where we like to use new version of the code library.&lt;/p&gt;

&lt;p&gt;There is one way around this for emergency use. Say that one has a code library that is used in loads of BizTalk artifacts (A place where we store all base functionality for the solution). Rebuilding all those parts and redeploying it, just to be able to update the version number, is not going to happened! It’s to much work and to risky. **So it’s possible to make a change in the &lt;em&gt;BTSBTSvc.exe.config&lt;/em&gt; file instead. **In my case the change would be something like the below (&lt;a href=&quot;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/cpgenref/html/gngrfbindingredirect.asp&quot;&gt;read more about here&lt;/a&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;dependentAssembly&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
  &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;assemblyIdentity name&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;StaticCodeLibrary&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; publicKeyToken&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;32ab4ba45e0a69a1&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; culture&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;neutral&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
  &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;bindingRedirect oldVersion&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;1.0.0.0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt; newVersion&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;1.0.1.0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;dependentAssembly&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</content>
  </entry>
  
  <entry>
    <title>Assembly loading policy from the GAC</title>
    <link href="http://richardhallgren.com/assembly-loading-policy-from-the-gac" />
    <updated>2007-01-17T17:27:04+00:00</updated>
    <id>http://richardhallgren.com/assembly-loading-policy-from-the-gac</id>
    <content type="html">&lt;p&gt;UPDATE: This does not apply to BizTalk … I’ve made an update &lt;a href=&quot;http://richardhallgren.com/blog/?p=51&quot;&gt;post here&lt;/a&gt;. Sorry.&lt;/p&gt;

&lt;p&gt;We’re working with a lot of code libraries that we use in different parts of our BizTalk solutions. As the are used on several servers and by loads of different “BizTalk parts” (both in orchestrations and maps) it’s important that we always keep the version number of the assemblies up to date. That means that every little change should increase the current version number. But as they are used in so many places people have started to skip this step as they thought they had to compile all parts that should use the new code (say it’s a bug fix and you’d like all “using parts” of the assembly to load the updated version). This is where GAC loading policy comes to the resource!&lt;/p&gt;

&lt;p&gt;First we have to understand that every .NET assembly is identified using four characteristics:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Assembly name&lt;/li&gt;
  &lt;li&gt;Major or minor version&lt;/li&gt;
  &lt;li&gt;Public key token&lt;/li&gt;
  &lt;li&gt;Culture&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Then we need to know that the first version number in for example version 1.1.2.1 is the &lt;strong&gt;major version&lt;/strong&gt;. The second is the &lt;strong&gt;minor version&lt;/strong&gt; and the third and fourth are &lt;strong&gt;build, revision version number&lt;/strong&gt;. So this means that if you have 1.1.2.1 installed and make a minor change the easiest way to use the new assembly is to change the one of the build or revision numbers (the third or fourth number). Then the CLR will load the new assembly without any other changes!&lt;/p&gt;

&lt;p&gt;But sometimes we have to change the minor or major version - and we still don’t have to recompile a thing! We can use a publisher policy file. This is an example of such a file defined for version 1.0.0.0 moving to 2.0.0.0.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;configuration&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;runtime&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;assemblyBinding &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;urn:schemas-microsoft-com:asm.v1&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;dependentAssembly&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
                &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;assemblyIdentity &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;name&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;BaseHelper&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; publicKeyToken&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;18517ea673f8584b&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; culture&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;neutral&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
                    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;bindingRedirect &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;oldVersion&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;1.0.0.0&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; newVersion&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;2.0.0.0&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;/&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;dependentAssembly&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;assemblyBinding&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;runtime&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;configuration&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This &lt;a href=&quot;http://support.microsoft.com/kb/891030&quot;&gt;kb article&lt;/a&gt; describes what to do next:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Change the version and recompile.&lt;/strong&gt; The first step is to create the new version of your component. After you’ve done that, you will need to modify the version number in the AssemblyInfo file for your component. &lt;br /&gt;
&lt;strong&gt;Create the publisher policy file. **Create the publisher policy file for the assembly using the format shown above. &lt;br /&gt;
**Use Assembly Linker (Al.exe) to create the publisher policy assembly.&lt;/strong&gt; The Assembly Linker is included with the .NET Framework SDK. To create the publisher policy assembly that redirects a binding from version 1.0 of Website.dll to version 2.0 using a publisher policy file called website.config, run the following command:&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;al /link:BaseHelper.config /out:policy.1.0.BaseHelper.dll /keyfile:c:\keyfile.snk&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This command will create a new assembly called policy.1.0.BaseHelper.dll. This naming convention is important, as indicated in the “What Is a Publisher Policy Assembly?” section.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Install the publisher policy assembly into the Global Assembly Cache.&lt;/strong&gt; The publisher policy assembly is installed into the GAC. It will be used by the .NET runtime when any application attempts to bind to version 1.0 of the BaseHelper.dll, and it will force the application to bind to the new version automatically.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;**Install the new version into the Global Assembly Cache. **Install the new version of the component into the GAC. After the new version has been installed, the old version can be safely removed.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;So no more excuses for not updating the version number!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Understanding persistence points</title>
    <link href="http://richardhallgren.com/understanding-persistence-points" />
    <updated>2007-01-08T12:11:25+00:00</updated>
    <id>http://richardhallgren.com/understanding-persistence-points</id>
    <content type="html">&lt;p&gt;I found &lt;a href=&quot;http://seroter.wordpress.com/2007/01/02/orchestration-handling-of-suspended-messages/&quot;&gt;this post from Richard Seroter’s blog&lt;/a&gt; on persistence points interesting. The post deals with the basics in persistence points and how to tweak them to get a resumed orchestration to resume at an expected step. Not understanding persistence point and not thinking about them when planing and building an orchestration might cause some strange bugs and errors.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Testable data access code</title>
    <link href="http://richardhallgren.com/testable-data-access-code" />
    <updated>2007-01-03T15:26:55+00:00</updated>
    <id>http://richardhallgren.com/testable-data-access-code</id>
    <content type="html">&lt;p&gt;As one of the most important rules for a test &lt;strong&gt;is that it can’t rely on state&lt;/strong&gt;, I’ve always found automated data access testing hard. As I view it there are three approaches to accomplish reliable testing of such a layer:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;A local database that is restored for each and every test.&lt;/li&gt;
  &lt;li&gt;Using transactions that can rollback the database after the test completed&lt;/li&gt;
  &lt;li&gt;Using mock objects&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I guess all of them has drawbacks and are suitable in different situations.&lt;/p&gt;

&lt;p&gt;It would be possible to have ones data access layer connected to a local database that’s fully restored to a know state for every test. But as the database grows that process would soon get extremely slow. And as one of the requirements for testing and test driven development is that is possible to test often (and if we like to test often is has to be fast) I think this is a method that only works when we have a simple tiny database (something we almost never have …).&lt;/p&gt;

&lt;p&gt;Another way of do it would be use transactions to rollback each test operation on the database. A problem here is that we might use transactions within the access layer we like to test! We might even have transactions disabled. This &lt;a href=&quot;http://msdn.microsoft.com/msdnmag/issues/05/06/UnitTesting/default.aspx&quot;&gt;excellent article&lt;/a&gt; by Roy Osherove discusses the possibilities of using the transactions from  Enterprise Services (COM+) for rolling back database operations. This is an interesting approach and with the new &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.transactions.aspx&quot;&gt;System.Transactions namespace in .NET 2.0&lt;/a&gt; things should be even easier. But still, if one is using transactions in the actually access layer that is being tested we still have to use something else. Another problem is that transactions always will cause a minor performance hit that might grow when using it in a large project with loads of tests.&lt;/p&gt;

&lt;p&gt;And then we have mock objects. The first thing we have to think about here is what we should test in a unit test? Should we really test the all the way to the database or should we stay within the boundaries of the application? My option is that a unit test should not test all the way through to the database, then it’s a integration test. &lt;strong&gt;However&lt;/strong&gt; it might be very useful to have such a test in our test suite. If we decide to actually test trough to the database mock object will not do us any good. They will only be able to test that the right method in the data access class were called in correct order.&lt;/p&gt;

&lt;p&gt;Some links I found useful:&lt;br /&gt;
&lt;a href=&quot;http://weblogs.asp.net/rosherove/archive/2004/12/10/279258.aspx&quot;&gt;http://weblogs.asp.net/rosherove/archive/2004/12/10/279258.aspx&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;http://weblogs.asp.net/rosherove/articles/dbunittesting.aspx&quot;&gt;http://weblogs.asp.net/rosherove/articles/dbunittesting.aspx&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;http://weblogs.asp.net/rosherove/archive/2004/07/20/187863.aspx&quot;&gt;http://weblogs.asp.net/rosherove/archive/2004/07/20/187863.aspx&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;http://msdn.microsoft.com/msdnmag/issues/04/10/NMock/default.aspx&quot;&gt;http://msdn.microsoft.com/msdnmag/issues/04/10/NMock/default.aspx&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnaspp/html/aspnet-testwithnunit.asp&quot;&gt;http://msdn.microsoft.com/library…testwithnunit.asp&lt;/a&gt;&lt;br /&gt;
&lt;a href=&quot;http://msdn.microsoft.com/msdnmag/issues/05/06/UnitTesting/default.aspx&quot;&gt;http://msdn.microsoft.com/msdnmag…default.aspx&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Web service times out before the orchestration completes</title>
    <link href="http://richardhallgren.com/web-service-times-out-before-the-orchestration-completes" />
    <updated>2006-12-20T10:09:33+00:00</updated>
    <id>http://richardhallgren.com/web-service-times-out-before-the-orchestration-completes</id>
    <content type="html">&lt;p&gt;Today we ran into some problems when making a call to a web service that took more than 90 seconds via the SOAP adapter. After 90 seconds we got a “System.Net.WebException: The operation has timed-out” error in return. It turned out that we had to set the &lt;em&gt;SOAP.ClientConnectionTimeOut&lt;/em&gt; context property for the request message. We did this in the message construction using the following code.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;MyRequestMessage(SOAP.ClientConnectionTimeout) = 200000;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I found this &lt;a href=&quot;http://www.winterdom.com/weblog/2005/07/17/WebServiceCallTimeoutInBizTalk.aspx&quot;&gt;post by Thomas Restrepo&lt;/a&gt; useful for understanding both the problem and solution. Apparently the default value is 90000 (90 seconds) before the adapter times out. This &lt;a href=&quot;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/BTS_2004WP/html/5cab05ab-6848-4f6c-8d11-9abc4dd1d1fa.asp&quot;&gt;article on MSDN&lt;/a&gt; is also an excellent read when working with web services and BizTalk server.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>How to set a custom file name using the file adapter in BizTalk</title>
    <link href="http://richardhallgren.com/how-to-set-a-custom-file-name-using-the-file-adapter-in-biztalk" />
    <updated>2006-12-15T10:28:26+00:00</updated>
    <id>http://richardhallgren.com/how-to-set-a-custom-file-name-using-the-file-adapter-in-biztalk</id>
    <content type="html">&lt;p&gt;Found this &lt;a href=&quot;http://www.codeproject.com/useritems/SendHandlerMacro.asp&quot;&gt;article&lt;/a&gt; on the code project on how to set a custom name on a output file - something I recently had to do. It also contains a list of all the macros that are available in the file adapter - so does this &lt;a href=&quot;http://blogs.msdn.com/oallen/archive/2004/03/19/92673.aspx&quot;&gt;post from Owen Allen&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Advanced Microsoft BizTalk Server 2004 and Microsoft Operations Manager 2005 Scenarios</title>
    <link href="http://richardhallgren.com/advanced-microsoft-biztalk-server-2004-and-microsoft-operations-manager-2005-scenarios" />
    <updated>2006-12-15T07:27:02+00:00</updated>
    <id>http://richardhallgren.com/advanced-microsoft-biztalk-server-2004-and-microsoft-operations-manager-2005-scenarios</id>
    <content type="html">&lt;p&gt;Scott Colestock has a vary thorough &lt;a href=&quot;http://www.microsoft.com/technet/prodtechnol/biztalk/biztalk2004/maintain/advanced-biztalk-mom.mspx&quot;&gt;article&lt;/a&gt; on &lt;a href=&quot;http://technet.microsoft.com/en-us/default.aspx&quot;&gt;TechNet&lt;/a&gt; about &lt;a href=&quot;http://www.microsoft.com/mom/default.mspx&quot;&gt;MOM 2005&lt;/a&gt; and BizTalk. It’s really amazing what it possible to accomplish when one gets these two solutions to play together.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>BOM - Byte Order Mark in BizTalk output</title>
    <link href="http://richardhallgren.com/bom-byte-order-mark-in-biztalk-output" />
    <updated>2006-12-13T15:38:05+00:00</updated>
    <id>http://richardhallgren.com/bom-byte-order-mark-in-biztalk-output</id>
    <content type="html">&lt;p&gt;Today was another day of new BizTalk problems … The task was easy; produce a XML file and send to a receiving system. Fine. Done. … Not.&lt;/p&gt;

&lt;p&gt;The receiving system could not read the file because of some strange characters in the beginning of the file! It looked something like the below when opening the file in a fancy text editor (&lt;a href=&quot;http://www.ultraedit.com/&quot;&gt;UltraEdit&lt;/a&gt; or &lt;a href=&quot;http://www.textpad.com/&quot;&gt;TextPad&lt;/a&gt; for example).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;i»¿&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF00FF; &quot;&amp;gt;xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;?&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a couple of very interesting (:/) hours of &lt;a href=&quot;http://en.wikipedia.org/wiki/Google_(verb)&quot;&gt;Googling&lt;/a&gt; I found this from Ben McFarlin&lt;/p&gt;

&lt;blockquote&gt;

&amp;gt; 
&amp;gt; It is because internal BizTalk messages are in UTF8 format and include  
the byte order mark. When you added the xml declaration for UTF16 it  
confused the engine; the declaration read UTF16 but the byte order mark indicated UTF8.
&amp;gt; 
&amp;gt; &lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/12/WindowsLiveWriter/BOMByteOrderMark_EA75/preserveBOM%5B5%5D5.jpg&quot;&gt;&lt;img src=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/12/WindowsLiveWriter/BOMByteOrderMark_EA75/preserveBOM_thumb%5B5%5D5.jpg&quot; alt=&quot;Preserve BOM&quot; /&gt;&lt;/a&gt;When I finally found the cause the solution was easy. Just another of those &lt;a href=&quot;http://support.microsoft.com/kb/921044&quot;&gt;weird properties&lt;/a&gt; … This time it’s called &lt;em&gt;Preserve BOM&lt;/em&gt; (on the properties of the XML Assembly pipeline component - see figure on the right). &lt;em&gt;BOM&lt;/em&gt; of course stands for &lt;em&gt;Byte Order Mark&lt;/em&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Gmail and Opera Mini on the phone!</title>
    <link href="http://richardhallgren.com/gmail-and-opera-mini-on-the-phone" />
    <updated>2006-12-13T11:51:46+00:00</updated>
    <id>http://richardhallgren.com/gmail-and-opera-mini-on-the-phone</id>
    <content type="html">&lt;p&gt;A couple of months ago I found the new Gmail mobile application. It’s a clean small Java application that one downloads to the mobile phone for accessing the Gmail account.&lt;/p&gt;

&lt;p&gt;The application has easy access to almost all of the features that the ordinary web interface has. There was (and probably still are) an mobile version of the web interface but it didn’t have the easy access to all the different menus as this application has. I really like it and use it several times each day.&lt;/p&gt;

&lt;p&gt;The supported devices are listed &lt;a href=&quot;http://mail.google.com/support/bin/answer.py?answer=50425&quot;&gt;here&lt;/a&gt; and to get on your phone all you do is to visit this URL &lt;a href=&quot;http://gmail.com/app&quot;&gt;http://gmail.com/app&lt;/a&gt; with your device.&lt;/p&gt;

&lt;p&gt;Another cool little application is the &lt;a href=&quot;http://www.operamini.com/&quot;&gt;Opera Mini browser&lt;/a&gt;. These a full feature list &lt;a href=&quot;http://www.operamini.com/features/&quot;&gt;here&lt;/a&gt;. Basically it transforms the pages so that they fit the mobile screen, and it’s fast! It also has some special features for navigation on small screens. And it supports RSS bookmarks!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Nevermind the XML namespaces in Xpath expressions</title>
    <link href="http://richardhallgren.com/nevermind-the-xml-namespaces-in-xpath-expressions" />
    <updated>2006-12-11T15:45:59+00:00</updated>
    <id>http://richardhallgren.com/nevermind-the-xml-namespaces-in-xpath-expressions</id>
    <content type="html">&lt;p&gt;Understanding &lt;a href=&quot;http://www.w3.org/TR/xpath&quot;&gt;Xpath&lt;/a&gt; expressions is definitely a success factor when working with BizTalk development. Xpath is extremely powerful (when one gets it right) but it’s one of the must frustration techniques I’ve ever worked with! Xpath is one of those languages that either gives you to answer you want to a query - or (more often) just doesn’t give you anything in return! In 99 percent of the cases this means that you missed something in your match. In 99 percent of these cases this means that you got some problems with namespaces in the XML document your querying (This is certainly true when working with BizTalk that “namespace-heavy”). One technique to get around this is to use the same approach as BizTalk itself uses - the &lt;a href=&quot;http://www.w3.org/TR/xpath#function-local-name&quot;&gt;Xpath local-name() function&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Consider the following XML document.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Message &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt;xmlns:ns0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;Standard.Envelope/1.1&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF0000; &quot;&amp;gt; xmlns:xsi&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns0:Envelope&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Header&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;MessageTypeInfo&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
                &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;MessageType&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;MessageType&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;MessageTypeInfo&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Action&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;INSERTED&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Action&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Addressees&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
                &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;SenderCode&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;Mill&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;SenderCode&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
            &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Addressees&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
        &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Header&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
    &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;ns0:Envelope&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;/&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #800000; &quot;&amp;gt;Message&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Xpath expression below will hit the &lt;em&gt;Envelope _node. But is’s very fragile! As soon as the namespace prefix changes (It might change to _ns1&lt;/em&gt; and namespace &lt;em&gt;ns0&lt;/em&gt; will be used for something else.) you’ll end up with an empty result.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;/Message/ns0:Envelope&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, if one uses the below expressions instead - that makes use of the local-name function - it ignores the namespace and only cares about the name of the node (&lt;em&gt;Envelope&lt;/em&gt; that is ;)). And this is of course far less sensitive to change.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;/Message/*[local-name()=&apos;Envelope&apos;]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</content>
  </entry>
  
  <entry>
    <title>BizTalk Deploy Tool</title>
    <link href="http://richardhallgren.com/biztalk-deploy-tool" />
    <updated>2006-12-11T14:44:13+00:00</updated>
    <id>http://richardhallgren.com/biztalk-deploy-tool</id>
    <content type="html">&lt;p&gt;I’m currently working in a stabilization phase on a deployment application for BizTalk 2006 projects. We based the solution on the &lt;a href=&quot;http://www.gotdotnet.com/codegallery/codegallery.aspx?id=b4d6499f-0020-4771-a305-c156498db75e&quot;&gt;Enterprise Solutions Build Framework&lt;/a&gt; and the &lt;a href=&quot;http://msdn2.microsoft.com/en-US/library/aa559050.aspx&quot;&gt;BizTalk Explorer Object Model&lt;/a&gt;. Basically our solution has a GUI that makes it possible to point out which artifacts one likes to deploy (from the developers local BizTalk server).&lt;/p&gt;

&lt;p&gt;The application then figures out all the dependencies that the selected artifacts has (In our solution an Orchestration for example might have &amp;gt; 20 dependencies to different schemas, pipelines, C# libraries etc, etc).&lt;/p&gt;

&lt;p&gt;All DLL:s of the different artifacts are then extracted from the local GAC (where they exist when deployed to the local BizTalk). These DLL:s are then packed in to one single deployment package also containing a single XML file that keeps track of the dependencies and the order of witch they have to be deployed in BizTalk (the most depending schemas first and so on). The XML file also contains other meta data information such as ports the artifacts use etc.&lt;/p&gt;

&lt;p&gt;This package is then loaded into another part of the application were it’s possible to point out the different servers one like to deploy to. This view then shows information about what has to be done on the server to make it possible to deploy without conflicts (One might have running Orchestration or suspended messages for example that has to be stopped or terminated.). At this stage we also check the naming of the different artifacts. These have to comply with the naming conventions that are configured in the config file of the applications (a warning is shown if the artifact doesn’t validate towards these).&lt;/p&gt;

&lt;p&gt;When no warnings (its possible to override a warning) or conflicts are shown one can deploy. We then move the deploy scripts to the servers and use the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/wea2sca5.aspx&quot;&gt;MSBuild&lt;/a&gt; tasks in the &lt;a href=&quot;http://www.gotdotnet.com/codegallery/codegallery.aspx?id=b4d6499f-0020-4771-a305-c156498db75e&quot;&gt;SBF&lt;/a&gt; to deploy everything for us. We really saved some serious time with this approach and even if it took us a while to get everything working it’s been well worth it!&lt;/p&gt;

&lt;p&gt;We have a huge feature list for the next phase of the tool and are planing to and support for &lt;a href=&quot;http://www.gotdotnet.com/workspaces/workspace.aspx?id=85ef830b-5903-4872-8071-4d4123a5553b&quot;&gt;BizUnit&lt;/a&gt; tests in the DLL:s (so that one gets a warning when deploying a Orchestration without etc). We also like to add more meta data about the port and make it possible to configure new ports as a part of the deployment process. Etc, etc …&lt;/p&gt;

&lt;p&gt;Feel free to comment or write we line for further information about this approach. It would also be interesting to hear about other approaches for deployment and what kind of features these solutions have.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>ARCast - Patterns and Anti-Patterns for SOA</title>
    <link href="http://richardhallgren.com/arcast-patterns-and-anti-patterns-for-soa" />
    <updated>2006-12-11T13:37:10+00:00</updated>
    <id>http://richardhallgren.com/arcast-patterns-and-anti-patterns-for-soa</id>
    <content type="html">&lt;p&gt;I’m a loyal &lt;a href=&quot;http://channel9.msdn.com/shows/ARCast_with_Ron_Jacobs&quot;&gt;ARcast&lt;/a&gt; listener and I think I’ve listened to most of the shows that ever been produced (at least those that are available in the archive). I also listen to a couple of other podcasts that are focusing on .NET and Microsoft techniques (for example &lt;a href=&quot;http://www.dotnetrocks.com/&quot;&gt;.NET Rocks!&lt;/a&gt;) and in my opinion ARcast is by far the most rewarding (I guess this is both a matter of taste and depending on what kind of work one does.)! However these two shows on &lt;em&gt;Patterns and anti-patterns for SOA&lt;/em&gt; (&lt;a href=&quot;http://channel9.msdn.com/ShowPost.aspx?PostID=259342&quot;&gt;part 1&lt;/a&gt; and &lt;a href=&quot;http://channel9.msdn.com/ShowPost.aspx?PostID=260161&quot;&gt;part 2&lt;/a&gt;) really stands out!&lt;/p&gt;

&lt;p&gt;They really got me thinking of a couple of anti-patterns the project I’m currently working on are stuck in. And Ron Jacob delivers (as always) the message with a lot of humor and enthusiasm. Recommended!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>XML comment in BizTalk output message</title>
    <link href="http://richardhallgren.com/xml-comment-in-biztalk-output-message" />
    <updated>2006-12-11T13:18:36+00:00</updated>
    <id>http://richardhallgren.com/xml-comment-in-biztalk-output-message</id>
    <content type="html">&lt;p&gt;We ran into an issue today when we had to have an XML comment just below the XML declaration in a message we’re producing in our BizTalk 2006 solution. We needed to produce something like the below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;&amp;lt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #FF00FF; &quot;&amp;gt;xml version=&quot;1.0&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #0000FF; &quot;&amp;gt;?&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;
&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt;&amp;lt;!--&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt; Comment goes here &amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #008000; &quot;&amp;gt;--&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our first approach was to create a map in the send port and to have a custom XSLT template in there that added the comment before the whole transformation process started. We actually got this to work but it meant that we had to have a whole new map with a separate XSLT document in the project!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/12/WindowsLiveWriter/XMLcommentinBizTalkoutputmessage_C9D4/xml%20assembler%20settings%5B1%5D5.jpg&quot;&gt;&lt;img src=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/12/WindowsLiveWriter/XMLcommentinBizTalkoutputmessage_C9D4/xml%20assembler%20settings_thumb%5B1%5D5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;Eventually we found a property called &lt;em&gt;Xml Asm Processing Instructions&lt;/em&gt; (highlighted in the figure - click it to view it in original size) on the XML assembly component (used in the standard XMLTransmit pipeline).&lt;/p&gt;

&lt;p&gt;We just put the comment as a value in this property and we were done! No new artifacts or code! Just a weird property - typical BizTalk behavior!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Virtual Desktop Manager in XP PowerToys</title>
    <link href="http://richardhallgren.com/virtual-desktop-manager-in-xp-powertoys" />
    <updated>2006-09-29T08:57:21+00:00</updated>
    <id>http://richardhallgren.com/virtual-desktop-manager-in-xp-powertoys</id>
    <content type="html">&lt;p&gt;Today someone complained about Windows XP’s lack of virtual desktops and that Mac had the possibility to have several desktops active with different content. I remembered that had tried something like that a couple of years ago and after a while I found &lt;a href=&quot;http://www.microsoft.com/windowsxp/downloads/powertoys/xppowertoys.mspx&quot;&gt;Microsoft PowerToys for Windows XP&lt;/a&gt; again.&lt;/p&gt;

&lt;p&gt;The PowerToys package contains several small XP add-ins. For example the &lt;em&gt;&lt;strong&gt;Virtual Desktop Manager&lt;/strong&gt;&lt;/em&gt;!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/09/WindowsLiveWriter/VirtualDesktopManagerinXPPowerToys_9965/desktops%5B1%5D.jpg&quot;&gt;&lt;img src=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/09/WindowsLiveWriter/VirtualDesktopManagerinXPPowerToys_9965/desktops.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As the image above show the manager makes it possible to have four separate desktops running at one - nice! A few configurations tips that I found useful was &lt;strong&gt;&lt;em&gt;turn of the shared desktops option&lt;/em&gt;&lt;/strong&gt; and to &lt;em&gt;&lt;strong&gt;set the shortcut&lt;/strong&gt;&lt;/em&gt; for showing the desktops to &lt;em&gt;alt-§&lt;/em&gt; (that’s close to the &lt;em&gt;alt-tab&lt;/em&gt; option).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/09/WindowsLiveWriter/VirtualDesktopManagerinXPPowerToys_9965/multitask%5B1%5D.jpg&quot;&gt;&lt;img src=&quot;http://richardhallgren.com/blog/wp-content/uploads/2006/09/WindowsLiveWriter/VirtualDesktopManagerinXPPowerToys_9965/multitask.jpg&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;An other cool application in the PowerToys package is the &lt;em&gt;&lt;strong&gt;Alt-Tab Replacement&lt;/strong&gt;&lt;/em&gt; that shows a small preview of the different windows one is multi tasking between (as shown in the image above).&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Visual Studio Database Project</title>
    <link href="http://richardhallgren.com/visual-studio-database-project" />
    <updated>2006-09-28T09:00:54+00:00</updated>
    <id>http://richardhallgren.com/visual-studio-database-project</id>
    <content type="html">&lt;p&gt;I’ve realized that I never understood the full potential of the Visual Studio Database Project. None of the projects I’ve worked on has had a effective process on handling changes and versioning of the database schema. Test data, build scripts, changes to the local development database versus the test and production base has also been a bit bumpy. I’ve haven’t understood that working with the Database Project potentially could solves a lot of these challenges .&lt;/p&gt;

&lt;p&gt;A &lt;a href=&quot;http://www.awprofessional.com/articles/article.asp?p=31764&amp;amp;seqNum=1&amp;amp;rl=1&quot;&gt;chapter&lt;/a&gt; from the &lt;a href=&quot;http://www.awprofessional.com/bookstore/product.asp?isbn=0672323435&amp;amp;rl=1&quot;&gt;Database Access with Visual Basic® .NET&lt;/a&gt; book describes some features in the Database Project.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>CSS Control Adapter Toolkit</title>
    <link href="http://richardhallgren.com/css-control-adapter-toolkit" />
    <updated>2006-09-28T06:40:09+00:00</updated>
    <id>http://richardhallgren.com/css-control-adapter-toolkit</id>
    <content type="html">&lt;p&gt;A while ago Microsoft released the &lt;a href=&quot;http://weblogs.asp.net/scottgu/archive/2006/05/02/CSS-Control-Adapter-Toolkit-for-ASP.NET-2.0-.aspx&quot;&gt;CSS Control Adapter Toolkit&lt;/a&gt; for ASP.NET 2.0. It finally makes it possible to use all the time saving ASP.NET controls in 2.0 without all the horrible HTML they used to produce. The toolkit gives access to the now improved source of the following adapter controls:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Menu&lt;/li&gt;
  &lt;li&gt;TreeView&lt;/li&gt;
  &lt;li&gt;GridView&lt;/li&gt;
  &lt;li&gt;DetailsView&lt;/li&gt;
  &lt;li&gt;FormsView&lt;/li&gt;
  &lt;li&gt;DataList&lt;/li&gt;
  &lt;li&gt;Login&lt;/li&gt;
  &lt;li&gt;ChangePassword&lt;/li&gt;
  &lt;li&gt;CreateUser&lt;/li&gt;
  &lt;li&gt;PasswordRecovery&lt;/li&gt;
  &lt;li&gt;LoginStatus&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Make sure to have the latest &lt;a href=&quot;http://weblogs.asp.net/scottgu/archive/2006/09/08/CSS-Control-Adapter-Toolkit-Update.aspx&quot;&gt;update&lt;/a&gt;. The update fixed a few things in the old controls and added a couple more.&lt;/p&gt;

&lt;p&gt;One can almost think of the this toolkit as a patch for ASP.NET and &lt;strong&gt;when creating a public website this really is a must&lt;/strong&gt;!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>BizTalk Server 2006 Troubleshooters Guide</title>
    <link href="http://richardhallgren.com/biztalk-server-2006-troubleshooters-guide" />
    <updated>2006-09-27T20:16:10+00:00</updated>
    <id>http://richardhallgren.com/biztalk-server-2006-troubleshooters-guide</id>
    <content type="html">&lt;p&gt;I’ve just started reading the new &lt;a href=&quot;http://blogs.msdn.com/biztalk_server_team_blog/archive/2006/09/13/752294.aspx&quot;&gt;BizTalk Server 2006 Troubleshooters Guide&lt;/a&gt;, it’s basically 133 pages packed with best practices and common pitfalls to avoid. It’s seems to be a great resource and I’ll try to use this blog to summarize some of the different parts - just have to get some more time! ;)&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>FileSystemWatcher Class</title>
    <link href="http://richardhallgren.com/filesystemwatcher-class" />
    <updated>2006-09-25T10:02:04+00:00</updated>
    <id>http://richardhallgren.com/filesystemwatcher-class</id>
    <content type="html">&lt;p&gt;I just found the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx&quot;&gt;FileSystemWatcher class&lt;/a&gt; in the &lt;a href=&quot;http://msdn2.microsoft.com/en-us/library/29kt2zfk.aspx&quot;&gt;System.IO&lt;/a&gt; namespace. It provides the functionality to listen on the file system for changes on a file or directory. The class fires a couple of events: &lt;em&gt;Changed&lt;/em&gt;, &lt;em&gt;Created&lt;/em&gt;, &lt;em&gt;Deleted&lt;/em&gt; and &lt;em&gt;Renamed&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;I didn’t know of this class until now. I always thought one had to write a service to accomplish something like this! Definitely very useful!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>More BizTalk and integration related Webcasts!</title>
    <link href="http://richardhallgren.com/more-biztalk-and-integration-related-webcasts" />
    <updated>2006-09-20T18:40:59+00:00</updated>
    <id>http://richardhallgren.com/more-biztalk-and-integration-related-webcasts</id>
    <content type="html">&lt;p&gt;I found a couple of really good webcasts &lt;a href=&quot;http://www.microsoft.com/events/series/msdnbpi.mspx&quot;&gt;here&lt;/a&gt;!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>VS 2005 project on the old IIS</title>
    <link href="http://richardhallgren.com/vs-2005-project-on-the-old-iis" />
    <updated>2006-09-13T06:24:29+00:00</updated>
    <id>http://richardhallgren.com/vs-2005-project-on-the-old-iis</id>
    <content type="html">&lt;p&gt;As most people know the web project that are created and tested in VS 2005 run on an internal web server (called Cassini).&lt;/p&gt;

&lt;p&gt;In some situations this is useful as it enables one to quickly get the project up and running and start testing. But as the sites usually are going to run on an IIS in production I usually like to test it and develop it on one as well (for other reasons, check &lt;a href=&quot;http://codebetter.com/blogs/peter.van.ooijen/archive/2006/09/12/Switching-from-the-VS-development-server-to-IIS.aspx&quot;&gt;this&lt;/a&gt; out).&lt;/p&gt;

&lt;p&gt;Here’s &lt;a href=&quot;http://codebetter.com/blogs/peter.van.ooijen/archive/2006/09/12/Switching-from-the-VS-development-server-to-IIS.aspx&quot;&gt;a good article&lt;/a&gt; on how to change the setting that makes VS behave as it it used to (put it on an URL and create a virtual directory for it).&lt;/p&gt;

&lt;p&gt;The only drawback I can think of is that it becomes a bit more complicated when it comes to deleting a project …&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Excel into BizTalk 2006 - the easy way</title>
    <link href="http://richardhallgren.com/excel-into-biztalk-2006-the-easy-way" />
    <updated>2006-09-11T20:08:41+00:00</updated>
    <id>http://richardhallgren.com/excel-into-biztalk-2006-the-easy-way</id>
    <content type="html">&lt;p&gt;FarPoint just released a &lt;a href=&quot;http://www.fpoint.com/biztalk/default.aspx&quot;&gt;pipeline disassembler component for Excel documents&lt;/a&gt; (called “FarPoint Spread for Microsoft® BizTalk® Server 2006”). It looks pretty cool! It comes with a “Spreadsheet Schema wizard” that integrates with Visual Studio 2005. It could potentially save a lot of work.&lt;/p&gt;

&lt;p&gt;I guess the reason that Microsoft hasn’t released anything like this is that they like to push the use of Infopath. Basically everything would be much easier if one uses Infopath, but there might be situations where this isn’t possible.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Viewstate</title>
    <link href="http://richardhallgren.com/viewstate" />
    <updated>2006-09-11T07:10:45+00:00</updated>
    <id>http://richardhallgren.com/viewstate</id>
    <content type="html">&lt;p&gt;Before writing a new user or custom control read &lt;a href=&quot;http://weblogs.asp.net/infinitiesloop/archive/2006/08/03/Truly-Understanding-Viewstate.aspx&quot;&gt;this article&lt;/a&gt; about Viewstate!&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>BizTalk Webcasts</title>
    <link href="http://richardhallgren.com/biztalk-webcasts" />
    <updated>2006-09-09T10:58:53+00:00</updated>
    <id>http://richardhallgren.com/biztalk-webcasts</id>
    <content type="html">&lt;p&gt;I’m not sure of how many know of &lt;a href=&quot;http://msdn.microsoft.com/biztalk/community/webcasts/default.aspx&quot;&gt;these Webcasts&lt;/a&gt; that Microsoft keep publishing. I didn’t know of them until recently and that I’ve learnt a lot by viewing them. I find it a excellent way of learning new things and tips from some of the most skilled people working with BizTalk.&lt;/p&gt;

&lt;p&gt;I recommend the following:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/cui/WebCastEventDetails.aspx?EventID=1032284450&amp;amp;EventCategory=5&amp;amp;culture=en-us&amp;amp;CountryCode=US&quot;&gt;Design Human Workflow Solutions with BizTalk Server 2004&lt;/a&gt; (medium)&lt;br /&gt;
This is a &lt;strong&gt;absolute must to watch&lt;/strong&gt;. The demo is this presentation is a killer! It’s a complete workflow system build in **four **days that really shows the strengths of BizTalk. It’s also emphasizes some important architecture best practices in BizTalk.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/cui/WebCastEventDetails.aspx?EventID=1032278710&amp;amp;EventCategory=5&amp;amp;culture=en-us&amp;amp;CountryCode=US&quot;&gt;BizTalk Web Services and WSE&lt;/a&gt; (medium)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/CUI/EventDetail.aspx?EventID=1032247084&amp;amp;Culture=en-US&quot;&gt;Getting up to speed with BizTalk Server 2004 for the Visual Studio .NET Developer&lt;/a&gt; (basic)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/CUI/WebCastEventDetails.aspx?EventID=1032262823&amp;amp;EventCategory=3&amp;amp;culture=en-US&amp;amp;CountryCode=US&quot;&gt;Biztalk Server 2004 Architecture&lt;/a&gt;** (basic)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/CUI/WebCastEventDetails.aspx?EventID=1032262826&amp;amp;Culture=en-US&quot;&gt;Biztalk Server 2004 Orchestration for the Visual Studio .NET Developer&lt;/a&gt; (basic)&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  
  <entry>
    <title>BizTalk exams passed!</title>
    <link href="http://richardhallgren.com/biztalk-exams-passed" />
    <updated>2006-09-09T10:44:33+00:00</updated>
    <id>http://richardhallgren.com/biztalk-exams-passed</id>
    <content type="html">&lt;p&gt;Yesterday I passed both the 2004 exam (&lt;a href=&quot;http://www.microsoft.com/learning/exams/74-135.asp&quot;&gt;074-135: Developing E-Business Solutions Using Microsoft BizTalk Server 2004&lt;/a&gt;) and the new 2006 BizTalk exam (070-235: TS: &lt;a href=&quot;http://www.microsoft.com/learning/exams/70-235.asp&quot;&gt;Developing Business Process and Integration Solutions by Using Microsoft® BizTalk® Server 2006&lt;/a&gt;)!&lt;/p&gt;

&lt;h3 id=&quot;webcasts&quot;&gt;Webcasts&lt;/h3&gt;

&lt;p&gt;When I first started studying for the exam I hadn’t really worked with BizTalk. These Webcasts provided an easy introduction to the basics of the products:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/CUI/EventDetail.aspx?EventID=1032247084&amp;amp;Culture=en-US&quot;&gt;Getting up to speed with BizTalk Server for .NET Developer&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/CUI/WebCastEventDetails.aspx?EventID=1032262826&amp;amp;Culture=en-US&quot;&gt;BizTalk Orchestration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://msevents.microsoft.com/CUI/WebCastEventDetails.aspx?EventID=1032262823&amp;amp;EventCategory=3&amp;amp;culture=en-US&amp;amp;CountryCode=US&quot;&gt;Biztalk Server 2004 Architecture&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The Webcasts are help by &lt;a href=&quot;http://blogs.msdn.com/scottwoo/&quot;&gt;Scott Woodgate&lt;/a&gt;. He used to be the product manager for BizTalk and knows it inside out (besides being a skilled presenter).&lt;/p&gt;

&lt;h3 id=&quot;installation&quot;&gt;Installation&lt;/h3&gt;

&lt;p&gt;Next thing I did was to install a Virtual PC with a Windows 2003 server. Then I used &lt;a href=&quot;http://blogs.msdn.com/luke/articles/211384.aspx&quot;&gt;this list&lt;/a&gt;. The list saved me from some major pitfalls while installing BizTalk (especially 2004 is known to be a messy installation)!&lt;/p&gt;

&lt;p&gt;The only problem I ran into during the installation was a collation error on the SQL server (BizTalk Server does not support case-sensitive collations, use &lt;em&gt;Latin1_General_CI_AS&lt;/em&gt;).&lt;/p&gt;

&lt;h3 id=&quot;tutorials&quot;&gt;Tutorials&lt;/h3&gt;

&lt;p&gt;Then I worked my way through &lt;a href=&quot;http://www.microsoft.com/downloads/details.aspx?familyid=9C64562C-3FA7-49BA-885E-82213D00776E&amp;amp;displaylang=en&quot;&gt;these tutorials&lt;/a&gt;. They cover a big part of the product. I can also recommend reading the &lt;a href=&quot;http://book.itzero.com/read/microsoft/0505/Sams.Microsoft.BizTalk.Server.2004.Unleashed.Nov.2004.eBook-LiB_html/&quot;&gt;BizTalk Unleashed 2004&lt;/a&gt; book. Make sure to understand everything in the tutorials as most of it actually will show up on the exam. Make sure to pay extra attention to deployment and the development of business rules! Of course one also has to understand the basics of Orchestration and XML mapping.&lt;/p&gt;

&lt;h3 id=&quot;exams&quot;&gt;Exams&lt;/h3&gt;

&lt;p&gt;To pass the exams you’ll have to &lt;strong&gt;understand the whole architecture&lt;/strong&gt; and when messages are written to the message database (&lt;em&gt;dehydrate&lt;/em&gt; and &lt;em&gt;hydrate&lt;/em&gt;). &lt;strong&gt;Understand pipelines&lt;/strong&gt; - develop your own pipeline and deploy it to really understand this part (remember all the interfaces etc). While developing pipeline use the different &lt;strong&gt;pipeline testing tools&lt;/strong&gt; that are available (pipeline.exe etc). Read about &lt;strong&gt;message patters&lt;/strong&gt; and particularly the &lt;em&gt;convoy pattern&lt;/em&gt; etc. You will need to know most of the &lt;strong&gt;mapping functiods&lt;/strong&gt; and what they are used for. Use and understand the &lt;em&gt;import&lt;/em&gt;, &lt;em&gt;include&lt;/em&gt; and &lt;em&gt;redefine&lt;/em&gt; &lt;strong&gt;functionality in the schema editor&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;One big miss I did while studying was the security part and what &lt;strong&gt;different BizTalk users groups that exists&lt;/strong&gt;. Use &lt;a href=&quot;http://msdn.microsoft.com/library/default.asp?url=/library/en-us/bts06coredocs/html/a01603bd-4105-4691-819d-de43b00b40f3.asp&quot;&gt;this list&lt;/a&gt; and learn the most important ones (both the Windows and the SQL Server Roles). To pass the exam you don’t really have to know that much about the specifics of &lt;em&gt;BAS&lt;/em&gt;, &lt;em&gt;BAM&lt;/em&gt; ands &lt;em&gt;HWS&lt;/em&gt; - you do need to know what the different solutions are used for and what their limits are.&lt;/p&gt;

&lt;p&gt;The new exams are a bit different as they involve setting up a lot of action-lists where one drag and drop actions to create a list of actions for completing a described task. No information about how many actions are required in the finished list etc. However the 2006 is “easier” as it deals a lot with actual development tasks and not so much with security things and details as the old ones (like specific user groups and interfaces etc).&lt;/p&gt;

&lt;p&gt;A few tips if your planing to take the 2006 exams is that you study the new &lt;strong&gt;BTSTask tool&lt;/strong&gt;, developing business rules using the &lt;strong&gt;Business Rule Composer&lt;/strong&gt; tool and BAM (Business Activity Monitoring) and especially &lt;strong&gt;the process of configuring BAM&lt;/strong&gt;.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Resources …</title>
    <link href="http://richardhallgren.com/resources" />
    <updated>2006-08-31T05:59:16+00:00</updated>
    <id>http://richardhallgren.com/resources</id>
    <content type="html">&lt;p&gt;I’ve started reading &lt;a href=&quot;http://www.hanselman.com/blog/ScottHanselmans2006UltimateDeveloperAndPowerUsersToolListForWindows.aspx&quot;&gt;this list&lt;/a&gt;. Jisses! There’s is literally a ton of links to excellent resources here!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Validation&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;I’ll work my way down the list when I have some more time. However I found &lt;a href=&quot;http://www.peterblum.com/VAM/Home.aspx&quot;&gt;this&lt;/a&gt;, seems like it could have saved my a lot if I’d known about earlier. It’s a package with validation controls for ASP.NET for every situation. Looks really good.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Date&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.peterblum.com/DateControls/Home.aspx&quot;&gt;This&lt;/a&gt; seems like another usefull resource. Loads and loads of different date controls. I’ll have to remeber this site the next time I’ll nedd one.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>My first NNUG meeting</title>
    <link href="http://richardhallgren.com/my-first-nnug-meeting" />
    <updated>2006-08-30T05:32:30+00:00</updated>
    <id>http://richardhallgren.com/my-first-nnug-meeting</id>
    <content type="html">&lt;p&gt;I just came back from my first &lt;a href=&quot;http://www.nnug.no/&quot;&gt;NNUG meeting&lt;/a&gt; (.NET user group) ever! The meeting consisted of two presentations (plus some Microsoft info about &lt;a href=&quot;http://www.microsoft.com/events/teched2006/&quot;&gt;Tech Ed&lt;/a&gt; etc), one about the new &lt;a href=&quot;http://wf.netfx3.com/&quot;&gt;Windows Workflow Foundation&lt;/a&gt; and one about the &lt;a href=&quot;http://msdn.microsoft.com/asp.net/downloads/providers/default.aspx?pull=/library/en-us/dnaspnet/html/asp02182004.asp&quot;&gt;Provider model in .NET 2.0&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Neither of them were really breathtaking. Besides the fact that deleting the namespace in the web.coning in ASP.NET 2.0 actually enables the XML config code hinting!&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;configuration
     xmlns&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;http://schemas.microsoft.com/.NetConfiguration/v2.0&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Becomes&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;div&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;configuration&amp;lt;/span&amp;gt;&amp;lt;span style=&quot;color: #000000; &quot;&amp;gt;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Apparently it’s a bug in Visual Studio 2005! It’s always irritated me as I’ve seen it working in different presentations etc. At leats it’s an easy fix.&lt;/p&gt;

&lt;p&gt;The new &lt;a href=&quot;http://wf.netfx3.com/&quot;&gt;Windows Workflow Foundation&lt;/a&gt; is basically Orchestration from Biztalk that Microsoft put into a isolated component. This makes it possible to call orchestrations like processes (called workflows) from all .NET code.&lt;/p&gt;

&lt;p&gt;I also got to talk to a guy with heavy &lt;a href=&quot;http://www.microsoft.com/biztalk/&quot;&gt;Biztalk 2004&lt;/a&gt; experience. It’s interesting as my new job will involve some major Biztalk development. Apparently Biztalk has some issues consering the XML mapper and the XSLT it generates (I’ve heard that before). Sounds like I got some XSLT writing a head of me …&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>The Regulator!</title>
    <link href="http://richardhallgren.com/the-regulator" />
    <updated>2006-08-29T14:26:30+00:00</updated>
    <id>http://richardhallgren.com/the-regulator</id>
    <content type="html">&lt;p&gt;I had to write a few regular expression for a project today. As always I couldn’t remember the syntax. After a bit of searching I found this &lt;a href=&quot;http://tools.osherove.com/Default.aspx?tabid=185&quot;&gt;excellent free tool&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;It saved me a lot of time. It even generates .NET code.&lt;/p&gt;
</content>
  </entry>
  
  <entry>
    <title>Code formater Plugin for Windows Live Writer</title>
    <link href="http://richardhallgren.com/code-formater-plugin-for-windows-live-writer" />
    <updated>2006-08-26T13:11:57+00:00</updated>
    <id>http://richardhallgren.com/code-formater-plugin-for-windows-live-writer</id>
    <content type="html">&lt;p&gt;I use &lt;a href=&quot;http://windowslivewriter.spaces.live.com/&quot;&gt;Windows Live Writer&lt;/a&gt; for writing and posting to my blog. However I’ve always had problems with code formating. Until now!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://http://www.codeplex.com/Wiki/View.aspx?ProjectName=WlwCodeFormatter&quot;&gt;This little plug in&lt;/a&gt; to Live Writer does the job!&lt;/p&gt;

&lt;p&gt;Thanks to Steve Dunn whos excellt blog you’ll find &lt;a href=&quot;http://stevedunns.blogspot.com/&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  

</feed>
