<!doctype html>
<html lang="en-US">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>
    Gobbledygooks
    
      &middot; Tips and tricks on BizTalk generated SOAP Web Services
    
  </title>

  <!-- Sitemap -->
  <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="riha feed" href="http://richardhallgren.com/feed">
</head>

  <body class="bg-bg-yellow flex justify-center font-mono py-4 px-4 post-page">
    <div class="max-w-[750px]">
      <div class="">
        <div class="flex justify-center">
          <a href="/">
            <img
              src="/assets/riha-profile-image.jpeg"
              class="rounded-full w-32 border-profile-border shadow profile-image"
            >
          </a>
        </div>
      </div>
      <div class="my-12"></div>

      <h1>Tips and tricks on BizTalk generated SOAP Web Services</h1>
      <div class="my-1"></div>
      <div class="text-center text-text-subtle text-sm">Jun 16, 2009</div>
      <div class=" my-12">
        <p>Traditional SOAP Web Services might feel kind of old as more and more people move over to WCF. But a lot of integration projects still relay heavily on old fashion SOAP Web Services.</p>

<p>Using BizTalk generated Web Services however has a few issues and one needs to add a few extra steps and procedures to make them effective and easy to work with. This post aims to collect, link and discuss all those issues and solutions.</p>

<h3 id="1-building-and-deploying">1. Building and deploying</h3>

<p>BizTalk Server includes the “BizTalk Web Services Publishing Wizard” tool that integrates with Visual Studio. This is basically a tool to generate a <a href="http://en.wikipedia.org/wiki/Domain-specific_programming_language">DSL</a> based script for generating web services.</p>

<p><a href="../assets/2009/06/image.png"><img src="../assets/2009/06/image-thumb.png" alt="image" /></a></p>

<p>The wizard collects information about what schema or a orchestration to expose, namespaces, names of service and method, where on IIS to publish the service etc, etc.</p>

<p>The output of the tool is then a xml file (a “WebServiceDescription” file) that has all the collected values in it.</p>

<p><a href="../assets/2009/06/image1.png"><img src="../assets/2009/06/image-thumb1.png" alt="image" /></a></p>

<p>As a final step Visual Studio uses the newly created description file as input to a class called WebServiceBuilder in the .NET Framework. It is this class that is responsible for interpreting the description, configure and generate the service.</p>

<p>A common procedure is to use the wizard and click thru it and input values for <strong><em>every</em></strong> single deployment. This is of course slow, error prone and stupid.</p>

<p>What is much better is to take a copy of the generated “WebServiceDescription” file, save it to your source control system and then programmatically pass the file to the WebServiceBuilder class as part of your deployment process. Possible changes to the details of the service can then be done directly in the description file.</p>

<p>I have seen this approach save lots of time and problems related to deployment.</p>

<ul>
  <li>
    <p>Paul Petrov has a great post on how to call the “WebServiceBuilder” class and pass the description file using C#.      <br />
<a href="http://geekswithblogs.net/paulp/archive/2006/05/22/79282.aspx">http://geekswithblogs.net/paulp/archive/2006/05/22/79282.aspx</a></p>
  </li>
  <li>
    <p>Michael Stephenson has a good post on how to used the “WebServiceBuilder” class via MSBuild.      <br />
<a href="http://geekswithblogs.net/michaelstephenson/archive/2006/09/16/91369.aspx">http://geekswithblogs.net/michaelstephenson/archive/2006/09/16/91369.aspx</a></p>
  </li>
</ul>

<h3 id="2-fixing-namespace">2. Fixing namespace</h3>

<p>Another annoying problem (I’d would actually go so far as calling it a bug) is the problem with the <em>bodyTypeAssemblyQualifiedName</em> value in the generated Web Service class.</p>

<p>This causes BizTalk to skip looking up the actual message type for the incoming message. As no message type exists for the message is in BizTalk mapping and routing on message types etc will fail. It is a know problem and there are solutions to it. I would also recommend take the extra time need to make this small “post process step” be part of your deployment process (see how <a href="http://www.richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja/">here</a>).</p>

<ul>
  <li>
    <p>Saravana Kumar discusses the problem and solutions in this great post.      <br />
<a href="http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx">http://www.digitaldeposit.net/saravana/post/2007/08/17/SOAP-Adapter-and-BizTalk-Web-Publishing-Wizard-things-you-need-to-know.aspx</a></p>
  </li>
  <li>
    <p>Richard Seroter has a short and well written post published.      <br />
[http://blogs.msdn.com/richardbpi/archive/2006/09/15/Fixing-_2200<em>SOAP-_2F00</em>-Envelope-Schema_2200<em>-Error-In-BizTalk.aspx](http://blogs.msdn.com/richardbpi/archive/2006/09/15/Fixing-_2200_SOAP-_2F00</em>-Envelope-Schema_2200_-Error-In-BizTalk.aspx)</p>
  </li>
  <li>
    <p>I have a post on how to solve the issue using MSBuild.      <br />
<a href="http://www.richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja/">http://www.richardhallgren.com/handle-the-bodytypeassemblyqualifiedname-soap-adapter-bug-in-msbuild-as-a-regex-ninja/</a></p>
  </li>
</ul>

<h3 id="3-pre-compiling">3. Pre-compiling</h3>

<p>By default the “WebServiceBuilder” class generates a web service <em>without</em> pre-compiling it. Usually this is not a problem. <em>But</em> in some cases were one really on the web service being online and give a quick response-message the performance problems in this approach can be a huge problem.</p>

<p>When generating the web service without pre-compiling it IIS has to compile the service and then keep the compiled service in memory. That means that when IIS releases the service from memory there is a latency before IIS re-compiled the service, loaded it into memory and executed it. This is a known problem and I have seen this “slow first hit” issue been a frequent question the different forums.</p>

<p>The solution is to use the aspnet_compiler.exe tool and pre-compile the service and the use those pre-compiled dlls as the service. IIS then never has to recompile it and will serve initial hits much faster.</p>

<p>Here is an example of how we defined a target to do this as part of our deployment process using MSBuild.</p>

<ol>
  <li>
    <p>Pre-compile the service into a new folder</p>
  </li>
  <li>
    <p>Clean out the “old” not compile service folder.</p>
  </li>
  <li>
    <p>Copy the pre-complied service into the service folder</p>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Target Name="CompileWeb"&gt;
    &lt;Message Text="Uses aspnet compiler to compile the service into a new folder. Then copies the compiled content back into its original place" /&gt;
    &lt;AspNetCompiler
        PhysicalPath="$(WebSiteServicePath)InitiateProjectService\"
        VirtualPath="/WebServiceName"
        TargetPath="$(WebSiteServicePath)$(WebServiceName)Compiled\"
        Force="true" /&gt;

    &lt;Folder.CleanFolder Path="$(WebSiteServicePath)$(WebServiceName)\"/&gt;

    &lt;Folder.CopyFolder
                Source="$(WebSiteServicePath)$(WebServiceName)Compiled\"
                Destination="$(WebSiteServicePath)$(WebServiceName)\" /&gt;

&lt;/Target&gt;
</code></pre></div></div>

<ul>
  <li>Paul Petrov has two different articles here describing the process and also a different way that above on how to include the pre-compilation in you build process.</li>
</ul>

<p><a href="http://geekswithblogs.net/paulp/archive/2006/03/30/73900.aspx">http://geekswithblogs.net/paulp/archive/2006/03/30/73900.aspx</a>, <a href="http://geekswithblogs.net/paulp/archive/2006/04/19/75633.aspx">http://geekswithblogs.net/paulp/archive/2006/04/19/75633.aspx</a></p>


      </div>
      <div class="mt-6" />
<div class="flex items-baseline justify-center gap-4">
  <a href="https://www.linkedin.com/in/richardhallgren/">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-linkedin"
    >
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
      <rect width="4" height="12" x="2" y="9" />
      <circle cx="4" cy="4" r="2" />
    </svg>
  </a>
  <a href="mailto:richard@revision.app">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-mail"
    >
      <rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
    </svg>
  </a>
</div>

    </div>
  </body>
</html>
