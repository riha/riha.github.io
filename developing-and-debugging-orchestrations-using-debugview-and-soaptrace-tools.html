<!doctype html>
<html lang="en-US">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>
    Gobbledygooks
    
      &middot; Developing and debugging orchestrations using DebugView and SOAPTrace tools
    
  </title>

  <!-- Sitemap -->
  <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="riha feed" href="http://richardhallgren.com/feed">
</head>

  <body class="bg-bg-yellow flex justify-center font-mono py-4 px-4 post-page">
    <div class="max-w-[750px]">
      <div class="">
        <div class="flex justify-center">
          <a href="/">
            <img
              src="/assets/riha-profile-image.jpeg"
              class="rounded-full w-32 border-profile-border shadow profile-image"
            >
          </a>
        </div>
      </div>
      <div class="my-12"></div>

      <h1>Developing and debugging orchestrations using DebugView and SOAPTrace tools</h1>
      <div class="my-1"></div>
      <div class="text-center text-text-subtle text-sm">Jul 31, 2007</div>
      <div class=" my-12">
        <p>The main problem I have with developing BizTalk orchestrations is the fact that I’m so blind when it comes to follow the runtime processing. Using the <a href="http://msdn2.microsoft.com/EN-US/library/aa577988.aspx">debugger</a> that is part of the HAT tool is slow and clumsy which IMHO makes the tool almost useless in everyday development. But there is hope!</p>

<h2 id="debugview">DebugView</h2>

<p><a href="http://www.microsoft.com/technet/sysinternals/default.mspx">Sysinternals</a> (<em>Windows Sysinternal</em> now - Microsoft bought them last year) <a href="http://www.microsoft.com/technet/sysinternals/Miscellaneous/DebugView.mspx">DebugView</a> is a wonderful little tool and is especially useful when it comes to figure out what’s actually going on inside an orchestration. Basically the tool listens to system wide debug output. From an orchestration it’s possible to write debug information using the .NET <em><a href="http://msdn2.microsoft.com/en-us/library/system.diagnostics.aspx">System.Diagnostics</a></em> namespace and the <a href="http://msdn2.microsoft.com/en-us/library/system.diagnostics.debug.aspx"><em>Debug</em></a> or <em><a href="http://msdn2.microsoft.com/en-us/library/system.diagnostics.trace.aspx">Trace</a></em> class.</p>

<h3 id="decide-on-how-to-filter">Decide on how to filter</h3>

<p>There are a couple of handy little tricks that makes DebugView a even better in BizTalk development. First one should try and have something in the debug messages that makes it possible to filter and distinct one’s own (as DebugView listens system wide debug output all running applications debug info will show up). Our team decided on “<a href="http://www.sogeti.com">Sogeti</a>” (our company name) for all our development and to have a method in our BaseLibrary component that outputs something like the below (the BaseLibrary is a small little .NET component with a couple of very useful classes we use company wide in our BizTalk related development).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div&gt;&lt;span style="color: #000000; "&gt;System.Diagnostics.Debug.WrtieLine(&lt;/span&gt;&lt;span style="color: #000000; "&gt;"&lt;/span&gt;&lt;span style="color: #000000; "&gt;Sogeti, your debug/trace message here&lt;/span&gt;&lt;span style="color: #000000; "&gt;"&lt;/span&gt;&lt;span style="color: #000000; "&gt;)&lt;/span&gt;&lt;/div&gt;
</code></pre></div></div>

<p>This make is possible to have a filter in DebugView and to for example have it look something like this.</p>

<p><a href="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview133.jpg"><img src="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview1-thumb13.jpg" alt="" /></a></p>

<h3 id="trace-full-context-of-messages">Trace full context of messages</h3>

<p>Another little useful trick is to trace the full context of messages. This is done be storing the message in a <em>XmlDocument</em> typed variable and get the <em>OuterXml</em> property of that variable. The below code is and example of this.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div&gt;&lt;span style="color: #000000; "&gt;tempXml &lt;/span&gt;&lt;span style="color: #000000; "&gt;=&lt;/span&gt;&lt;span style="color: #000000; "&gt; msgFindPartyRequest.parameters;
System.Diagnostics.Trace.Write(System.String.Concat(&lt;/span&gt;&lt;span style="color: #000000; "&gt;"&lt;/span&gt;&lt;span style="color: #000000; "&gt;Sogeti, msgFindPartyRequest: &lt;/span&gt;&lt;span style="color: #000000; "&gt;"&lt;/span&gt;&lt;span style="color: #000000; "&gt;, tempXml.OuterXml));&lt;/span&gt;&lt;/div&gt;
</code></pre></div></div>

<p>Example of a full message trace.</p>

<p><a href="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview253.jpg"><img src="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1debugview2-thumb13.jpg" alt="" /></a></p>

<h3 id="to-trace-or-debug---thats-the-question">To Trace or Debug - that’s the question</h3>

<p>As stated earlier both <em>System.Diagnostics.Debug</em> and <em>System.Diagnostics.Trace</em> has methods (<em>Write</em>, <em>WriteLine</em> and so on) for outputting debug information. However there is only one that stays in your compiled code when switching from Development to Deployment compilation mode (guess which one ;)). So make sure you choose the right class for the right information. I like to have some critical messages left using Trace and be able to trace these even on the test and production server.</p>

<h3 id="debugview-on-a-remote-desktop">DebugView on a remote desktop</h3>

<p>When running DebugView on an other server (say a test or a production server) using <a href="http://www.microsoft.com/windowsxp/downloads/tools/rdclientdl.mspx">Remote Desktop</a> I’ve found that ones has to use the <a href="http://firechewy.com/blog/archive/2005/10/18/926.aspx">console user</a> on the server. This kind of makes sense as if we’re connection “normally” we’re creating a virtual session and that’s not were the debug information is written to.</p>

<h2 id="microsoft-soap-toolkit-30">Microsoft SOAP Toolkit 3.0</h2>

<p>This is a totally <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=C943C0DD-CEEC-4088-9753-86F052EC8450&amp;displaylang=en">other tool</a> than DebugView but I thought it fit here any way. It’s a handy tool when working with SOAP based messages. Without it’s very hard to actually figure out how the raw request and response message look and why your orchestration web service is acting the way it does.</p>

<p><a href="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace123.jpg"><img src="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace1-thumb3.jpg" alt="" /></a></p>

<p>The trace tool is placed as a <a href="http://en.wikipedia.org/wiki/Reverse_proxy">reverse proxy</a> between BizTalk and the Internet. It’s setup by telling the tracing tool which localhost port to listen at (for example 9091 as in the example below) then we’ll redirect to that port by changing the setting in the BizTalk send port.</p>

<p><a href="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soapsendport122.jpg"><img src="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soapsendport1-thumb2.jpg" alt="" /></a></p>

<p>Finally we’ll set up the trace tool to listen to port 9091 and redirect all traffic to our web service URL at port 80 in this case. So basically the trace tool will catch all the traffic hitting the 9091 port and forward it.</p>

<p><a href="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace222.jpg"><img src="../assets/2007/07/windowslivewriterdevelopinganddebugingorchestrationsusing-dfd1soaptrace2-thumb2.jpg" alt="" /></a></p>

<p>That’s it! This is probably basic stuff for most of you but hopefully it’s useful for someone!</p>

<p>I’ve also noticed that the SOAP Toolkit is deprecated by Microsoft and I’d like to hear if anyone used something else (like <a href="http://www.fiddlertool.com/fiddler/">Fiddler</a> example) for tracing SOAP messages. I’d also love some other tips, tools and methods you use for debugging BizTalk orchestrations.</p>

      </div>
      <div class="mt-6" />
<div class="flex items-baseline justify-center gap-4">
  <a href="https://www.linkedin.com/in/richardhallgren/">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-linkedin"
    >
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
      <rect width="4" height="12" x="2" y="9" />
      <circle cx="4" cy="4" r="2" />
    </svg>
  </a>
  <a href="mailto:richard@revision.app">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-mail"
    >
      <rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
    </svg>
  </a>
</div>

    </div>
  </body>
</html>
