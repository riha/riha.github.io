<!doctype html>
<html lang="en-US">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>
    Gobbledygooks
    
      &middot; Build and generate environment specific binding files for BizTalk Server using Team Foundation Build Services
    
  </title>

  <!-- Sitemap -->
  <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="riha feed" href="http://richardhallgren.com/feed">
</head>

  <body class="bg-bg-yellow flex justify-center font-mono py-4 px-4 post-page">
    <div class="max-w-[750px]">
      <div class="">
        <div class="flex justify-center">
          <a href="/">
            <img
              src="/assets/riha-profile-image.jpeg"
              class="rounded-full w-32 border-profile-border shadow profile-image"
            >
          </a>
        </div>
      </div>
      <div class="my-12"></div>

      <h1>Build and generate environment specific binding files for BizTalk Server using Team Foundation Build Services</h1>
      <div class="my-1"></div>
      <div class="text-center text-text-subtle text-sm">Mar 31, 2015</div>
      <div class=" my-12">
        <p>As most know a BizTalk Solution has two major parts – its resources in form of dlls, and its configuration in form of bindings. 
In an <a href="http://richardhallgren.com/build-and-generate-msi-for-biztalk-server-using-team-foundation-build-services/">previous post</a> 
I described how to build and pack <em>resources</em> into an MSI using Team Foundation Server (TFS) Build Services. Managing the configuration in a similar way is equally important.
So let’s see how we can build environment specific binding files using TFS Build Services and some config transformations syntax goodness!</p>

<p><img src="https://www.dropbox.com/s/3c4hz5v643v1p4z/5.png?raw=1" alt="Workflow" /></p>

<h2 id="creating-a-simple-binding-example-for-development-and-test-environment">Creating a simple binding example for development and test environment</h2>

<p>Let’s start with a simple example of a simple binding with a receive port, receive location and a 
send port for two different environments - one called “Test” and one “Production”.</p>

<table class="post" border="0" cellspacing="0" cellpadding="0">
    <tr>
        <th>Port type</th>
        <th>Name</th>
        <th>Destination path in Test</th>
        <th>Destination path in Production</th>
    </tr>
    <tr>
        <td>Receive Port</td>
        <td>BtsSample_ReceivePort_A</td>
        <td>N/A</td>
        <td>N/A</td>
    </tr>
        <tr>
        <td>Receive Location</td>
        <td>BtsSample_ReceivePort_A_Location (File)</td>
        <td>C:\Temp\In\*.xml</td>
        <td>C:\Temp\In\*.xml</td>
    </tr>
        <tr>
        <td>Send Port</td>
        <td>BtsSample_SendPort_A (File)</td>
        <td>C:\Temp\<strong>TEST</strong>\Out\%MessageID%.xml</td>
        <td>C:\Temp\<strong>PROD</strong>\Out\%MessageID%.xml</td>
    </tr>
</table>
<p>As one can see there’s a small difference between the send ports destinations paths in Test and Production.</p>

<h2 id="exporting-a-binding-template">Exporting a binding template</h2>
<p>Next we’ll create a binding template. The binding template will hold all information that is shared between the different environments. 
This is achieved this by an ordinary export of the application binding from the BizTalk Administration Console - as you’ve probably done many times before.
<script src="https://gist.github.com/riha/72a597136892e428cf92.js"></script></p>

<h2 id="creating-environment-specific-bindings-using-webconfig-transformation-syntax">Creating environment specific bindings using web.config Transformation Syntax</h2>
<p>The <a href="https://msdn.microsoft.com/en-us/library/dd465326.aspx">Web.config Transformation Syntax</a> is feature that showed up in Visual Studio 2010 and 
is often used to transform app.config and web.config files between different versions and environments – but it will of course work on any type 
of configuration file. Including BizTalk binding files!</p>

<p>So for each environment we’ll then create an environment specific config file that only contains the values that differs between the template and 
the values for that environment. We use the Web.config Transformation Syntax to match the nodes and values that we like to update in the template.</p>

<p>Below is the Test environment specific file matching the send port and replacing the value with the value specific for Test.
<script src="https://gist.github.com/riha/9f9fb0d2ca57502bd6f5.js"></script></p>

<p>The Production specific file also matches the send port but with a different value for the Destination path.
<script src="https://gist.github.com/riha/bf86d3de83f48b910809.js"></script></p>

<h2 id="using-msbuild-to-execute-the-transformation">Using MSBuild to execute the transformation</h2>
<p>As part of the Visual Studio installation an MSBuild target is installed for executing the transform. 
The target is installed into the standard <a href="https://msdn.microsoft.com/en-us/library/ms164309.aspx">MSBuild Extensions Path</a> 
which usally mean something lilke <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v10.0\Web\Microsoft.Web.Publishing.targets</code> 
depending a Visual Studio version etc.</p>

<p>Finally we’ll add a small .proj file to pass some parameters to the MSBuild process. We need to tell the process what file to use as 
template and what different environment specific files we like to use.
<script src="https://gist.github.com/riha/79c4dab8854b8db6c692.js"></script></p>

<p>Next we can kick of MSBuild and point it to the cretated proj file. <code class="language-plaintext highlighter-rouge">C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild build.proj</code>.</p>

<p>Voila! MSBuild has performed our transformation and created two complete environment specific binding file by combining the template with the specific environment files - one of test and one for production.</p>

<p><img src="https://www.dropbox.com/s/i0lt7i3lu54uih5/2.png?raw=1" alt="Two specific binding files" /></p>

<h2 id="generating-the-file-using-tfs-build-services">Generating the file using TFS Build Services</h2>
<p>Start by setting up a TFS build definition as described in previous post on 
<a href="http://richardhallgren.com/build-and-generate-msi-for-biztalk-server-using-team-foundation-build-services/">Generating BizTalk MSI using TFS Build Services</a>.</p>

<p>We then need to add the $(DestinationPath) property to our Destination path to make sure the outputted binding files are written to the same 
path as the rest of the resources.</p>

<script src="https://gist.github.com/riha/5213f920b22912fd1476.js"></script>

<p>Once we have our build template all that’s needed is to add the build.proj file to the files to compile as shown below.</p>

<p><img src="https://www.dropbox.com/s/o71ofgvt1f5ngay/3.png?raw=1" alt="Adding a build file" /></p>

<p>When finally running the build our two complete binding files are written to the deployment area and ready for installation!</p>

<p><img src="https://www.dropbox.com/s/szlteu8h963o1z7/4.png?raw=1" alt="Binding files in the deployment area" /></p>

      </div>
      <div class="mt-6" />
<div class="flex items-baseline justify-center gap-4">
  <a href="https://www.linkedin.com/in/richardhallgren/">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-linkedin"
    >
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
      <rect width="4" height="12" x="2" y="9" />
      <circle cx="4" cy="4" r="2" />
    </svg>
  </a>
  <a href="mailto:richard@revision.app">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-mail"
    >
      <rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
    </svg>
  </a>
</div>

    </div>
  </body>
</html>
