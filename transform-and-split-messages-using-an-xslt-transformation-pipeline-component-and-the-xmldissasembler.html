<!doctype html>
<html lang="en-US">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>
    Gobbledygooks
    
      &middot; Transform and split messages using an Xslt transformation pipeline component and the XmlDissasembler
    
  </title>

  <!-- Sitemap -->
  <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="riha feed" href="http://richardhallgren.com/feed">
</head>

  <body class="bg-bg-yellow max-w-[650px]  font-mono  post-page px-4 py-4 " style="margin: 0 auto;" >
    <div class=" ">
      <div class="">
        <div class="flex justify-center">
          <a href="/">
            <img
              src="/assets/riha-profile-image.jpeg"
              class="rounded-full w-32 border-profile-border shadow profile-image"
            >
          </a>
        </div>
      </div>
      <div class="my-12"></div>

      <h1>Transform and split messages using an Xslt transformation pipeline component and the XmlDissasembler</h1>
      <div class="my-1"></div>
      <div class="text-center text-text-subtle text-sm">Aug 02, 2007</div>
      
        <p>There was a question on the <a href="http://www.microsoft.com/technet/community/newsgroups/dgbrowser/en-us/default.mspx?dg=microsoft.public.biztalk.general">Microsoft newsgroup</a> the other day where someone had to split a message into parts. But some of the information that was supposed to go in to the different parts were part of the envelope. I thought I’d give my solution to the problem a try - here it is.</p>

<p>Say for example that we receive the following message.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ns0:EmployeeSalesReport &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;ReportID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="R100"&lt;/span&gt;&lt;span style="color: #FF0000; "&gt; EmployeeID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="0012345"&lt;/span&gt;&lt;span style="color: #FF0000; "&gt; xmlns:ns0&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="http://Example.TransformAndSplit.EmployeeSalesReport"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sales&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ns1:Sale &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns:ns1&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="http://Example.TransformAndSplit.Sale"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;100&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;10&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ns1:Sale&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ns1:Sale &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns:ns1&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="http://Example.TransformAndSplit.Sale"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;200&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;20&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ns1:Sale&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sales&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ns0:EmployeeSalesReport&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;/div&gt;
</code></pre></div></div>

<p>In the above message we have different sales information from one employee <strong>but all the global employee and report information (the <em>ReportID</em> and <em>EmployeeID</em> attributes) exists in the root node</strong> (what we’ll call the <em>envelope</em> of the message).</p>

<p>What we like to achieve is to split this envelope message into it’s different sale item so we get separate message looking something like the below where each item contains the global information from the envelope.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sale &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="http://Example.TransformAndSplit.Sale"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;200&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;20&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;0012345&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ReportID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;R100&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ReportID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sale&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;/div&gt;
</code></pre></div></div>

<p>There might be different needs for doing this in a pipeline but much of it comes down to choice of architecture style in your BizTalk solution. Personally I’d refuse to introduce another orchestration for splitting a message like this. I don’t believe that’s what orchestrations are for (they should deal with possible logic and workflow in my world). I’m sure other people feel different - feel free to use the comments.</p>

<h2 id="step-1---transforming-the-envelope-message-using-xslt">Step 1 - Transforming the envelope message using XSLT</h2>

<p>The first thing we’ll need to do is to transform the envelope message so that the information from the root node (the <em>ReportID</em> and the <em>EmployeeID</em>) get into every single _Sale-_node. There are a couple of ways of achieving this but I’ll use the <a href="http://msdn2.microsoft.com/en-us/library/aa561389.aspx">XSLT-transformation pipeline component</a> that ships with the BizTalk 2006 SDK.</p>

<p>All this component does is to let you point out a <a href="http://en.wikipedia.org/wiki/XSLT">XSLT stylesheet</a> you like to use to transform your message.</p>

<p><a href="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6xsltpipeline29.jpg"><img src="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6xsltpipeline-thumb9.jpg" alt="" /></a></p>

<p>The stylesheet I’ve used is part of the solution that you can download here. I will not show the stylesheet full script here but rather the result after the message travel through the component.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div&gt;&lt;span style="color: #0000FF; "&gt;&lt;?&lt;/span&gt;&lt;span style="color: #FF00FF; "&gt;xml version="1.0" encoding="utf-8"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;?&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeSalesReport &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;EmployeeID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="0012345"&lt;/span&gt;&lt;span style="color: #FF0000; "&gt; ReportID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="R100"&lt;/span&gt;&lt;span style="color: #FF0000; "&gt; xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="http://Example.TransformAndSplit.EmployeeSalesReport"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sales &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sale &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="http://Example.TransformAndSplit.Sale"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;100&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;10&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;0012345&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ReportID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;R100&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ReportID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sale&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sale &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;="http://Example.TransformAndSplit.Sale"&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;200&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ItemID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;20&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Amount&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;0012345&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
            &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;&lt;/span&gt;&lt;span style="color: #800000; "&gt;ReportID &lt;/span&gt;&lt;span style="color: #FF0000; "&gt;xmlns&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;=""&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;R100&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;ReportID&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
        &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sale&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
    &lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;Sales&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;span style="color: #000000; "&gt;
&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&lt;/&lt;/span&gt;&lt;span style="color: #800000; "&gt;EmployeeSalesReport&lt;/span&gt;&lt;span style="color: #0000FF; "&gt;&gt;&lt;/span&gt;&lt;/div&gt;
</code></pre></div></div>

<p>Ok, nice. Now we have all the information we like in each of the <em>Sale</em>-nodes! All we have to do now is to split the message!</p>

<h2 id="step-2---splitting-the-message">Step 2 - Splitting the message</h2>

<p>We’ll use the standard <a href="http://msdn2.microsoft.com/en-us/library/ms964545.aspx"><em>XmlDisassembler</em></a> component for splitting the message. All we have to do is to make sure we done the following.</p>

<ol>
  <li>
    <p>Set the schema envelope property to “<strong>true”</strong> in the schema editor.</p>
  </li>
  <li>
    <p>Set the <em>Body Xpath</em> property on the _EmployeeSalesReport-_node to point to the _Sale-_node.</p>
  </li>
  <li>
    <p>Configure the <em>Document Schemas _and</em> Envelope Schemas (<em>same properties are called _DocumentSpecNames</em> and <em>EnvelopeSpecNames</em> if your doing the configuration after deployment in the administration console_)_ properties of the <em>XmlDisassember</em> component to match the names of your schemas.</p>
  </li>
</ol>

<p>This is what the envelope schema looks like in this example.</p>

<p><a href="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6envelopeschema59.jpg"><img src="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6envelopeschema-thumb19.jpg" alt="" /></a></p>

<p>This is what the <em>XmlDisassembler</em> configuration looks like.</p>

<p><a href="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6pipelineconfig29.jpg"><img src="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6pipelineconfig-thumb9.jpg" alt="" /></a></p>

<p>There, we’re done! Now we can drop a test file containing two <em>Sale</em>-nodes and all the report/employee information on the top and have the two following separate files as a result when using a file send port.</p>

<p><a href="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6out29.jpg"><img src="../assets/2007/08/windowslivewritertransformandsplitmessagesusinganxslttrab-f7f6out-thumb9.jpg" alt="" /></a></p>

<h2 id="setting-up-the-test-solution">Setting up the test solution</h2>

<ol>
  <li>
    <p><a href="http://www.richardhallgren.com/blogfiles/Example.TransformAndSplit.zip">Download</a> a zipped version of the solution.</p>
  </li>
  <li>
    <p>You’ll have to unzip the project to <em>C:\Example.TransformAndSplit</em>. If that isn’t possible you’ll have to change the path to the XSLT stylesheet in the <em>XsltComponent</em> in the pipeline as this is a fixed path.</p>
  </li>
  <li>
    <p>When you build the <em>XsltComponent</em> the <em>Output path</em> is set to the <em>Pipeline Components</em> folder. This assumes that BizTalk is installed at _C:\Program Files\Microsoft BizTalk Server 2006_. If that isn’t the case make sure to change the output path of the component.</p>
  </li>
  <li>
    <p>If you’d like to run the pipeline component in debug I’ve set this up using the <a href="http://msdn.microsoft.com/library/en-us/sdk/htm/ebiz_sdk_utils_pipeline_ackm.asp?frame=true">pipeline.exe tool.</a> There are however some paths in the debug setting of the <em>XsltComponent</em> project also that assumes that your BizTalk solutions is installed at <em>C:\Program Files\Microsoft BizTalk Server 2006. _If this isn’t the case you’ll have to change some values in the _Command lines arguments</em> property, but that only if you like to run debug.</p>
  </li>
  <li>
    <p>Build and deploy.</p>
  </li>
  <li>
    <p>Set up a receive port and location using the <em>TransformAndSplitSales</em> pipeline.</p>
  </li>
  <li>
    <p>Set up a send port with for example a filter on the name of the <em>Receiveport</em> you’ve just set up.</p>
  </li>
  <li>
    <p>Drop the example message that’s part of the solution!</p>
  </li>
</ol>

<h2 id="final-thoughts">Final thoughts</h2>

<p>This example didn’t really take much more than an hour to put together. I do however realize that this is a simplified incoming message and that in the case of a more complex message we’d get a messy XSLT stylesheet to maintain. It’s also important to remember that using this method with XSLT transformation means that we will load the entire incoming Xml document into memory, so when we’re dealing with bigger Xml documents we’ll have manipulate the incoming message using other techniques.</p>

<p>Hope this is useful for someone!</p>

      
      <div class="mt-6" />
<div class="flex items-baseline justify-center gap-4">
  <a href="https://www.linkedin.com/in/richardhallgren/">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-linkedin"
    >
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
      <rect width="4" height="12" x="2" y="9" />
      <circle cx="4" cy="4" r="2" />
    </svg>
  </a>
  <a href="mailto:richard@revision.app">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-mail"
    >
      <rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
    </svg>
  </a>
</div>

    </div>
  </body>
</html>
