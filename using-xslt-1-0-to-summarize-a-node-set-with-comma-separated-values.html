<!doctype html>
<html lang="en-US">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>
    Gobbledygooks
    
      &middot; Using XSLT 1.0 to summarize a node-set with comma separated values
    
  </title>

  <!-- Sitemap -->
  <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="riha feed" href="http://richardhallgren.com/feed">
</head>

  <body class="bg-bg-yellow max-w-[650px]  font-mono  post-page px-4 py-4 " style="margin: 0 auto;" >
    <div class=" ">
      <div class="">
        <div class="flex justify-center">
          <a href="/">
            <img
              src="/assets/riha-profile-image.jpeg"
              class="rounded-full w-32 border-profile-border shadow profile-image"
            >
          </a>
        </div>
      </div>
      <div class="my-12"></div>

      <h1>Using XSLT 1.0 to summarize a node-set with comma separated values</h1>
      <div class="my-1"></div>
      <div class="text-center text-text-subtle text-sm">Feb 26, 2010</div>
      
        <p>Pure XSLT is very powerful but it definitely has its weaknesses (I’ve written about how to extend XSLT using mapping and BizTalk previously <a href="http://www.richardhallgren.com/how-the-extend-a-custom-xslt-in-biztalk-using-exslt-and-the-mvpxml-project/">here</a>) … One of those are handling numbers that uses a different decimal-separator than a point (“.”).</p>

<p>Take for example the XML below</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Prices&gt;
  &lt;Price&gt;10,1&lt;/Price&gt;
  &lt;Price&gt;10,2&lt;/Price&gt;
  &lt;Price&gt;10,3&lt;/Price&gt;
&lt;/Prices&gt;
</code></pre></div></div>

<p>Just using the <a href="http://www.zvon.org/xxl/XSLTreference/Output/function_sum.html">XSLT sum-function</a> on these values will give us a “NaN” values. To solve it we’ll have to use recursion and something like in the sample below.</p>

<p>The sample will select the node-set to summarize and send it to the “SummarizePrice” template. It will then add the value for the first Price tag of the by transforming the comma to a point. It will then check if it’s the last value and if not use recursion to call into itself again with the next value. It will  keep adding to the total amount until it reaches the last value of the node set.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;xsl:template match="Prices"&gt;
  &lt;xsl:call-template name="SummurizePrice"&gt;
    &lt;xsl:with-param name="nodes" select="Price" /&gt;
  &lt;/xsl:call-template&gt;
&lt;/xsl:template&gt;

&lt;xsl:template name="SummurizePrice"&gt;
  &lt;xsl:param name="index" select="1" /&gt;
  &lt;xsl:param name="nodes" /&gt;
  &lt;xsl:param name="totalPrice" select="0" /&gt;

  &lt;xsl:variable name="currentPrice" select="translate($nodes[$index], ',', '.')"/&gt;

  &lt;xsl:choose&gt;
    &lt;xsl:when test="$index=count($nodes)"&gt;
      &lt;xsl:value-of select="$totalPrice + $currentPrice"/&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
      &lt;xsl:call-template name="SummurizePrice"&gt;
        &lt;xsl:with-param name="index" select="$index + 1" /&gt;
        &lt;xsl:with-param name="totalPrice" select="$totalPrice + $currentPrice" /&gt;
        &lt;xsl:with-param name="nodes" select="$nodes" /&gt;
      &lt;/xsl:call-template&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;

&lt;/xsl:template&gt;
</code></pre></div></div>

<p>Simple but a bit messy and nice to have for future cut and paste ;)</p>

      
      <div class="mt-6" />
<div class="flex items-baseline justify-center gap-4">
  <a href="https://www.linkedin.com/in/richardhallgren/">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-linkedin"
    >
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
      <rect width="4" height="12" x="2" y="9" />
      <circle cx="4" cy="4" r="2" />
    </svg>
  </a>
  <a href="mailto:richard@revision.app">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-mail"
    >
      <rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
    </svg>
  </a>
</div>

    </div>
  </body>
</html>
