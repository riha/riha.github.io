<!doctype html>
<html lang="en-US">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>
    Gobbledygooks
    
      &middot; BAM ate my XML declaration!
    
  </title>

  <!-- Sitemap -->
  <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="riha feed" href="http://richardhallgren.com/feed">
</head>

  <body class="bg-bg-yellow flex justify-center font-mono py-4 px-4 post-page">
    <div class="max-w-[750px]">
      <div class="">
        <div class="flex justify-center">
          <a href="/">
            <img
              src="/assets/riha-profile-image.jpeg"
              class="rounded-full w-32 border-profile-border shadow profile-image"
            >
          </a>
        </div>
      </div>
      <div class="my-12"></div>

      <h1>BAM ate my XML declaration!</h1>
      <div class="my-1"></div>
      <div class="text-center text-text-subtle text-sm">May 28, 2009</div>
      <div class=" my-12">
        <p>There are integrations which only purpose is to move a file <em>just as it is</em>. No advanced routing. No orchestration processing. No transformation. Just a simple port-to-port messaging scenario.</p>

<p>It is however still a good idea to monitor these just as one would monitor a more complicated integration. We use BAM to monitor all our integrations and to measure how many messages that has been processed in a integration. Using BAM monitoring in a simple solution as the above however has its issues …</p>

<h3 id="setting-up-a-simple-test-solution">Setting up a simple test solution</h3>

<p><a href="../assets/2009/05/image.png"><img src="../assets/2009/05/image-thumb.png" alt="image" /></a></p>

<ol>
  <li>
    <p>The solution will move a XML file between two port called “SimpleTrackingReceivePort” and “SimpleTrackingSendPort”.</p>
  </li>
  <li>
    <p>Both port have <em>PassThru pipelines configured</em>.</p>
  </li>
  <li>
    <p><em>The XML file does not have a installed schema</em>. Remember we are just moving the file not actually doing anything with it.</p>
  </li>
  <li>
    <p>A BAM tracking definition with one milestone called “StartPort” will be used. This will be mapped to the “PortStartTime” property on both the receiving and sending port .</p>
  </li>
</ol>

<p>Our tracking profile configuration will like below. Dead simple.</p>

<p><a href="../assets/2009/05/image1.png"><img src="../assets/2009/05/image-thumb1.png" alt="image" /></a></p>

<h3 id="so--whats-the-problem">So – what’s the problem?</h3>

<p>Let us drop a XML message looking some like this.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-16"?&gt;
&lt;SimpleTest&gt;
    &lt;SimpleContent Text="This is a test" /&gt;
&lt;/SimpleTest&gt;
</code></pre></div></div>

<p>Remember that there is not a schema installed so we do not really have to worry about the structure of the file. It should just be “a file” to BizTalk and everything should be transferred between the ports. Even if we drop a executable or whatever - it should just be transferred. <strong><em>Nothing should read or examine the file</em></strong> as it’s just a pass thru!</p>

<p><strong><em>As soon as BAM tracking is configured on a port that is however not the case</em></strong>. Lets take a look at the file we receive on the other end of our integration.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;SimpleTest&gt;
    &lt;SimpleContent Text="This is a test" /&gt;
&lt;/SimpleTest&gt;
</code></pre></div></div>

<p><strong><em>BizTalk now removed our XML declaration!</em></strong> Basically it treated the message as a XML message and parsed the message as such while tracking it. It’ will also add the dreaded <a href="http://en.wikipedia.org/wiki/Byte-order_mark">Byte-Order-Mark</a> and fail any non-valid XML messages. The problem is that <strong><em>this is not the behavior what one expects</em></strong> and causes receiving systems that rely on the XML declaration to fail!</p>

<p>As we also don’t have a installed schema it is not possible to use a XMLTransmit pipeline to add the XML declaration and remove the BOM.</p>

<h3 id="what-to-do">What to do?</h3>

<p>If you’d like to track a XML based message using BAM make sure you have the schema installed … Even if you are just using PassThru.</p>

<p>Is it a bug or just something one should expect? In my opinion it is at least <strong><em>very</em></strong> annoying!</p>

      </div>
      <div class="mt-6" />
<div class="flex items-baseline justify-center gap-4">
  <a href="https://www.linkedin.com/in/richardhallgren/">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-linkedin"
    >
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
      <rect width="4" height="12" x="2" y="9" />
      <circle cx="4" cy="4" r="2" />
    </svg>
  </a>
  <a href="mailto:richard@revision.app">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-mail"
    >
      <rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
    </svg>
  </a>
</div>

    </div>
  </body>
</html>
