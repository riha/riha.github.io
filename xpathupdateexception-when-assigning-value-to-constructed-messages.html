<!doctype html>
<html lang="en-US">
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <title>
    Gobbledygooks
    
      &middot; XPathUpdateException when assigning value to constructed messages
    
  </title>

  <!-- Sitemap -->
  <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="riha feed" href="http://richardhallgren.com/feed">
</head>

  <body class="bg-bg-yellow flex justify-center font-mono py-4 px-4 post-page">
    <div class="max-w-[750px]">
      <div class="">
        <div class="flex justify-center">
          <a href="/">
            <img
              src="/assets/riha-profile-image.jpeg"
              class="rounded-full w-32 border-profile-border shadow profile-image"
            >
          </a>
        </div>
      </div>
      <div class="my-12"></div>

      <h1>XPathUpdateException when assigning value to constructed messages</h1>
      <div class="my-1"></div>
      <div class="text-center text-text-subtle text-sm">May 14, 2007</div>
      <div class=" my-12">
        <p>Ever had a “use of unconstructed message” error message in your orchestrations? Then you know that messages has to be constructed before one can use them within orchestrations. Basically messages in orchestrations are created in ports or when executing a map in a construct shape. However there is also the possibility of creating messages in expression shapes using code. Matt Meleski does a great job explain the different approaches in his <em><a href="http://objectsharp.com/cs/blogs/matt/archive/2004/11/09/1009.aspx">Constructing BizTalk 2004 XML Messages (In an Orchestration) - Choices</a></em> blog post_._</p>

<p>However there are some pitfalls when constructing messages from scratch within orchestration (a part from the fact that there really isn’t a clean way of doing it … Scott Colestock has some ideas in <a href="http://www.traceofthought.net/PermaLink,guid,c1164c59-72e2-49e2-be7a-47e4e8dc46d4.aspx">this post</a>).</p>

<p>A common problem is <em>XPathUpdateException</em>. Say one has a mapping that looks like the one below where one node isn’t mapped. <strong>This will create a message without the <em>ElementB</em> element</strong>. This doesn’t have to be in a mapping, it could also happend when constructing a message using code in a expression shape. A common scenario is that we <strong>add code for constructing the bone structure of the XML message</strong>, then change the schema <strong>without updating the construct code. Ergo a message will be constructed without that element</strong> (could be both valid or invalid XML then depending on the <em>Min Occurs</em> value)!</p>

<p><a href="../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping23.jpg">[](../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping23.jpg)</a><a href="../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping61.jpg"><img src="../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2complexmapping-thumb61.jpg" alt="" /></a></p>

<p>When we then try to add a value to the element that hasn’t been created the exception will be thrown!</p>

<p><a href="../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2assignment31.jpg"><img src="../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2assignment-thumb31.jpg" alt="" /></a></p>

<p>One way around when using a map is to make sure to have a default value on every element to force them be constructed. Adding the following to map will make it work.</p>

<p><a href="../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2defaultvalue61.jpg"><img src="../assets/2007/05/windowslivewriterxpa.setdistinguishedfieldwhileassigningv-ceb2defaultvalue-thumb61.jpg" alt="" /></a></p>

<p>It’s a one time mistake but it’s good to know what to look for when the <em>XPathUpdateException in Microsoft.XLANGs.Core.XSDPart.SetDistinguishedField</em> (if it’s a distinguished field that is) shows up in the event log.</p>

      </div>
      <div class="mt-6" />
<div class="flex items-baseline justify-center gap-4">
  <a href="https://www.linkedin.com/in/richardhallgren/">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-linkedin"
    >
      <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
      <rect width="4" height="12" x="2" y="9" />
      <circle cx="4" cy="4" r="2" />
    </svg>
  </a>
  <a href="mailto:richard@revision.app">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="lucide lucide-mail"
    >
      <rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
    </svg>
  </a>
</div>

    </div>
  </body>
</html>
